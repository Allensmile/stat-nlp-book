<!DOCTYPE html>
<!-- saved from url=(0074)http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=120">
        <title>Parsing</title>
        

<script src="../assets/javascripts/jquery-1.9.0.min.js" type="text/javascript"></script>
<link rel="stylesheet" media="screen" href="../assets/stylesheets/normalize.css">

<!-- Moro imports -->
<script src="../assets/javascripts/document.js" type="text/javascript"></script>
<script src="../assets/javascripts/moro.js" type="text/javascript"></script>
<script src="../assets/javascripts/moro-cellconfig.js" type="text/javascript"></script>
<script src="../assets/javascripts/editor.js" type="text/javascript"></script>
<script src="../assets/javascripts/moro-static.js" type="text/javascript"></script>

<link rel="stylesheet" media="screen" href="../assets/stylesheets/moro.css">
<link rel="stylesheet" media="screen" href="../assets/stylesheets/static.css">

<!-- ACE editor -->
<script src="../assets/javascripts/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="../assets/javascripts/ace/ext-language_tools.js" type="text/javascript" charset="utf-8"></script>

<!-- Bootstrap -->
<link href="../assets/javascripts/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
<script src="../assets/javascripts/bootstrap/js/bootstrap.js" type="text/javascript"></script>

<!-- Icons, etc.-->
<link href="../assets/stylesheets/font-awesome/css/font-awesome.min.css" rel="stylesheet">
<link href="../assets/stylesheets/octicons/octicons.css" rel="stylesheet">

<!-- MathJax -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} }, "HTML-CSS": { linebreaks: {automatic: true} } });
</script>
<script type="text/javascript" src="../assets/javascripts/MathJax.js"></script>
<!--script type="text/javascript" src="../assets/javascripts/MathJax-2.5-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script-->

<!-- Highlight.js -->
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/styles/tomorrow.min.css">
<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/highlight.min.js"></script>

<!-- HTMLGEN -->
<script type="text/javascript" src="../assets/javascripts/d3.min.js"></script>
<script type="text/javascript" src="../assets/javascripts/raphael-min.js"></script><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style>
<script type="text/javascript" src="../assets/javascripts/nv.d3.min.js"></script>
<script src="../assets/javascripts/htmlgen/d3utils.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" src="../assets/javascripts/brat/client/lib/head.load.min.js"></script>

<script type="text/javascript" src="../assets/javascripts/dagre-d3.js"></script>

<link href="../assets/stylesheets/nv.d3.css" rel="stylesheet">
<link rel="stylesheet" media="screen" href="../assets/stylesheets/htmlgen.css">

        

<link rel="icon" type="image/x-icon" href="../assets/images/wolfe-logo-black.png">

<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic,900">
<link rel="stylesheet" media="screen" href="../assets/stylesheets/gridism.css">
<link rel="stylesheet" media="screen" href="../assets/stylesheets/normalize.css">
<link rel="stylesheet" media="screen" href="../assets/stylesheets/wolfe.css">

        <link rel="stylesheet" media="screen" href="../assets/stylesheets/statnlpbook.css">
        <link rel="stylesheet" media="screen" href="../assets/stylesheets/statnlpbookScrollReveal.css">

    <script src="../assets/javascripts/ace/snippets/text.js"></script><script src="../assets/javascripts/ace/theme-chaos.js"></script><script src="../assets/javascripts/ace/mode-markdown.js"></script><style id="ace-chaos">.ace-chaos .ace_gutter {background: #141414;color: #595959;border-right: 1px solid #282828;}.ace-chaos .ace_gutter-cell.ace_warning {background-image: none;background: #FC0;border-left: none;padding-left: 0;color: #000;}.ace-chaos .ace_gutter-cell.ace_error {background-position: -6px center;background-image: none;background: #F10;border-left: none;padding-left: 0;color: #000;}.ace-chaos .ace_print-margin {border-left: 1px solid #555;right: 0;background: #1D1D1D;}.ace-chaos {background-color: #161616;color: #E6E1DC;}.ace-chaos .ace_cursor {border-left: 2px solid #FFFFFF;}.ace-chaos .ace_cursor.ace_overwrite {border-left: 0px;border-bottom: 1px solid #FFFFFF;}.ace-chaos .ace_marker-layer .ace_selection {background: #494836;}.ace-chaos .ace_marker-layer .ace_step {background: rgb(198, 219, 174);}.ace-chaos .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid #FCE94F;}.ace-chaos .ace_marker-layer .ace_active-line {background: #333;}.ace-chaos .ace_gutter-active-line {background-color: #222;}.ace-chaos .ace_invisible {color: #404040;}.ace-chaos .ace_keyword {color:#00698F;}.ace-chaos .ace_keyword.ace_operator {color:#FF308F;}.ace-chaos .ace_constant {color:#1EDAFB;}.ace-chaos .ace_constant.ace_language {color:#FDC251;}.ace-chaos .ace_constant.ace_library {color:#8DFF0A;}.ace-chaos .ace_constant.ace_numeric {color:#58C554;}.ace-chaos .ace_invalid {color:#FFFFFF;background-color:#990000;}.ace-chaos .ace_invalid.ace_deprecated {color:#FFFFFF;background-color:#990000;}.ace-chaos .ace_support {color: #999;}.ace-chaos .ace_support.ace_function {color:#00AEEF;}.ace-chaos .ace_function {color:#00AEEF;}.ace-chaos .ace_string {color:#58C554;}.ace-chaos .ace_comment {color:#555;font-style:italic;padding-bottom: 0px;}.ace-chaos .ace_variable {color:#997744;}.ace-chaos .ace_meta.ace_tag {color:#BE53E6;}.ace-chaos .ace_entity.ace_other.ace_attribute-name {color:#FFFF89;}.ace-chaos .ace_markup.ace_underline {text-decoration: underline;}.ace-chaos .ace_fold-widget {text-align: center;}.ace-chaos .ace_fold-widget:hover {color: #777;}.ace-chaos .ace_fold-widget.ace_start,.ace-chaos .ace_fold-widget.ace_end,.ace-chaos .ace_fold-widget.ace_closed{background: none;border: none;box-shadow: none;}.ace-chaos .ace_fold-widget.ace_start:after {content: '▾'}.ace-chaos .ace_fold-widget.ace_end:after {content: '▴'}.ace-chaos .ace_fold-widget.ace_closed:after {content: '‣'}.ace-chaos .ace_indent-guide {border-right:1px dotted #333;margin-right:-1px;}.ace-chaos .ace_fold { background: #222; border-radius: 3px; color: #7AF; border: none; }.ace-chaos .ace_fold:hover {background: #CCC; color: #000;}</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><script src="../assets/javascripts/ace/snippets/markdown.js"></script><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none}
.MathJax .MathJax_EmBox {display: block!important; overflow: hidden; width: 1px; height: 60em; min-height: 0; max-height: none}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Blank; src: url('about:blank')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>
    <body class="wrap" style="zoom: 1;"><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div>
        <header>
            <nav class="mobile-nav show-on-mobiles">
                    <!--{% include primary-nav-items.html %}-->
            </nav>
            <div class="grid">
                <div class="center-on-mobiles">
                    <h1>
                        <a href="../00_intro.html">
                            <h1 class="logo-text">StatNLP</h1>
                        </a>
                    </h1>
                    [<a id="toggle-view" href="../01_tasks/0x_parsing.html">Text</a>]
                </div>
            </div>
        </header>
        <section>
            <div class="grid">
                <div>
                
                    
                
                    
                
                    
                
                    
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; /&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" role="math" style="width: 0.002em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.002em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(3.867em 1000em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mrow" id="MathJax-Span-2"></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"></math></span></span><script type="math/tex" id="MathJax-Element-1">
  \def\prob{p}
  \def\vocab{V}
  \def\params{\boldsymbol{\theta}}
  \def\argmax{\mathop{\arg\,\max}}
  \def\param{\theta}
  \def\bpi{\boldsymbol{\pi}}
  \def\balpha{\boldsymbol{\alpha}}
  \def\bbeta{\boldsymbol{\beta}}
  \def\perplexity{PP}
  \def\x{\mathbf{x}}
  \def\y{\mathbf{y}}
  \def\Xs{\mathcal{X}}
  \def\Ys{\mathcal{Y}}
  \def\perplexity{PP}
  \def\train{\mathcal{D}_\mathit{train}}
  \def\counts#1#2{\#_{#1}(#2)}
  \def\RR{\bf R}
  \def\length#1{\mathop{length}(#1)}
  \def\aligns{\mathbf{a}}
  \def\align{a}
  \def\source{\mathbf{s}}
  \def\ssource{s}
  \def\target{\mathbf{t}}
  \def\starget{t}
</script>
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                </div>
                <div id="static_content" class="unit center-on-mobiles">
                    <h1>Parsing</h1>
                <div id="cell0" class="cellWrapper"><div id="editCell0" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor0" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode0" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay0" class="cell"><div class="newslide"></div><div class="slideStart" id="slide0"></div><p><span class="summary">Based on Mike Collins <a href="http://www.cs.columbia.edu/~mcollins/courses/nlp2011/notes/pcfgs.pdf">Lecture</a>.</span></p>
<div class="newslide"></div><div class="slideStart" id="slide1"></div><p><span class="summary">It is useful to understand the syntactic structure of a sentence: where are the <em>verbs</em>, what are the <em>subject</em> and <em>object</em> of the verbs, which <em>phrases</em> form coherent <em>sub-structures</em>?</span></p>
<div class="newslide"></div><div class="slideStart" id="slide2"></div><p>In linguistics these questions are asked in the field of <strong>syntax</strong>, from the Greek syntaxis (arrangement). There are three core concepts:</p>
<ul>
  <li><strong>Constituency</strong>: groups of words act as single units.</li>
  <li><strong>Grammatical Relations</strong>: object, subject, direct object etc.</li>
  <li><strong>Subcategorization</strong>: restrictions on the type of phrases that go with certain words.</li>
</ul>
<div class="newslide"></div><div class="slideStart" id="slide3"></div><h3>Context Free Grammars</h3><p><span class="summary">Context Free Grammars define rules that expand ...</span></p>
<div class="newslide"></div><div class="slideStart" id="slide4"></div><p>More formally, a CFG is a 4-tuple <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x03A3;&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-3" role="math" style="width: 7.479em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.494em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.798em 1006.46em 2.764em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-4"><span class="mi" id="MathJax-Span-5" style="font-family: STIXGeneral-Italic;">G</span><span class="mo" id="MathJax-Span-6" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">=</span><span class="mo" id="MathJax-Span-7" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">(</span><span class="mi" id="MathJax-Span-8" style="font-family: STIXGeneral-Italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.059em;"></span></span><span class="mo" id="MathJax-Span-9" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-10" style="font-family: STIXGeneral-Regular; padding-left: 0.194em;">Σ</span><span class="mo" id="MathJax-Span-11" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-12" style="font-family: STIXGeneral-Italic; padding-left: 0.194em;">R</span><span class="mo" id="MathJax-Span-13" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-14" style="font-family: STIXGeneral-Italic; padding-left: 0.194em;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mo" id="MathJax-Span-15" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.221em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.023em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo>=</mo><mo stretchy="false">(</mo><mi>N</mi><mo>,</mo><mi mathvariant="normal">Σ</mi><mo>,</mo><mi>R</mi><mo>,</mo><mi>S</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-2">G=(N,\Sigma,R,S)</script> where</p>
<ul>
  <li><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-16" role="math" style="width: 0.851em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.735em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.817em 1000.74em 2.61em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-17"><span class="mi" id="MathJax-Span-18" style="font-family: STIXGeneral-Italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.059em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.043em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.823em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-3">N</script> is a set of <em>non-terminal symbols</em>.</li>
  <li><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x03A3;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-19" role="math" style="width: 0.735em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.639em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.817em 1000.62em 2.59em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-20"><span class="mi" id="MathJax-Span-21" style="font-family: STIXGeneral-Regular;">Σ</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.021em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.801em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="normal">Σ</mi></math></span></span><script type="math/tex" id="MathJax-Element-4">\Sigma</script> is a set of <em>terminal symbols</em>.</li>
  <li><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-22" role="math" style="width: 0.716em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.619em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.817em 1000.6em 2.59em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-23"><span class="mi" id="MathJax-Span-24" style="font-family: STIXGeneral-Italic;">R</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.021em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.801em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi></math></span></span><script type="math/tex" id="MathJax-Element-5">R</script> is a finite set of <em>rules</em> <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;Y&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;Y&lt;/mi&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;Y&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-25" role="math" style="width: 7.537em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.552em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.817em 1006.55em 2.745em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-26"><span class="mi" id="MathJax-Span-27" style="font-family: STIXGeneral-Italic;">X<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.04em;"></span></span><span class="mo" id="MathJax-Span-28" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">→</span><span class="msubsup" id="MathJax-Span-29" style="padding-left: 0.31em;"><span style="display: inline-block; position: relative; width: 0.986em; height: 0px;"><span style="position: absolute; clip: rect(3.286em 1000.64em 4.059em -999.999em); top: -3.999em; left: 0.001em;"><span class="mi" id="MathJax-Span-30" style="font-family: STIXGeneral-Italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.078em;"></span></span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span><span style="position: absolute; top: -3.844em; left: 0.561em;"><span class="mn" id="MathJax-Span-31" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-32"><span style="display: inline-block; position: relative; width: 0.986em; height: 0px;"><span style="position: absolute; clip: rect(3.286em 1000.64em 4.059em -999.999em); top: -3.999em; left: 0.001em;"><span class="mi" id="MathJax-Span-33" style="font-family: STIXGeneral-Italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.078em;"></span></span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span><span style="position: absolute; top: -3.844em; left: 0.561em;"><span class="mn" id="MathJax-Span-34" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">2</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span></span></span><span class="mo" id="MathJax-Span-35" style="font-family: STIXGeneral-Regular; padding-left: 0.194em;">…</span><span class="msubsup" id="MathJax-Span-36" style="padding-left: 0.194em;"><span style="display: inline-block; position: relative; width: 0.986em; height: 0px;"><span style="position: absolute; clip: rect(3.286em 1000.64em 4.059em -999.999em); top: -3.999em; left: 0.001em;"><span class="mi" id="MathJax-Span-37" style="font-family: STIXGeneral-Italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.078em;"></span></span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span><span style="position: absolute; top: -3.844em; left: 0.561em;"><span class="mi" id="MathJax-Span-38" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">n</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.199em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.979em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi><mo stretchy="false">→</mo><msub><mi>Y</mi><mn>1</mn></msub><msub><mi>Y</mi><mn>2</mn></msub><mo>…</mo><msub><mi>Y</mi><mi>n</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-6">X \rightarrow Y_1 Y_2\ldots Y_n</script> where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;X&lt;/mi&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-39" role="math" style="width: 3.093em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.687em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.817em 1002.69em 2.61em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-40"><span class="mi" id="MathJax-Span-41" style="font-family: STIXGeneral-Italic;">X<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.04em;"></span></span><span class="mo" id="MathJax-Span-42" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">∈</span><span class="mi" id="MathJax-Span-43" style="font-family: STIXGeneral-Italic; padding-left: 0.31em;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.059em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.043em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.823em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>X</mi><mo>∈</mo><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-7">X \in N</script> and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;Y&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo&gt;&amp;#x222A;&lt;/mo&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x03A3;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-44" role="math" style="width: 5.315em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.619em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.817em 1004.6em 2.745em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-45"><span class="msubsup" id="MathJax-Span-46"><span style="display: inline-block; position: relative; width: 0.832em; height: 0px;"><span style="position: absolute; clip: rect(3.286em 1000.64em 4.059em -999.999em); top: -3.999em; left: 0.001em;"><span class="mi" id="MathJax-Span-47" style="font-family: STIXGeneral-Italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.078em;"></span></span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span><span style="position: absolute; top: -3.844em; left: 0.561em;"><span class="mi" id="MathJax-Span-48" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span></span></span><span class="mo" id="MathJax-Span-49" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">∈</span><span class="mi" id="MathJax-Span-50" style="font-family: STIXGeneral-Italic; padding-left: 0.31em;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.059em;"></span></span><span class="mo" id="MathJax-Span-51" style="font-family: STIXGeneral-Regular; padding-left: 0.252em;">∪</span><span class="mi" id="MathJax-Span-52" style="font-family: STIXGeneral-Regular; padding-left: 0.252em;">Σ</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.199em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.979em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>Y</mi><mi>i</mi></msub><mo>∈</mo><mi>N</mi><mo>∪</mo><mi mathvariant="normal">Σ</mi></math></span></span><script type="math/tex" id="MathJax-Element-8">Y_i \in N \cup \Sigma</script>.</li>
  <li><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-53" role="math" style="width: 2.919em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.532em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.798em 1002.53em 2.61em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-54"><span class="mi" id="MathJax-Span-55" style="font-family: STIXGeneral-Italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mo" id="MathJax-Span-56" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">∈</span><span class="mi" id="MathJax-Span-57" style="font-family: STIXGeneral-Italic; padding-left: 0.31em;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.059em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.043em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.846em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>S</mi><mo>∈</mo><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-9">S \in N</script> is a <em>start symbol</em>.</li>
</ul>
<div class="newslide"></div><div class="slideStart" id="slide5"></div><p>Before we show examples, let us define a scala data structure for PCFGs.</p></div></div><div id="cell1" class="cellWrapper"><div id="editCell1" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor1" class="cell editor ace_editor ace-chaos ace_dark" style="height: 228px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 26px; width: 11.4019px; left: 60.4019px; top: 192px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 280px; width: 45px;"><div class="ace_gutter-cell " style="height: 26px;">1</div><div class="ace_gutter-cell " style="height: 26px;">2</div><div class="ace_gutter-cell " style="height: 26px;">3</div><div class="ace_gutter-cell " style="height: 26px;">4</div><div class="ace_gutter-cell " style="height: 26px;">5</div><div class="ace_gutter-cell " style="height: 26px;">6</div><div class="ace_gutter-cell " style="height: 26px;">7</div><div class="ace_gutter-cell " style="height: 26px;">8</div></div><div class="ace_gutter-active-line" style="top: 192px; height: 26px;"></div></div><div class="ace_scroller" style="left: 45px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 1051px; height: 280px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 916.15px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_comment">//&nbsp;sealed&nbsp;trait&nbsp;can&nbsp;be&nbsp;extended&nbsp;only&nbsp;in&nbsp;the&nbsp;same&nbsp;file</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">sealed</span>&nbsp;<span class="ace_keyword">trait</span>&nbsp;<span class="ace_identifier">RHS</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_comment">//&nbsp;Symbol&nbsp;represents&nbsp;a&nbsp;closed&nbsp;set&nbsp;of&nbsp;identifiers&nbsp;enabling&nbsp;quick&nbsp;comparison</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">case</span>&nbsp;<span class="ace_keyword">class</span>&nbsp;<span class="ace_identifier">NonTerminal</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">name</span>:<span class="ace_identifier">Symbol</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword">extends</span>&nbsp;<span class="ace_identifier">RHS</span>&nbsp;</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">case</span>&nbsp;<span class="ace_keyword">class</span>&nbsp;<span class="ace_identifier">Terminal</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">name</span>:<span class="ace_support ace_function">String</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword">extends</span>&nbsp;<span class="ace_identifier">RHS</span>&nbsp;</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">case</span>&nbsp;<span class="ace_keyword">class</span>&nbsp;<span class="ace_identifier">Rule</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">lhs</span>:<span class="ace_identifier">NonTerminal</span>,<span class="ace_identifier">rhs</span>:<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">RHS</span><span class="ace_paren ace_rparen">])</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">case</span>&nbsp;<span class="ace_keyword">class</span>&nbsp;<span class="ace_identifier">CFG</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">N</span>:<span class="ace_identifier">Set</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">NonTerminal</span><span class="ace_paren ace_rparen">]</span>,<span class="ace_identifier">Sigma</span>:<span class="ace_identifier">Set</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">Terminal</span><span class="ace_paren ace_rparen">]</span>,<span class="ace_identifier">R</span>:<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">Rule</span><span class="ace_paren ace_rparen">]</span>,<span class="ace_identifier">S</span>:<span class="ace_identifier">NonTerminal</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_constant ace_numeric">1</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 15.4019px; top: 182px; width: 11.4019px; height: 26px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 228px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 45px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 1051px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode1" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay1" class="cell"><div class="string-result"><span class="asString String">1</span></div></div></div><div id="cell2" class="cellWrapper"><div id="editCell2" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor2" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode2" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay2" class="cell"><div class="newslide"></div><div class="slideStart" id="slide6"></div><p><span class="summary">Let us now create an example CFG</span></p></div></div><div id="cell3" class="cellWrapper" hidden="true"><div id="editCell3" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor3" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode3" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay3" class="cell" style="display: none;"><div class="text-center"><i class="fa fa-refresh fa-spin fa-lg"></i></div></div></div><div id="cell4" class="cellWrapper"><div id="editCell4" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor4" class="cell editor ace_editor ace-chaos ace_dark" style="height: 254px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 26px; width: 11.4019px; left: 105.608px; top: 218px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 306px; width: 56px;"><div class="ace_gutter-cell " style="height: 26px;">1</div><div class="ace_gutter-cell " style="height: 26px;">2</div><div class="ace_gutter-cell " style="height: 26px;">3</div><div class="ace_gutter-cell " style="height: 26px;">4</div><div class="ace_gutter-cell " style="height: 26px;">5</div><div class="ace_gutter-cell " style="height: 26px;">6</div><div class="ace_gutter-cell " style="height: 26px;">7</div><div class="ace_gutter-cell " style="height: 26px;">8</div><div class="ace_gutter-cell " style="height: 26px;">9</div></div><div class="ace_gutter-active-line" style="top: 218px; height: 26px;"></div></div><div class="ace_scroller" style="left: 56px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 1040px; height: 306px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 916.15px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_comment">//&nbsp;def&nbsp;cfgFromRules(start:NonTerminal,&nbsp;rules:Rule*)</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">cfg</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">cfgFromRules</span><span class="ace_paren ace_lparen">(</span><span class="ace_symbol ace_constant">'S</span>,</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_symbol ace_constant">'S</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_symbol ace_constant">'NP_p</span>,<span class="ace_symbol ace_constant">'VP_p</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_symbol ace_constant">'S</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_symbol ace_constant">'NP_s</span>,&nbsp;<span class="ace_symbol ace_constant">'VP_s</span><span class="ace_paren ace_rparen">)</span>,&nbsp;&nbsp;&nbsp;</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_symbol ace_constant">'NP_p</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"Matko"</span>,<span class="ace_string">"raps"</span><span class="ace_paren ace_rparen">)</span>,</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_symbol ace_constant">'VP_p</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"are"</span>,&nbsp;<span class="ace_symbol ace_constant">'ADJ</span><span class="ace_paren ace_rparen">)</span>,</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_symbol ace_constant">'NP_s</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"Matko"</span><span class="ace_paren ace_rparen">)</span>,</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_symbol ace_constant">'VP_s</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"raps"</span>,&nbsp;<span class="ace_string">"in"</span>,&nbsp;<span class="ace_string">"StatNLP"</span><span class="ace_paren ace_rparen">)</span>,</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_symbol ace_constant">'ADJ</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_string">"silly"</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_identifier">cfg</span>&nbsp;</div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 49.6075px; top: 208px; width: 11.4019px; height: 26px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 254px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 56px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 1040px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode4" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay4" class="cell"><div class="string-result"><table> <tbody><tr> <td> 'S </td><td> 'NP_s 'VP_s </td> </tr><tr> <td> 'S </td><td> 'NP_p 'VP_p </td> </tr><tr> <td> 'ADJ </td><td> silly </td> </tr><tr> <td> 'NP_p </td><td> Matko raps </td> </tr><tr> <td> 'NP_s </td><td> Matko </td> </tr><tr> <td> 'VP_p </td><td> are 'ADJ </td> </tr><tr> <td> 'VP_s </td><td> raps in StatNLP </td> </tr> </tbody></table></div></div></div><div id="cell5" class="cellWrapper"><div id="editCell5" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor5" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode5" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay5" class="cell"><div class="newslide"></div><div class="slideStart" id="slide7"></div><h3>(Left-most) Derivation</h3><p>A left-most derivation given a CFG <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-58" role="math" style="width: 0.851em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.735em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.817em 1000.74em 2.61em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-59"><span class="mi" id="MathJax-Span-60" style="font-family: STIXGeneral-Italic;">G</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.043em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.823em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi></math></span></span><script type="math/tex" id="MathJax-Element-10">G</script> is a sequence of strings <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-61" role="math" style="width: 3.479em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.015em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(2.03em 1003.01em 2.745em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-62"><span class="msubsup" id="MathJax-Span-63"><span style="display: inline-block; position: relative; width: 0.813em; height: 0px;"><span style="position: absolute; clip: rect(3.499em 1000.37em 4.078em -999.999em); top: -3.999em; left: 0.001em;"><span class="mi" id="MathJax-Span-64" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span><span style="position: absolute; top: -3.844em; left: 0.387em;"><span class="mn" id="MathJax-Span-65" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span></span></span><span class="mo" id="MathJax-Span-66" style="font-family: STIXGeneral-Regular; padding-left: 0.194em;">…</span><span class="msubsup" id="MathJax-Span-67" style="padding-left: 0.194em;"><span style="display: inline-block; position: relative; width: 0.813em; height: 0px;"><span style="position: absolute; clip: rect(3.499em 1000.37em 4.078em -999.999em); top: -3.999em; left: 0.001em;"><span class="mi" id="MathJax-Span-68" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span><span style="position: absolute; top: -3.844em; left: 0.387em;"><span class="mi" id="MathJax-Span-69" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">n</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.199em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.734em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>s</mi><mn>1</mn></msub><mo>…</mo><msub><mi>s</mi><mi>n</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-11">s_1 \ldots s_n</script> such that </p>
<ul>
  <li><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-70" role="math" style="width: 3.035em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.629em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.798em 1002.63em 2.745em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-71"><span class="msubsup" id="MathJax-Span-72"><span style="display: inline-block; position: relative; width: 0.813em; height: 0px;"><span style="position: absolute; clip: rect(3.499em 1000.37em 4.078em -999.999em); top: -3.999em; left: 0.001em;"><span class="mi" id="MathJax-Span-73" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span><span style="position: absolute; top: -3.844em; left: 0.387em;"><span class="mn" id="MathJax-Span-74" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span></span></span><span class="mo" id="MathJax-Span-75" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">=</span><span class="mi" id="MathJax-Span-76" style="font-family: STIXGeneral-Italic; padding-left: 0.31em;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.199em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.979em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>s</mi><mn>1</mn></msub><mo>=</mo><mi>S</mi></math></span></span><script type="math/tex" id="MathJax-Element-12">s_1 = S</script>, that is, the first string consists only of the start symbol.</li>
  <li><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x03A3;&lt;/mi&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-77" role="math" style="width: 3.672em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.189em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.779em 1003.19em 2.745em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-78"><span class="msubsup" id="MathJax-Span-79"><span style="display: inline-block; position: relative; width: 0.813em; height: 0px;"><span style="position: absolute; clip: rect(3.499em 1000.37em 4.078em -999.999em); top: -3.999em; left: 0.001em;"><span class="mi" id="MathJax-Span-80" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span><span style="position: absolute; top: -3.844em; left: 0.387em;"><span class="mi" id="MathJax-Span-81" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">n</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span></span></span><span class="mo" id="MathJax-Span-82" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">∈</span><span class="msubsup" id="MathJax-Span-83" style="padding-left: 0.31em;"><span style="display: inline-block; position: relative; width: 1.064em; height: 0px;"><span style="position: absolute; clip: rect(3.286em 1000.6em 4.059em -999.999em); top: -3.999em; left: 0.001em;"><span class="mi" id="MathJax-Span-84" style="font-family: STIXGeneral-Regular;">Σ</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span><span style="position: absolute; top: -4.366em; left: 0.619em;"><span class="mo" id="MathJax-Span-85" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">∗</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.199em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.023em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>s</mi><mi>n</mi></msub><mo>∈</mo><msup><mi mathvariant="normal">Σ</mi><mo>∗</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-13">s_n \in \Sigma^*</script>, that is, the last string consists of only terminals.</li>
  <li>Each <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-86" role="math" style="width: 0.793em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.677em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.701em 1000.68em 2.416em -999.999em); top: -2.202em; left: 0.001em;"><span class="mrow" id="MathJax-Span-87"><span class="msubsup" id="MathJax-Span-88"><span style="display: inline-block; position: relative; width: 0.658em; height: 0px;"><span style="position: absolute; clip: rect(3.499em 1000.37em 4.078em -999.999em); top: -3.999em; left: 0.001em;"><span class="mi" id="MathJax-Span-89" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span><span style="position: absolute; top: -3.844em; left: 0.387em;"><span class="mi" id="MathJax-Span-90" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.204em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.199em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.734em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>s</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-14">s_i</script> for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;gt;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-91" role="math" style="width: 2.397em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.088em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.798em 1001.99em 2.61em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-92"><span class="mi" id="MathJax-Span-93" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-94" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">&gt;</span><span class="mn" id="MathJax-Span-95" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.043em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.846em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mo>&gt;</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-15">i > 1</script> is generated by replacing the left-most non-terminal <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-96" role="math" style="width: 0.658em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.561em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(2.03em 1000.56em 2.61em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-97"><span class="mi" id="MathJax-Span-98" style="font-family: STIXGeneral-Italic;">α</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.043em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.557em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi></math></span></span><script type="math/tex" id="MathJax-Element-16">\alpha</script> with the right-hand side of any rule that has <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-99" role="math" style="width: 0.658em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.561em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(2.03em 1000.56em 2.61em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-100"><span class="mi" id="MathJax-Span-101" style="font-family: STIXGeneral-Italic;">α</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.043em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.557em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi></math></span></span><script type="math/tex" id="MathJax-Element-17">\alpha</script> as left-hand side.</li>
</ul>
<div class="newslide"></div><div class="slideStart" id="slide8"></div><p>Let us write some code that puts this definition into action and generates random derivations based on a grammar. </p></div></div><div id="cell6" class="cellWrapper"><div id="editCell6" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor6" class="cell editor ace_editor ace-chaos ace_dark" style="height: 488px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 26px; width: 11.4019px; left: 94.2056px; top: 452px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 540px; width: 56px;"><div class="ace_gutter-cell " style="height: 26px;">1</div><div class="ace_gutter-cell " style="height: 26px;">2</div><div class="ace_gutter-cell " style="height: 26px;">3</div><div class="ace_gutter-cell " style="height: 52px;">4</div><div class="ace_gutter-cell " style="height: 26px;">5</div><div class="ace_gutter-cell " style="height: 26px;">6<span class="ace_fold-widget ace_start ace_open" style="height: 26px;"></span></div><div class="ace_gutter-cell " style="height: 26px;">7</div><div class="ace_gutter-cell " style="height: 52px;">8</div><div class="ace_gutter-cell " style="height: 52px;">9</div><div class="ace_gutter-cell " style="height: 52px;">10</div><div class="ace_gutter-cell " style="height: 26px;">11</div><div class="ace_gutter-cell " style="height: 26px;">12</div><div class="ace_gutter-cell " style="height: 26px;">13</div><div class="ace_gutter-cell " style="height: 26px;">14</div></div><div class="ace_gutter-active-line" style="top: 452px; height: 26px;"></div></div><div class="ace_scroller" style="left: 56px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 1040px; height: 540px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 916.15px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"><div class="ace_bracket ace_start" style="height:26px;width:11.401875px;top:156px;left:881.944375px;"></div></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">import</span>&nbsp;<span class="ace_identifier">scala</span>.<span class="ace_identifier">collection</span>.<span class="ace_identifier">mutable</span>.<span class="ace_paren ace_lparen">{</span><span class="ace_identifier">ArrayBuffer</span>,<span class="ace_identifier">ListBuffer</span><span class="ace_paren ace_rparen">}</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">rand</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_keyword">new</span>&nbsp;<span class="ace_identifier">scala</span>.<span class="ace_identifier">util</span>.<span class="ace_identifier">Random</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_comment">//&nbsp;0&nbsp;is&nbsp;the&nbsp;seed</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">@<span class="ace_identifier">scala</span>.<span class="ace_identifier">annotation</span>.<span class="ace_identifier">tailrec</span>&nbsp;<span class="ace_comment">//annotation&nbsp;that&nbsp;ensures&nbsp;tail&nbsp;recursive&nbsp;optimization</span></div></div><div class="ace_line_group" style="height:52px"><div class="ace_line" style="height:26px"><span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">generateDeriv</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">cfg</span>:&nbsp;<span class="ace_identifier">CFG</span>,&nbsp;<span class="ace_identifier">sentence</span>:<span class="ace_support ace_function">Seq</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">RHS</span><span class="ace_paren ace_rparen">]</span>,&nbsp;<span class="ace_identifier">result</span>:<span class="ace_support ace_function">Seq</span><span class="ace_paren ace_lparen">[</span><span class="ace_support ace_function">Seq</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">RHS</span><span class="ace_paren ace_rparen">]]</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_support ace_function">Seq</span>.<span class="ace_identifier">empty</span><span class="ace_paren ace_rparen">)</span>:<span class="ace_support ace_function">Seq</span><span class="ace_paren ace_lparen">[</span><span class="ace_support ace_function">Seq</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">R</span></div><div class="ace_line" style="height:26px"><span class="ace_identifier">HS</span><span class="ace_paren ace_rparen">]]</span>&nbsp;<span class="ace_keyword ace_operator">=</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_comment">//&nbsp;finds&nbsp;the&nbsp;first&nbsp;element&nbsp;of&nbsp;the&nbsp;sentence&nbsp;which&nbsp;is&nbsp;a&nbsp;NonTerminal&nbsp;symbol</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_identifier">sentence</span>.<span class="ace_identifier">zipWithIndex</span>.<span class="ace_identifier">collectFirst</span>&nbsp;<span class="ace_paren ace_lparen">{</span>&nbsp;<span class="ace_keyword">case</span>&nbsp;<span class="ace_identifier">r</span>@<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">n</span>:<span class="ace_identifier">NonTerminal</span>,<span class="ace_identifier">_</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_identifier">r</span>&nbsp;<span class="ace_paren ace_rparen">}</span>&nbsp;<span class="ace_keyword">match</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">case</span>&nbsp;<span class="ace_identifier">Some</span><span class="ace_paren ace_lparen">((</span><span class="ace_identifier">n</span>,<span class="ace_identifier">index</span><span class="ace_paren ace_rparen">))</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;for&nbsp;an&nbsp;element&nbsp;that's&nbsp;a&nbsp;NonTerminal&nbsp;symbol</span></div></div><div class="ace_line_group" style="height:52px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">rules</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;&nbsp;<span class="ace_identifier">cfg</span>.<span class="ace_identifier">R</span>.<span class="ace_identifier">filter</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">lhs</span>&nbsp;<span class="ace_keyword ace_operator">==</span>&nbsp;<span class="ace_identifier">n</span><span class="ace_paren ace_rparen">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;find&nbsp;all&nbsp;rules&nbsp;whose&nbsp;lhs&nbsp;is&nbsp;</span></div><div class="ace_line" style="height:26px"><span class="ace_comment">that&nbsp;symbol</span></div></div><div class="ace_line_group" style="height:52px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">sampled</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">rules</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">rand</span>.<span class="ace_identifier">nextInt</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">rules</span>.<span class="ace_identifier">length</span><span class="ace_paren ace_rparen">))</span>&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;randomly&nbsp;pick&nbsp;one&nbsp;rule&nbsp;out&nbsp;of&nbsp;</span></div><div class="ace_line" style="height:26px"><span class="ace_comment">them</span></div></div><div class="ace_line_group" style="height:52px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">next</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">sentence</span>.<span class="ace_identifier">patch</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">index</span>,<span class="ace_identifier">sampled</span>.<span class="ace_identifier">rhs</span>,<span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;replace&nbsp;that&nbsp;element&nbsp;with&nbsp;the&nbsp;</span></div><div class="ace_line" style="height:26px"><span class="ace_comment">rule's&nbsp;rhs</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_identifier">generateDeriv</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">cfg</span>,&nbsp;<span class="ace_identifier">next</span>,&nbsp;<span class="ace_identifier">result</span>.<span class="ace_identifier">get</span>&nbsp;:<span class="ace_keyword ace_operator">+</span>&nbsp;<span class="ace_identifier">next</span><span class="ace_paren ace_rparen">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;recursively&nbsp;repeat&nbsp;again</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;didn't&nbsp;find&nbsp;such&nbsp;rule</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">case</span>&nbsp;<span class="ace_identifier">None</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_identifier">result</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;no&nbsp;NonTerminal&nbsp;symbols&nbsp;to&nbsp;expand</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 38.2056px; top: 442px; width: 11.4019px; height: 26px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 488px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 56px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 1040px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode6" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay6" class="cell" style="display: none;"><div class="text-center"><i class="fa fa-refresh fa-spin fa-lg"></i></div></div></div><div id="cell7" class="cellWrapper"><div id="editCell7" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor7" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode7" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay7" class="cell"><div class="newslide"></div><div class="slideStart" id="slide9"></div><p>Let us generate an example derivation.</p></div></div><div id="cell8" class="cellWrapper"><div id="editCell8" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor8" class="cell editor ace_editor ace-chaos ace_dark" style="height: 46px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 26px; width: 11.4019px; left: 391.056px; top: 10px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 98px; width: 45px;"><div class="ace_gutter-cell " style="height: 26px;">1</div></div><div class="ace_gutter-active-line" style="top: 10px; height: 26px;"></div></div><div class="ace_scroller" style="left: 45px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 1051px; height: 98px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 916.15px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_identifier">generateDeriv</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">cfg</span>,<span class="ace_support ace_function">Seq</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">cfg</span>.<span class="ace_identifier">S</span><span class="ace_paren ace_rparen">))</span>&nbsp;</div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 346.056px; top: 0px; width: 11.4019px; height: 26px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 46px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 45px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 1051px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode8" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay8" class="cell"><div class="string-result"><table> <tbody><tr> <td> 'NP_s 'VP_s </td> </tr><tr> <td> Matko 'VP_s </td> </tr><tr> <td> Matko raps in StatNLP </td> </tr> </tbody></table></div></div></div><div id="cell9" class="cellWrapper"><div id="editCell9" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor9" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode9" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay9" class="cell"><div class="newslide"></div><div class="slideStart" id="slide10"></div><h3>Parse Trees</h3><p><span class="summary">Derivations can be compactly present as trees where each non-leaf node corresponds to an expanded left-hand-side and its children to the rules' right hand side.</span></p>
<div class="newslide"></div><div class="slideStart" id="slide11"></div><p><span class="summary">A scala data structure to represent trees</span></p></div></div><div id="cell10" class="cellWrapper"><div id="editCell10" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor10" class="cell editor ace_editor ace-chaos ace_dark" style="height: 98px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 26px; width: 11.4019px; left: 596.29px; top: 62px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 150px; width: 45px;"><div class="ace_gutter-cell " style="height: 26px;">1</div><div class="ace_gutter-cell " style="height: 26px;">2</div><div class="ace_gutter-cell " style="height: 26px;">3</div></div><div class="ace_gutter-active-line" style="top: 62px; height: 26px;"></div></div><div class="ace_scroller" style="left: 45px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 1051px; height: 150px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 916.15px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">sealed</span>&nbsp;<span class="ace_keyword">trait</span>&nbsp;<span class="ace_identifier">ParseTree</span>&nbsp;<span class="ace_paren ace_lparen">{</span>&nbsp;<span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">node</span>:&nbsp;<span class="ace_identifier">RHS</span><span class="ace_paren ace_rparen">}</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">case</span>&nbsp;<span class="ace_keyword">class</span>&nbsp;<span class="ace_identifier">Node</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">node</span>:<span class="ace_identifier">NonTerminal</span>,&nbsp;<span class="ace_identifier">children</span>:<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">ParseTree</span><span class="ace_paren ace_rparen">])</span>&nbsp;<span class="ace_keyword">extends</span>&nbsp;<span class="ace_identifier">ParseTree</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">case</span>&nbsp;<span class="ace_keyword">class</span>&nbsp;<span class="ace_identifier">Leaf</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">node</span>:<span class="ace_identifier">Terminal</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword">extends</span>&nbsp;<span class="ace_identifier">ParseTree</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 551.29px; top: 52px; width: 11.4019px; height: 26px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 98px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 45px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 1051px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode10" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay10" class="cell" style="display: none;"><div class="text-center"><i class="fa fa-refresh fa-spin fa-lg"></i></div></div></div><div id="cell11" class="cellWrapper" hidden="true"><div id="editCell11" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor11" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode11" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay11" class="cell" style="display: none;"><div class="text-center"><i class="fa fa-refresh fa-spin fa-lg"></i></div></div></div><div id="cell12" class="cellWrapper"><div id="editCell12" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor12" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode12" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay12" class="cell"><p>We can construct trees through parse the usual case class constructors, and render them graphically.</p></div></div><div id="cell13" class="cellWrapper"><div id="editCell13" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor13" class="cell editor ace_editor ace-chaos ace_dark" style="height: 72px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 26px; width: 11.4019px; left: 733.113px; top: 36px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 124px; width: 45px;"><div class="ace_gutter-cell " style="height: 26px;">1</div><div class="ace_gutter-cell " style="height: 26px;">2</div></div><div class="ace_gutter-active-line" style="top: 36px; height: 26px;"></div></div><div class="ace_scroller" style="left: 45px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 1051px; height: 124px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 916.15px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"><div class="ace_bracket ace_start" style="height:26px;width:11.401875px;top:0px;left:49.6075px;"></div></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_identifier">Node</span><span class="ace_paren ace_lparen">(</span><span class="ace_symbol ace_constant">'S</span>,&nbsp;<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Node</span><span class="ace_paren ace_lparen">(</span><span class="ace_symbol ace_constant">'NP_p</span>,&nbsp;<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Leaf</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"Matko"</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_identifier">Leaf</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"raps"</span><span class="ace_paren ace_rparen">)))</span>,</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_identifier">Node</span><span class="ace_paren ace_lparen">(</span><span class="ace_symbol ace_constant">'VP_p</span>,<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Leaf</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"are"</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_identifier">Leaf</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"silly"</span><span class="ace_paren ace_rparen">)))))</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 688.113px; top: 26px; width: 11.4019px; height: 26px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 72px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 45px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 1051px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode13" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay13" class="cell"><div class="string-result"><div id="parseTreea513359e-bf83-451f-bfa7-14af322b1f51" class="parseTree">
<svg height="291"><g><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M227.9296875,37.97290764904742L128.44140625,77L128.44140625,97" marker-end="url(../01_tasks/0x_parsing.html#arrowhead16)" style="fill: none;"></path><defs><marker id="arrowhead16" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M276.2265625,37.081441941669766L388.55859375,77L388.55859375,97" marker-end="url(../01_tasks/0x_parsing.html#arrowhead17)" style="fill: none;"></path><defs><marker id="arrowhead17" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M85.24379832474227,154L54.9296875,174L54.9296875,194" marker-end="url(../01_tasks/0x_parsing.html#arrowhead18)" style="fill: none;"></path><defs><marker id="arrowhead18" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M171.63901417525773,154L201.953125,174L201.953125,194" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead19)" style="fill: none;"></path><defs><marker id="arrowhead19" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M352.90834407216494,154L327.890625,174L327.890625,194" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead20)" style="fill: none;"></path><defs><marker id="arrowhead20" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M424.20884342783506,154L449.2265625,174L449.2265625,194" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead21)" style="fill: none;"></path><defs><marker id="arrowhead21" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g></g><g class="nodes"><g class="node nonterminal" transform="translate(252.078125,28.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-24.1484375" y="-28.5" width="48.296875" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-14.1484375,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'S</tspan></text></g></g></g><g class="node nonterminal" transform="translate(128.44140625,125.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-54.421875" y="-28.5" width="108.84375" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-44.421875,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'NP_p</tspan></text></g></g></g><g class="node terminal" transform="translate(54.9296875,222.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-54.9296875" y="-28.5" width="109.859375" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-44.9296875,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">Matko</tspan></text></g></g></g><g class="node terminal" transform="translate(201.953125,222.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-42.09375" y="-28.5" width="84.1875" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-32.09375,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">raps</tspan></text></g></g></g><g class="node nonterminal" transform="translate(388.55859375,125.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-53.5078125" y="-28.5" width="107.015625" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-43.5078125,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'VP_p</tspan></text></g></g></g><g class="node terminal" transform="translate(327.890625,222.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-33.84375" y="-28.5" width="67.6875" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-23.84375,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">are</tspan></text></g></g></g><g class="node terminal" transform="translate(449.2265625,222.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-37.4921875" y="-28.5" width="74.984375" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-27.4921875,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">silly</tspan></text></g></g></g></g></g></g></svg>
</div>
<script>
$('#parseTreea513359e-bf83-451f-bfa7-14af322b1f51 svg').empty();
// Create the input graph
var g = new dagreD3.graphlib.Graph()
  .setGraph({ranksep: 40})
  .setDefaultEdgeLabel(function() { return {}; });

// Here we"re setting nodeclass, which is used by our custom drawNodes function
// below.
g.setNode(1, { label: "'S", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(2, { label: "'NP_p", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(3, { label: "Matko", class: "terminal", labelStyle: "font-size: 33px"});
g.setNode(4, { label: "raps", class: "terminal", labelStyle: "font-size: 33px"});
g.setNode(5, { label: "'VP_p", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(6, { label: "are", class: "terminal", labelStyle: "font-size: 33px"});
g.setNode(7, { label: "silly", class: "terminal", labelStyle: "font-size: 33px"});

g.nodes().forEach(function(v) {
  var node = g.node(v);
  // Round the corners of the nodes
  node.rx = node.ry = 5;
});

// Set up edges, no special attributes.
g.setEdge(1, 2);
g.setEdge(1, 5);
g.setEdge(2, 3);
g.setEdge(2, 4);
g.setEdge(5, 6);
g.setEdge(5, 7);

// Create the renderer
var render = new dagreD3.render();

// Set up an SVG group so that we can translate the final graph.
var svg = d3.select('#parseTreea513359e-bf83-451f-bfa7-14af322b1f51 svg'),
    svgGroup = svg.append("g");

// Run the renderer. This is what draws the final graph.
render(d3.select('#parseTreea513359e-bf83-451f-bfa7-14af322b1f51 svg g'), g);

// Center the graph
var xCenterOffset = (svg.attr("width") - g.graph().width) / 2;
//svgGroup.attr("transform", "translate(" + xCenterOffset + ", 20)");
svg.attr("height", g.graph().height + 40);

</script></div></div></div><div id="cell14" class="cellWrapper"><div id="editCell14" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor14" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode14" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay14" class="cell"><div class="newslide"></div><div class="slideStart" id="slide12"></div><p>In the same way we could generate derivations before, we can now generate parse trees from a CFG.</p></div></div><div id="cell15" class="cellWrapper"><div id="editCell15" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor15" class="cell editor ace_editor ace-chaos ace_dark" style="height: 280px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 26px; width: 11.4019px; left: 82.8038px; top: 244px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 332px; width: 56px;"><div class="ace_gutter-cell " style="height: 26px;">1<span class="ace_fold-widget ace_start ace_open" style="height: 26px;"></span></div><div class="ace_gutter-cell " style="height: 26px;">2</div><div class="ace_gutter-cell " style="height: 26px;">3</div><div class="ace_gutter-cell " style="height: 26px;">4</div><div class="ace_gutter-cell " style="height: 26px;">5</div><div class="ace_gutter-cell " style="height: 26px;">6</div><div class="ace_gutter-cell " style="height: 52px;">7</div><div class="ace_gutter-cell " style="height: 26px;">8</div><div class="ace_gutter-cell " style="height: 26px;">9</div></div><div class="ace_gutter-active-line" style="top: 244px; height: 26px;"></div></div><div class="ace_scroller" style="left: 56px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 1040px; height: 332px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 916.15px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">generateTree</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">cfg</span>:<span class="ace_identifier">CFG</span>,&nbsp;<span class="ace_identifier">rhs</span>:<span class="ace_identifier">RHS</span><span class="ace_paren ace_rparen">)</span>:<span class="ace_identifier">ParseTree</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">rhs</span>&nbsp;<span class="ace_keyword">match</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_keyword">case</span>&nbsp;<span class="ace_identifier">t</span>:<span class="ace_identifier">Terminal</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_identifier">Leaf</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span><span class="ace_paren ace_rparen">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;for&nbsp;a&nbsp;terminal&nbsp;node,&nbsp;return&nbsp;the&nbsp;leaf</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_comment">//&nbsp;for&nbsp;a&nbsp;NonTerminal&nbsp;node...</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_keyword">case</span>&nbsp;<span class="ace_identifier">n</span>:<span class="ace_identifier">NonTerminal</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;for&nbsp;a&nbsp;NonTerminal&nbsp;node...</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">rules</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;&nbsp;<span class="ace_identifier">cfg</span>.<span class="ace_identifier">R</span>.<span class="ace_identifier">filter</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">lhs</span>&nbsp;<span class="ace_keyword ace_operator">==</span>&nbsp;<span class="ace_identifier">n</span><span class="ace_paren ace_rparen">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;find&nbsp;appropriate&nbsp;rules</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">sampled</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">rules</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">rand</span>.<span class="ace_identifier">nextInt</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">rules</span>.<span class="ace_identifier">length</span><span class="ace_paren ace_rparen">))</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;pick&nbsp;one</span></div></div><div class="ace_line_group" style="height:52px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">children</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">sampled</span>.<span class="ace_identifier">rhs</span>.<span class="ace_identifier">map</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">generateTree</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">cfg</span>,<span class="ace_identifier">_</span><span class="ace_paren ace_rparen">))</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;and&nbsp;generate&nbsp;trees&nbsp;for&nbsp;its&nbsp;</span></div><div class="ace_line" style="height:26px"><span class="ace_comment">rhs</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">Node</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">n</span>,<span class="ace_identifier">children</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_paren ace_rparen">}</span>&nbsp;</div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 26.8038px; top: 234px; width: 11.4019px; height: 26px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 280px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 56px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 1040px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode15" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay15" class="cell" style="display: none;"><div class="text-center"><i class="fa fa-refresh fa-spin fa-lg"></i></div></div></div><div id="cell16" class="cellWrapper"><div id="editCell16" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor16" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode16" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay16" class="cell"><div class="newslide"></div><div class="slideStart" id="slide13"></div><p>Now let us generate a tree, starting from a non-terminal in the CFG.</p></div></div><div id="cell17" class="cellWrapper"><div id="editCell17" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor17" class="cell editor ace_editor ace-chaos ace_dark" style="height: 46px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 26px; width: 11.4019px; left: 334.047px; top: 10px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 98px; width: 45px;"><div class="ace_gutter-cell " style="height: 26px;">1</div></div><div class="ace_gutter-active-line" style="top: 10px; height: 26px;"></div></div><div class="ace_scroller" style="left: 45px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 1051px; height: 98px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 916.15px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_identifier">generateTree</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">cfg</span>,<span class="ace_symbol ace_constant">'S</span><span class="ace_paren ace_rparen">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 289.047px; top: 0px; width: 11.4019px; height: 26px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 46px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 45px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 1051px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode17" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay17" class="cell"><div class="string-result"><div id="parseTreebd56939c-c992-46a0-b312-520826516faf" class="parseTree">
<svg height="291"><g><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M161.7578125,37.442051893826424L54.9296875,77L54.9296875,97" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead37)" style="fill: none;"></path><defs><marker id="arrowhead37" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M210.0546875,37.442051893826424L316.8828125,77L316.8828125,97" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead38)" style="fill: none;"></path><defs><marker id="arrowhead38" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M54.9296875,154L54.9296875,174L54.9296875,194" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead39)" style="fill: none;"></path><defs><marker id="arrowhead39" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M264.296875,147.69111549180886L201.953125,174L201.953125,194" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead40)" style="fill: none;"></path><defs><marker id="arrowhead40" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M316.8828125,154L316.8828125,174L316.8828125,194" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead41)" style="fill: none;"></path><defs><marker id="arrowhead41" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M369.46875,143.17671106779295L461.1640625,174L461.1640625,194" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead42)" style="fill: none;"></path><defs><marker id="arrowhead42" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g></g><g class="nodes"><g class="node nonterminal" transform="translate(185.90625,28.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-24.1484375" y="-28.5" width="48.296875" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-14.1484375,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'S</tspan></text></g></g></g><g class="node nonterminal" transform="translate(54.9296875,125.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-53.4921875" y="-28.5" width="106.984375" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-43.4921875,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'NP_s</tspan></text></g></g></g><g class="node terminal" transform="translate(54.9296875,222.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-54.9296875" y="-28.5" width="109.859375" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-44.9296875,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">Matko</tspan></text></g></g></g><g class="node nonterminal" transform="translate(316.8828125,125.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-52.5859375" y="-28.5" width="105.171875" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-42.5859375,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'VP_s</tspan></text></g></g></g><g class="node terminal" transform="translate(201.953125,222.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-42.09375" y="-28.5" width="84.1875" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-32.09375,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">raps</tspan></text></g></g></g><g class="node terminal" transform="translate(316.8828125,222.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-22.8359375" y="-28.5" width="45.671875" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-12.8359375,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">in</tspan></text></g></g></g><g class="node terminal" transform="translate(461.1640625,222.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-71.4453125" y="-28.5" width="142.890625" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-61.4453125,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">StatNLP</tspan></text></g></g></g></g></g></g></svg>
</div>
<script>
$('#parseTreebd56939c-c992-46a0-b312-520826516faf svg').empty();
// Create the input graph
var g = new dagreD3.graphlib.Graph()
  .setGraph({ranksep: 40})
  .setDefaultEdgeLabel(function() { return {}; });

// Here we"re setting nodeclass, which is used by our custom drawNodes function
// below.
g.setNode(1, { label: "'S", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(2, { label: "'NP_s", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(3, { label: "Matko", class: "terminal", labelStyle: "font-size: 33px"});
g.setNode(4, { label: "'VP_s", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(5, { label: "raps", class: "terminal", labelStyle: "font-size: 33px"});
g.setNode(6, { label: "in", class: "terminal", labelStyle: "font-size: 33px"});
g.setNode(7, { label: "StatNLP", class: "terminal", labelStyle: "font-size: 33px"});

g.nodes().forEach(function(v) {
  var node = g.node(v);
  // Round the corners of the nodes
  node.rx = node.ry = 5;
});

// Set up edges, no special attributes.
g.setEdge(1, 2);
g.setEdge(1, 4);
g.setEdge(2, 3);
g.setEdge(4, 5);
g.setEdge(4, 6);
g.setEdge(4, 7);

// Create the renderer
var render = new dagreD3.render();

// Set up an SVG group so that we can translate the final graph.
var svg = d3.select('#parseTreebd56939c-c992-46a0-b312-520826516faf svg'),
    svgGroup = svg.append("g");

// Run the renderer. This is what draws the final graph.
render(d3.select('#parseTreebd56939c-c992-46a0-b312-520826516faf svg g'), g);

// Center the graph
var xCenterOffset = (svg.attr("width") - g.graph().width) / 2;
//svgGroup.attr("transform", "translate(" + xCenterOffset + ", 20)");
svg.attr("height", g.graph().height + 40);

</script></div></div></div><div id="cell18" class="cellWrapper"><div id="editCell18" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor18" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode18" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay18" class="cell"><div class="newslide"></div><div class="slideStart" id="slide14"></div><h3>Finding Parse Trees</h3><p><span class="summary"> <strong>Parsing</strong>: find a legal parse tree given a sentence and a grammar.</span></p><p><span class="summary"></span></p>
<ul>
  <li><strong>Top-Down</strong>: Start with the start symbol and generate trees; backtrack if they do not match observed sentence.</li>
  <li><strong>Bottom-Up</strong>: Start with the sentence, and find rules that generate parts of it; backtrack if no start symbol can be induced.</li>
  <li><strong>Dynamic Programming</strong>: Explore several trees in parallel and re-use computations.</li>
</ul>
<div class="newslide"></div><div class="slideStart" id="slide15"></div><h4>Bottom-Up Parsing with Backtracking</h4><p><span class="summary"> <strong>Reduce</strong> a stack of trees using rules, <strong>shift</strong> tokens on the stack, <strong>backtrack</strong> when we reach the end but have more than one tree on the stack.</span></p>
<div class="newslide"></div><div class="slideStart" id="slide16"></div><p><span class="summary">A scala bottom up parser:</span></p></div></div><div id="cell19" class="cellWrapper"><div id="editCell19" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor19" class="cell editor ace_editor ace-chaos ace_dark" style="height: 1346px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 26px; width: 11.4019px; left: 82.8038px; top: 1310px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 1398px; width: 56px;"><div class="ace_gutter-cell " style="height: 26px;">1</div><div class="ace_gutter-cell " style="height: 26px;">2</div><div class="ace_gutter-cell " style="height: 26px;">3</div><div class="ace_gutter-cell " style="height: 26px;">4</div><div class="ace_gutter-cell " style="height: 26px;">5</div><div class="ace_gutter-cell " style="height: 26px;">6<span class="ace_fold-widget ace_start ace_open" style="height: 26px;"></span></div><div class="ace_gutter-cell " style="height: 26px;">7</div><div class="ace_gutter-cell " style="height: 26px;">8</div><div class="ace_gutter-cell " style="height: 26px;">9</div><div class="ace_gutter-cell " style="height: 26px;">10<span class="ace_fold-widget ace_start ace_open" style="height: 26px;"></span></div><div class="ace_gutter-cell " style="height: 26px;">11<span class="ace_fold-widget ace_start ace_open" style="height: 26px;"></span></div><div class="ace_gutter-cell " style="height: 26px;">12</div><div class="ace_gutter-cell " style="height: 26px;">13</div><div class="ace_gutter-cell " style="height: 26px;">14<span class="ace_fold-widget ace_start ace_open" style="height: 26px;"></span></div><div class="ace_gutter-cell " style="height: 26px;">15</div><div class="ace_gutter-cell " style="height: 26px;">16</div><div class="ace_gutter-cell " style="height: 52px;">17</div><div class="ace_gutter-cell " style="height: 26px;">18</div><div class="ace_gutter-cell " style="height: 26px;">19</div><div class="ace_gutter-cell " style="height: 26px;">20</div><div class="ace_gutter-cell " style="height: 26px;">21</div><div class="ace_gutter-cell " style="height: 26px;">22</div><div class="ace_gutter-cell " style="height: 26px;">23</div><div class="ace_gutter-cell " style="height: 26px;">24</div><div class="ace_gutter-cell " style="height: 26px;">25<span class="ace_fold-widget ace_start ace_open" style="height: 26px;"></span></div><div class="ace_gutter-cell " style="height: 26px;">26</div><div class="ace_gutter-cell " style="height: 26px;">27</div><div class="ace_gutter-cell " style="height: 26px;">28</div><div class="ace_gutter-cell " style="height: 26px;">29</div><div class="ace_gutter-cell " style="height: 26px;">30</div><div class="ace_gutter-cell " style="height: 26px;">31</div><div class="ace_gutter-cell " style="height: 26px;">32</div><div class="ace_gutter-cell " style="height: 26px;">33<span class="ace_fold-widget ace_start ace_open" style="height: 26px;"></span></div><div class="ace_gutter-cell " style="height: 52px;">34</div><div class="ace_gutter-cell " style="height: 26px;">35</div><div class="ace_gutter-cell " style="height: 52px;">36</div><div class="ace_gutter-cell " style="height: 26px;">37</div><div class="ace_gutter-cell " style="height: 26px;">38</div><div class="ace_gutter-cell " style="height: 52px;">39<span class="ace_fold-widget ace_start ace_open" style="height: 26px;"></span></div><div class="ace_gutter-cell " style="height: 52px;">40</div><div class="ace_gutter-cell " style="height: 52px;">41</div><div class="ace_gutter-cell " style="height: 26px;">42</div><div class="ace_gutter-cell " style="height: 26px;">43</div><div class="ace_gutter-cell " style="height: 26px;">44</div><div class="ace_gutter-cell " style="height: 26px;">45</div></div><div class="ace_gutter-active-line" style="top: 1310px; height: 26px;"></div></div><div class="ace_scroller" style="left: 56px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 1040px; height: 1398px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 916.15px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">type</span>&nbsp;<span class="ace_identifier">Stack</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">ParseTree</span><span class="ace_paren ace_rparen">]</span>&nbsp;<span class="ace_comment">//&nbsp;stack&nbsp;of&nbsp;processed&nbsp;trees</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">type</span>&nbsp;<span class="ace_identifier">Buffer</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">[</span><span class="ace_support ace_function">String</span><span class="ace_paren ace_rparen">]</span>&nbsp;<span class="ace_comment">//&nbsp;buffer&nbsp;of&nbsp;remaining&nbsp;words</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">case</span>&nbsp;<span class="ace_keyword">class</span>&nbsp;<span class="ace_identifier">State</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">stack</span>:<span class="ace_identifier">Stack</span>,&nbsp;<span class="ace_identifier">buffer</span>:<span class="ace_identifier">Buffer</span>,&nbsp;<span class="ace_identifier">rules</span>:<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">Rule</span><span class="ace_paren ace_rparen">])</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">case</span>&nbsp;<span class="ace_keyword">class</span>&nbsp;<span class="ace_identifier">Transition</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">state</span>:<span class="ace_identifier">State</span>,&nbsp;<span class="ace_identifier">op</span>:<span class="ace_identifier">Symbol</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">bottomUpParse</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">cfg</span>:<span class="ace_identifier">CFG</span>,&nbsp;<span class="ace_identifier">sentence</span>:<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">[</span><span class="ace_support ace_function">String</span><span class="ace_paren ace_rparen">])</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_keyword">var</span>&nbsp;<span class="ace_identifier">history</span>:<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">State</span><span class="ace_paren ace_rparen">]</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">Nil</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_keyword">var</span>&nbsp;<span class="ace_identifier">state</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">State</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Nil</span>,<span class="ace_identifier">sentence</span>,<span class="ace_identifier">Nil</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_comment">//&nbsp;initial&nbsp;state</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_keyword">var</span>&nbsp;<span class="ace_identifier">transitions</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">Transition</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">state</span>,<span class="ace_symbol ace_constant">'Init</span><span class="ace_paren ace_rparen">)</span>&nbsp;::&nbsp;<span class="ace_identifier">Nil</span>&nbsp;<span class="ace_comment">//&nbsp;list&nbsp;of&nbsp;transitions</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">reduce</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">while</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">state</span>.<span class="ace_identifier">rules</span>.<span class="ace_identifier">nonEmpty</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">rule</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">state</span>.<span class="ace_identifier">rules</span>.<span class="ace_identifier">head</span>&nbsp;<span class="ace_comment">//&nbsp;take&nbsp;the&nbsp;leftmost&nbsp;rule</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">top</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">state</span>.<span class="ace_identifier">stack</span>.<span class="ace_identifier">take</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">rule</span>.<span class="ace_identifier">rhs</span>.<span class="ace_identifier">length</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">reverse</span>&nbsp;<span class="ace_comment">//&nbsp;take&nbsp;elems&nbsp;from&nbsp;stack</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_keyword">if</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">top</span>.<span class="ace_identifier">map</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">node</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">==</span>&nbsp;<span class="ace_identifier">rule</span>.<span class="ace_identifier">rhs</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_paren ace_lparen">{</span>&nbsp;<span class="ace_comment">//&nbsp;if&nbsp;rule&nbsp;can&nbsp;be&nbsp;applied</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">history</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">state</span>&nbsp;::&nbsp;<span class="ace_identifier">history</span>&nbsp;<span class="ace_comment">//&nbsp;add&nbsp;state&nbsp;to&nbsp;the&nbsp;history</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">state</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">state</span>.<span class="ace_identifier">copy</span><span class="ace_paren ace_lparen">(</span></div></div><div class="ace_line_group" style="height:52px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_identifier">stack</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">Node</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">rule</span>.<span class="ace_identifier">lhs</span>,&nbsp;<span class="ace_identifier">top</span><span class="ace_paren ace_rparen">)</span>&nbsp;::&nbsp;<span class="ace_identifier">state</span>.<span class="ace_identifier">stack</span>.<span class="ace_identifier">drop</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">rule</span>.<span class="ace_identifier">rhs</span>.<span class="ace_identifier">length</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_comment">//&nbsp;take&nbsp;rhs&nbsp;</span></div><div class="ace_line" style="height:26px"><span class="ace_comment">off&nbsp;the&nbsp;stack,&nbsp;add&nbsp;lhs&nbsp;on</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_identifier">rules</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">cfg</span>.<span class="ace_identifier">R</span>&nbsp;<span class="ace_comment">//&nbsp;re-populate&nbsp;rules</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">transitions</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">Transition</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">state</span>,<span class="ace_symbol ace_constant">'Reduce</span><span class="ace_paren ace_rparen">)</span>&nbsp;::&nbsp;<span class="ace_identifier">transitions</span>&nbsp;<span class="ace_comment">//&nbsp;log</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span>&nbsp;<span class="ace_keyword">else</span>&nbsp;<span class="ace_identifier">state</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">state</span>.<span class="ace_identifier">copy</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">rules</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">state</span>.<span class="ace_identifier">rules</span>.<span class="ace_identifier">tail</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_comment">//&nbsp;otherwise&nbsp;ignore&nbsp;the&nbsp;rule</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span>&nbsp;&nbsp;&nbsp;</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">shift</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_paren ace_lparen">{</span>&nbsp;<span class="ace_comment">//&nbsp;shift&nbsp;the&nbsp;left&nbsp;word&nbsp;from&nbsp;the&nbsp;buffer&nbsp;to&nbsp;the&nbsp;stack</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">state</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">state</span>.<span class="ace_identifier">copy</span><span class="ace_paren ace_lparen">(</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_identifier">stack</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">Leaf</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">state</span>.<span class="ace_identifier">buffer</span>.<span class="ace_identifier">head</span><span class="ace_paren ace_rparen">)</span>&nbsp;::&nbsp;<span class="ace_identifier">state</span>.<span class="ace_identifier">stack</span>,&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;add&nbsp;word&nbsp;to&nbsp;the&nbsp;stack</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_identifier">buffer</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">state</span>.<span class="ace_identifier">buffer</span>.<span class="ace_identifier">tail</span>,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;decrease&nbsp;the&nbsp;buffer</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_identifier">rules</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">cfg</span>.<span class="ace_identifier">R</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;populate&nbsp;rules</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">transitions</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">Transition</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">state</span>,<span class="ace_symbol ace_constant">'Shift</span><span class="ace_paren ace_rparen">)</span>&nbsp;::&nbsp;<span class="ace_identifier">transitions</span>&nbsp;<span class="ace_comment">//&nbsp;log</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">backtrack</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_paren ace_lparen">{</span>&nbsp;<span class="ace_comment">//&nbsp;go&nbsp;back&nbsp;to&nbsp;the&nbsp;previous&nbsp;state</span></div></div><div class="ace_line_group" style="height:52px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">state</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">history</span>.<span class="ace_identifier">head</span>.<span class="ace_identifier">copy</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">rules</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">history</span>.<span class="ace_identifier">head</span>.<span class="ace_identifier">rules</span>.<span class="ace_identifier">tail</span><span class="ace_paren ace_rparen">)</span>&nbsp;&nbsp;<span class="ace_comment">//&nbsp;state&nbsp;=&nbsp;current&nbsp;state&nbsp;</span></div><div class="ace_line" style="height:26px"><span class="ace_comment">without&nbsp;the&nbsp;last&nbsp;rule</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">transitions</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">Transition</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">state</span>,<span class="ace_symbol ace_constant">'Backtrack</span><span class="ace_paren ace_rparen">)</span>&nbsp;::&nbsp;<span class="ace_identifier">transitions</span>&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;log</span></div></div><div class="ace_line_group" style="height:52px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">history</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">history</span>.<span class="ace_identifier">tail</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;get&nbsp;rid&nbsp;of&nbsp;the&nbsp;last&nbsp;</span></div><div class="ace_line" style="height:26px"><span class="ace_comment">history&nbsp;element</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_comment">//&nbsp;aka&nbsp;shift-reduce&nbsp;parsing&nbsp;with&nbsp;backtracking</span></div></div><div class="ace_line_group" style="height:52px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_keyword">while</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">state</span>.<span class="ace_identifier">buffer</span>.<span class="ace_identifier">nonEmpty</span>&nbsp;<span class="ace_keyword ace_operator">||</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">state</span>.<span class="ace_identifier">stack</span>.<span class="ace_identifier">length</span>&nbsp;<span class="ace_keyword ace_operator">&gt;</span>&nbsp;<span class="ace_constant ace_numeric">1</span>&nbsp;<span class="ace_keyword ace_operator">&amp;&amp;</span>&nbsp;<span class="ace_identifier">history</span>.<span class="ace_identifier">nonEmpty</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">||</span>&nbsp;<span class="ace_identifier">state</span></div><div class="ace_line" style="height:26px">.<span class="ace_identifier">rules</span>.<span class="ace_identifier">nonEmpty</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:52px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">if</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">state</span>.<span class="ace_identifier">rules</span>.<span class="ace_identifier">nonEmpty</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_identifier">reduce</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;reduce,&nbsp;if&nbsp;there&nbsp;are&nbsp;rules&nbsp;to&nbsp;</span></div><div class="ace_line" style="height:26px"><span class="ace_comment">reduce&nbsp;with</span></div></div><div class="ace_line_group" style="height:52px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">if</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">state</span>.<span class="ace_identifier">buffer</span>.<span class="ace_identifier">nonEmpty</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_identifier">shift</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;shift,&nbsp;if&nbsp;there&nbsp;is&nbsp;something&nbsp;on&nbsp;the&nbsp;</span></div><div class="ace_line" style="height:26px"><span class="ace_comment">buffer&nbsp;to&nbsp;shift</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">else</span>&nbsp;<span class="ace_keyword">if</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">state</span>.<span class="ace_identifier">stack</span>.<span class="ace_identifier">length</span>&nbsp;<span class="ace_keyword ace_operator">&gt;</span>&nbsp;<span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_identifier">backtrack</span><span class="ace_paren ace_lparen">(</span><span class="ace_paren ace_rparen">)</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;backtrack,&nbsp;if&nbsp;nothing&nbsp;else&nbsp;to&nbsp;do</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_identifier">transitions</span>&nbsp;</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_paren ace_rparen">}</span>&nbsp;</div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 26.8038px; top: 1300px; width: 11.4019px; height: 26px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 1346px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 56px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 1040px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode19" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay19" class="cell"><div class="string-result"><span class="asString String">res22: ParseTree = Node(NonTerminal('S),List(Node(NonTerminal('NP_s),List(Leaf(Terminal(Matko)))), Node(NonTerminal('VP_s),List(Leaf(Terminal(raps)), Leaf(Terminal(in)), Leaf(Terminal(StatNLP))))))
</span></div></div></div><div id="cell20" class="cellWrapper" hidden="true"><div id="editCell20" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor20" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode20" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay20" class="cell" style="display: none;"><div class="text-center"><i class="fa fa-refresh fa-spin fa-lg"></i></div></div></div><div id="cell21" class="cellWrapper"><div id="editCell21" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor21" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode21" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay21" class="cell"><p>Let us run an example parse.</p></div></div><div id="cell22" class="cellWrapper"><div id="editCell22" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor22" class="cell editor ace_editor ace-chaos ace_dark" style="height: 46px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 26px; width: 11.4019px; left: 881.337px; top: 10px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 98px; width: 45px;"><div class="ace_gutter-cell " style="height: 26px;">1</div></div><div class="ace_gutter-active-line" style="top: 10px; height: 26px;"></div></div><div class="ace_scroller" style="left: 45px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 1051px; height: 98px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 916.15px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_identifier">bottomUpParse</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">cfg</span>,&nbsp;<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"MCRiedel"</span>,&nbsp;<span class="ace_string">"raps"</span>,&nbsp;<span class="ace_string">"are"</span>,&nbsp;<span class="ace_string">"silly"</span><span class="ace_paren ace_rparen">))</span>.<span class="ace_identifier">reverse</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 836.337px; top: 0px; width: 11.4019px; height: 26px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 46px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 45px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 1051px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode22" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay22" class="cell"><div class="string-result"><table> <tbody><tr> <td> 'Init </td><td> </td><td> MCRiedel raps are silly </td> </tr><tr> <td> 'Shift </td><td> MCRiedel </td><td> raps are silly </td> </tr><tr> <td> 'Shift </td><td> MCRiedel | raps </td><td> are silly </td> </tr><tr> <td> 'Shift </td><td> MCRiedel | raps | are </td><td> silly </td> </tr><tr> <td> 'Shift </td><td> MCRiedel | raps | are | silly </td><td> </td> </tr><tr> <td> 'Reduce </td><td> MCRiedel | raps | are | ('ADJ silly) </td><td> </td> </tr><tr> <td> 'Reduce </td><td> MCRiedel | raps | ('VP_p are ('ADJ silly)) </td><td> </td> </tr><tr> <td> 'Backtrack </td><td> MCRiedel | raps | are | ('ADJ silly) </td><td> </td> </tr><tr> <td> 'Backtrack </td><td> MCRiedel | raps | are | silly </td><td> </td> </tr> </tbody></table></div></div></div><div id="cell23" class="cellWrapper"><div id="editCell23" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor23" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode23" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay23" class="cell"><div class="newslide"></div><div class="slideStart" id="slide17"></div><h3>Dynamic Programming for Parsing</h3><p>A problem with the bottom-up parser is the fact that, after back-tracking, it may redo many steps it had already before (can you find examples of this behaviour in the transitions above?). This suggests to remember steps and re-use then when needed. This is the general idea behind <em>dynamic programming</em>: caching and reusing computation whenever possible. </p>
<div class="newslide"></div><div class="slideStart" id="slide18"></div><h4>Chomsky Normal Form</h4><p>In the case of CFG parsing there exists a very effective dynamic program, the so-called Cocke–Younger–Kasami (CYK) algorithm. However, before we can apply this algorithm we need to <em>normalize</em> the grammar. In particular, we need to make sure that each rule has one of the following forms:</p>
<ul>
  <li><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-102" role="math" style="width: 3.499em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.035em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.798em 1003.03em 2.803em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-103"><span class="mi" id="MathJax-Span-104" style="font-family: STIXGeneral-Italic;">α</span><span class="mo" id="MathJax-Span-105" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">→</span><span class="mi" id="MathJax-Span-106" style="font-family: STIXGeneral-Italic; padding-left: 0.31em;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mi" id="MathJax-Span-107" style="font-family: STIXGeneral-Italic;">γ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.266em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.068em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi><mo stretchy="false">→</mo><mi>β</mi><mi>γ</mi></math></span></span><script type="math/tex" id="MathJax-Element-18">\alpha \rightarrow \beta \gamma</script> where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;&amp;#x03B3;&lt;/mi&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo class=&quot;MJX-variant&quot;&gt;&amp;#x2216;&lt;/mo&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;{&lt;/mo&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;mo fence=&quot;false&quot; stretchy=&quot;false&quot;&gt;}&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-108" role="math" style="width: 6.803em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.914em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.759em 1005.82em 2.803em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-109"><span class="mi" id="MathJax-Span-110" style="font-family: STIXGeneral-Italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mo" id="MathJax-Span-111" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-112" style="font-family: STIXGeneral-Italic; padding-left: 0.194em;">γ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.02em;"></span></span><span class="mo" id="MathJax-Span-113" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">∈</span><span class="mi" id="MathJax-Span-114" style="font-family: STIXGeneral-Italic; padding-left: 0.31em;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.059em;"></span></span><span class="mo" id="MathJax-Span-115" style="font-family: STIXVariants; padding-left: 0.252em;">∖</span><span class="mo" id="MathJax-Span-116" style="font-family: STIXGeneral-Regular; padding-left: 0.252em;">{</span><span class="mi" id="MathJax-Span-117" style="font-family: STIXGeneral-Italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mo" id="MathJax-Span-118" style="font-family: STIXGeneral-Regular;">}</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.266em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.112em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>β</mi><mo>,</mo><mi>γ</mi><mo>∈</mo><mi>N</mi><mo class="MJX-variant">∖</mo><mo fence="false" stretchy="false">{</mo><mi>S</mi><mo fence="false" stretchy="false">}</mo></math></span></span><script type="math/tex" id="MathJax-Element-19">\beta,\gamma \in N \setminus \{ S \} </script>.</li>
  <li><span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-119" role="math" style="width: 2.764em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.397em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.933em 1002.4em 2.61em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-120"><span class="mi" id="MathJax-Span-121" style="font-family: STIXGeneral-Italic;">α</span><span class="mo" id="MathJax-Span-122" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">→</span><span class="mi" id="MathJax-Span-123" style="font-family: STIXGeneral-Italic; padding-left: 0.31em;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.043em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.69em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi><mo stretchy="false">→</mo><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-20">\alpha \rightarrow t</script> where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x03A3;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-124" role="math" style="width: 2.59em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.243em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.817em 1002.22em 2.61em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-125"><span class="mi" id="MathJax-Span-126" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.02em;"></span></span><span class="mo" id="MathJax-Span-127" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">∈</span><span class="mi" id="MathJax-Span-128" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">Σ</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.043em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.846em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mo>∈</mo><mi mathvariant="normal">Σ</mi></math></span></span><script type="math/tex" id="MathJax-Element-21">t \in \Sigma</script>.</li>
</ul><p>In words: each rule is either binary and expands into two non-terminal non-Start symbols, or unary and expands into a word. This form is called <em>Chomsky Normal Form</em> (CNF). </p>
<div class="newslide"></div><div class="slideStart" id="slide19"></div><p>Fortunately we can convert every CFG into an equivalent CFG in CNF, in the sense that any derivation or parse of sentence in one grammar can be loss-lessly converted to a derivation in the other grammar. We present this conversion in scala below, but omitted cases not relevant to our grammar (Exercise: add these cases).</p></div></div><div id="cell24" class="cellWrapper"><div id="editCell24" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor24" class="cell editor ace_editor ace-chaos ace_dark" style="height: 722px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 26px; width: 11.4019px; left: 299.439px; top: 686px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 774px; width: 56px;"><div class="ace_gutter-cell " style="height: 26px;">1</div><div class="ace_gutter-cell " style="height: 26px;">2<span class="ace_fold-widget ace_start ace_open" style="height: 26px;"></span></div><div class="ace_gutter-cell " style="height: 26px;">3<span class="ace_fold-widget ace_start ace_open" style="height: 26px;"></span></div><div class="ace_gutter-cell " style="height: 52px;">4</div><div class="ace_gutter-cell " style="height: 26px;">5</div><div class="ace_gutter-cell " style="height: 26px;">6</div><div class="ace_gutter-cell " style="height: 26px;">7</div><div class="ace_gutter-cell " style="height: 26px;">8</div><div class="ace_gutter-cell " style="height: 52px;">9</div><div class="ace_gutter-cell " style="height: 26px;">10</div><div class="ace_gutter-cell " style="height: 26px;">11</div><div class="ace_gutter-cell " style="height: 26px;">12</div><div class="ace_gutter-cell " style="height: 26px;">13</div><div class="ace_gutter-cell " style="height: 52px;">14</div><div class="ace_gutter-cell " style="height: 26px;">15</div><div class="ace_gutter-cell " style="height: 26px;">16</div><div class="ace_gutter-cell " style="height: 26px;">17</div><div class="ace_gutter-cell " style="height: 26px;">18</div><div class="ace_gutter-cell " style="height: 52px;">19</div><div class="ace_gutter-cell " style="height: 26px;">20</div><div class="ace_gutter-cell " style="height: 26px;">21</div><div class="ace_gutter-cell " style="height: 26px;">22</div><div class="ace_gutter-cell " style="height: 26px;">23</div></div><div class="ace_gutter-active-line" style="top: 686px; height: 26px;"></div></div><div class="ace_scroller" style="left: 56px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 1040px; height: 774px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 916.15px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">@<span class="ace_identifier">scala</span>.<span class="ace_identifier">annotation</span>.<span class="ace_identifier">tailrec</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">toCNF</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">cfg</span>:<span class="ace_identifier">CFG</span>,&nbsp;<span class="ace_identifier">result</span>:<span class="ace_identifier">CFG</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">CFG</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Set</span>.<span class="ace_identifier">empty</span>,&nbsp;<span class="ace_identifier">Set</span>.<span class="ace_identifier">empty</span>,&nbsp;<span class="ace_identifier">Nil</span>,<span class="ace_symbol ace_constant">'S</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_identifier">id</span>:<span class="ace_support ace_function">Int</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">)</span>:<span class="ace_identifier">CFG</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_identifier">cfg</span>.<span class="ace_identifier">R</span>&nbsp;<span class="ace_keyword">match</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:52px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">case</span>&nbsp;<span class="ace_identifier">Rule</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">lhs</span>,<span class="ace_identifier">rhs</span><span class="ace_paren ace_rparen">)</span>&nbsp;::&nbsp;<span class="ace_identifier">tail</span>&nbsp;<span class="ace_keyword">if</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">rhs</span>.<span class="ace_identifier">length</span>&nbsp;<span class="ace_keyword ace_operator">&gt;</span>&nbsp;<span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;A&nbsp;-&gt;&nbsp;BCD&nbsp;=&gt;&nbsp;A&nbsp;-&gt;&nbsp;B1D,&nbsp;</span></div><div class="ace_line" style="height:26px"><span class="ace_comment">B1&nbsp;-&gt;&nbsp;BC</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">leftN</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">NonTerminal</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Symbol</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">lhs</span>.<span class="ace_identifier">name</span>.<span class="ace_identifier">toString</span>&nbsp;<span class="ace_keyword ace_operator">+</span>&nbsp;<span class="ace_identifier">id</span><span class="ace_paren ace_rparen">))</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">rule1</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">Rule</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">lhs</span>,&nbsp;<span class="ace_identifier">leftN</span>&nbsp;::&nbsp;<span class="ace_identifier">rhs</span>.<span class="ace_identifier">drop</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">))</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">rule2</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">Rule</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">leftN</span>,&nbsp;<span class="ace_identifier">rhs</span>.<span class="ace_identifier">take</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">))</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_identifier">toCNF</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">cfg</span>.<span class="ace_identifier">copy</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">R</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">rule1</span>::<span class="ace_identifier">rule2</span>::<span class="ace_identifier">tail</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_identifier">result</span>,&nbsp;<span class="ace_identifier">id</span>&nbsp;<span class="ace_keyword ace_operator">+</span>&nbsp;<span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:52px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">case</span>&nbsp;<span class="ace_identifier">Rule</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">lhs</span>,&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">l1</span>:<span class="ace_identifier">Terminal</span><span class="ace_paren ace_rparen">)</span>&nbsp;::&nbsp;<span class="ace_identifier">l2</span>&nbsp;::&nbsp;<span class="ace_identifier">Nil</span><span class="ace_paren ace_rparen">)</span>&nbsp;::&nbsp;<span class="ace_identifier">tail</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;A&nbsp;-&gt;&nbsp;aX&nbsp;=&gt;&nbsp;A&nbsp;-&gt;&nbsp;A1X,&nbsp;</span></div><div class="ace_line" style="height:26px"><span class="ace_comment">A1&nbsp;-&gt;&nbsp;a</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">n</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">NonTerminal</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Symbol</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">l1</span>.<span class="ace_identifier">name</span>&nbsp;<span class="ace_keyword ace_operator">+</span>&nbsp;<span class="ace_identifier">id</span><span class="ace_paren ace_rparen">))</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">rule1</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">Rule</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">lhs</span>,&nbsp;<span class="ace_identifier">n</span>&nbsp;::&nbsp;<span class="ace_identifier">l2</span>&nbsp;::&nbsp;<span class="ace_identifier">Nil</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">rule2</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">Rule</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">n</span>,<span class="ace_identifier">l1</span>&nbsp;::&nbsp;<span class="ace_identifier">Nil</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_identifier">toCNF</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">cfg</span>.<span class="ace_identifier">copy</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">R</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">rule1</span>::<span class="ace_identifier">rule2</span>::<span class="ace_identifier">tail</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_identifier">result</span>,&nbsp;<span class="ace_identifier">id</span>&nbsp;<span class="ace_keyword ace_operator">+</span>&nbsp;<span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:52px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">case</span>&nbsp;<span class="ace_identifier">Rule</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">lhs</span>,<span class="ace_identifier">l1</span>&nbsp;::&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">l2</span>:<span class="ace_identifier">Terminal</span><span class="ace_paren ace_rparen">)</span>&nbsp;::&nbsp;<span class="ace_identifier">Nil</span><span class="ace_paren ace_rparen">)</span>&nbsp;::&nbsp;<span class="ace_identifier">tail</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;A&nbsp;-&gt;&nbsp;Xa&nbsp;=&gt;&nbsp;A&nbsp;-&gt;&nbsp;XA1,&nbsp;A1&nbsp;</span></div><div class="ace_line" style="height:26px"><span class="ace_comment">-&gt;&nbsp;a</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">n</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">NonTerminal</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Symbol</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">l2</span>.<span class="ace_identifier">name</span>&nbsp;<span class="ace_keyword ace_operator">+</span>&nbsp;<span class="ace_identifier">id</span><span class="ace_paren ace_rparen">))</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">rule1</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">Rule</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">lhs</span>,&nbsp;<span class="ace_identifier">l1</span>&nbsp;::&nbsp;<span class="ace_identifier">n</span>&nbsp;::&nbsp;<span class="ace_identifier">Nil</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">rule2</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">Rule</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">n</span>,&nbsp;<span class="ace_identifier">l2</span>&nbsp;::&nbsp;<span class="ace_identifier">Nil</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_identifier">toCNF</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">cfg</span>.<span class="ace_identifier">copy</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">R</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">rule1</span>::<span class="ace_identifier">rule2</span>::<span class="ace_identifier">tail</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_identifier">result</span>,&nbsp;<span class="ace_identifier">id</span>&nbsp;<span class="ace_keyword ace_operator">+</span>&nbsp;<span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:52px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">case</span>&nbsp;<span class="ace_identifier">h</span>&nbsp;::&nbsp;<span class="ace_identifier">tail</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_identifier">toCNF</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">cfg</span>.<span class="ace_identifier">copy</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">R</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">tail</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_identifier">result</span>.<span class="ace_identifier">copy</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">R</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">h</span>&nbsp;::&nbsp;<span class="ace_identifier">result</span>.<span class="ace_identifier">R</span><span class="ace_paren ace_rparen">)</span>,<span class="ace_identifier">id</span><span class="ace_paren ace_rparen">)</span>&nbsp;&nbsp;<span class="ace_comment">//&nbsp;</span></div><div class="ace_line" style="height:26px"><span class="ace_comment">just&nbsp;copy&nbsp;in&nbsp;any&nbsp;other&nbsp;rule</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">case</span>&nbsp;<span class="ace_identifier">Nil</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_identifier">result</span>&nbsp;&nbsp;</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span>&nbsp;&nbsp;&nbsp;&nbsp;</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_paren ace_rparen">}</span>&nbsp;</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">cnf</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">toCNF</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">cfg</span><span class="ace_paren ace_rparen">)</span>&nbsp;</div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 243.439px; top: 676px; width: 11.4019px; height: 26px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 722px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 56px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 1040px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode24" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay24" class="cell"><div class="string-result"><table> <tbody><tr> <td> 'S </td><td> 'NP_p 'VP_p </td> </tr><tr> <td> 'S </td><td> 'NP_s 'VP_s </td> </tr><tr> <td> ''VP_s3 </td><td> 'raps5 'in6 </td> </tr><tr> <td> 'ADJ </td><td> silly </td> </tr><tr> <td> 'Matko0 </td><td> Matko </td> </tr><tr> <td> 'NP_p </td><td> 'Matko0 'raps1 </td> </tr><tr> <td> 'NP_s </td><td> Matko </td> </tr><tr> <td> 'StatNLP4 </td><td> StatNLP </td> </tr><tr> <td> 'VP_p </td><td> 'are2 'ADJ </td> </tr><tr> <td> 'VP_s </td><td> ''VP_s3 'StatNLP4 </td> </tr><tr> <td> 'are2 </td><td> are </td> </tr><tr> <td> 'in6 </td><td> in </td> </tr><tr> <td> 'raps1 </td><td> raps </td> </tr><tr> <td> 'raps5 </td><td> raps </td> </tr> </tbody></table></div></div></div><div id="cell25" class="cellWrapper"><div id="editCell25" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor25" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode25" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay25" class="cell"><div class="newslide"></div><div class="slideStart" id="slide20"></div><h4>CYK algorithm</h4><p>The CYK algorithm caches, for each span in the sentence, all possible trees that can cover the span according to the CFG. Again we record all changes throughout the algorithm for later visualization. </p></div></div><div id="cell26" class="cellWrapper"><div id="editCell26" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor26" class="cell editor ace_editor ace-chaos ace_dark" style="height: 722px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 26px; width: 11.4019px; left: 60px; top: 686px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 774px; width: 56px;"><div class="ace_gutter-cell " style="height: 26px;">1</div><div class="ace_gutter-cell " style="height: 26px;">2<span class="ace_fold-widget ace_start ace_open" style="height: 26px;"></span></div><div class="ace_gutter-cell " style="height: 26px;">3</div><div class="ace_gutter-cell " style="height: 26px;">4</div><div class="ace_gutter-cell " style="height: 26px;">5</div><div class="ace_gutter-cell " style="height: 26px;">6</div><div class="ace_gutter-cell " style="height: 26px;">7<span class="ace_fold-widget ace_start ace_open" style="height: 26px;"></span></div><div class="ace_gutter-cell " style="height: 26px;">8</div><div class="ace_gutter-cell " style="height: 26px;">9<span class="ace_fold-widget ace_start ace_open" style="height: 26px;"></span></div><div class="ace_gutter-cell " style="height: 26px;">10</div><div class="ace_gutter-cell " style="height: 26px;">11</div><div class="ace_gutter-cell " style="height: 26px;">12</div><div class="ace_gutter-cell " style="height: 26px;">13</div><div class="ace_gutter-cell " style="height: 26px;">14<span class="ace_fold-widget ace_start ace_open" style="height: 26px;"></span></div><div class="ace_gutter-cell " style="height: 26px;">15</div><div class="ace_gutter-cell " style="height: 26px;">16</div><div class="ace_gutter-cell " style="height: 26px;">17</div><div class="ace_gutter-cell " style="height: 26px;">18</div><div class="ace_gutter-cell " style="height: 26px;">19<span class="ace_fold-widget ace_start ace_open" style="height: 26px;"></span></div><div class="ace_gutter-cell " style="height: 26px;">20</div><div class="ace_gutter-cell " style="height: 26px;">21</div><div class="ace_gutter-cell " style="height: 26px;">22</div><div class="ace_gutter-cell " style="height: 26px;">23</div><div class="ace_gutter-cell " style="height: 26px;">24</div><div class="ace_gutter-cell " style="height: 26px;">25</div><div class="ace_gutter-cell " style="height: 26px;">26</div><div class="ace_gutter-cell " style="height: 26px;">27</div></div><div class="ace_gutter-active-line" style="top: 686px; height: 26px;"></div></div><div class="ace_scroller" style="left: 56px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 1040px; height: 774px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 916.15px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">type</span>&nbsp;<span class="ace_identifier">Chart</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">Map</span><span class="ace_paren ace_lparen">[(</span><span class="ace_support ace_function">Int</span>,<span class="ace_support ace_function">Int</span><span class="ace_paren ace_rparen">)</span>,<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">ParseTree</span><span class="ace_paren ace_rparen">]]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;our&nbsp;cache&nbsp;(trees&nbsp;for&nbsp;each&nbsp;span)</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">cyk</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">cfg</span>:<span class="ace_identifier">CFG</span>,&nbsp;<span class="ace_identifier">s</span>:<span class="ace_identifier">IndexedSeq</span><span class="ace_paren ace_lparen">[</span><span class="ace_support ace_function">String</span><span class="ace_paren ace_rparen">])</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_keyword">var</span>&nbsp;<span class="ace_identifier">chart</span>:<span class="ace_identifier">Chart</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">Map</span>.<span class="ace_identifier">empty</span>&nbsp;<span class="ace_identifier">withDefaultValue</span>&nbsp;<span class="ace_identifier">Nil</span>&nbsp;&nbsp;<span class="ace_comment">//&nbsp;initialize&nbsp;cache</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_keyword">var</span>&nbsp;<span class="ace_identifier">charts</span>:<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">Chart</span><span class="ace_paren ace_rparen">]</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">Nil</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;initialize&nbsp;global&nbsp;chart</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">n</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">s</span>.<span class="ace_identifier">length</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_comment">//&nbsp;init&nbsp;for&nbsp;the&nbsp;1st&nbsp;row&nbsp;of&nbsp;the&nbsp;chart&nbsp;(A&nbsp;-&gt;&nbsp;a&nbsp;rules)</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_keyword">for</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">i</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_constant ace_numeric">0</span>&nbsp;<span class="ace_identifier">until</span>&nbsp;<span class="ace_identifier">n</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;take&nbsp;all&nbsp;the&nbsp;applicable&nbsp;rules&nbsp;with&nbsp;terminal&nbsp;symbols&nbsp;in&nbsp;rhs</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">chart</span>&nbsp;<span class="ace_keyword ace_operator">+=</span>&nbsp;&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">i</span>,<span class="ace_identifier">i</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_identifier">cfg</span>.<span class="ace_identifier">R</span>.<span class="ace_identifier">collect</span>&nbsp;<span class="ace_paren ace_lparen">{</span>&nbsp;<span class="ace_comment">//&nbsp;produce&nbsp;(i,i)&nbsp;-&gt;&nbsp;Node(rhs,&nbsp;Leaf(t))</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">case</span>&nbsp;<span class="ace_identifier">Rule</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">rhs</span>,<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span>@<span class="ace_identifier">Terminal</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">w</span><span class="ace_paren ace_rparen">))</span>&nbsp;::&nbsp;<span class="ace_identifier">Nil</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword">if</span>&nbsp;<span class="ace_identifier">w</span>&nbsp;<span class="ace_keyword ace_operator">==</span>&nbsp;<span class="ace_identifier">s</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">i</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_identifier">Node</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">rhs</span>,&nbsp;<span class="ace_identifier">Leaf</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span><span class="ace_paren ace_rparen">)</span>&nbsp;::&nbsp;<span class="ace_identifier">Nil</span><span class="ace_paren ace_rparen">)}</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">charts</span>&nbsp;::<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">chart</span>&nbsp;<span class="ace_comment">//&nbsp;add&nbsp;trees&nbsp;for&nbsp;each&nbsp;span&nbsp;to&nbsp;charts</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_comment">//&nbsp;all&nbsp;further&nbsp;levels</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_keyword">for</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">l</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_constant ace_numeric">1</span>&nbsp;<span class="ace_identifier">until</span>&nbsp;<span class="ace_identifier">n</span>;&nbsp;<span class="ace_identifier">b</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_constant ace_numeric">0</span>&nbsp;<span class="ace_identifier">until</span>&nbsp;<span class="ace_identifier">n</span>&nbsp;<span class="ace_keyword ace_operator">-</span>&nbsp;<span class="ace_identifier">l</span>;&nbsp;<span class="ace_identifier">e</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">b</span>&nbsp;<span class="ace_keyword ace_operator">+</span>&nbsp;<span class="ace_identifier">l</span>;&nbsp;<span class="ace_identifier">m</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_identifier">b</span>&nbsp;<span class="ace_identifier">until</span>&nbsp;<span class="ace_identifier">e</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;search&nbsp;for&nbsp;rules&nbsp;where&nbsp;rhs&nbsp;=&nbsp;List(left,&nbsp;right)</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">trees</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_keyword">for</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">left</span>@<span class="ace_identifier">Node</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">nl</span>,<span class="ace_identifier">_</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_identifier">chart</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">b</span>,<span class="ace_identifier">m</span><span class="ace_paren ace_rparen">)</span>;&nbsp;</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<span class="ace_identifier">right</span>@<span class="ace_identifier">Node</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">nr</span>,<span class="ace_identifier">_</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_identifier">chart</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">m</span>&nbsp;<span class="ace_keyword ace_operator">+</span>&nbsp;<span class="ace_constant ace_numeric">1</span>,<span class="ace_identifier">e</span><span class="ace_paren ace_rparen">)</span>;</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<span class="ace_comment">//&nbsp;search&nbsp;for&nbsp;rules&nbsp;where&nbsp;rhs&nbsp;=&nbsp;left&nbsp;+&nbsp;right&nbsp;elem</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<span class="ace_identifier">rule</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_identifier">cfg</span>.<span class="ace_identifier">R</span>.<span class="ace_identifier">filter</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">rhs</span>&nbsp;<span class="ace_keyword ace_operator">==</span>&nbsp;<span class="ace_identifier">nl</span>&nbsp;::&nbsp;<span class="ace_identifier">nr</span>&nbsp;::&nbsp;<span class="ace_identifier">Nil</span><span class="ace_paren ace_rparen">))</span>&nbsp;<span class="ace_keyword">yield</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_identifier">Node</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">rule</span>.<span class="ace_identifier">lhs</span>,&nbsp;<span class="ace_identifier">left</span>&nbsp;::&nbsp;<span class="ace_identifier">right</span>&nbsp;::&nbsp;<span class="ace_identifier">Nil</span><span class="ace_paren ace_rparen">)</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span>&nbsp;<span class="ace_comment">//&nbsp;the&nbsp;result&nbsp;is&nbsp;a&nbsp;collection&nbsp;of&nbsp;trees</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">chart</span>&nbsp;<span class="ace_keyword ace_operator">+=</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">b</span>,<span class="ace_identifier">e</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">trees</span>&nbsp;:::&nbsp;<span class="ace_identifier">chart</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">b</span>,<span class="ace_identifier">e</span><span class="ace_paren ace_rparen">))</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;add&nbsp;trees&nbsp;to&nbsp;chart&nbsp;elem</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">charts</span>&nbsp;::<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">chart</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;add&nbsp;trees&nbsp;for&nbsp;each&nbsp;span&nbsp;to&nbsp;charts</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_identifier">charts</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_paren ace_rparen">}</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 4px; top: 676px; width: 11.4019px; height: 26px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 722px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 56px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 1040px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode26" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay26" class="cell" style="display: none;"><div class="text-center"><i class="fa fa-refresh fa-spin fa-lg"></i></div></div></div><div id="cell27" class="cellWrapper"><div id="editCell27" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor27" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode27" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay27" class="cell"><div class="newslide"></div><div class="slideStart" id="slide21"></div><p>Let us run the algorithm.</p></div></div><div id="cell28" class="cellWrapper"><div id="editCell28" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor28" class="cell editor ace_editor ace-chaos ace_dark" style="height: 46px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 26px; width: 11.4019px; left: 790.122px; top: 10px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 98px; width: 45px;"><div class="ace_gutter-cell " style="height: 26px;">1</div></div><div class="ace_gutter-active-line" style="top: 10px; height: 26px;"></div></div><div class="ace_scroller" style="left: 45px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 1051px; height: 98px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 916.15px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_identifier">cyk</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">cnf</span>,&nbsp;<span class="ace_identifier">Vector</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"Matko"</span>,<span class="ace_string">"raps"</span>,&nbsp;<span class="ace_string">"in"</span>,&nbsp;<span class="ace_string">"StatNLP"</span><span class="ace_paren ace_rparen">))</span>.<span class="ace_identifier">head</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0</span>,<span class="ace_constant ace_numeric">3</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">head</span>&nbsp;</div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 745.122px; top: 0px; width: 11.4019px; height: 26px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 46px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 45px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 1051px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode28" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay28" class="cell"><div class="string-result"><div id="parseTreef9b6209a-cd9b-415e-ad10-7718d86dcb27" class="parseTree">
<svg height="485"><g><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M215.046875,34.85603747986094L54.9296875,77L54.9296875,97" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead70)" style="fill: none;"></path><defs><marker id="arrowhead70" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M263.34375,42.29149034038639L324.1171875,77L324.1171875,97" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead71)" style="fill: none;"></path><defs><marker id="arrowhead71" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M54.9296875,154L54.9296875,174L54.9296875,194" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead72)" style="fill: none;"></path><defs><marker id="arrowhead72" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M271.53125,151.1726564957534L224.7734375,174L224.7734375,194" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead73)" style="fill: none;"></path><defs><marker id="arrowhead73" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M376.703125,142.72119062063143L472.21484375,174L472.21484375,194" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead74)" style="fill: none;"></path><defs><marker id="arrowhead74" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M183.76107442010309,251L154.98046875,271L154.98046875,291" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead75)" style="fill: none;"></path><defs><marker id="arrowhead75" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M265.7858005798969,251L294.56640625,271L294.56640625,291" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead76)" style="fill: none;"></path><defs><marker id="arrowhead76" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M154.98046875,348L154.98046875,368L154.98046875,388" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead77)" style="fill: none;"></path><defs><marker id="arrowhead77" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M294.56640625,348L294.56640625,368L294.56640625,388" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead78)" style="fill: none;"></path><defs><marker id="arrowhead78" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M472.21484375,251L472.21484375,271L472.21484375,291" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead79)" style="fill: none;"></path><defs><marker id="arrowhead79" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g></g><g class="nodes"><g class="node nonterminal" transform="translate(239.1953125,28.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-24.1484375" y="-28.5" width="48.296875" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-14.1484375,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'S</tspan></text></g></g></g><g class="node nonterminal" transform="translate(54.9296875,125.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-53.4921875" y="-28.5" width="106.984375" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-43.4921875,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'NP_s</tspan></text></g></g></g><g class="node terminal" transform="translate(54.9296875,222.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-54.9296875" y="-28.5" width="109.859375" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-44.9296875,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">Matko</tspan></text></g></g></g><g class="node nonterminal" transform="translate(324.1171875,125.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-52.5859375" y="-28.5" width="105.171875" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-42.5859375,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'VP_s</tspan></text></g></g></g><g class="node nonterminal" transform="translate(224.7734375,222.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-64.9140625" y="-28.5" width="129.828125" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-54.9140625,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">''VP_s3</tspan></text></g></g></g><g class="node nonterminal" transform="translate(154.98046875,319.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-54.421875" y="-28.5" width="108.84375" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-44.421875,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'raps5</tspan></text></g></g></g><g class="node terminal" transform="translate(154.98046875,416.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-42.09375" y="-28.5" width="84.1875" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-32.09375,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">raps</tspan></text></g></g></g><g class="node nonterminal" transform="translate(294.56640625,319.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-35.1640625" y="-28.5" width="70.328125" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-25.1640625,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'in6</tspan></text></g></g></g><g class="node terminal" transform="translate(294.56640625,416.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-22.8359375" y="-28.5" width="45.671875" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-12.8359375,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">in</tspan></text></g></g></g><g class="node nonterminal" transform="translate(472.21484375,222.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-83.7734375" y="-28.5" width="167.546875" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-73.7734375,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'StatNLP4</tspan></text></g></g></g><g class="node terminal" transform="translate(472.21484375,319.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-71.4453125" y="-28.5" width="142.890625" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-61.4453125,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">StatNLP</tspan></text></g></g></g></g></g></g></svg>
</div>
<script>
$('#parseTreef9b6209a-cd9b-415e-ad10-7718d86dcb27 svg').empty();
// Create the input graph
var g = new dagreD3.graphlib.Graph()
  .setGraph({ranksep: 40})
  .setDefaultEdgeLabel(function() { return {}; });

// Here we"re setting nodeclass, which is used by our custom drawNodes function
// below.
g.setNode(1, { label: "'S", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(2, { label: "'NP_s", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(3, { label: "Matko", class: "terminal", labelStyle: "font-size: 33px"});
g.setNode(4, { label: "'VP_s", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(5, { label: "''VP_s3", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(6, { label: "'raps5", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(7, { label: "raps", class: "terminal", labelStyle: "font-size: 33px"});
g.setNode(8, { label: "'in6", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(9, { label: "in", class: "terminal", labelStyle: "font-size: 33px"});
g.setNode(10, { label: "'StatNLP4", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(11, { label: "StatNLP", class: "terminal", labelStyle: "font-size: 33px"});

g.nodes().forEach(function(v) {
  var node = g.node(v);
  // Round the corners of the nodes
  node.rx = node.ry = 5;
});

// Set up edges, no special attributes.
g.setEdge(1, 2);
g.setEdge(1, 4);
g.setEdge(2, 3);
g.setEdge(4, 5);
g.setEdge(4, 10);
g.setEdge(5, 6);
g.setEdge(5, 8);
g.setEdge(6, 7);
g.setEdge(8, 9);
g.setEdge(10, 11);

// Create the renderer
var render = new dagreD3.render();

// Set up an SVG group so that we can translate the final graph.
var svg = d3.select('#parseTreef9b6209a-cd9b-415e-ad10-7718d86dcb27 svg'),
    svgGroup = svg.append("g");

// Run the renderer. This is what draws the final graph.
render(d3.select('#parseTreef9b6209a-cd9b-415e-ad10-7718d86dcb27 svg g'), g);

// Center the graph
var xCenterOffset = (svg.attr("width") - g.graph().width) / 2;
//svgGroup.attr("transform", "translate(" + xCenterOffset + ", 20)");
svg.attr("height", g.graph().height + 40);

</script></div></div></div><div id="cell29" class="cellWrapper"><div id="editCell29" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor29" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode29" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay29" class="cell"><div class="newslide"></div><div class="slideStart" id="slide22"></div>
<div class="exercise">
  <div class="exname">Exercise</div>
  <div class="extext">Manually perform CYK for this <a href="https://docs.google.com/document/d/160QtURHYQKdIWApWXZZFyyPH1q0EB0Nq4ptc8gmzCeM/edit#heading=h.hlfvaoch2h87">data</a></div>
</div>
<div class="newslide"></div><div class="slideStart" id="slide23"></div><h3>Ambiguity</h3><p><span class="summary">Sentences can have several legal parse trees.</span></p></div></div><div id="cell30" class="cellWrapper"><div id="editCell30" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor30" class="cell editor ace_editor ace-chaos ace_dark" style="height: 280px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 26px; width: 11.4019px; left: 504.673px; top: 244px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 358px; width: 56px;"><div class="ace_gutter-cell " style="height: 26px;">1</div><div class="ace_gutter-cell " style="height: 26px;">2</div><div class="ace_gutter-cell " style="height: 26px;">3</div><div class="ace_gutter-cell " style="height: 26px;">4</div><div class="ace_gutter-cell " style="height: 26px;">5</div><div class="ace_gutter-cell " style="height: 26px;">6</div><div class="ace_gutter-cell " style="height: 26px;">7</div><div class="ace_gutter-cell " style="height: 26px;">8</div><div class="ace_gutter-cell " style="height: 52px;">9</div></div><div class="ace_gutter-active-line" style="top: 218px; height: 52px;"></div></div><div class="ace_scroller" style="left: 56px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 1040px; height: 358px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 916.15px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">ambCFG</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">cfgFromRules</span><span class="ace_paren ace_lparen">(</span><span class="ace_symbol ace_constant">'S</span>,</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_symbol ace_constant">'S</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_symbol ace_constant">'Subj</span>,<span class="ace_symbol ace_constant">'VP</span><span class="ace_paren ace_rparen">)</span>,</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_symbol ace_constant">'Subj</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_string">"He"</span>,</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_symbol ace_constant">'Verb</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_string">"shot"</span>,</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_symbol ace_constant">'VP</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_symbol ace_constant">'Verb</span>,<span class="ace_symbol ace_constant">'Obj</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_symbol ace_constant">'VP</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_symbol ace_constant">'Verb</span>,<span class="ace_symbol ace_constant">'Obj</span>,<span class="ace_symbol ace_constant">'PP</span><span class="ace_paren ace_rparen">)</span>,</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_symbol ace_constant">'PP</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"in"</span>,<span class="ace_string">"his"</span>,<span class="ace_string">"pyjamas"</span><span class="ace_paren ace_rparen">)</span>,</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_symbol ace_constant">'Obj</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"the"</span>,<span class="ace_string">"elephant"</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_symbol ace_constant">'Obj</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"the"</span>,<span class="ace_string">"elephant"</span>,<span class="ace_symbol ace_constant">'PP</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_paren ace_rparen">)</span>&nbsp;</div></div><div class="ace_line_group" style="height:52px"><div class="ace_line" style="height:26px"><span class="ace_identifier">filterNonTerminals</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ambCFG</span>.<span class="ace_identifier">N</span>,<span class="ace_identifier">cyk</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">toCNF</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ambCFG</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_identifier">Vector</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"He"</span>,&nbsp;<span class="ace_string">"shot"</span>,&nbsp;<span class="ace_string">"the"</span>,&nbsp;<span class="ace_string">"elephant"</span>,&nbsp;</div><div class="ace_line" style="height:26px"><span class="ace_string">"in"</span>,&nbsp;<span class="ace_string">"his"</span>,&nbsp;<span class="ace_string">"pyjamas"</span><span class="ace_paren ace_rparen">))</span>.<span class="ace_identifier">head</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0</span>,<span class="ace_constant ace_numeric">6</span><span class="ace_paren ace_rparen">)</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">))</span>&nbsp;</div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 448.673px; top: 234px; width: 11.4019px; height: 26px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 280px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 56px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 1040px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode30" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay30" class="cell"><div class="string-result"><div id="parseTree07fbe4f5-ca53-4d02-80e4-6a7309af223d" class="parseTree">
<svg height="388"><g><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M226.73828125,34.22112504054802L46.171875,77L46.171875,97" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead105)" style="fill: none;"></path><defs><marker id="arrowhead105" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M275.03515625,37.30911387942179L383.83984375,77L383.83984375,97" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead106)" style="fill: none;"></path><defs><marker id="arrowhead106" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M46.171875,154L46.171875,174L46.171875,194" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead107)" style="fill: none;"></path><defs><marker id="arrowhead107" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M348.68359375,133.67461655149165L175.2578125,174L175.2578125,194" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead108)" style="fill: none;"></path><defs><marker id="arrowhead108" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M384.4986307989691,154L384.9609375,174L384.9609375,194" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead109)" style="fill: none;"></path><defs><marker id="arrowhead109" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M418.99609375,130.69556264432117L712.01953125,174L712.01953125,194" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead110)" style="fill: none;"></path><defs><marker id="arrowhead110" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M175.2578125,251L175.2578125,271L175.2578125,291" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead111)" style="fill: none;"></path><defs><marker id="arrowhead111" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M346.140625,246.26105496672417L305.72265625,271L305.72265625,291" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead112)" style="fill: none;"></path><defs><marker id="arrowhead112" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M423.78125,246.95299578915325L461.95703125,271L461.95703125,291" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead113)" style="fill: none;"></path><defs><marker id="arrowhead113" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M676.86328125,238.90730717185386L608.09765625,271L608.09765625,291" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead114)" style="fill: none;"></path><defs><marker id="arrowhead114" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M712.01953125,251L712.01953125,271L712.01953125,291" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead115)" style="fill: none;"></path><defs><marker id="arrowhead115" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M747.17578125,233.67912206115864L864.54296875,271L864.54296875,291" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead116)" style="fill: none;"></path><defs><marker id="arrowhead116" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g></g><g class="nodes"><g class="node nonterminal" transform="translate(250.88671875,28.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-24.1484375" y="-28.5" width="48.296875" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-14.1484375,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'S</tspan></text></g></g></g><g class="node nonterminal" transform="translate(46.171875,125.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-46.171875" y="-28.5" width="92.34375" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-36.171875,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'Subj</tspan></text></g></g></g><g class="node terminal" transform="translate(46.171875,222.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-31.0859375" y="-28.5" width="62.171875" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-21.0859375,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">He</tspan></text></g></g></g><g class="node nonterminal" transform="translate(383.83984375,125.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-35.15625" y="-28.5" width="70.3125" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-25.15625,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'VP</tspan></text></g></g></g><g class="node nonterminal" transform="translate(175.2578125,222.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-48" y="-28.5" width="96" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-38,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'Verb</tspan></text></g></g></g><g class="node terminal" transform="translate(175.2578125,319.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-41.1796875" y="-28.5" width="82.359375" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-31.1796875,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">shot</tspan></text></g></g></g><g class="node nonterminal" transform="translate(384.9609375,222.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-38.8203125" y="-28.5" width="77.640625" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-28.8203125,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'Obj</tspan></text></g></g></g><g class="node terminal" transform="translate(305.72265625,319.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-32.9296875" y="-28.5" width="65.859375" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-22.9296875,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">the</tspan></text></g></g></g><g class="node terminal" transform="translate(461.95703125,319.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-73.3046875" y="-28.5" width="146.609375" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-63.3046875,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">elephant</tspan></text></g></g></g><g class="node nonterminal" transform="translate(712.01953125,222.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-35.15625" y="-28.5" width="70.3125" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-25.15625,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'PP</tspan></text></g></g></g><g class="node terminal" transform="translate(608.09765625,319.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-22.8359375" y="-28.5" width="45.671875" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-12.8359375,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">in</tspan></text></g></g></g><g class="node terminal" transform="translate(712.01953125,319.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-31.0859375" y="-28.5" width="62.171875" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-21.0859375,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">his</tspan></text></g></g></g><g class="node terminal" transform="translate(864.54296875,319.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-71.4375" y="-28.5" width="142.875" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-61.4375,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">pyjamas</tspan></text></g></g></g></g></g></g></svg>
</div>
<script>
$('#parseTree07fbe4f5-ca53-4d02-80e4-6a7309af223d svg').empty();
// Create the input graph
var g = new dagreD3.graphlib.Graph()
  .setGraph({ranksep: 40})
  .setDefaultEdgeLabel(function() { return {}; });

// Here we"re setting nodeclass, which is used by our custom drawNodes function
// below.
g.setNode(1, { label: "'S", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(2, { label: "'Subj", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(3, { label: "He", class: "terminal", labelStyle: "font-size: 33px"});
g.setNode(4, { label: "'VP", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(5, { label: "'Verb", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(6, { label: "shot", class: "terminal", labelStyle: "font-size: 33px"});
g.setNode(7, { label: "'Obj", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(8, { label: "the", class: "terminal", labelStyle: "font-size: 33px"});
g.setNode(9, { label: "elephant", class: "terminal", labelStyle: "font-size: 33px"});
g.setNode(10, { label: "'PP", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(11, { label: "in", class: "terminal", labelStyle: "font-size: 33px"});
g.setNode(12, { label: "his", class: "terminal", labelStyle: "font-size: 33px"});
g.setNode(13, { label: "pyjamas", class: "terminal", labelStyle: "font-size: 33px"});

g.nodes().forEach(function(v) {
  var node = g.node(v);
  // Round the corners of the nodes
  node.rx = node.ry = 5;
});

// Set up edges, no special attributes.
g.setEdge(1, 2);
g.setEdge(1, 4);
g.setEdge(2, 3);
g.setEdge(4, 5);
g.setEdge(4, 7);
g.setEdge(4, 10);
g.setEdge(5, 6);
g.setEdge(7, 8);
g.setEdge(7, 9);
g.setEdge(10, 11);
g.setEdge(10, 12);
g.setEdge(10, 13);

// Create the renderer
var render = new dagreD3.render();

// Set up an SVG group so that we can translate the final graph.
var svg = d3.select('#parseTree07fbe4f5-ca53-4d02-80e4-6a7309af223d svg'),
    svgGroup = svg.append("g");

// Run the renderer. This is what draws the final graph.
render(d3.select('#parseTree07fbe4f5-ca53-4d02-80e4-6a7309af223d svg g'), g);

// Center the graph
var xCenterOffset = (svg.attr("width") - g.graph().width) / 2;
//svgGroup.attr("transform", "translate(" + xCenterOffset + ", 20)");
svg.attr("height", g.graph().height + 40);

</script></div></div></div><div id="cell31" class="cellWrapper"><div id="editCell31" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor31" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode31" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay31" class="cell"><div class="newslide"></div><div class="slideStart" id="slide24"></div><p><span class="summary">Can we assign the better parse a higher <em>probability</em>?</span></p>
<div class="newslide"></div><div class="slideStart" id="slide25"></div><h3>Probabilistic Context Free Grammars</h3><p><a href="http://www.cs.columbia.edu/~mcollins/courses/nlp2011/notes/pcfgs.pdf">Probabilistic Context Free Grammars</a> (PFCGs) are Context Free Grammars in which rules have probabilities. More formally, a PCFG consists of </p>
<ul>
  <li>A Context Free Grammar <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-22-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;G&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x03A3;&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;S&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-129" role="math" style="width: 5.953em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.18em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.798em 1005.14em 2.764em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-130"><span class="mi" id="MathJax-Span-131" style="font-family: STIXGeneral-Italic;">G</span><span class="mo" id="MathJax-Span-132" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-133" style="font-family: STIXGeneral-Italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.059em;"></span></span><span class="mo" id="MathJax-Span-134" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-135" style="font-family: STIXGeneral-Regular; padding-left: 0.194em;">Σ</span><span class="mo" id="MathJax-Span-136" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-137" style="font-family: STIXGeneral-Italic; padding-left: 0.194em;">R</span><span class="mo" id="MathJax-Span-138" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-139" style="font-family: STIXGeneral-Italic; padding-left: 0.194em;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mo" id="MathJax-Span-140" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.221em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.023em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>G</mi><mo stretchy="false">(</mo><mi>N</mi><mo>,</mo><mi mathvariant="normal">Σ</mi><mo>,</mo><mi>R</mi><mo>,</mo><mi>S</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-22">G(N,\Sigma,R,S)</script>.</li>
  <li>A parameter <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-23-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-141" role="math" style="width: 4.349em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.769em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.798em 1003.73em 2.803em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-142"><span class="mi" id="MathJax-Span-143" style="font-family: STIXGeneral-Italic;">q</span><span class="mo" id="MathJax-Span-144" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-145" style="font-family: STIXGeneral-Italic;">α</span><span class="mo" id="MathJax-Span-146" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">→</span><span class="mi" id="MathJax-Span-147" style="font-family: STIXGeneral-Italic; padding-left: 0.31em;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mo" id="MathJax-Span-148" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.266em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.068em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>q</mi><mo stretchy="false">(</mo><mi>α</mi><mo stretchy="false">→</mo><mi>β</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-23">q(\alpha \rightarrow \beta)</script> for each rule <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-24-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-149" role="math" style="width: 5.199em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.523em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.798em 1004.5em 2.803em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-150"><span class="mi" id="MathJax-Span-151" style="font-family: STIXGeneral-Italic;">α</span><span class="mo" id="MathJax-Span-152" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">→</span><span class="mi" id="MathJax-Span-153" style="font-family: STIXGeneral-Italic; padding-left: 0.31em;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mo" id="MathJax-Span-154" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">∈</span><span class="mi" id="MathJax-Span-155" style="font-family: STIXGeneral-Italic; padding-left: 0.31em;">R</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.266em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.068em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi><mo stretchy="false">→</mo><mi>β</mi><mo>∈</mo><mi>R</mi></math></span></span><script type="math/tex" id="MathJax-Element-24">\alpha \rightarrow \beta \in R</script>. For each possible left hand side <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-25-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-156" role="math" style="width: 2.977em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.59em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.817em 1002.59em 2.61em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-157"><span class="mi" id="MathJax-Span-158" style="font-family: STIXGeneral-Italic;">α</span><span class="mo" id="MathJax-Span-159" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">∈</span><span class="mi" id="MathJax-Span-160" style="font-family: STIXGeneral-Italic; padding-left: 0.31em;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.059em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.043em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.823em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi><mo>∈</mo><mi>N</mi></math></span></span><script type="math/tex" id="MathJax-Element-25">\alpha \in N</script> we require <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-26-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/munder&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-161" role="math" style="width: 8.214em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.131em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.721em 1007.03em 3.035em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-162"><span class="munderover" id="MathJax-Span-163"><span style="display: inline-block; position: relative; width: 1.354em; height: 0px;"><span style="position: absolute; clip: rect(3.189em 1000.85em 4.329em -999.999em); top: -3.999em; left: 0.001em;"><span class="mo" id="MathJax-Span-164" style="font-family: STIXGeneral-Regular; vertical-align: 0.001em;">∑</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span><span style="position: absolute; top: -3.709em; left: 0.909em;"><span class="mi" id="MathJax-Span-165" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span></span></span><span class="mi" id="MathJax-Span-166" style="font-family: STIXGeneral-Italic; padding-left: 0.194em;">q</span><span class="mo" id="MathJax-Span-167" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-168" style="font-family: STIXGeneral-Italic;">α</span><span class="mo" id="MathJax-Span-169" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">→</span><span class="mi" id="MathJax-Span-170" style="font-family: STIXGeneral-Italic; padding-left: 0.31em;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span class="mo" id="MathJax-Span-171" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-172" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">=</span><span class="mn" id="MathJax-Span-173" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.532em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.423em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><munder><mo>∑</mo><mi>β</mi></munder><mi>q</mi><mo stretchy="false">(</mo><mi>α</mi><mo stretchy="false">→</mo><mi>β</mi><mo stretchy="false">)</mo><mo>=</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-26">\sum_\beta q(\alpha \rightarrow \beta) = 1</script>.</li>
</ul><p>A PCFG defines a probability distribution over parse trees as follows. Given a parse tree <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-27-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-174" role="math" style="width: 0.407em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.349em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.837em 1000.35em 2.61em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-175"><span class="texatom" id="MathJax-Span-176"><span class="mrow" id="MathJax-Span-177"><span class="mi" id="MathJax-Span-178" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.043em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.779em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-27">\mathbf{t}</script> that contains the rules <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-28-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-179" role="math" style="width: 10.358em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.006em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.798em 1009.01em 2.803em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-180"><span class="msubsup" id="MathJax-Span-181"><span style="display: inline-block; position: relative; width: 0.986em; height: 0px;"><span style="position: absolute; clip: rect(3.499em 1000.54em 4.078em -999.999em); top: -3.999em; left: 0.001em;"><span class="mi" id="MathJax-Span-182" style="font-family: STIXGeneral-Italic;">α</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span><span style="position: absolute; top: -3.844em; left: 0.561em;"><span class="mn" id="MathJax-Span-183" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span></span></span><span class="mo" id="MathJax-Span-184" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">→</span><span class="msubsup" id="MathJax-Span-185" style="padding-left: 0.31em;"><span style="display: inline-block; position: relative; width: 0.929em; height: 0px;"><span style="position: absolute; clip: rect(3.267em 1000.52em 4.271em -999.999em); top: -3.999em; left: 0.001em;"><span class="mi" id="MathJax-Span-186" style="font-family: STIXGeneral-Italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span><span style="position: absolute; top: -3.844em; left: 0.503em;"><span class="mn" id="MathJax-Span-187" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span></span></span><span class="mo" id="MathJax-Span-188" style="font-family: STIXGeneral-Regular;">,</span><span class="mo" id="MathJax-Span-189" style="font-family: STIXGeneral-Regular; padding-left: 0.194em;">…</span><span class="mo" id="MathJax-Span-190" style="font-family: STIXGeneral-Regular; padding-left: 0.194em;">,</span><span class="msubsup" id="MathJax-Span-191" style="padding-left: 0.194em;"><span style="display: inline-block; position: relative; width: 0.986em; height: 0px;"><span style="position: absolute; clip: rect(3.499em 1000.54em 4.078em -999.999em); top: -3.999em; left: 0.001em;"><span class="mi" id="MathJax-Span-192" style="font-family: STIXGeneral-Italic;">α</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span><span style="position: absolute; top: -3.844em; left: 0.561em;"><span class="mi" id="MathJax-Span-193" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">n</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span></span></span><span class="mo" id="MathJax-Span-194" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">→</span><span class="msubsup" id="MathJax-Span-195" style="padding-left: 0.31em;"><span style="display: inline-block; position: relative; width: 0.929em; height: 0px;"><span style="position: absolute; clip: rect(3.267em 1000.52em 4.271em -999.999em); top: -3.999em; left: 0.001em;"><span class="mi" id="MathJax-Span-196" style="font-family: STIXGeneral-Italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span><span style="position: absolute; top: -3.844em; left: 0.503em;"><span class="mi" id="MathJax-Span-197" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">n</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.266em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.068em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>α</mi><mn>1</mn></msub><mo stretchy="false">→</mo><msub><mi>β</mi><mn>1</mn></msub><mo>,</mo><mo>…</mo><mo>,</mo><msub><mi>α</mi><mi>n</mi></msub><mo stretchy="false">→</mo><msub><mi>β</mi><mi>n</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-28">\alpha_1 \rightarrow \beta_1, \ldots, \alpha_n \rightarrow \beta_n</script>, the probability of this tree under the PCFG is: <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-29-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x220F;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/munderover&gt;&lt;mi&gt;q&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-198" role="math" style="width: 9.991em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.677em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(0.871em 1008.64em 3.846em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-199"><span class="mi" id="MathJax-Span-200" style="font-family: STIXGeneral-Italic;">p</span><span class="mo" id="MathJax-Span-201" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-202"><span class="mrow" id="MathJax-Span-203"><span class="mi" id="MathJax-Span-204" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-205" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-206" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">=</span><span class="munderover" id="MathJax-Span-207" style="padding-left: 0.31em;"><span style="display: inline-block; position: relative; width: 1.354em; height: 0px;"><span style="position: absolute; clip: rect(2.977em 1001.32em 4.542em -999.999em); top: -3.999em; left: 0.001em;"><span class="mo" id="MathJax-Span-208" style="font-family: STIXSizeOneSym; vertical-align: -0.521em;">∏</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span><span style="position: absolute; clip: rect(3.479em 1000.19em 4.175em -999.999em); top: -2.84em; left: 0.581em;"><span class="mi" id="MathJax-Span-209" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span><span style="position: absolute; clip: rect(3.537em 1000.33em 4.059em -999.999em); top: -5.197em; left: 0.503em;"><span class="mi" id="MathJax-Span-210" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">n</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span></span></span><span class="mi" id="MathJax-Span-211" style="font-family: STIXGeneral-Italic; padding-left: 0.194em;">q</span><span class="mo" id="MathJax-Span-212" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-213"><span style="display: inline-block; position: relative; width: 0.832em; height: 0px;"><span style="position: absolute; clip: rect(3.499em 1000.54em 4.078em -999.999em); top: -3.999em; left: 0.001em;"><span class="mi" id="MathJax-Span-214" style="font-family: STIXGeneral-Italic;">α</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span><span style="position: absolute; top: -3.844em; left: 0.561em;"><span class="mi" id="MathJax-Span-215" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span></span></span><span class="mo" id="MathJax-Span-216" style="font-family: STIXGeneral-Regular; padding-left: 0.31em;">→</span><span class="msubsup" id="MathJax-Span-217" style="padding-left: 0.31em;"><span style="display: inline-block; position: relative; width: 0.774em; height: 0px;"><span style="position: absolute; clip: rect(3.267em 1000.52em 4.271em -999.999em); top: -3.999em; left: 0.001em;"><span class="mi" id="MathJax-Span-218" style="font-family: STIXGeneral-Italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.001em;"></span></span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span><span style="position: absolute; top: -3.844em; left: 0.503em;"><span class="mi" id="MathJax-Span-219" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.001em;"></span></span></span></span><span class="mo" id="MathJax-Span-220" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.466em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 3.357em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>p</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><munderover><mo>∏</mo><mi>i</mi><mi>n</mi></munderover><mi>q</mi><mo stretchy="false">(</mo><msub><mi>α</mi><mi>i</mi></msub><mo stretchy="false">→</mo><msub><mi>β</mi><mi>i</mi></msub><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-29">  \newcommand{parse}{\mathbf{t}}  p(\parse) = \prod_i^n q(\alpha_i \rightarrow \beta_i) </script></p><p>Notice that we can develop and operate parsers with the structured prediction recipe. We have model <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-30-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-221" role="math" style="width: 0.6em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.523em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(2.03em 1000.48em 2.803em -999.999em); top: -2.53em; left: 0.001em;"><span class="mrow" id="MathJax-Span-222"><span class="mi" id="MathJax-Span-223" style="font-family: STIXGeneral-Italic;">p</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.266em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.779em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math></span></span><script type="math/tex" id="MathJax-Element-30">p</script>, some parameters <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-31-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-224" role="math" style="width: 0.581em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.503em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.759em 1000.48em 2.59em -999.999em); top: -2.511em; left: 0.001em;"><span class="mrow" id="MathJax-Span-225"><span class="mi" id="MathJax-Span-226" style="font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.513em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.043em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.868em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-31">\params</script> that need to be estimated on a training set, and the prediction/search problem of finding the most likely parse tree given a sentence. The next sections will cover these aspects.</p>
<div class="newslide"></div><div class="slideStart" id="slide26"></div><p>Before we show examples, let us define a scala data structure for PCFGs. </p></div></div><div id="cell32" class="cellWrapper"><div id="editCell32" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor32" class="cell editor ace_editor ace-chaos ace_dark" style="height: 72px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 26px; width: 11.4019px; left: 1029.56px; top: 36px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 124px; width: 45px;"><div class="ace_gutter-cell " style="height: 26px;">1</div><div class="ace_gutter-cell " style="height: 26px;">2</div></div><div class="ace_gutter-active-line" style="top: 36px; height: 26px;"></div></div><div class="ace_scroller" style="left: 45px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 1051px; height: 124px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 916.15px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"><div class="ace_bracket ace_start" style="height:26px;width:11.401875px;top:26px;left:175.02812500000002px;"></div></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">case</span>&nbsp;<span class="ace_keyword">class</span>&nbsp;<span class="ace_identifier">ProbRule</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">lhs</span>:<span class="ace_identifier">NonTerminal</span>,&nbsp;<span class="ace_identifier">rhs</span>:&nbsp;<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">RHS</span><span class="ace_paren ace_rparen">]</span>,<span class="ace_identifier">prob</span>:<span class="ace_support ace_function">Double</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">case</span>&nbsp;<span class="ace_keyword">class</span>&nbsp;<span class="ace_identifier">PCFG</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">N</span>:<span class="ace_identifier">Set</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">NonTerminal</span><span class="ace_paren ace_rparen">]</span>,<span class="ace_identifier">Sigma</span>:<span class="ace_identifier">Set</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">Terminal</span><span class="ace_paren ace_rparen">]</span>,<span class="ace_identifier">R</span>:<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">ProbRule</span><span class="ace_paren ace_rparen">]</span>,<span class="ace_identifier">S</span>:<span class="ace_identifier">NonTerminal</span><span class="ace_paren ace_rparen">)</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 984.561px; top: 26px; width: 11.4019px; height: 26px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 72px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 45px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 1051px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode32" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay32" class="cell" style="display: none;"><div class="text-center"><i class="fa fa-refresh fa-spin fa-lg"></i></div></div></div><div id="cell33" class="cellWrapper"><div id="editCell33" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor33" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode33" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay33" class="cell"><div class="newslide"></div><div class="slideStart" id="slide27"></div><p>Let us now create an example PCFG. </p></div></div><div id="cell34" class="cellWrapper" hidden="true"><div id="editCell34" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor34" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode34" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay34" class="cell" style="display: none;"><div class="text-center"><i class="fa fa-refresh fa-spin fa-lg"></i></div></div></div><div id="cell35" class="cellWrapper"><div id="editCell35" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor35" class="cell editor ace_editor ace-chaos ace_dark" style="height: 254px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 26px; width: 11.4019px; left: 105.608px; top: 218px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 306px; width: 56px;"><div class="ace_gutter-cell " style="height: 26px;">1</div><div class="ace_gutter-cell " style="height: 26px;">2</div><div class="ace_gutter-cell " style="height: 26px;">3</div><div class="ace_gutter-cell " style="height: 26px;">4</div><div class="ace_gutter-cell " style="height: 26px;">5</div><div class="ace_gutter-cell " style="height: 26px;">6</div><div class="ace_gutter-cell " style="height: 26px;">7</div><div class="ace_gutter-cell " style="height: 26px;">8</div><div class="ace_gutter-cell " style="height: 26px;">9</div></div><div class="ace_gutter-active-line" style="top: 218px; height: 26px;"></div></div><div class="ace_scroller" style="left: 56px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 1040px; height: 306px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 916.15px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">pcfg</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">pcfgFromRules</span><span class="ace_paren ace_lparen">(</span><span class="ace_symbol ace_constant">'S</span>,</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_symbol ace_constant">'S</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_symbol ace_constant">'Subj</span>,<span class="ace_symbol ace_constant">'VP</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_constant ace_numeric">1.0</span><span class="ace_paren ace_rparen">)</span>,</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_symbol ace_constant">'Subj</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_string">"He"</span>,&nbsp;<span class="ace_constant ace_numeric">1.0</span><span class="ace_paren ace_rparen">)</span>,</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_symbol ace_constant">'Verb</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_string">"shot"</span>,&nbsp;<span class="ace_constant ace_numeric">1.0</span><span class="ace_paren ace_rparen">)</span>,</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_symbol ace_constant">'VP</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_symbol ace_constant">'Verb</span>,<span class="ace_symbol ace_constant">'Obj</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_constant ace_numeric">0.7</span><span class="ace_paren ace_rparen">)</span>&nbsp;,&nbsp;<span class="ace_symbol ace_constant">'VP</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_symbol ace_constant">'Verb</span>,<span class="ace_symbol ace_constant">'Obj</span>,<span class="ace_symbol ace_constant">'PP</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_constant ace_numeric">0.3</span><span class="ace_paren ace_rparen">)</span>,</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_symbol ace_constant">'PP</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"in"</span>,<span class="ace_string">"his"</span>,<span class="ace_string">"pyjamas"</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_constant ace_numeric">1.0</span><span class="ace_paren ace_rparen">)</span>,</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_symbol ace_constant">'Obj</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"the"</span>,<span class="ace_string">"elephant"</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_constant ace_numeric">0.5</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_symbol ace_constant">'Obj</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"the"</span>,<span class="ace_string">"elephant"</span>,<span class="ace_symbol ace_constant">'PP</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_constant ace_numeric">0.5</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_paren ace_rparen">)</span>&nbsp;</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_identifier">pcfg</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 49.6075px; top: 208px; width: 11.4019px; height: 26px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 254px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 56px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 1040px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode35" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay35" class="cell"><div class="string-result"><table> <tbody><tr> <td> 'S </td><td> 'Subj 'VP </td><td> 1.0 </td> </tr><tr> <td> 'Obj </td><td> the elephant </td><td> 0.5 </td> </tr><tr> <td> 'Obj </td><td> the elephant 'PP </td><td> 0.5 </td> </tr><tr> <td> 'PP </td><td> in his pyjamas </td><td> 1.0 </td> </tr><tr> <td> 'Subj </td><td> He </td><td> 1.0 </td> </tr><tr> <td> 'VP </td><td> 'Verb 'Obj </td><td> 0.7 </td> </tr><tr> <td> 'VP </td><td> 'Verb 'Obj 'PP </td><td> 0.3 </td> </tr><tr> <td> 'Verb </td><td> shot </td><td> 1.0 </td> </tr> </tbody></table></div></div></div><div id="cell36" class="cellWrapper"><div id="editCell36" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor36" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode36" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay36" class="cell"><div class="newslide"></div><div class="slideStart" id="slide28"></div><p>Let us first focus on the prediction task: given a sentence, find the highest scoring parse tree. In a way, we have already solved a variant of this problem. We can consider a CFG as a deterministic distribution over trees, and finding <em>a</em> highest scoring parse is equivalent to finding any legal tree—our bottom-up and dynamic program based algorithms hence performed a structured prediction.</p>
<div class="newslide"></div><div class="slideStart" id="slide29"></div><h4>CYK for PCFGs</h4><p>Here we present a probabilistic variant of the CYK algorithm. Notice that again we require normalization to CNF. Exercise: how to incorporate the rule probabilities during normalization? </p></div></div><div id="cell37" class="cellWrapper"><div id="editCell37" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor37" class="cell editor ace_editor ace-chaos ace_dark" style="height: 722px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 26px; width: 11.4019px; left: 60px; top: 686px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 774px; width: 56px;"><div class="ace_gutter-cell " style="height: 26px;">1</div><div class="ace_gutter-cell " style="height: 26px;">2<span class="ace_fold-widget ace_start ace_open" style="height: 26px;"></span></div><div class="ace_gutter-cell " style="height: 26px;">3</div><div class="ace_gutter-cell " style="height: 26px;">4</div><div class="ace_gutter-cell " style="height: 26px;">5</div><div class="ace_gutter-cell " style="height: 26px;">6</div><div class="ace_gutter-cell " style="height: 26px;">7</div><div class="ace_gutter-cell " style="height: 26px;">8</div><div class="ace_gutter-cell " style="height: 26px;">9<span class="ace_fold-widget ace_start ace_open" style="height: 26px;"></span></div><div class="ace_gutter-cell " style="height: 26px;">10<span class="ace_fold-widget ace_start ace_open" style="height: 26px;"></span></div><div class="ace_gutter-cell " style="height: 52px;">11</div><div class="ace_gutter-cell " style="height: 26px;">12</div><div class="ace_gutter-cell " style="height: 26px;">13</div><div class="ace_gutter-cell " style="height: 26px;">14<span class="ace_fold-widget ace_start ace_open" style="height: 26px;"></span></div><div class="ace_gutter-cell " style="height: 26px;">15</div><div class="ace_gutter-cell " style="height: 26px;">16</div><div class="ace_gutter-cell " style="height: 26px;">17<span class="ace_fold-widget ace_start ace_open" style="height: 26px;"></span></div><div class="ace_gutter-cell " style="height: 26px;">18</div><div class="ace_gutter-cell " style="height: 26px;">19</div><div class="ace_gutter-cell " style="height: 26px;">20</div><div class="ace_gutter-cell " style="height: 26px;">21</div><div class="ace_gutter-cell " style="height: 26px;">22</div><div class="ace_gutter-cell " style="height: 26px;">23</div><div class="ace_gutter-cell " style="height: 26px;">24</div><div class="ace_gutter-cell " style="height: 26px;">25</div><div class="ace_gutter-cell " style="height: 26px;">26</div></div><div class="ace_gutter-active-line" style="top: 686px; height: 26px;"></div></div><div class="ace_scroller" style="left: 56px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 1040px; height: 774px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 916.15px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">type</span>&nbsp;<span class="ace_identifier">PChart</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">Map</span><span class="ace_paren ace_lparen">[(</span><span class="ace_support ace_function">Int</span>,<span class="ace_support ace_function">Int</span><span class="ace_paren ace_rparen">)</span>,<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">[(</span><span class="ace_identifier">ParseTree</span>,<span class="ace_support ace_function">Double</span><span class="ace_paren ace_rparen">)]]</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">pcyk</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">cfg</span>:<span class="ace_identifier">PCFG</span>,&nbsp;<span class="ace_identifier">s</span>:<span class="ace_identifier">IndexedSeq</span><span class="ace_paren ace_lparen">[</span><span class="ace_support ace_function">String</span><span class="ace_paren ace_rparen">])</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_keyword">var</span>&nbsp;<span class="ace_identifier">chart</span>:<span class="ace_identifier">PChart</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">Map</span>.<span class="ace_identifier">empty</span>&nbsp;<span class="ace_identifier">withDefaultValue</span>&nbsp;<span class="ace_identifier">Nil</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_keyword">var</span>&nbsp;<span class="ace_identifier">charts</span>:<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">PChart</span><span class="ace_paren ace_rparen">]</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">Nil</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">n</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">s</span>.<span class="ace_identifier">length</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">unify</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">trees</span>:<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">[(</span><span class="ace_identifier">ParseTree</span>,<span class="ace_support ace_function">Double</span><span class="ace_paren ace_rparen">)])</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">trees</span>.<span class="ace_identifier">groupBy</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">_1</span>.<span class="ace_identifier">node</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">mapValues</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">maxBy</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">_2</span><span class="ace_paren ace_rparen">))</span>.<span class="ace_identifier">values</span>.<span class="ace_identifier">toList</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_comment">//init</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_keyword">for</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">i</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_constant ace_numeric">0</span>&nbsp;<span class="ace_identifier">until</span>&nbsp;<span class="ace_identifier">n</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">chart</span>&nbsp;<span class="ace_keyword ace_operator">+=</span>&nbsp;&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">i</span>,<span class="ace_identifier">i</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_identifier">unify</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">cfg</span>.<span class="ace_identifier">R</span>.<span class="ace_identifier">collect</span>&nbsp;<span class="ace_paren ace_lparen">{</span>&nbsp;</div></div><div class="ace_line_group" style="height:52px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">case</span>&nbsp;<span class="ace_identifier">ProbRule</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">rhs</span>,<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span>@<span class="ace_identifier">Terminal</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">w</span><span class="ace_paren ace_rparen">))</span>&nbsp;::&nbsp;<span class="ace_identifier">Nil</span>,&nbsp;<span class="ace_identifier">p</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword">if</span>&nbsp;<span class="ace_identifier">w</span>&nbsp;<span class="ace_keyword ace_operator">==</span>&nbsp;<span class="ace_identifier">s</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">i</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Node</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">rhs</span>,&nbsp;<span class="ace_identifier">Leaf</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span><span class="ace_paren ace_rparen">)</span>&nbsp;::&nbsp;</div><div class="ace_line" style="height:26px"><span class="ace_identifier">Nil</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_identifier">math</span>.<span class="ace_identifier">log</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">p</span><span class="ace_paren ace_rparen">))})</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">charts</span>&nbsp;::<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">chart</span>&nbsp;&nbsp;</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_keyword">for</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">l</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_constant ace_numeric">1</span>&nbsp;<span class="ace_identifier">until</span>&nbsp;<span class="ace_identifier">n</span>;&nbsp;<span class="ace_identifier">b</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_constant ace_numeric">0</span>&nbsp;<span class="ace_identifier">until</span>&nbsp;<span class="ace_identifier">n</span>&nbsp;<span class="ace_keyword ace_operator">-</span>&nbsp;<span class="ace_identifier">l</span>;&nbsp;<span class="ace_identifier">e</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">b</span>&nbsp;<span class="ace_keyword ace_operator">+</span>&nbsp;<span class="ace_identifier">l</span>;&nbsp;<span class="ace_identifier">m</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_identifier">b</span>&nbsp;<span class="ace_identifier">until</span>&nbsp;<span class="ace_identifier">e</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">trees</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_keyword">for</span>&nbsp;<span class="ace_paren ace_lparen">((</span><span class="ace_identifier">left</span>@<span class="ace_identifier">Node</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">nl</span>,<span class="ace_identifier">_</span><span class="ace_paren ace_rparen">)</span>,<span class="ace_identifier">pl</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_identifier">chart</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">b</span>,<span class="ace_identifier">m</span><span class="ace_paren ace_rparen">)</span>;&nbsp;</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">right</span>@<span class="ace_identifier">Node</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">nr</span>,<span class="ace_identifier">_</span><span class="ace_paren ace_rparen">)</span>,<span class="ace_identifier">pr</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_identifier">chart</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">m</span>&nbsp;<span class="ace_keyword ace_operator">+</span>&nbsp;<span class="ace_constant ace_numeric">1</span>,<span class="ace_identifier">e</span><span class="ace_paren ace_rparen">)</span>;</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<span class="ace_identifier">rule</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_identifier">cfg</span>.<span class="ace_identifier">R</span>.<span class="ace_identifier">filter</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">rhs</span>&nbsp;<span class="ace_keyword ace_operator">==</span>&nbsp;<span class="ace_identifier">nl</span>&nbsp;::&nbsp;<span class="ace_identifier">nr</span>&nbsp;::&nbsp;<span class="ace_identifier">Nil</span><span class="ace_paren ace_rparen">))</span>&nbsp;<span class="ace_keyword">yield</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_comment">//&nbsp;notice&nbsp;the&nbsp;probability&nbsp;multiplication</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Node</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">rule</span>.<span class="ace_identifier">lhs</span>,&nbsp;<span class="ace_identifier">left</span>&nbsp;::&nbsp;<span class="ace_identifier">right</span>&nbsp;::&nbsp;<span class="ace_identifier">Nil</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_identifier">pl</span>&nbsp;<span class="ace_keyword ace_operator">+</span>&nbsp;<span class="ace_identifier">pr</span>&nbsp;<span class="ace_keyword ace_operator">+</span>&nbsp;<span class="ace_identifier">math</span>.<span class="ace_identifier">log</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">rule</span>.<span class="ace_identifier">prob</span><span class="ace_paren ace_rparen">))</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span>&nbsp;</div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">chart</span>&nbsp;<span class="ace_keyword ace_operator">+=</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">b</span>,<span class="ace_identifier">e</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_identifier">unify</span><span class="ace_paren ace_lparen">((</span><span class="ace_identifier">trees</span>&nbsp;:::&nbsp;<span class="ace_identifier">chart</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">b</span>,<span class="ace_identifier">e</span><span class="ace_paren ace_rparen">)))</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">charts</span>&nbsp;::<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">chart</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px">&nbsp;&nbsp;<span class="ace_identifier">charts</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"><span class="ace_paren ace_rparen">}</span></div></div><div class="ace_line_group" style="height:26px"><div class="ace_line" style="height:26px"></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 4px; top: 676px; width: 11.4019px; height: 26px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 722px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 56px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 1040px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode37" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay37" class="cell" style="display: none;"><div class="text-center"><i class="fa fa-refresh fa-spin fa-lg"></i></div></div></div><div id="cell38" class="cellWrapper"><div id="editCell38" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor38" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode38" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay38" class="cell"><div class="newslide"></div><div class="slideStart" id="slide30"></div><p>The above algorithm now returns only a single parse for the given sentence: the one with the higher probability. You can adapt to return all parses by changing the <code>unify</code> method to return the input as is.</p></div></div><div id="cell39" class="cellWrapper"><div id="editCell39" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor39" class="cell editor ace_editor ace-chaos ace_dark" style="height: 72px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 26px; width: 11.4019px; left: 448.066px; top: 36px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 176px; width: 45px;"><div class="ace_gutter-cell " style="height: 52px;">1</div></div><div class="ace_gutter-active-line" style="top: 10px; height: 52px;"></div></div><div class="ace_scroller" style="left: 45px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 1051px; height: 176px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 916.15px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"><div class="ace_bracket ace_start" style="height:26px;width:11.401875px;top:0px;left:209.23375000000001px;"></div></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:52px"><div class="ace_line" style="height:26px"><span class="ace_identifier">filterNonTerminals</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">pcfg</span>.<span class="ace_identifier">N</span>,&nbsp;<span class="ace_identifier">pcyk</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">toPCNF</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">pcfg</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_identifier">Vector</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"He"</span>,&nbsp;<span class="ace_string">"shot"</span>,&nbsp;<span class="ace_string">"the"</span>,&nbsp;<span class="ace_string">"elephant"</span>,&nbsp;<span class="ace_string">"in"</span>,&nbsp;</div><div class="ace_line" style="height:26px"><span class="ace_string">"his"</span>,&nbsp;<span class="ace_string">"pyjamas"</span><span class="ace_paren ace_rparen">))</span>.<span class="ace_identifier">head</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0</span>,<span class="ace_constant ace_numeric">6</span><span class="ace_paren ace_rparen">)</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">_1</span><span class="ace_paren ace_rparen">)</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 403.066px; top: 26px; width: 11.4019px; height: 26px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 72px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 45px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 1051px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode39" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay39" class="cell"><div class="string-result"><div id="parseTreee80ff700-313a-4410-98a3-6fa1fa8b0b50" class="parseTree">
<svg height="485"><g><g class="output"><g class="clusters"></g><g class="edgePaths"><g class="edgePath" style="opacity: 1;"><path class="path" d="M150.4765625,37.61771682277095L46.171875,77L46.171875,97" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead146)" style="fill: none;"></path><defs><marker id="arrowhead146" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M198.7734375,46.336228435455084L240.2890625,77L240.2890625,97" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead147)" style="fill: none;"></path><defs><marker id="arrowhead147" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M46.171875,154L46.171875,174L46.171875,194" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead148)" style="fill: none;"></path><defs><marker id="arrowhead148" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M205.1328125,152.17929833139783L176.37890625,174L176.37890625,194" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead149)" style="fill: none;"></path><defs><marker id="arrowhead149" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M275.4453125,137.19520135037376L386.08203125,174L386.08203125,194" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead150)" style="fill: none;"></path><defs><marker id="arrowhead150" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M176.37890625,251L176.37890625,271L176.37890625,291" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead151)" style="fill: none;"></path><defs><marker id="arrowhead151" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M347.26171875,244.49675976633807L300.48828125,271L300.48828125,291" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead152)" style="fill: none;"></path><defs><marker id="arrowhead152" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M424.90234375,249.15300818403009L456.72265625,271L456.72265625,291" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead153)" style="fill: none;"></path><defs><marker id="arrowhead153" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M424.90234375,230.71812446717817L615.18359375,271L615.18359375,291" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead154)" style="fill: none;"></path><defs><marker id="arrowhead154" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M580.02734375,328.9630043141761L435,368L435,388" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead155)" style="fill: none;"></path><defs><marker id="arrowhead155" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M580.02734375,341.8582441223173L538.921875,368L538.921875,388" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead156)" style="fill: none;"></path><defs><marker id="arrowhead156" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g><g class="edgePath" style="opacity: 1;"><path class="path" d="M650.33984375,341.8582441223173L691.4453125,368L691.4453125,388" marker-end="url(http://localhost:9000/template/statnlpbookScrollReveal/01_tasks/0x_parsing#arrowhead157)" style="fill: none;"></path><defs><marker id="arrowhead157" viewBox="0 0 10 10" refX="9" refY="5" markerUnits="strokeWidth" markerWidth="8" markerHeight="6" orient="auto"><path d="M 0 0 L 10 5 L 0 10 z" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path></marker></defs></g></g><g class="edgeLabels"><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g><g class="edgeLabel" transform="" style="opacity: 1;"><g transform="translate(0,0)" class="label"><text><tspan space="preserve" dy="1em" x="1"></tspan></text></g></g></g><g class="nodes"><g class="node nonterminal" transform="translate(174.625,28.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-24.1484375" y="-28.5" width="48.296875" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-14.1484375,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'S</tspan></text></g></g></g><g class="node nonterminal" transform="translate(46.171875,125.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-46.171875" y="-28.5" width="92.34375" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-36.171875,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'Subj</tspan></text></g></g></g><g class="node terminal" transform="translate(46.171875,222.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-31.0859375" y="-28.5" width="62.171875" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-21.0859375,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">He</tspan></text></g></g></g><g class="node nonterminal" transform="translate(240.2890625,125.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-35.15625" y="-28.5" width="70.3125" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-25.15625,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'VP</tspan></text></g></g></g><g class="node nonterminal" transform="translate(176.37890625,222.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-48" y="-28.5" width="96" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-38,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'Verb</tspan></text></g></g></g><g class="node terminal" transform="translate(176.37890625,319.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-41.1796875" y="-28.5" width="82.359375" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-31.1796875,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">shot</tspan></text></g></g></g><g class="node nonterminal" transform="translate(386.08203125,222.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-38.8203125" y="-28.5" width="77.640625" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-28.8203125,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'Obj</tspan></text></g></g></g><g class="node terminal" transform="translate(300.48828125,319.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-32.9296875" y="-28.5" width="65.859375" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-22.9296875,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">the</tspan></text></g></g></g><g class="node terminal" transform="translate(456.72265625,319.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-73.3046875" y="-28.5" width="146.609375" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-63.3046875,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">elephant</tspan></text></g></g></g><g class="node nonterminal" transform="translate(615.18359375,319.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-35.15625" y="-28.5" width="70.3125" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-25.15625,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">'PP</tspan></text></g></g></g><g class="node terminal" transform="translate(435,416.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-22.8359375" y="-28.5" width="45.671875" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-12.8359375,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">in</tspan></text></g></g></g><g class="node terminal" transform="translate(538.921875,416.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-31.0859375" y="-28.5" width="62.171875" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-21.0859375,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">his</tspan></text></g></g></g><g class="node terminal" transform="translate(691.4453125,416.5)" style="opacity: 1;"><rect rx="5" ry="5" x="-71.4375" y="-28.5" width="142.875" height="57"></rect><g class="label" transform="translate(0,0)"><g transform="translate(-61.4375,-18.5)"><text style="font-size: 33px"><tspan space="preserve" dy="1em" x="1">pyjamas</tspan></text></g></g></g></g></g></g></svg>
</div>
<script>
$('#parseTreee80ff700-313a-4410-98a3-6fa1fa8b0b50 svg').empty();
// Create the input graph
var g = new dagreD3.graphlib.Graph()
  .setGraph({ranksep: 40})
  .setDefaultEdgeLabel(function() { return {}; });

// Here we"re setting nodeclass, which is used by our custom drawNodes function
// below.
g.setNode(1, { label: "'S", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(2, { label: "'Subj", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(3, { label: "He", class: "terminal", labelStyle: "font-size: 33px"});
g.setNode(4, { label: "'VP", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(5, { label: "'Verb", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(6, { label: "shot", class: "terminal", labelStyle: "font-size: 33px"});
g.setNode(7, { label: "'Obj", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(8, { label: "the", class: "terminal", labelStyle: "font-size: 33px"});
g.setNode(9, { label: "elephant", class: "terminal", labelStyle: "font-size: 33px"});
g.setNode(10, { label: "'PP", class: "nonterminal", labelStyle: "font-size: 33px"});
g.setNode(11, { label: "in", class: "terminal", labelStyle: "font-size: 33px"});
g.setNode(12, { label: "his", class: "terminal", labelStyle: "font-size: 33px"});
g.setNode(13, { label: "pyjamas", class: "terminal", labelStyle: "font-size: 33px"});

g.nodes().forEach(function(v) {
  var node = g.node(v);
  // Round the corners of the nodes
  node.rx = node.ry = 5;
});

// Set up edges, no special attributes.
g.setEdge(1, 2);
g.setEdge(1, 4);
g.setEdge(2, 3);
g.setEdge(4, 5);
g.setEdge(4, 7);
g.setEdge(5, 6);
g.setEdge(7, 8);
g.setEdge(7, 9);
g.setEdge(7, 10);
g.setEdge(10, 11);
g.setEdge(10, 12);
g.setEdge(10, 13);

// Create the renderer
var render = new dagreD3.render();

// Set up an SVG group so that we can translate the final graph.
var svg = d3.select('#parseTreee80ff700-313a-4410-98a3-6fa1fa8b0b50 svg'),
    svgGroup = svg.append("g");

// Run the renderer. This is what draws the final graph.
render(d3.select('#parseTreee80ff700-313a-4410-98a3-6fa1fa8b0b50 svg g'), g);

// Center the graph
var xCenterOffset = (svg.attr("width") - g.graph().width) / 2;
//svgGroup.attr("transform", "translate(" + xCenterOffset + ", 20)");
svg.attr("height", g.graph().height + 40);

</script></div></div></div></div>
                

<script>
    var divCells = $('#static_content');
    /* COMPILERS OBJECT */
    var compilers = {};
    
        compilers.scala = {};
        compilers.scala.hideAfterCompile = false;
        compilers.scala.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/scala");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = '';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.scala.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.scala.aggregate = true;
    
        compilers.markdown = {};
        compilers.markdown.hideAfterCompile = true;
        compilers.markdown.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/markdown");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = '';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.markdown.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.markdown.aggregate = false;
    
        compilers.section = {};
        compilers.section.hideAfterCompile = true;
        compilers.section.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/text");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = 'Section Name';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.section.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.section.aggregate = false;
    
        compilers.latex = {};
        compilers.latex.hideAfterCompile = true;
        compilers.latex.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/latex");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = '';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.latex.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.latex.aggregate = false;
    
        compilers.heading1 = {};
        compilers.heading1.hideAfterCompile = true;
        compilers.heading1.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/text");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = 'Heading';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.heading1.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.heading1.aggregate = false;
    
        compilers.heading2 = {};
        compilers.heading2.hideAfterCompile = true;
        compilers.heading2.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/text");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = 'Heading';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.heading2.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.heading2.aggregate = false;
    
        compilers.heading3 = {};
        compilers.heading3.hideAfterCompile = true;
        compilers.heading3.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/text");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = 'Heading';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.heading3.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.heading3.aggregate = false;
    
        compilers.heading4 = {};
        compilers.heading4.hideAfterCompile = true;
        compilers.heading4.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/text");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = 'Heading';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.heading4.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.heading4.aggregate = false;
    
        compilers.heading5 = {};
        compilers.heading5.hideAfterCompile = true;
        compilers.heading5.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/text");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = 'Heading';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.heading5.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.heading5.aggregate = false;
    
        compilers.html = {};
        compilers.html.hideAfterCompile = true;
        compilers.html.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/html");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = '';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.html.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.html.aggregate = false;
    
        compilers.imageurl = {};
        compilers.imageurl.hideAfterCompile = true;
        compilers.imageurl.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/text");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = 'URL';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.imageurl.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.imageurl.aggregate = false;
    
        compilers.google_viewer = {};
        compilers.google_viewer.hideAfterCompile = true;
        compilers.google_viewer.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/text");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = 'URL';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.google_viewer.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.google_viewer.aggregate = false;
    

    /* DOCUMENT OBJECT */
    var doc = newDoc("Parsing");
    doc.aceTheme = 'chaos';
    doc.allowExecution = false;

    /* add cells */
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nNote that this chapter is heavily influenced by the structure and content of [Mike Collins' PCFG lecture](http://www.cs.columbia.edu/~mcollins/courses/nlp2011/notes/pcfgs.pdf). <span class=\"summary\">Based on Mike Collins [Lecture](http://www.cs.columbia.edu/~mcollins/courses/nlp2011/notes/pcfgs.pdf).</span> \n\n<div class=\"newslide\"></div>\nIn many NLP applications it is useful to understand the syntactic structure of a sentence: where are the verbs, what are the subject and object of the verbs, which phrases form coherent sub-structures of the sentence? Understanding this enables the machine to more effectively translate from Japanese to English, or to understand the query [\"who is the president of the united state\"](https://www.google.co.uk/search?q=who+is+the+president+of+the+united+state&oq=who+is+the+president+of+the+united+state&aqs=chrome..69i57j0l5.252j0j4&sourceid=chrome&es_sm=119&ie=UTF-8) and execute it against a database. <span class=\"summary\">It is useful to understand the syntactic structure of a sentence: where are the _verbs_, what are the _subject_ and _object_ of the verbs, which _phrases_ form coherent _sub-structures_?</span>  \n\n<div class=\"newslide\"></div>\nIn linguistics these questions are asked in the field of **syntax**, from the Greek syntaxis (arrangement). There are three core concepts:\n\n* **Constituency**: groups of words act as single units.\n* **Grammatical Relations**: object, subject, direct object etc. \n* **Subcategorization**: restrictions on the type of phrases that go with certain words.\n\n<div class=\"newslide\"></div>\n### Context Free Grammars\nA common approach to capture constituency, grammatical relations and subcategorization is based on [Context Free Grammars](https://www.cs.rochester.edu/~nelson/courses/csc_173/grammars/cfg.html) (CFGs). On a high level, these grammars assume that legal sentences can be derived by repeatedly and _independently_ expanding abstract symbols (such as \"NounPhrase\" or \"Adjective\") into more concrete sequences of symbols (such as \"Adjective Noun\" or \"green\") until each symbol is a concrete word. <span class=\"summary\">Context Free Grammars define rules that expand ...</span> \n\n<div class=\"newslide\"></div>\nMore formally, a CFG is a 4-tuple \\\\(G=(N,\\Sigma,R,S)\\\\) where\n\n  * \\\\(N\\\\) is a set of _non-terminal symbols_.\n  * \\\\(\\Sigma\\\\) is a set of _terminal symbols_.\n  * \\\\(R\\\\) is a finite set of _rules_ \\\\(X \\rightarrow Y_1 Y_2\\ldots Y_n\\\\) where \\\\(X \\in N\\\\) and \\\\(Y_i \\in N \\cup \\Sigma\\\\). \n  * \\\\(S \\in N\\\\) is a _start symbol_. \n\n<div class=\"newslide\"></div>\nBefore we show examples, let us define a scala data structure for PCFGs.","extraFields":{}};
        var id = 0;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"// sealed trait can be extended only in the same file\nsealed trait RHS\n// Symbol represents a closed set of identifiers enabling quick comparison\ncase class NonTerminal(name:Symbol) extends RHS \ncase class Terminal(name:String) extends RHS \ncase class Rule(lhs:NonTerminal,rhs:List[RHS])\ncase class CFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[Rule],S:NonTerminal)\n1","extraFields":{"aggregatedCells":"[]"}};
        var id = 1;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nLet us now create an example CFG. Notice that we implemented a  implicit conversion methods which will allow us to construct terminals, non-terminals and rules more succinctly. We omit these methods here for brevity. <span class=\"summary\">Let us now create an example CFG</span> ","extraFields":{}};
        var id = 2;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\nimplicit def toTerm(word:String) = Terminal(word)\nval anyToRhs:PartialFunction[Any,RHS] = {\n  case s:String => toTerm(s) \n  case s:Symbol => toNonTerm(s) \n}\nimplicit def toRule1(rule:(Symbol,List[Any])) = \n  Rule(rule._1,rule._2.collect(anyToRhs)) \n\nimplicit def toRule2(rule:(Symbol,Any)) = \n  Rule(rule._1,List(anyToRhs(rule._2))) \n    \ndef rhsToString(rhs:RHS) = rhs match {\n  case NonTerminal(n) => n.toString\n  case Terminal(w) => w\n}    \nimplicit def toHTML(cfg:CFG) = {\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\n      if (x == cfg.S) -1 else if (y == cfg.S) 1 else x.name.toString.compareTo(y.name.toString)\n    }  \n  }      \n  table(cfg.R.sortBy(_.lhs)(lhsOrdering).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\" \"))))    \n}\nimplicit def derivToHTML(deriv:Seq[Seq[RHS]]) = {\n  table(deriv.map(d => Seq(d.map(rhsToString).mkString(\" \"))))    \n}\ndef cfgFromRules(start:NonTerminal, rules:Rule*) = {\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\n  CFG(nonTerminals,terminals,rules.toList,start)\n}  ","extraFields":{"hide":"true","hide_output":"true","aggregatedCells":"[\"// sealed trait can be extended only in the same file\\nsealed trait RHS\\n// Symbol represents a closed set of identifiers, enabling quick comparison\\ncase class NonTerminal(name:Symbol) extends RHS \\ncase class Terminal(name:String) extends RHS \\ncase class Rule(lhs:NonTerminal,rhs:List[RHS])\\ncase class CFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[Rule],S:NonTerminal)\\n1\"]"}};
        var id = 3;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"// def cfgFromRules(start:NonTerminal, rules:Rule*)\nval cfg = cfgFromRules('S,\n  'S -> List('NP_p,'VP_p), 'S -> List('NP_s, 'VP_s),   \n  'NP_p -> List(\"Matko\",\"raps\"),\n  'VP_p -> List(\"are\", 'ADJ),\n  'NP_s -> List(\"Matko\"),\n  'VP_s -> List(\"raps\", \"in\", \"StatNLP\"),\n  'ADJ -> \"silly\")\ncfg ","extraFields":{"aggregatedCells":"[\"// sealed trait can be extended only in the same file\\nsealed trait RHS\\n// Symbol represents a closed set of identifiers, enabling quick comparison\\ncase class NonTerminal(name:Symbol) extends RHS \\ncase class Terminal(name:String) extends RHS \\ncase class Rule(lhs:NonTerminal,rhs:List[RHS])\\ncase class CFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[Rule],S:NonTerminal)\\n1\",\"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\\nimplicit def toTerm(word:String) = Terminal(word)\\nval anyToRhs:PartialFunction[Any,RHS] = {\\n  case s:String => toTerm(s) \\n  case s:Symbol => toNonTerm(s) \\n}\\nimplicit def toRule1(rule:(Symbol,List[Any])) = \\n  Rule(rule._1,rule._2.collect(anyToRhs)) \\n\\nimplicit def toRule2(rule:(Symbol,Any)) = \\n  Rule(rule._1,List(anyToRhs(rule._2))) \\n    \\ndef rhsToString(rhs:RHS) = rhs match {\\n  case NonTerminal(n) => n.toString\\n  case Terminal(w) => w\\n}    \\nimplicit def toHTML(cfg:CFG) = {\\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\\n      if (x == cfg.S) -1 else if (y == cfg.S) 1 else x.name.toString.compareTo(y.name.toString)\\n    }  \\n  }      \\n  table(cfg.R.sortBy(_.lhs)(lhsOrdering).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\nimplicit def derivToHTML(deriv:Seq[Seq[RHS]]) = {\\n  table(deriv.map(d => Seq(d.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\ndef cfgFromRules(start:NonTerminal, rules:Rule*) = {\\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\\n  CFG(nonTerminals,terminals,rules.toList,start)\\n}  \"]"}};
        var id = 4;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\n### (Left-most) Derivation\nA left-most derivation given a CFG \\\\(G\\\\) is a sequence of strings \\\\(s_1 \\ldots s_n\\\\) such that \n\n* \\\\(s_1 = S\\\\), that is, the first string consists only of the start symbol.\n* \\\\(s_n \\in \\Sigma^*\\\\), that is, the last string consists of only terminals.\n* Each \\\\(s_i\\\\) for \\\\(i > 1\\\\) is generated by replacing the left-most non-terminal \\\\(\\alpha\\\\) with the right-hand side of any rule that has \\\\(\\alpha\\\\) as left-hand side. \n\n<div class=\"newslide\"></div>\nLet us write some code that puts this definition into action and generates random derivations based on a grammar. ","extraFields":{}};
        var id = 5;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"import scala.collection.mutable.{ArrayBuffer,ListBuffer}\nval rand = new scala.util.Random(0) // 0 is the seed\n@scala.annotation.tailrec //annotation that ensures tail recursive optimization\ndef generateDeriv(cfg: CFG, sentence:Seq[RHS], result:Seq[Seq[RHS]] = Seq.empty):Seq[Seq[RHS]] =\n// finds the first element of the sentence which is a NonTerminal symbol\n  sentence.zipWithIndex.collectFirst { case r@(n:NonTerminal,_) => r } match {\n    case Some((n,index)) =>     // for an element that's a NonTerminal symbol\n      val rules =  cfg.R.filter(_.lhs == n)             // find all rules whose lhs is that symbol\n      val sampled = rules(rand.nextInt(rules.length))   // randomly pick one rule out of them\n      val next = sentence.patch(index,sampled.rhs,1)    // replace that element with the rule's rhs\n      generateDeriv(cfg, next, result.get :+ next)      // recursively repeat again\n    // didn't find such rule\n    case None => result         // no NonTerminal symbols to expand\n  }","extraFields":{"aggregatedCells":"[\"// sealed trait can be extended only in the same file\\nsealed trait RHS\\n// Symbol represents a closed set of identifiers, enabling quick comparison\\ncase class NonTerminal(name:Symbol) extends RHS \\ncase class Terminal(name:String) extends RHS \\ncase class Rule(lhs:NonTerminal,rhs:List[RHS])\\ncase class CFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[Rule],S:NonTerminal)\\n1\",\"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\\nimplicit def toTerm(word:String) = Terminal(word)\\nval anyToRhs:PartialFunction[Any,RHS] = {\\n  case s:String => toTerm(s) \\n  case s:Symbol => toNonTerm(s) \\n}\\nimplicit def toRule1(rule:(Symbol,List[Any])) = \\n  Rule(rule._1,rule._2.collect(anyToRhs)) \\n\\nimplicit def toRule2(rule:(Symbol,Any)) = \\n  Rule(rule._1,List(anyToRhs(rule._2))) \\n    \\ndef rhsToString(rhs:RHS) = rhs match {\\n  case NonTerminal(n) => n.toString\\n  case Terminal(w) => w\\n}    \\nimplicit def toHTML(cfg:CFG) = {\\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\\n      if (x == cfg.S) -1 else if (y == cfg.S) 1 else x.name.toString.compareTo(y.name.toString)\\n    }  \\n  }      \\n  table(cfg.R.sortBy(_.lhs)(lhsOrdering).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\nimplicit def derivToHTML(deriv:Seq[Seq[RHS]]) = {\\n  table(deriv.map(d => Seq(d.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\ndef cfgFromRules(start:NonTerminal, rules:Rule*) = {\\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\\n  CFG(nonTerminals,terminals,rules.toList,start)\\n}  \",\"// def cfgFromRules(start:NonTerminal, rules:Rule*)\\nval cfg = cfgFromRules('S,\\n  'S -> List('NP_p,'VP_p), 'S -> List('NP_s, 'VP_s),   \\n  'NP_p -> List(\\\"Matko\\\",\\\"raps\\\"),\\n  'VP_p -> List(\\\"are\\\", 'ADJ),\\n  'NP_s -> List(\\\"Matko\\\"),\\n  'VP_s -> List(\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\"),\\n  'ADJ -> \\\"silly\\\")\\ncfg \"]","hide_output":"true"}};
        var id = 6;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nLet us generate an example derivation.","extraFields":{}};
        var id = 7;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"generateDeriv(cfg,Seq(cfg.S)) ","extraFields":{"cache":"false","aggregatedCells":"[\"// sealed trait can be extended only in the same file\\nsealed trait RHS\\n// Symbol represents a closed set of identifiers, enabling quick comparison\\ncase class NonTerminal(name:Symbol) extends RHS \\ncase class Terminal(name:String) extends RHS \\ncase class Rule(lhs:NonTerminal,rhs:List[RHS])\\ncase class CFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[Rule],S:NonTerminal)\\n1\",\"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\\nimplicit def toTerm(word:String) = Terminal(word)\\nval anyToRhs:PartialFunction[Any,RHS] = {\\n  case s:String => toTerm(s) \\n  case s:Symbol => toNonTerm(s) \\n}\\nimplicit def toRule1(rule:(Symbol,List[Any])) = \\n  Rule(rule._1,rule._2.collect(anyToRhs)) \\n\\nimplicit def toRule2(rule:(Symbol,Any)) = \\n  Rule(rule._1,List(anyToRhs(rule._2))) \\n    \\ndef rhsToString(rhs:RHS) = rhs match {\\n  case NonTerminal(n) => n.toString\\n  case Terminal(w) => w\\n}    \\nimplicit def toHTML(cfg:CFG) = {\\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\\n      if (x == cfg.S) -1 else if (y == cfg.S) 1 else x.name.toString.compareTo(y.name.toString)\\n    }  \\n  }      \\n  table(cfg.R.sortBy(_.lhs)(lhsOrdering).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\nimplicit def derivToHTML(deriv:Seq[Seq[RHS]]) = {\\n  table(deriv.map(d => Seq(d.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\ndef cfgFromRules(start:NonTerminal, rules:Rule*) = {\\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\\n  CFG(nonTerminals,terminals,rules.toList,start)\\n}  \",\"// def cfgFromRules(start:NonTerminal, rules:Rule*)\\nval cfg = cfgFromRules('S,\\n  'S -> List('NP_p,'VP_p), 'S -> List('NP_s, 'VP_s),   \\n  'NP_p -> List(\\\"Matko\\\",\\\"raps\\\"),\\n  'VP_p -> List(\\\"are\\\", 'ADJ),\\n  'NP_s -> List(\\\"Matko\\\"),\\n  'VP_s -> List(\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\"),\\n  'ADJ -> \\\"silly\\\")\\ncfg \",\"import scala.collection.mutable.{ArrayBuffer,ListBuffer}\\nval rand = new scala.util.Random(0) // 0 is the seed\\n@scala.annotation.tailrec //annotation that ensures tail recursive optimization\\ndef generateDeriv(cfg: CFG, sentence:Seq[RHS], result:Seq[Seq[RHS]] = Seq.empty):Seq[Seq[RHS]] = \\n  // finds the first element of the sentence which is a NonTerminal symbol\\n  sentence.zipWithIndex.collectFirst { case r@(n:NonTerminal,_) => r } match {\\n    // for element that's a NonTerminal symbol\\n    case Some((n,index)) =>\\n      // find all rules whose lhs is that symbol\\n      val rules =  cfg.R.filter(_.lhs == n)\\n      // randomly pick one rule out of them\\n      val sampled = rules(rand.nextInt(rules.length))\\n      // replace that element with the rule's rhs\\n      val next = sentence.patch(index,sampled.rhs,1)\\n      // recursively repeat again\\n      generateDeriv(cfg, next, result.get :+ next)\\n    // didn't find such rule\\n    case None => result \\n  }\"]"}};
        var id = 8;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\n### Parse Trees\nDerivations can be compactly present as trees where each non-leaf node corresponds to an expanded left-hand-side and its children to the rules' right hand side.\n<span class=\"summary\">Derivations can be compactly present as trees where each non-leaf node corresponds to an expanded left-hand-side and its children to the rules' right hand side.</summary>\n\n<div class=\"newslide\"></div>\n<span class=\"summary\">A scala data structure to represent trees</summary>","extraFields":{}};
        var id = 9;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"sealed trait ParseTree { def node: RHS}\ncase class Node(node:NonTerminal, children:List[ParseTree]) extends ParseTree\ncase class Leaf(node:Terminal) extends ParseTree","extraFields":{"aggregatedCells":"[\"// sealed trait can be extended only in the same file\\nsealed trait RHS\\n// Symbol represents a closed set of identifiers, enabling quick comparison\\ncase class NonTerminal(name:Symbol) extends RHS \\ncase class Terminal(name:String) extends RHS \\ncase class Rule(lhs:NonTerminal,rhs:List[RHS])\\ncase class CFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[Rule],S:NonTerminal)\\n1\",\"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\\nimplicit def toTerm(word:String) = Terminal(word)\\nval anyToRhs:PartialFunction[Any,RHS] = {\\n  case s:String => toTerm(s) \\n  case s:Symbol => toNonTerm(s) \\n}\\nimplicit def toRule1(rule:(Symbol,List[Any])) = \\n  Rule(rule._1,rule._2.collect(anyToRhs)) \\n\\nimplicit def toRule2(rule:(Symbol,Any)) = \\n  Rule(rule._1,List(anyToRhs(rule._2))) \\n    \\ndef rhsToString(rhs:RHS) = rhs match {\\n  case NonTerminal(n) => n.toString\\n  case Terminal(w) => w\\n}    \\nimplicit def toHTML(cfg:CFG) = {\\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\\n      if (x == cfg.S) -1 else if (y == cfg.S) 1 else x.name.toString.compareTo(y.name.toString)\\n    }  \\n  }      \\n  table(cfg.R.sortBy(_.lhs)(lhsOrdering).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\nimplicit def derivToHTML(deriv:Seq[Seq[RHS]]) = {\\n  table(deriv.map(d => Seq(d.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\ndef cfgFromRules(start:NonTerminal, rules:Rule*) = {\\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\\n  CFG(nonTerminals,terminals,rules.toList,start)\\n}  \",\"// def cfgFromRules(start:NonTerminal, rules:Rule*)\\nval cfg = cfgFromRules('S,\\n  'S -> List('NP_p,'VP_p), 'S -> List('NP_s, 'VP_s),   \\n  'NP_p -> List(\\\"Matko\\\",\\\"raps\\\"),\\n  'VP_p -> List(\\\"are\\\", 'ADJ),\\n  'NP_s -> List(\\\"Matko\\\"),\\n  'VP_s -> List(\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\"),\\n  'ADJ -> \\\"silly\\\")\\ncfg \",\"import scala.collection.mutable.{ArrayBuffer,ListBuffer}\\nval rand = new scala.util.Random(0) // 0 is the seed\\n@scala.annotation.tailrec //annotation that ensures tail recursive optimization\\ndef generateDeriv(cfg: CFG, sentence:Seq[RHS], result:Seq[Seq[RHS]] = Seq.empty):Seq[Seq[RHS]] = \\n  // finds the first element of the sentence which is a NonTerminal symbol\\n  sentence.zipWithIndex.collectFirst { case r@(n:NonTerminal,_) => r } match {\\n    // for element that's a NonTerminal symbol\\n    case Some((n,index)) =>\\n      // find all rules whose lhs is that symbol\\n      val rules =  cfg.R.filter(_.lhs == n)\\n      // randomly pick one rule out of them\\n      val sampled = rules(rand.nextInt(rules.length))\\n      // replace that element with the rule's rhs\\n      val next = sentence.patch(index,sampled.rhs,1)\\n      // recursively repeat again\\n      generateDeriv(cfg, next, result.get :+ next)\\n    // didn't find such rule\\n    case None => result \\n  }\",\"generateDeriv(cfg,Seq(cfg.S)) \"]","hide_output":"true"}};
        var id = 10;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"import ml.wolfe.nlp.syntax._\ndef toRenderTree(tree:ParseTree):RenderTree = tree match {\n  case Leaf(Terminal(w)) => RenderTree(w,\"terminal\")\n  case Node(NonTerminal(l),children) => RenderTree(l.toString, \"nonterminal\",children map toRenderTree)\n}\nimplicit def treeToHTML(tree:ParseTree) = renderParseTree(toRenderTree(tree))\n","extraFields":{"hide":"true","aggregatedCells":"[\"// sealed trait can be extended only in the same file\\nsealed trait RHS\\n// Symbol represents a closed set of identifiers, enabling quick comparison\\ncase class NonTerminal(name:Symbol) extends RHS \\ncase class Terminal(name:String) extends RHS \\ncase class Rule(lhs:NonTerminal,rhs:List[RHS])\\ncase class CFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[Rule],S:NonTerminal)\\n1\",\"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\\nimplicit def toTerm(word:String) = Terminal(word)\\nval anyToRhs:PartialFunction[Any,RHS] = {\\n  case s:String => toTerm(s) \\n  case s:Symbol => toNonTerm(s) \\n}\\nimplicit def toRule1(rule:(Symbol,List[Any])) = \\n  Rule(rule._1,rule._2.collect(anyToRhs)) \\n\\nimplicit def toRule2(rule:(Symbol,Any)) = \\n  Rule(rule._1,List(anyToRhs(rule._2))) \\n    \\ndef rhsToString(rhs:RHS) = rhs match {\\n  case NonTerminal(n) => n.toString\\n  case Terminal(w) => w\\n}    \\nimplicit def toHTML(cfg:CFG) = {\\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\\n      if (x == cfg.S) -1 else if (y == cfg.S) 1 else x.name.toString.compareTo(y.name.toString)\\n    }  \\n  }      \\n  table(cfg.R.sortBy(_.lhs)(lhsOrdering).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\nimplicit def derivToHTML(deriv:Seq[Seq[RHS]]) = {\\n  table(deriv.map(d => Seq(d.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\ndef cfgFromRules(start:NonTerminal, rules:Rule*) = {\\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\\n  CFG(nonTerminals,terminals,rules.toList,start)\\n}  \",\"// def cfgFromRules(start:NonTerminal, rules:Rule*)\\nval cfg = cfgFromRules('S,\\n  'S -> List('NP_p,'VP_p), 'S -> List('NP_s, 'VP_s),   \\n  'NP_p -> List(\\\"Matko\\\",\\\"raps\\\"),\\n  'VP_p -> List(\\\"are\\\", 'ADJ),\\n  'NP_s -> List(\\\"Matko\\\"),\\n  'VP_s -> List(\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\"),\\n  'ADJ -> \\\"silly\\\")\\ncfg \",\"import scala.collection.mutable.{ArrayBuffer,ListBuffer}\\nval rand = new scala.util.Random(0) // 0 is the seed\\n@scala.annotation.tailrec //annotation that ensures tail recursive optimization\\ndef generateDeriv(cfg: CFG, sentence:Seq[RHS], result:Seq[Seq[RHS]] = Seq.empty):Seq[Seq[RHS]] = \\n  // finds the first element of the sentence which is a NonTerminal symbol\\n  sentence.zipWithIndex.collectFirst { case r@(n:NonTerminal,_) => r } match {\\n    // for element that's a NonTerminal symbol\\n    case Some((n,index)) =>\\n      // find all rules whose lhs is that symbol\\n      val rules =  cfg.R.filter(_.lhs == n)\\n      // randomly pick one rule out of them\\n      val sampled = rules(rand.nextInt(rules.length))\\n      // replace that element with the rule's rhs\\n      val next = sentence.patch(index,sampled.rhs,1)\\n      // recursively repeat again\\n      generateDeriv(cfg, next, result.get :+ next)\\n    // didn't find such rule\\n    case None => result \\n  }\",\"generateDeriv(cfg,Seq(cfg.S)) \",\"sealed trait ParseTree { def node: RHS}\\ncase class Node(node:NonTerminal, children:List[ParseTree]) extends ParseTree\\ncase class Leaf(node:Terminal) extends ParseTree\"]","hide_output":"true"}};
        var id = 11;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"We can construct trees through parse the usual case class constructors, and render them graphically.","extraFields":{}};
        var id = 12;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"Node('S, List(Node('NP_p, List(Leaf(\"Matko\"), Leaf(\"raps\"))),\n              Node('VP_p,List(Leaf(\"are\"), Leaf(\"silly\")))))","extraFields":{"aggregatedCells":"[\"// sealed trait can be extended only in the same file\\nsealed trait RHS\\n// Symbol represents a closed set of identifiers, enabling quick comparison\\ncase class NonTerminal(name:Symbol) extends RHS \\ncase class Terminal(name:String) extends RHS \\ncase class Rule(lhs:NonTerminal,rhs:List[RHS])\\ncase class CFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[Rule],S:NonTerminal)\\n1\",\"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\\nimplicit def toTerm(word:String) = Terminal(word)\\nval anyToRhs:PartialFunction[Any,RHS] = {\\n  case s:String => toTerm(s) \\n  case s:Symbol => toNonTerm(s) \\n}\\nimplicit def toRule1(rule:(Symbol,List[Any])) = \\n  Rule(rule._1,rule._2.collect(anyToRhs)) \\n\\nimplicit def toRule2(rule:(Symbol,Any)) = \\n  Rule(rule._1,List(anyToRhs(rule._2))) \\n    \\ndef rhsToString(rhs:RHS) = rhs match {\\n  case NonTerminal(n) => n.toString\\n  case Terminal(w) => w\\n}    \\nimplicit def toHTML(cfg:CFG) = {\\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\\n      if (x == cfg.S) -1 else if (y == cfg.S) 1 else x.name.toString.compareTo(y.name.toString)\\n    }  \\n  }      \\n  table(cfg.R.sortBy(_.lhs)(lhsOrdering).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\nimplicit def derivToHTML(deriv:Seq[Seq[RHS]]) = {\\n  table(deriv.map(d => Seq(d.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\ndef cfgFromRules(start:NonTerminal, rules:Rule*) = {\\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\\n  CFG(nonTerminals,terminals,rules.toList,start)\\n}  \",\"// def cfgFromRules(start:NonTerminal, rules:Rule*)\\nval cfg = cfgFromRules('S,\\n  'S -> List('NP_p,'VP_p), 'S -> List('NP_s, 'VP_s),   \\n  'NP_p -> List(\\\"Matko\\\",\\\"raps\\\"),\\n  'VP_p -> List(\\\"are\\\", 'ADJ),\\n  'NP_s -> List(\\\"Matko\\\"),\\n  'VP_s -> List(\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\"),\\n  'ADJ -> \\\"silly\\\")\\ncfg \",\"import scala.collection.mutable.{ArrayBuffer,ListBuffer}\\nval rand = new scala.util.Random(0) // 0 is the seed\\n@scala.annotation.tailrec //annotation that ensures tail recursive optimization\\ndef generateDeriv(cfg: CFG, sentence:Seq[RHS], result:Seq[Seq[RHS]] = Seq.empty):Seq[Seq[RHS]] = \\n  // finds the first element of the sentence which is a NonTerminal symbol\\n  sentence.zipWithIndex.collectFirst { case r@(n:NonTerminal,_) => r } match {\\n    // for element that's a NonTerminal symbol\\n    case Some((n,index)) =>\\n      // find all rules whose lhs is that symbol\\n      val rules =  cfg.R.filter(_.lhs == n)\\n      // randomly pick one rule out of them\\n      val sampled = rules(rand.nextInt(rules.length))\\n      // replace that element with the rule's rhs\\n      val next = sentence.patch(index,sampled.rhs,1)\\n      // recursively repeat again\\n      generateDeriv(cfg, next, result.get :+ next)\\n    // didn't find such rule\\n    case None => result \\n  }\",\"generateDeriv(cfg,Seq(cfg.S)) \",\"sealed trait ParseTree { def node: RHS}\\ncase class Node(node:NonTerminal, children:List[ParseTree]) extends ParseTree\\ncase class Leaf(node:Terminal) extends ParseTree\",\"import ml.wolfe.nlp.syntax._\\ndef toRenderTree(tree:ParseTree):RenderTree = tree match {\\n  case Leaf(Terminal(w)) => RenderTree(w,\\\"terminal\\\")\\n  case Node(NonTerminal(l),children) => RenderTree(l.toString, \\\"nonterminal\\\",children map toRenderTree)\\n}\\nimplicit def treeToHTML(tree:ParseTree) = renderParseTree(toRenderTree(tree))\\n\"]"}};
        var id = 13;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nIn the same way we could generate derivations before, we can now generate parse trees from a CFG.","extraFields":{}};
        var id = 14;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"def generateTree(cfg:CFG, rhs:RHS):ParseTree = rhs match {\n  case t:Terminal => Leaf(t)    // for a terminal node, return the leaf\n  // for a NonTerminal node...\n  case n:NonTerminal =>         // for a NonTerminal node...\n    val rules =  cfg.R.filter(_.lhs == n)                   // find appropriate rules\n    val sampled = rules(rand.nextInt(rules.length))         // pick one\n    val children = sampled.rhs.map(generateTree(cfg,_))     // and generate trees for its rhs\n    Node(n,children)\n} ","extraFields":{"hide_output":"true","aggregatedCells":"[\"// sealed trait can be extended only in the same file\\nsealed trait RHS\\n// Symbol represents a closed set of identifiers, enabling quick comparison\\ncase class NonTerminal(name:Symbol) extends RHS \\ncase class Terminal(name:String) extends RHS \\ncase class Rule(lhs:NonTerminal,rhs:List[RHS])\\ncase class CFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[Rule],S:NonTerminal)\\n1\",\"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\\nimplicit def toTerm(word:String) = Terminal(word)\\nval anyToRhs:PartialFunction[Any,RHS] = {\\n  case s:String => toTerm(s) \\n  case s:Symbol => toNonTerm(s) \\n}\\nimplicit def toRule1(rule:(Symbol,List[Any])) = \\n  Rule(rule._1,rule._2.collect(anyToRhs)) \\n\\nimplicit def toRule2(rule:(Symbol,Any)) = \\n  Rule(rule._1,List(anyToRhs(rule._2))) \\n    \\ndef rhsToString(rhs:RHS) = rhs match {\\n  case NonTerminal(n) => n.toString\\n  case Terminal(w) => w\\n}    \\nimplicit def toHTML(cfg:CFG) = {\\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\\n      if (x == cfg.S) -1 else if (y == cfg.S) 1 else x.name.toString.compareTo(y.name.toString)\\n    }  \\n  }      \\n  table(cfg.R.sortBy(_.lhs)(lhsOrdering).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\nimplicit def derivToHTML(deriv:Seq[Seq[RHS]]) = {\\n  table(deriv.map(d => Seq(d.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\ndef cfgFromRules(start:NonTerminal, rules:Rule*) = {\\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\\n  CFG(nonTerminals,terminals,rules.toList,start)\\n}  \",\"// def cfgFromRules(start:NonTerminal, rules:Rule*)\\nval cfg = cfgFromRules('S,\\n  'S -> List('NP_p,'VP_p), 'S -> List('NP_s, 'VP_s),   \\n  'NP_p -> List(\\\"Matko\\\",\\\"raps\\\"),\\n  'VP_p -> List(\\\"are\\\", 'ADJ),\\n  'NP_s -> List(\\\"Matko\\\"),\\n  'VP_s -> List(\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\"),\\n  'ADJ -> \\\"silly\\\")\\ncfg \",\"import scala.collection.mutable.{ArrayBuffer,ListBuffer}\\nval rand = new scala.util.Random(0) // 0 is the seed\\n@scala.annotation.tailrec //annotation that ensures tail recursive optimization\\ndef generateDeriv(cfg: CFG, sentence:Seq[RHS], result:Seq[Seq[RHS]] = Seq.empty):Seq[Seq[RHS]] = \\n  // finds the first element of the sentence which is a NonTerminal symbol\\n  sentence.zipWithIndex.collectFirst { case r@(n:NonTerminal,_) => r } match {\\n    // for element that's a NonTerminal symbol\\n    case Some((n,index)) =>\\n      // find all rules whose lhs is that symbol\\n      val rules =  cfg.R.filter(_.lhs == n)\\n      // randomly pick one rule out of them\\n      val sampled = rules(rand.nextInt(rules.length))\\n      // replace that element with the rule's rhs\\n      val next = sentence.patch(index,sampled.rhs,1)\\n      // recursively repeat again\\n      generateDeriv(cfg, next, result.get :+ next)\\n    // didn't find such rule\\n    case None => result \\n  }\",\"generateDeriv(cfg,Seq(cfg.S)) \",\"sealed trait ParseTree { def node: RHS}\\ncase class Node(node:NonTerminal, children:List[ParseTree]) extends ParseTree\\ncase class Leaf(node:Terminal) extends ParseTree\",\"import ml.wolfe.nlp.syntax._\\ndef toRenderTree(tree:ParseTree):RenderTree = tree match {\\n  case Leaf(Terminal(w)) => RenderTree(w,\\\"terminal\\\")\\n  case Node(NonTerminal(l),children) => RenderTree(l.toString, \\\"nonterminal\\\",children map toRenderTree)\\n}\\nimplicit def treeToHTML(tree:ParseTree) = renderParseTree(toRenderTree(tree))\\n\",\"Node('S, List(Node('NP_p, List(Leaf(\\\"Matko\\\"), Leaf(\\\"raps\\\"))),\\n              Node('VP_p,List(Leaf(\\\"are\\\"), Leaf(\\\"silly\\\")))))\"]"}};
        var id = 15;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nNow let us generate a tree, starting from a non-terminal in the CFG.","extraFields":{}};
        var id = 16;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"generateTree(cfg,'S)     ","extraFields":{"cache":"false","aggregatedCells":"[\"// sealed trait can be extended only in the same file\\nsealed trait RHS\\n// Symbol represents a closed set of identifiers, enabling quick comparison\\ncase class NonTerminal(name:Symbol) extends RHS \\ncase class Terminal(name:String) extends RHS \\ncase class Rule(lhs:NonTerminal,rhs:List[RHS])\\ncase class CFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[Rule],S:NonTerminal)\\n1\",\"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\\nimplicit def toTerm(word:String) = Terminal(word)\\nval anyToRhs:PartialFunction[Any,RHS] = {\\n  case s:String => toTerm(s) \\n  case s:Symbol => toNonTerm(s) \\n}\\nimplicit def toRule1(rule:(Symbol,List[Any])) = \\n  Rule(rule._1,rule._2.collect(anyToRhs)) \\n\\nimplicit def toRule2(rule:(Symbol,Any)) = \\n  Rule(rule._1,List(anyToRhs(rule._2))) \\n    \\ndef rhsToString(rhs:RHS) = rhs match {\\n  case NonTerminal(n) => n.toString\\n  case Terminal(w) => w\\n}    \\nimplicit def toHTML(cfg:CFG) = {\\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\\n      if (x == cfg.S) -1 else if (y == cfg.S) 1 else x.name.toString.compareTo(y.name.toString)\\n    }  \\n  }      \\n  table(cfg.R.sortBy(_.lhs)(lhsOrdering).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\nimplicit def derivToHTML(deriv:Seq[Seq[RHS]]) = {\\n  table(deriv.map(d => Seq(d.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\ndef cfgFromRules(start:NonTerminal, rules:Rule*) = {\\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\\n  CFG(nonTerminals,terminals,rules.toList,start)\\n}  \",\"// def cfgFromRules(start:NonTerminal, rules:Rule*)\\nval cfg = cfgFromRules('S,\\n  'S -> List('NP_p,'VP_p), 'S -> List('NP_s, 'VP_s),   \\n  'NP_p -> List(\\\"Matko\\\",\\\"raps\\\"),\\n  'VP_p -> List(\\\"are\\\", 'ADJ),\\n  'NP_s -> List(\\\"Matko\\\"),\\n  'VP_s -> List(\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\"),\\n  'ADJ -> \\\"silly\\\")\\ncfg \",\"import scala.collection.mutable.{ArrayBuffer,ListBuffer}\\nval rand = new scala.util.Random(0) // 0 is the seed\\n@scala.annotation.tailrec //annotation that ensures tail recursive optimization\\ndef generateDeriv(cfg: CFG, sentence:Seq[RHS], result:Seq[Seq[RHS]] = Seq.empty):Seq[Seq[RHS]] = \\n  // finds the first element of the sentence which is a NonTerminal symbol\\n  sentence.zipWithIndex.collectFirst { case r@(n:NonTerminal,_) => r } match {\\n    // for element that's a NonTerminal symbol\\n    case Some((n,index)) =>\\n      // find all rules whose lhs is that symbol\\n      val rules =  cfg.R.filter(_.lhs == n)\\n      // randomly pick one rule out of them\\n      val sampled = rules(rand.nextInt(rules.length))\\n      // replace that element with the rule's rhs\\n      val next = sentence.patch(index,sampled.rhs,1)\\n      // recursively repeat again\\n      generateDeriv(cfg, next, result.get :+ next)\\n    // didn't find such rule\\n    case None => result \\n  }\",\"generateDeriv(cfg,Seq(cfg.S)) \",\"sealed trait ParseTree { def node: RHS}\\ncase class Node(node:NonTerminal, children:List[ParseTree]) extends ParseTree\\ncase class Leaf(node:Terminal) extends ParseTree\",\"import ml.wolfe.nlp.syntax._\\ndef toRenderTree(tree:ParseTree):RenderTree = tree match {\\n  case Leaf(Terminal(w)) => RenderTree(w,\\\"terminal\\\")\\n  case Node(NonTerminal(l),children) => RenderTree(l.toString, \\\"nonterminal\\\",children map toRenderTree)\\n}\\nimplicit def treeToHTML(tree:ParseTree) = renderParseTree(toRenderTree(tree))\\n\",\"Node('S, List(Node('NP_p, List(Leaf(\\\"Matko\\\"), Leaf(\\\"raps\\\"))),\\n              Node('VP_p,List(Leaf(\\\"are\\\"), Leaf(\\\"silly\\\")))))\",\"def generateTree(cfg:CFG, rhs:RHS):ParseTree = rhs match {\\n  case t:Terminal => Leaf(t)\\n  case n:NonTerminal =>\\n    val rules =  cfg.R.filter(_.lhs == n)\\n    val sampled = rules(rand.nextInt(rules.length))\\n    val children = sampled.rhs.map(generateTree(cfg,_))\\n    Node(n,children)\\n} \"]"}};
        var id = 17;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\n### Finding Parse Trees\nAs you can see, parse trees uncover how a sentence is structured with respect to a grammar. In fact, they give us insights about both constituency and grammatical relations: In the above case the subtrees headed by \"NP\" nodes represent noun phrase constituents; likewise, the \"NP\" and \"VP\" subtrees under \"S\" represent the subject and object of a sentence. It is interesting to generate trees and hence sentences given a starting symbol. However, in practice it is often more useful to find a parse tree given a sentence, if existent. This process is generally referred to as parsing. <span class=\"summary\"> **Parsing**: find a legal parse tree given a sentence and a grammar.</span>\n\nThere are a couple of approaches to find a legal parse tree given a sentence and grammar:<span class=\"summary\"></span>\n\n* **Top-Down**: Start with the start symbol and generate trees; backtrack if they do not match observed sentence.\n* **Bottom-Up**: Start with the sentence, and find rules that generate parts of it; backtrack if no start symbol can be induced.\n* **Dynamic Programming**: Explore several trees in parallel and re-use computations.\n\n<div class=\"newslide\"></div>\n#### Bottom-Up Parsing with Backtracking\nA bottom-up parser with backtracking maintains a state consisting of a stack of processed trees, and buffer of remaining words, and a history of previous states we can backtrack to if we cannot make more progress. Roughly speaking, the algorithm proceeds by iteratively reducing the stack via rules to new trees, moving forward in the sentence, and backtracking to previous states when we reach the end of the sentence but cannot create a single tree. <span class=\"summary\"> **Reduce** a stack of trees using rules, **shift** tokens on the stack, **backtrack** when we reach the end but have more than one tree on the stack.</span>\n\n<div class=\"newslide\"></div>\nIn Scala code the parsing algorithm can be formulated as follows. Notice the use of immutable data structures which makes storing and recalling previous states very efficient. Also notice that we record a history of transitions. This is not needed for the algorithm to work, but allows us to inspect its behaviour afterwards. <span class=\"summary\">A scala bottom up parser:</span>","extraFields":{}};
        var id = 18;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"type Stack = List[ParseTree] // stack of processed trees\ntype Buffer = List[String] // buffer of remaining words\ncase class State(stack:Stack, buffer:Buffer, rules:List[Rule])\ncase class Transition(state:State, op:Symbol)\n\ndef bottomUpParse(cfg:CFG, sentence:List[String]) = {\n  var history:List[State] = Nil\n  var state = State(Nil,sentence,Nil) // initial state\n  var transitions = Transition(state,'Init) :: Nil // list of transitions\n  def reduce() {\n    while (state.rules.nonEmpty) {\n      val rule = state.rules.head // take the leftmost rule\n      val top = state.stack.take(rule.rhs.length).reverse // take elems from stack\n      if (top.map(_.node) == rule.rhs) { // if rule can be applied\n        history = state :: history // add state to the history\n        state = state.copy(\n          stack = Node(rule.lhs, top) :: state.stack.drop(rule.rhs.length), // take rhs off the stack, add lhs on\n          rules = cfg.R // re-populate rules\n        )\n        transitions = Transition(state,'Reduce) :: transitions // log\n\n      } else state = state.copy(rules = state.rules.tail) // otherwise ignore the rule\n    }   \n  }\n  def shift() { // shift the left word from the buffer to the stack\n    state = state.copy(\n      stack = Leaf(state.buffer.head) :: state.stack,   // add word to the stack\n      buffer = state.buffer.tail,                       // decrease the buffer\n      rules = cfg.R                                     // populate rules\n    )\n    transitions = Transition(state,'Shift) :: transitions // log\n  }\n  def backtrack() { // go back to the previous state\n    state = history.head.copy(rules = history.head.rules.tail)  // state = current state without the last rule\n    transitions = Transition(state,'Backtrack) :: transitions   // log\n    history = history.tail                                      // get rid of the last history element\n  }\n  // aka shift-reduce parsing with backtracking\n  while (state.buffer.nonEmpty || (state.stack.length > 1 && history.nonEmpty) || state.rules.nonEmpty) {\n    if (state.rules.nonEmpty) reduce()              // reduce, if there are rules to reduce with\n    if (state.buffer.nonEmpty) shift()              // shift, if there is something on the buffer to shift\n    else if (state.stack.length > 1) backtrack()    // backtrack, if nothing else to do\n  }\n  transitions \n} ","extraFields":{"aggregatedCells":"[\"// sealed trait can be extended only in the same file\\nsealed trait RHS\\n// Symbol represents a closed set of identifiers, enabling quick comparison\\ncase class NonTerminal(name:Symbol) extends RHS \\ncase class Terminal(name:String) extends RHS \\ncase class Rule(lhs:NonTerminal,rhs:List[RHS])\\ncase class CFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[Rule],S:NonTerminal)\\n1\",\"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\\nimplicit def toTerm(word:String) = Terminal(word)\\nval anyToRhs:PartialFunction[Any,RHS] = {\\n  case s:String => toTerm(s) \\n  case s:Symbol => toNonTerm(s) \\n}\\nimplicit def toRule1(rule:(Symbol,List[Any])) = \\n  Rule(rule._1,rule._2.collect(anyToRhs)) \\n\\nimplicit def toRule2(rule:(Symbol,Any)) = \\n  Rule(rule._1,List(anyToRhs(rule._2))) \\n    \\ndef rhsToString(rhs:RHS) = rhs match {\\n  case NonTerminal(n) => n.toString\\n  case Terminal(w) => w\\n}    \\nimplicit def toHTML(cfg:CFG) = {\\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\\n      if (x == cfg.S) -1 else if (y == cfg.S) 1 else x.name.toString.compareTo(y.name.toString)\\n    }  \\n  }      \\n  table(cfg.R.sortBy(_.lhs)(lhsOrdering).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\nimplicit def derivToHTML(deriv:Seq[Seq[RHS]]) = {\\n  table(deriv.map(d => Seq(d.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\ndef cfgFromRules(start:NonTerminal, rules:Rule*) = {\\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\\n  CFG(nonTerminals,terminals,rules.toList,start)\\n}  \",\"// def cfgFromRules(start:NonTerminal, rules:Rule*)\\nval cfg = cfgFromRules('S,\\n  'S -> List('NP_p,'VP_p), 'S -> List('NP_s, 'VP_s),   \\n  'NP_p -> List(\\\"Matko\\\",\\\"raps\\\"),\\n  'VP_p -> List(\\\"are\\\", 'ADJ),\\n  'NP_s -> List(\\\"Matko\\\"),\\n  'VP_s -> List(\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\"),\\n  'ADJ -> \\\"silly\\\")\\ncfg \",\"import scala.collection.mutable.{ArrayBuffer,ListBuffer}\\nval rand = new scala.util.Random(0) // 0 is the seed\\n@scala.annotation.tailrec //annotation that ensures tail recursive optimization\\ndef generateDeriv(cfg: CFG, sentence:Seq[RHS], result:Seq[Seq[RHS]] = Seq.empty):Seq[Seq[RHS]] = \\n  // finds the first element of the sentence which is a NonTerminal symbol\\n  sentence.zipWithIndex.collectFirst { case r@(n:NonTerminal,_) => r } match {\\n    // for element that's a NonTerminal symbol\\n    case Some((n,index)) =>\\n      // find all rules whose lhs is that symbol\\n      val rules =  cfg.R.filter(_.lhs == n)\\n      // randomly pick one rule out of them\\n      val sampled = rules(rand.nextInt(rules.length))\\n      // replace that element with the rule's rhs\\n      val next = sentence.patch(index,sampled.rhs,1)\\n      // recursively repeat again\\n      generateDeriv(cfg, next, result.get :+ next)\\n    // didn't find such rule\\n    case None => result \\n  }\",\"generateDeriv(cfg,Seq(cfg.S)) \",\"sealed trait ParseTree { def node: RHS}\\ncase class Node(node:NonTerminal, children:List[ParseTree]) extends ParseTree\\ncase class Leaf(node:Terminal) extends ParseTree\",\"import ml.wolfe.nlp.syntax._\\ndef toRenderTree(tree:ParseTree):RenderTree = tree match {\\n  case Leaf(Terminal(w)) => RenderTree(w,\\\"terminal\\\")\\n  case Node(NonTerminal(l),children) => RenderTree(l.toString, \\\"nonterminal\\\",children map toRenderTree)\\n}\\nimplicit def treeToHTML(tree:ParseTree) = renderParseTree(toRenderTree(tree))\\n\",\"Node('S, List(Node('NP_p, List(Leaf(\\\"Matko\\\"), Leaf(\\\"raps\\\"))),\\n              Node('VP_p,List(Leaf(\\\"are\\\"), Leaf(\\\"silly\\\")))))\",\"def generateTree(cfg:CFG, rhs:RHS):ParseTree = rhs match {\\n  case t:Terminal => Leaf(t)\\n  case n:NonTerminal =>\\n    val rules =  cfg.R.filter(_.lhs == n)\\n    val sampled = rules(rand.nextInt(rules.length))\\n    val children = sampled.rhs.map(generateTree(cfg,_))\\n    Node(n,children)\\n} \",\"generateTree(cfg,'S)     \"]"}};
        var id = 19;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"def treeToString(tree:ParseTree):String = tree match {\n  case Node(NonTerminal(n), children) => s\"($n ${children.map(treeToString).mkString(\" \")})\"\n  case Leaf(Terminal(w)) => w\n}\nimplicit def transitionsToHTML(transitions:List[Transition]) = {\n  def toRow(t:Transition) = Seq(t.op, t.state.stack.reverse.map(treeToString).mkString(\" | \"),t.state.buffer.mkString(\" \"))\n  table(transitions.map(toRow))\n}\ndef filterNonTerminalsRecursive(N:Set[NonTerminal])(tree: ParseTree):List[ParseTree] = tree match {\n   case Node(n, children) if !N(n) => children flatMap filterNonTerminalsRecursive(N)\n   case Node(n, children) => Node(n,children flatMap filterNonTerminalsRecursive(N))::Nil\n   case _ => List(tree)\n} \ndef filterNonTerminals(N:Set[NonTerminal], tree: ParseTree) = filterNonTerminalsRecursive(N)(tree).head","extraFields":{"hide":"true","hide_output":"true","aggregatedCells":"[\"// sealed trait can be extended only in the same file\\nsealed trait RHS\\n// Symbol represents a closed set of identifiers, enabling quick comparison\\ncase class NonTerminal(name:Symbol) extends RHS \\ncase class Terminal(name:String) extends RHS \\ncase class Rule(lhs:NonTerminal,rhs:List[RHS])\\ncase class CFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[Rule],S:NonTerminal)\\n1\",\"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\\nimplicit def toTerm(word:String) = Terminal(word)\\nval anyToRhs:PartialFunction[Any,RHS] = {\\n  case s:String => toTerm(s) \\n  case s:Symbol => toNonTerm(s) \\n}\\nimplicit def toRule1(rule:(Symbol,List[Any])) = \\n  Rule(rule._1,rule._2.collect(anyToRhs)) \\n\\nimplicit def toRule2(rule:(Symbol,Any)) = \\n  Rule(rule._1,List(anyToRhs(rule._2))) \\n    \\ndef rhsToString(rhs:RHS) = rhs match {\\n  case NonTerminal(n) => n.toString\\n  case Terminal(w) => w\\n}    \\nimplicit def toHTML(cfg:CFG) = {\\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\\n      if (x == cfg.S) -1 else if (y == cfg.S) 1 else x.name.toString.compareTo(y.name.toString)\\n    }  \\n  }      \\n  table(cfg.R.sortBy(_.lhs)(lhsOrdering).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\nimplicit def derivToHTML(deriv:Seq[Seq[RHS]]) = {\\n  table(deriv.map(d => Seq(d.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\ndef cfgFromRules(start:NonTerminal, rules:Rule*) = {\\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\\n  CFG(nonTerminals,terminals,rules.toList,start)\\n}  \",\"// def cfgFromRules(start:NonTerminal, rules:Rule*)\\nval cfg = cfgFromRules('S,\\n  'S -> List('NP_p,'VP_p), 'S -> List('NP_s, 'VP_s),   \\n  'NP_p -> List(\\\"Matko\\\",\\\"raps\\\"),\\n  'VP_p -> List(\\\"are\\\", 'ADJ),\\n  'NP_s -> List(\\\"Matko\\\"),\\n  'VP_s -> List(\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\"),\\n  'ADJ -> \\\"silly\\\")\\ncfg \",\"import scala.collection.mutable.{ArrayBuffer,ListBuffer}\\nval rand = new scala.util.Random(0) // 0 is the seed\\n@scala.annotation.tailrec //annotation that ensures tail recursive optimization\\ndef generateDeriv(cfg: CFG, sentence:Seq[RHS], result:Seq[Seq[RHS]] = Seq.empty):Seq[Seq[RHS]] = \\n  // finds the first element of the sentence which is a NonTerminal symbol\\n  sentence.zipWithIndex.collectFirst { case r@(n:NonTerminal,_) => r } match {\\n    // for element that's a NonTerminal symbol\\n    case Some((n,index)) =>\\n      // find all rules whose lhs is that symbol\\n      val rules =  cfg.R.filter(_.lhs == n)\\n      // randomly pick one rule out of them\\n      val sampled = rules(rand.nextInt(rules.length))\\n      // replace that element with the rule's rhs\\n      val next = sentence.patch(index,sampled.rhs,1)\\n      // recursively repeat again\\n      generateDeriv(cfg, next, result.get :+ next)\\n    // didn't find such rule\\n    case None => result \\n  }\",\"generateDeriv(cfg,Seq(cfg.S)) \",\"sealed trait ParseTree { def node: RHS}\\ncase class Node(node:NonTerminal, children:List[ParseTree]) extends ParseTree\\ncase class Leaf(node:Terminal) extends ParseTree\",\"import ml.wolfe.nlp.syntax._\\ndef toRenderTree(tree:ParseTree):RenderTree = tree match {\\n  case Leaf(Terminal(w)) => RenderTree(w,\\\"terminal\\\")\\n  case Node(NonTerminal(l),children) => RenderTree(l.toString, \\\"nonterminal\\\",children map toRenderTree)\\n}\\nimplicit def treeToHTML(tree:ParseTree) = renderParseTree(toRenderTree(tree))\\n\",\"Node('S, List(Node('NP_p, List(Leaf(\\\"Matko\\\"), Leaf(\\\"raps\\\"))),\\n              Node('VP_p,List(Leaf(\\\"are\\\"), Leaf(\\\"silly\\\")))))\",\"def generateTree(cfg:CFG, rhs:RHS):ParseTree = rhs match {\\n  case t:Terminal => Leaf(t)\\n  case n:NonTerminal =>\\n    val rules =  cfg.R.filter(_.lhs == n)\\n    val sampled = rules(rand.nextInt(rules.length))\\n    val children = sampled.rhs.map(generateTree(cfg,_))\\n    Node(n,children)\\n} \",\"generateTree(cfg,'S)     \",\"type Stack = List[ParseTree]\\ntype Buffer = List[String]\\ncase class State(stack:Stack, buffer:Buffer, rules:List[Rule])\\ncase class Transition(state:State, op:Symbol)\\n\\ndef bottomUpParse(cfg:CFG, sentence:List[String]) = {\\n  var history:List[State] = Nil\\n  var state = State(Nil,sentence,Nil)\\n  var transitions = Transition(state,'Init) :: Nil\\n  def reduce() {\\n    while (state.rules.nonEmpty) {\\n      val rule = state.rules.head\\n      val top = state.stack.take(rule.rhs.length).reverse\\n      if (top.map(_.node) == rule.rhs) {\\n        history = state :: history \\n        state = state.copy(\\n          stack = Node(rule.lhs, top) :: state.stack.drop(rule.rhs.length),\\n          rules = cfg.R\\n        )\\n        transitions = Transition(state,'Reduce) :: transitions\\n\\n      } else state = state.copy(rules = state.rules.tail)\\n    }   \\n  }\\n  def shift() {\\n    state = state.copy(\\n      stack = Leaf(state.buffer.head) :: state.stack,  \\n      buffer = state.buffer.tail, \\n      rules = cfg.R\\n    )\\n    transitions = Transition(state,'Shift) :: transitions\\n  }\\n  def backtrack() {\\n    state = history.head.copy(rules = history.head.rules.tail) \\n    transitions = Transition(state,'Backtrack) :: transitions\\n    history = history.tail\\n  }\\n  while (state.buffer.nonEmpty || (state.stack.length > 1 && history.nonEmpty) || state.rules.nonEmpty) {\\n    if (state.rules.nonEmpty) reduce()\\n    if (state.buffer.nonEmpty) shift() \\n    else if (state.stack.length > 1) backtrack()\\n  }\\n  transitions \\n} \"]"}};
        var id = 20;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"Let us run an example parse.","extraFields":{}};
        var id = 21;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"bottomUpParse(cfg, List(\"MCRiedel\", \"raps\", \"are\", \"silly\")).reverse     ","extraFields":{"aggregatedCells":"[\"// sealed trait can be extended only in the same file\\nsealed trait RHS\\n// Symbol represents a closed set of identifiers, enabling quick comparison\\ncase class NonTerminal(name:Symbol) extends RHS \\ncase class Terminal(name:String) extends RHS \\ncase class Rule(lhs:NonTerminal,rhs:List[RHS])\\ncase class CFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[Rule],S:NonTerminal)\\n1\",\"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\\nimplicit def toTerm(word:String) = Terminal(word)\\nval anyToRhs:PartialFunction[Any,RHS] = {\\n  case s:String => toTerm(s) \\n  case s:Symbol => toNonTerm(s) \\n}\\nimplicit def toRule1(rule:(Symbol,List[Any])) = \\n  Rule(rule._1,rule._2.collect(anyToRhs)) \\n\\nimplicit def toRule2(rule:(Symbol,Any)) = \\n  Rule(rule._1,List(anyToRhs(rule._2))) \\n    \\ndef rhsToString(rhs:RHS) = rhs match {\\n  case NonTerminal(n) => n.toString\\n  case Terminal(w) => w\\n}    \\nimplicit def toHTML(cfg:CFG) = {\\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\\n      if (x == cfg.S) -1 else if (y == cfg.S) 1 else x.name.toString.compareTo(y.name.toString)\\n    }  \\n  }      \\n  table(cfg.R.sortBy(_.lhs)(lhsOrdering).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\nimplicit def derivToHTML(deriv:Seq[Seq[RHS]]) = {\\n  table(deriv.map(d => Seq(d.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\ndef cfgFromRules(start:NonTerminal, rules:Rule*) = {\\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\\n  CFG(nonTerminals,terminals,rules.toList,start)\\n}  \",\"// def cfgFromRules(start:NonTerminal, rules:Rule*)\\nval cfg = cfgFromRules('S,\\n  'S -> List('NP_p,'VP_p), 'S -> List('NP_s, 'VP_s),   \\n  'NP_p -> List(\\\"Matko\\\",\\\"raps\\\"),\\n  'VP_p -> List(\\\"are\\\", 'ADJ),\\n  'NP_s -> List(\\\"Matko\\\"),\\n  'VP_s -> List(\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\"),\\n  'ADJ -> \\\"silly\\\")\\ncfg \",\"import scala.collection.mutable.{ArrayBuffer,ListBuffer}\\nval rand = new scala.util.Random(0) // 0 is the seed\\n@scala.annotation.tailrec //annotation that ensures tail recursive optimization\\ndef generateDeriv(cfg: CFG, sentence:Seq[RHS], result:Seq[Seq[RHS]] = Seq.empty):Seq[Seq[RHS]] = \\n  // finds the first element of the sentence which is a NonTerminal symbol\\n  sentence.zipWithIndex.collectFirst { case r@(n:NonTerminal,_) => r } match {\\n    // for element that's a NonTerminal symbol\\n    case Some((n,index)) =>\\n      // find all rules whose lhs is that symbol\\n      val rules =  cfg.R.filter(_.lhs == n)\\n      // randomly pick one rule out of them\\n      val sampled = rules(rand.nextInt(rules.length))\\n      // replace that element with the rule's rhs\\n      val next = sentence.patch(index,sampled.rhs,1)\\n      // recursively repeat again\\n      generateDeriv(cfg, next, result.get :+ next)\\n    // didn't find such rule\\n    case None => result \\n  }\",\"generateDeriv(cfg,Seq(cfg.S)) \",\"sealed trait ParseTree { def node: RHS}\\ncase class Node(node:NonTerminal, children:List[ParseTree]) extends ParseTree\\ncase class Leaf(node:Terminal) extends ParseTree\",\"import ml.wolfe.nlp.syntax._\\ndef toRenderTree(tree:ParseTree):RenderTree = tree match {\\n  case Leaf(Terminal(w)) => RenderTree(w,\\\"terminal\\\")\\n  case Node(NonTerminal(l),children) => RenderTree(l.toString, \\\"nonterminal\\\",children map toRenderTree)\\n}\\nimplicit def treeToHTML(tree:ParseTree) = renderParseTree(toRenderTree(tree))\\n\",\"Node('S, List(Node('NP_p, List(Leaf(\\\"Matko\\\"), Leaf(\\\"raps\\\"))),\\n              Node('VP_p,List(Leaf(\\\"are\\\"), Leaf(\\\"silly\\\")))))\",\"def generateTree(cfg:CFG, rhs:RHS):ParseTree = rhs match {\\n  case t:Terminal => Leaf(t)\\n  case n:NonTerminal =>\\n    val rules =  cfg.R.filter(_.lhs == n)\\n    val sampled = rules(rand.nextInt(rules.length))\\n    val children = sampled.rhs.map(generateTree(cfg,_))\\n    Node(n,children)\\n} \",\"generateTree(cfg,'S)     \",\"type Stack = List[ParseTree]\\ntype Buffer = List[String]\\ncase class State(stack:Stack, buffer:Buffer, rules:List[Rule])\\ncase class Transition(state:State, op:Symbol)\\n\\ndef bottomUpParse(cfg:CFG, sentence:List[String]) = {\\n  var history:List[State] = Nil\\n  var state = State(Nil,sentence,Nil)\\n  var transitions = Transition(state,'Init) :: Nil\\n  def reduce() {\\n    while (state.rules.nonEmpty) {\\n      val rule = state.rules.head\\n      val top = state.stack.take(rule.rhs.length).reverse\\n      if (top.map(_.node) == rule.rhs) {\\n        history = state :: history \\n        state = state.copy(\\n          stack = Node(rule.lhs, top) :: state.stack.drop(rule.rhs.length),\\n          rules = cfg.R\\n        )\\n        transitions = Transition(state,'Reduce) :: transitions\\n\\n      } else state = state.copy(rules = state.rules.tail)\\n    }   \\n  }\\n  def shift() {\\n    state = state.copy(\\n      stack = Leaf(state.buffer.head) :: state.stack,  \\n      buffer = state.buffer.tail, \\n      rules = cfg.R\\n    )\\n    transitions = Transition(state,'Shift) :: transitions\\n  }\\n  def backtrack() {\\n    state = history.head.copy(rules = history.head.rules.tail) \\n    transitions = Transition(state,'Backtrack) :: transitions\\n    history = history.tail\\n  }\\n  while (state.buffer.nonEmpty || (state.stack.length > 1 && history.nonEmpty) || state.rules.nonEmpty) {\\n    if (state.rules.nonEmpty) reduce()\\n    if (state.buffer.nonEmpty) shift() \\n    else if (state.stack.length > 1) backtrack()\\n  }\\n  transitions \\n} \",\"def treeToString(tree:ParseTree):String = tree match {\\n  case Node(NonTerminal(n), children) => s\\\"($n ${children.map(treeToString).mkString(\\\" \\\")})\\\"\\n  case Leaf(Terminal(w)) => w\\n}\\nimplicit def transitionsToHTML(transitions:List[Transition]) = {\\n  def toRow(t:Transition) = Seq(t.op, t.state.stack.reverse.map(treeToString).mkString(\\\" | \\\"),t.state.buffer.mkString(\\\" \\\"))\\n  table(transitions.map(toRow))\\n}\\ndef filterNonTerminalsRecursive(N:Set[NonTerminal])(tree: ParseTree):List[ParseTree] = tree match {\\n   case Node(n, children) if !N(n) => children flatMap filterNonTerminalsRecursive(N)\\n   case Node(n, children) => Node(n,children flatMap filterNonTerminalsRecursive(N))::Nil\\n   case _ => List(tree)\\n} \\ndef filterNonTerminals(N:Set[NonTerminal], tree: ParseTree) = filterNonTerminalsRecursive(N)(tree).head\"]"}};
        var id = 22;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\n### Dynamic Programming for Parsing\nA problem with the bottom-up parser is the fact that, after back-tracking, it may redo many steps it had already before (can you find examples of this behaviour in the transitions above?). This suggests to remember steps and re-use then when needed. This is the general idea behind _dynamic programming_: caching and reusing computation whenever possible. \n\n<div class=\"newslide\"></div>\n#### Chomsky Normal Form\nIn the case of CFG parsing there exists a very effective dynamic program, the so-called Cocke–Younger–Kasami (CYK) algorithm. However, before we can apply this algorithm we need to _normalize_ the grammar. In particular, we need to make sure that each rule has one of the following forms:\n\n* \\\\(\\alpha \\rightarrow \\beta \\gamma\\\\) where \\\\(\\beta,\\gamma \\in N \\setminus \\\\{ S  \\\\} \\\\). \n* \\\\(\\alpha \\rightarrow t\\\\) where \\\\(t \\in \\Sigma\\\\).\n\n \nIn words: each rule is either binary and expands into two non-terminal non-Start symbols, or unary and expands into a word. This form is called _Chomsky Normal Form_ (CNF). \n\n<div class=\"newslide\"></div>\nFortunately we can convert every CFG into an equivalent CFG in CNF, in the sense that any derivation or parse of sentence in one grammar can be loss-lessly converted to a derivation in the other grammar. We present this conversion in scala below, but omitted cases not relevant to our grammar (Exercise: add these cases).\n\n","extraFields":{}};
        var id = 23;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"@scala.annotation.tailrec\ndef toCNF(cfg:CFG, result:CFG = CFG(Set.empty, Set.empty, Nil,'S), id:Int = 0):CFG = {\n  cfg.R match {\n    case Rule(lhs,rhs) :: tail if (rhs.length > 2) =>           // A -> BCD => A -> B1D, B1 -> BC\n      val leftN = NonTerminal(Symbol(lhs.name.toString + id))\n      val rule1 = Rule(lhs, leftN :: rhs.drop(2))\n      val rule2 = Rule(leftN, rhs.take(2))\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\n    case Rule(lhs, (l1:Terminal) :: l2 :: Nil) :: tail =>        // A -> aX => A -> A1X, A1 -> a\n      val n = NonTerminal(Symbol(l1.name + id))\n      val rule1 = Rule(lhs, n :: l2 :: Nil)\n      val rule2 = Rule(n,l1 :: Nil)\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\n    case Rule(lhs,l1 :: (l2:Terminal) :: Nil) :: tail =>        // A -> Xa => A -> XA1, A1 -> a\n      val n = NonTerminal(Symbol(l2.name + id))\n      val rule1 = Rule(lhs, l1 :: n :: Nil)\n      val rule2 = Rule(n, l2 :: Nil)\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\n    case h :: tail => toCNF(cfg.copy(R = tail), result.copy(R = h :: result.R),id)  // just copy in any other rule\n    case Nil => result  \n  }    \n} \nval cnf = toCNF(cfg) ","extraFields":{"aggregatedCells":"[\"// sealed trait can be extended only in the same file\\nsealed trait RHS\\n// Symbol represents a closed set of identifiers, enabling quick comparison\\ncase class NonTerminal(name:Symbol) extends RHS \\ncase class Terminal(name:String) extends RHS \\ncase class Rule(lhs:NonTerminal,rhs:List[RHS])\\ncase class CFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[Rule],S:NonTerminal)\\n1\",\"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\\nimplicit def toTerm(word:String) = Terminal(word)\\nval anyToRhs:PartialFunction[Any,RHS] = {\\n  case s:String => toTerm(s) \\n  case s:Symbol => toNonTerm(s) \\n}\\nimplicit def toRule1(rule:(Symbol,List[Any])) = \\n  Rule(rule._1,rule._2.collect(anyToRhs)) \\n\\nimplicit def toRule2(rule:(Symbol,Any)) = \\n  Rule(rule._1,List(anyToRhs(rule._2))) \\n    \\ndef rhsToString(rhs:RHS) = rhs match {\\n  case NonTerminal(n) => n.toString\\n  case Terminal(w) => w\\n}    \\nimplicit def toHTML(cfg:CFG) = {\\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\\n      if (x == cfg.S) -1 else if (y == cfg.S) 1 else x.name.toString.compareTo(y.name.toString)\\n    }  \\n  }      \\n  table(cfg.R.sortBy(_.lhs)(lhsOrdering).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\nimplicit def derivToHTML(deriv:Seq[Seq[RHS]]) = {\\n  table(deriv.map(d => Seq(d.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\ndef cfgFromRules(start:NonTerminal, rules:Rule*) = {\\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\\n  CFG(nonTerminals,terminals,rules.toList,start)\\n}  \",\"// def cfgFromRules(start:NonTerminal, rules:Rule*)\\nval cfg = cfgFromRules('S,\\n  'S -> List('NP_p,'VP_p), 'S -> List('NP_s, 'VP_s),   \\n  'NP_p -> List(\\\"Matko\\\",\\\"raps\\\"),\\n  'VP_p -> List(\\\"are\\\", 'ADJ),\\n  'NP_s -> List(\\\"Matko\\\"),\\n  'VP_s -> List(\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\"),\\n  'ADJ -> \\\"silly\\\")\\ncfg \",\"import scala.collection.mutable.{ArrayBuffer,ListBuffer}\\nval rand = new scala.util.Random(0) // 0 is the seed\\n@scala.annotation.tailrec //annotation that ensures tail recursive optimization\\ndef generateDeriv(cfg: CFG, sentence:Seq[RHS], result:Seq[Seq[RHS]] = Seq.empty):Seq[Seq[RHS]] = \\n  // finds the first element of the sentence which is a NonTerminal symbol\\n  sentence.zipWithIndex.collectFirst { case r@(n:NonTerminal,_) => r } match {\\n    // for element that's a NonTerminal symbol\\n    case Some((n,index)) =>\\n      // find all rules whose lhs is that symbol\\n      val rules =  cfg.R.filter(_.lhs == n)\\n      // randomly pick one rule out of them\\n      val sampled = rules(rand.nextInt(rules.length))\\n      // replace that element with the rule's rhs\\n      val next = sentence.patch(index,sampled.rhs,1)\\n      // recursively repeat again\\n      generateDeriv(cfg, next, result.get :+ next)\\n    // didn't find such rule\\n    case None => result \\n  }\",\"generateDeriv(cfg,Seq(cfg.S)) \",\"sealed trait ParseTree { def node: RHS}\\ncase class Node(node:NonTerminal, children:List[ParseTree]) extends ParseTree\\ncase class Leaf(node:Terminal) extends ParseTree\",\"import ml.wolfe.nlp.syntax._\\ndef toRenderTree(tree:ParseTree):RenderTree = tree match {\\n  case Leaf(Terminal(w)) => RenderTree(w,\\\"terminal\\\")\\n  case Node(NonTerminal(l),children) => RenderTree(l.toString, \\\"nonterminal\\\",children map toRenderTree)\\n}\\nimplicit def treeToHTML(tree:ParseTree) = renderParseTree(toRenderTree(tree))\\n\",\"Node('S, List(Node('NP_p, List(Leaf(\\\"Matko\\\"), Leaf(\\\"raps\\\"))),\\n              Node('VP_p,List(Leaf(\\\"are\\\"), Leaf(\\\"silly\\\")))))\",\"def generateTree(cfg:CFG, rhs:RHS):ParseTree = rhs match {\\n  case t:Terminal => Leaf(t)\\n  case n:NonTerminal =>\\n    val rules =  cfg.R.filter(_.lhs == n)\\n    val sampled = rules(rand.nextInt(rules.length))\\n    val children = sampled.rhs.map(generateTree(cfg,_))\\n    Node(n,children)\\n} \",\"generateTree(cfg,'S)     \",\"type Stack = List[ParseTree]\\ntype Buffer = List[String]\\ncase class State(stack:Stack, buffer:Buffer, rules:List[Rule])\\ncase class Transition(state:State, op:Symbol)\\n\\ndef bottomUpParse(cfg:CFG, sentence:List[String]) = {\\n  var history:List[State] = Nil\\n  var state = State(Nil,sentence,Nil)\\n  var transitions = Transition(state,'Init) :: Nil\\n  def reduce() {\\n    while (state.rules.nonEmpty) {\\n      val rule = state.rules.head\\n      val top = state.stack.take(rule.rhs.length).reverse\\n      if (top.map(_.node) == rule.rhs) {\\n        history = state :: history \\n        state = state.copy(\\n          stack = Node(rule.lhs, top) :: state.stack.drop(rule.rhs.length),\\n          rules = cfg.R\\n        )\\n        transitions = Transition(state,'Reduce) :: transitions\\n\\n      } else state = state.copy(rules = state.rules.tail)\\n    }   \\n  }\\n  def shift() {\\n    state = state.copy(\\n      stack = Leaf(state.buffer.head) :: state.stack,  \\n      buffer = state.buffer.tail, \\n      rules = cfg.R\\n    )\\n    transitions = Transition(state,'Shift) :: transitions\\n  }\\n  def backtrack() {\\n    state = history.head.copy(rules = history.head.rules.tail) \\n    transitions = Transition(state,'Backtrack) :: transitions\\n    history = history.tail\\n  }\\n  while (state.buffer.nonEmpty || (state.stack.length > 1 && history.nonEmpty) || state.rules.nonEmpty) {\\n    if (state.rules.nonEmpty) reduce()\\n    if (state.buffer.nonEmpty) shift() \\n    else if (state.stack.length > 1) backtrack()\\n  }\\n  transitions \\n} \",\"def treeToString(tree:ParseTree):String = tree match {\\n  case Node(NonTerminal(n), children) => s\\\"($n ${children.map(treeToString).mkString(\\\" \\\")})\\\"\\n  case Leaf(Terminal(w)) => w\\n}\\nimplicit def transitionsToHTML(transitions:List[Transition]) = {\\n  def toRow(t:Transition) = Seq(t.op, t.state.stack.reverse.map(treeToString).mkString(\\\" | \\\"),t.state.buffer.mkString(\\\" \\\"))\\n  table(transitions.map(toRow))\\n}\\ndef filterNonTerminalsRecursive(N:Set[NonTerminal])(tree: ParseTree):List[ParseTree] = tree match {\\n   case Node(n, children) if !N(n) => children flatMap filterNonTerminalsRecursive(N)\\n   case Node(n, children) => Node(n,children flatMap filterNonTerminalsRecursive(N))::Nil\\n   case _ => List(tree)\\n} \\ndef filterNonTerminals(N:Set[NonTerminal], tree: ParseTree) = filterNonTerminalsRecursive(N)(tree).head\",\"bottomUpParse(cfg, List(\\\"MCRiedel\\\", \\\"raps\\\", \\\"are\\\", \\\"silly\\\")).reverse     \"]"}};
        var id = 24;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\n#### CYK algorithm\nThe CYK algorithm caches, for each span in the sentence, all possible trees that can cover the span according to the CFG. Again we record all changes throughout the algorithm for later visualization. ","extraFields":{}};
        var id = 25;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"type Chart = Map[(Int,Int),List[ParseTree]]         // our cache (trees for each span)\ndef cyk(cfg:CFG, s:IndexedSeq[String]) = {\n  var chart:Chart = Map.empty withDefaultValue Nil  // initialize cache\n  var charts:List[Chart] = Nil                      // initialize global chart\n  val n = s.length\n  // init for the 1st row of the chart (A -> a rules)\n  for (i <- 0 until n) {\n    // take all the applicable rules with terminal symbols in rhs\n    chart +=  (i,i) -> cfg.R.collect { // produce (i,i) -> Node(rhs, Leaf(t))\n        case Rule(rhs,(t@Terminal(w)) :: Nil) if w == s(i) => Node(rhs, Leaf(t) :: Nil)}\n    charts ::= chart // add trees for each span to charts\n  }\n  // all further levels\n  for (l <- 1 until n; b <- 0 until n - l; e = b + l; m <- b until e) {\n    // search for rules where rhs = List(left, right)\n    val trees = for (left@Node(nl,_) <- chart(b,m); \n                     right@Node(nr,_) <- chart(m + 1,e);\n                     // search for rules where rhs = left + right elem\n                     rule <- cfg.R.filter(_.rhs == nl :: nr :: Nil)) yield {\n      Node(rule.lhs, left :: right :: Nil)      \n    } // the result is a collection of trees\n    chart += (b,e) -> (trees ::: chart(b,e))    // add trees to chart elem\n    charts ::= chart                            // add trees for each span to charts\n  }\n  charts\n}\n","extraFields":{"aggregatedCells":"[\"// sealed trait can be extended only in the same file\\nsealed trait RHS\\n// Symbol represents a closed set of identifiers, enabling quick comparison\\ncase class NonTerminal(name:Symbol) extends RHS \\ncase class Terminal(name:String) extends RHS \\ncase class Rule(lhs:NonTerminal,rhs:List[RHS])\\ncase class CFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[Rule],S:NonTerminal)\\n1\",\"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\\nimplicit def toTerm(word:String) = Terminal(word)\\nval anyToRhs:PartialFunction[Any,RHS] = {\\n  case s:String => toTerm(s) \\n  case s:Symbol => toNonTerm(s) \\n}\\nimplicit def toRule1(rule:(Symbol,List[Any])) = \\n  Rule(rule._1,rule._2.collect(anyToRhs)) \\n\\nimplicit def toRule2(rule:(Symbol,Any)) = \\n  Rule(rule._1,List(anyToRhs(rule._2))) \\n    \\ndef rhsToString(rhs:RHS) = rhs match {\\n  case NonTerminal(n) => n.toString\\n  case Terminal(w) => w\\n}    \\nimplicit def toHTML(cfg:CFG) = {\\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\\n      if (x == cfg.S) -1 else if (y == cfg.S) 1 else x.name.toString.compareTo(y.name.toString)\\n    }  \\n  }      \\n  table(cfg.R.sortBy(_.lhs)(lhsOrdering).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\nimplicit def derivToHTML(deriv:Seq[Seq[RHS]]) = {\\n  table(deriv.map(d => Seq(d.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\ndef cfgFromRules(start:NonTerminal, rules:Rule*) = {\\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\\n  CFG(nonTerminals,terminals,rules.toList,start)\\n}  \",\"// def cfgFromRules(start:NonTerminal, rules:Rule*)\\nval cfg = cfgFromRules('S,\\n  'S -> List('NP_p,'VP_p), 'S -> List('NP_s, 'VP_s),   \\n  'NP_p -> List(\\\"Matko\\\",\\\"raps\\\"),\\n  'VP_p -> List(\\\"are\\\", 'ADJ),\\n  'NP_s -> List(\\\"Matko\\\"),\\n  'VP_s -> List(\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\"),\\n  'ADJ -> \\\"silly\\\")\\ncfg \",\"import scala.collection.mutable.{ArrayBuffer,ListBuffer}\\nval rand = new scala.util.Random(0) // 0 is the seed\\n@scala.annotation.tailrec //annotation that ensures tail recursive optimization\\ndef generateDeriv(cfg: CFG, sentence:Seq[RHS], result:Seq[Seq[RHS]] = Seq.empty):Seq[Seq[RHS]] = \\n  // finds the first element of the sentence which is a NonTerminal symbol\\n  sentence.zipWithIndex.collectFirst { case r@(n:NonTerminal,_) => r } match {\\n    // for element that's a NonTerminal symbol\\n    case Some((n,index)) =>\\n      // find all rules whose lhs is that symbol\\n      val rules =  cfg.R.filter(_.lhs == n)\\n      // randomly pick one rule out of them\\n      val sampled = rules(rand.nextInt(rules.length))\\n      // replace that element with the rule's rhs\\n      val next = sentence.patch(index,sampled.rhs,1)\\n      // recursively repeat again\\n      generateDeriv(cfg, next, result.get :+ next)\\n    // didn't find such rule\\n    case None => result \\n  }\",\"generateDeriv(cfg,Seq(cfg.S)) \",\"sealed trait ParseTree { def node: RHS}\\ncase class Node(node:NonTerminal, children:List[ParseTree]) extends ParseTree\\ncase class Leaf(node:Terminal) extends ParseTree\",\"import ml.wolfe.nlp.syntax._\\ndef toRenderTree(tree:ParseTree):RenderTree = tree match {\\n  case Leaf(Terminal(w)) => RenderTree(w,\\\"terminal\\\")\\n  case Node(NonTerminal(l),children) => RenderTree(l.toString, \\\"nonterminal\\\",children map toRenderTree)\\n}\\nimplicit def treeToHTML(tree:ParseTree) = renderParseTree(toRenderTree(tree))\\n\",\"Node('S, List(Node('NP_p, List(Leaf(\\\"Matko\\\"), Leaf(\\\"raps\\\"))),\\n              Node('VP_p,List(Leaf(\\\"are\\\"), Leaf(\\\"silly\\\")))))\",\"def generateTree(cfg:CFG, rhs:RHS):ParseTree = rhs match {\\n  case t:Terminal => Leaf(t)\\n  case n:NonTerminal =>\\n    val rules =  cfg.R.filter(_.lhs == n)\\n    val sampled = rules(rand.nextInt(rules.length))\\n    val children = sampled.rhs.map(generateTree(cfg,_))\\n    Node(n,children)\\n} \",\"generateTree(cfg,'S)     \",\"type Stack = List[ParseTree]\\ntype Buffer = List[String]\\ncase class State(stack:Stack, buffer:Buffer, rules:List[Rule])\\ncase class Transition(state:State, op:Symbol)\\n\\ndef bottomUpParse(cfg:CFG, sentence:List[String]) = {\\n  var history:List[State] = Nil\\n  var state = State(Nil,sentence,Nil)\\n  var transitions = Transition(state,'Init) :: Nil\\n  def reduce() {\\n    while (state.rules.nonEmpty) {\\n      val rule = state.rules.head\\n      val top = state.stack.take(rule.rhs.length).reverse\\n      if (top.map(_.node) == rule.rhs) {\\n        history = state :: history \\n        state = state.copy(\\n          stack = Node(rule.lhs, top) :: state.stack.drop(rule.rhs.length),\\n          rules = cfg.R\\n        )\\n        transitions = Transition(state,'Reduce) :: transitions\\n\\n      } else state = state.copy(rules = state.rules.tail)\\n    }   \\n  }\\n  def shift() {\\n    state = state.copy(\\n      stack = Leaf(state.buffer.head) :: state.stack,  \\n      buffer = state.buffer.tail, \\n      rules = cfg.R\\n    )\\n    transitions = Transition(state,'Shift) :: transitions\\n  }\\n  def backtrack() {\\n    state = history.head.copy(rules = history.head.rules.tail) \\n    transitions = Transition(state,'Backtrack) :: transitions\\n    history = history.tail\\n  }\\n  while (state.buffer.nonEmpty || (state.stack.length > 1 && history.nonEmpty) || state.rules.nonEmpty) {\\n    if (state.rules.nonEmpty) reduce()\\n    if (state.buffer.nonEmpty) shift() \\n    else if (state.stack.length > 1) backtrack()\\n  }\\n  transitions \\n} \",\"def treeToString(tree:ParseTree):String = tree match {\\n  case Node(NonTerminal(n), children) => s\\\"($n ${children.map(treeToString).mkString(\\\" \\\")})\\\"\\n  case Leaf(Terminal(w)) => w\\n}\\nimplicit def transitionsToHTML(transitions:List[Transition]) = {\\n  def toRow(t:Transition) = Seq(t.op, t.state.stack.reverse.map(treeToString).mkString(\\\" | \\\"),t.state.buffer.mkString(\\\" \\\"))\\n  table(transitions.map(toRow))\\n}\\ndef filterNonTerminalsRecursive(N:Set[NonTerminal])(tree: ParseTree):List[ParseTree] = tree match {\\n   case Node(n, children) if !N(n) => children flatMap filterNonTerminalsRecursive(N)\\n   case Node(n, children) => Node(n,children flatMap filterNonTerminalsRecursive(N))::Nil\\n   case _ => List(tree)\\n} \\ndef filterNonTerminals(N:Set[NonTerminal], tree: ParseTree) = filterNonTerminalsRecursive(N)(tree).head\",\"bottomUpParse(cfg, List(\\\"MCRiedel\\\", \\\"raps\\\", \\\"are\\\", \\\"silly\\\")).reverse     \",\"@scala.annotation.tailrec\\ndef toCNF(cfg:CFG, result:CFG = CFG(Set.empty, Set.empty, Nil,'S), id:Int = 0):CFG = {\\n  cfg.R match {\\n    case Rule(lhs,rhs) :: tail if (rhs.length > 2) =>\\n      val leftN = NonTerminal(Symbol(lhs.name.toString + id))\\n      val rule1 = Rule(lhs, leftN :: rhs.drop(2))\\n      val rule2 = Rule(leftN, rhs.take(2))\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case Rule(lhs, (l1:Terminal) :: l2 :: Nil) :: tail => \\n      val n = NonTerminal(Symbol(l1.name + id))\\n      val rule1 = Rule(lhs, n :: l2 :: Nil)\\n      val rule2 = Rule(n,l1 :: Nil)\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case Rule(lhs,l1 :: (l2:Terminal) :: Nil) :: tail => \\n      val n = NonTerminal(Symbol(l2.name + id))\\n      val rule1 = Rule(lhs, l1 :: n :: Nil)\\n      val rule2 = Rule(n, l2 :: Nil)\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case h :: tail => toCNF(cfg.copy(R = tail), result.copy(R = h :: result.R),id)\\n    case Nil => result  \\n  }    \\n} \\nval cnf = toCNF(cfg) \"]","hide_output":"true"}};
        var id = 26;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nLet us run the algorithm.","extraFields":{}};
        var id = 27;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"cyk(cnf, Vector(\"Matko\",\"raps\", \"in\", \"StatNLP\")).head(0,3).head ","extraFields":{"aggregatedCells":"[\"// sealed trait can be extended only in the same file\\nsealed trait RHS\\n// Symbol represents a closed set of identifiers, enabling quick comparison\\ncase class NonTerminal(name:Symbol) extends RHS \\ncase class Terminal(name:String) extends RHS \\ncase class Rule(lhs:NonTerminal,rhs:List[RHS])\\ncase class CFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[Rule],S:NonTerminal)\\n1\",\"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\\nimplicit def toTerm(word:String) = Terminal(word)\\nval anyToRhs:PartialFunction[Any,RHS] = {\\n  case s:String => toTerm(s) \\n  case s:Symbol => toNonTerm(s) \\n}\\nimplicit def toRule1(rule:(Symbol,List[Any])) = \\n  Rule(rule._1,rule._2.collect(anyToRhs)) \\n\\nimplicit def toRule2(rule:(Symbol,Any)) = \\n  Rule(rule._1,List(anyToRhs(rule._2))) \\n    \\ndef rhsToString(rhs:RHS) = rhs match {\\n  case NonTerminal(n) => n.toString\\n  case Terminal(w) => w\\n}    \\nimplicit def toHTML(cfg:CFG) = {\\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\\n      if (x == cfg.S) -1 else if (y == cfg.S) 1 else x.name.toString.compareTo(y.name.toString)\\n    }  \\n  }      \\n  table(cfg.R.sortBy(_.lhs)(lhsOrdering).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\nimplicit def derivToHTML(deriv:Seq[Seq[RHS]]) = {\\n  table(deriv.map(d => Seq(d.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\ndef cfgFromRules(start:NonTerminal, rules:Rule*) = {\\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\\n  CFG(nonTerminals,terminals,rules.toList,start)\\n}  \",\"// def cfgFromRules(start:NonTerminal, rules:Rule*)\\nval cfg = cfgFromRules('S,\\n  'S -> List('NP_p,'VP_p), 'S -> List('NP_s, 'VP_s),   \\n  'NP_p -> List(\\\"Matko\\\",\\\"raps\\\"),\\n  'VP_p -> List(\\\"are\\\", 'ADJ),\\n  'NP_s -> List(\\\"Matko\\\"),\\n  'VP_s -> List(\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\"),\\n  'ADJ -> \\\"silly\\\")\\ncfg \",\"import scala.collection.mutable.{ArrayBuffer,ListBuffer}\\nval rand = new scala.util.Random(0) // 0 is the seed\\n@scala.annotation.tailrec //annotation that ensures tail recursive optimization\\ndef generateDeriv(cfg: CFG, sentence:Seq[RHS], result:Seq[Seq[RHS]] = Seq.empty):Seq[Seq[RHS]] = \\n  // finds the first element of the sentence which is a NonTerminal symbol\\n  sentence.zipWithIndex.collectFirst { case r@(n:NonTerminal,_) => r } match {\\n    // for element that's a NonTerminal symbol\\n    case Some((n,index)) =>\\n      // find all rules whose lhs is that symbol\\n      val rules =  cfg.R.filter(_.lhs == n)\\n      // randomly pick one rule out of them\\n      val sampled = rules(rand.nextInt(rules.length))\\n      // replace that element with the rule's rhs\\n      val next = sentence.patch(index,sampled.rhs,1)\\n      // recursively repeat again\\n      generateDeriv(cfg, next, result.get :+ next)\\n    // didn't find such rule\\n    case None => result \\n  }\",\"generateDeriv(cfg,Seq(cfg.S)) \",\"sealed trait ParseTree { def node: RHS}\\ncase class Node(node:NonTerminal, children:List[ParseTree]) extends ParseTree\\ncase class Leaf(node:Terminal) extends ParseTree\",\"import ml.wolfe.nlp.syntax._\\ndef toRenderTree(tree:ParseTree):RenderTree = tree match {\\n  case Leaf(Terminal(w)) => RenderTree(w,\\\"terminal\\\")\\n  case Node(NonTerminal(l),children) => RenderTree(l.toString, \\\"nonterminal\\\",children map toRenderTree)\\n}\\nimplicit def treeToHTML(tree:ParseTree) = renderParseTree(toRenderTree(tree))\\n\",\"Node('S, List(Node('NP_p, List(Leaf(\\\"Matko\\\"), Leaf(\\\"raps\\\"))),\\n              Node('VP_p,List(Leaf(\\\"are\\\"), Leaf(\\\"silly\\\")))))\",\"def generateTree(cfg:CFG, rhs:RHS):ParseTree = rhs match {\\n  case t:Terminal => Leaf(t)\\n  case n:NonTerminal =>\\n    val rules =  cfg.R.filter(_.lhs == n)\\n    val sampled = rules(rand.nextInt(rules.length))\\n    val children = sampled.rhs.map(generateTree(cfg,_))\\n    Node(n,children)\\n} \",\"generateTree(cfg,'S)     \",\"type Stack = List[ParseTree]\\ntype Buffer = List[String]\\ncase class State(stack:Stack, buffer:Buffer, rules:List[Rule])\\ncase class Transition(state:State, op:Symbol)\\n\\ndef bottomUpParse(cfg:CFG, sentence:List[String]) = {\\n  var history:List[State] = Nil\\n  var state = State(Nil,sentence,Nil)\\n  var transitions = Transition(state,'Init) :: Nil\\n  def reduce() {\\n    while (state.rules.nonEmpty) {\\n      val rule = state.rules.head\\n      val top = state.stack.take(rule.rhs.length).reverse\\n      if (top.map(_.node) == rule.rhs) {\\n        history = state :: history \\n        state = state.copy(\\n          stack = Node(rule.lhs, top) :: state.stack.drop(rule.rhs.length),\\n          rules = cfg.R\\n        )\\n        transitions = Transition(state,'Reduce) :: transitions\\n\\n      } else state = state.copy(rules = state.rules.tail)\\n    }   \\n  }\\n  def shift() {\\n    state = state.copy(\\n      stack = Leaf(state.buffer.head) :: state.stack,  \\n      buffer = state.buffer.tail, \\n      rules = cfg.R\\n    )\\n    transitions = Transition(state,'Shift) :: transitions\\n  }\\n  def backtrack() {\\n    state = history.head.copy(rules = history.head.rules.tail) \\n    transitions = Transition(state,'Backtrack) :: transitions\\n    history = history.tail\\n  }\\n  while (state.buffer.nonEmpty || (state.stack.length > 1 && history.nonEmpty) || state.rules.nonEmpty) {\\n    if (state.rules.nonEmpty) reduce()\\n    if (state.buffer.nonEmpty) shift() \\n    else if (state.stack.length > 1) backtrack()\\n  }\\n  transitions \\n} \",\"def treeToString(tree:ParseTree):String = tree match {\\n  case Node(NonTerminal(n), children) => s\\\"($n ${children.map(treeToString).mkString(\\\" \\\")})\\\"\\n  case Leaf(Terminal(w)) => w\\n}\\nimplicit def transitionsToHTML(transitions:List[Transition]) = {\\n  def toRow(t:Transition) = Seq(t.op, t.state.stack.reverse.map(treeToString).mkString(\\\" | \\\"),t.state.buffer.mkString(\\\" \\\"))\\n  table(transitions.map(toRow))\\n}\\ndef filterNonTerminalsRecursive(N:Set[NonTerminal])(tree: ParseTree):List[ParseTree] = tree match {\\n   case Node(n, children) if !N(n) => children flatMap filterNonTerminalsRecursive(N)\\n   case Node(n, children) => Node(n,children flatMap filterNonTerminalsRecursive(N))::Nil\\n   case _ => List(tree)\\n} \\ndef filterNonTerminals(N:Set[NonTerminal], tree: ParseTree) = filterNonTerminalsRecursive(N)(tree).head\",\"bottomUpParse(cfg, List(\\\"MCRiedel\\\", \\\"raps\\\", \\\"are\\\", \\\"silly\\\")).reverse     \",\"@scala.annotation.tailrec\\ndef toCNF(cfg:CFG, result:CFG = CFG(Set.empty, Set.empty, Nil,'S), id:Int = 0):CFG = {\\n  cfg.R match {\\n    case Rule(lhs,rhs) :: tail if (rhs.length > 2) =>\\n      val leftN = NonTerminal(Symbol(lhs.name.toString + id))\\n      val rule1 = Rule(lhs, leftN :: rhs.drop(2))\\n      val rule2 = Rule(leftN, rhs.take(2))\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case Rule(lhs, (l1:Terminal) :: l2 :: Nil) :: tail => \\n      val n = NonTerminal(Symbol(l1.name + id))\\n      val rule1 = Rule(lhs, n :: l2 :: Nil)\\n      val rule2 = Rule(n,l1 :: Nil)\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case Rule(lhs,l1 :: (l2:Terminal) :: Nil) :: tail => \\n      val n = NonTerminal(Symbol(l2.name + id))\\n      val rule1 = Rule(lhs, l1 :: n :: Nil)\\n      val rule2 = Rule(n, l2 :: Nil)\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case h :: tail => toCNF(cfg.copy(R = tail), result.copy(R = h :: result.R),id)\\n    case Nil => result  \\n  }    \\n} \\nval cnf = toCNF(cfg) \",\"type Chart = Map[(Int,Int),List[ParseTree]]\\ndef cyk(cfg:CFG, s:IndexedSeq[String]) = {\\n  var chart:Chart = Map.empty withDefaultValue Nil\\n  var charts:List[Chart] = Nil\\n  val n = s.length\\n  //init\\n  for (i <- 0 until n) {\\n    chart +=  (i,i) -> cfg.R.collect { \\n        case Rule(rhs,(t@Terminal(w)) :: Nil) if w == s(i) => Node(rhs, Leaf(t) :: Nil)}\\n    charts ::= chart  \\n  }\\n  for (l <- 1 until n; b <- 0 until n - l; e = b + l; m <- b until e) {\\n    val trees = for (left@Node(nl,_) <- chart(b,m); \\n                     right@Node(nr,_) <- chart(m + 1,e);\\n                     rule <- cfg.R.filter(_.rhs == nl :: nr :: Nil)) yield {\\n      Node(rule.lhs, left :: right :: Nil)      \\n    } \\n    chart += (b,e) -> (trees ::: chart(b,e))\\n    charts ::= chart\\n  }\\n  charts\\n}\\n\"]"}};
        var id = 28;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\n<div class=\"exercise\">\n  <div class=\"exname\">Exercise</div>\n  <div class=\"extext\">Manually perform CYK for this <a href=\"https://docs.google.com/document/d/160QtURHYQKdIWApWXZZFyyPH1q0EB0Nq4ptc8gmzCeM/edit#heading=h.hlfvaoch2h87\">data</a></div>\n</div>\n\n<div class=\"newslide\"></div>\n### Ambiguity \nFor real world grammars many phrases have several legal parse trees. Which one is the correct one depends on the intent of the speaker. That said, in many cases it is quite obvious that one parse tree should be more likely, or have a higher _probability_. This suggest a probabilistic treatment of grammars and parsing. Before we introduce probabilistic CFGs, let us inspect a typical case of syntactic natural language ambiguity. <span class=\"summary\">Sentences can have several legal parse trees.</span> \n","extraFields":{}};
        var id = 29;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"val ambCFG = cfgFromRules('S,\n  'S -> List('Subj,'VP),\n  'Subj -> \"He\",\n  'Verb -> \"shot\",\n  'VP -> List('Verb,'Obj), 'VP -> List('Verb,'Obj,'PP),\n  'PP -> List(\"in\",\"his\",\"pyjamas\"),\n  'Obj -> List(\"the\",\"elephant\"), 'Obj -> List(\"the\",\"elephant\",'PP)\n) \nfilterNonTerminals(ambCFG.N,cyk(toCNF(ambCFG), Vector(\"He\", \"shot\", \"the\", \"elephant\", \"in\", \"his\", \"pyjamas\")).head(0,6)(0)) ","extraFields":{"aggregatedCells":"[\"// sealed trait can be extended only in the same file\\nsealed trait RHS\\n// Symbol represents a closed set of identifiers, enabling quick comparison\\ncase class NonTerminal(name:Symbol) extends RHS \\ncase class Terminal(name:String) extends RHS \\ncase class Rule(lhs:NonTerminal,rhs:List[RHS])\\ncase class CFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[Rule],S:NonTerminal)\\n1\",\"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\\nimplicit def toTerm(word:String) = Terminal(word)\\nval anyToRhs:PartialFunction[Any,RHS] = {\\n  case s:String => toTerm(s) \\n  case s:Symbol => toNonTerm(s) \\n}\\nimplicit def toRule1(rule:(Symbol,List[Any])) = \\n  Rule(rule._1,rule._2.collect(anyToRhs)) \\n\\nimplicit def toRule2(rule:(Symbol,Any)) = \\n  Rule(rule._1,List(anyToRhs(rule._2))) \\n    \\ndef rhsToString(rhs:RHS) = rhs match {\\n  case NonTerminal(n) => n.toString\\n  case Terminal(w) => w\\n}    \\nimplicit def toHTML(cfg:CFG) = {\\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\\n      if (x == cfg.S) -1 else if (y == cfg.S) 1 else x.name.toString.compareTo(y.name.toString)\\n    }  \\n  }      \\n  table(cfg.R.sortBy(_.lhs)(lhsOrdering).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\nimplicit def derivToHTML(deriv:Seq[Seq[RHS]]) = {\\n  table(deriv.map(d => Seq(d.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\ndef cfgFromRules(start:NonTerminal, rules:Rule*) = {\\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\\n  CFG(nonTerminals,terminals,rules.toList,start)\\n}  \",\"// def cfgFromRules(start:NonTerminal, rules:Rule*)\\nval cfg = cfgFromRules('S,\\n  'S -> List('NP_p,'VP_p), 'S -> List('NP_s, 'VP_s),   \\n  'NP_p -> List(\\\"Matko\\\",\\\"raps\\\"),\\n  'VP_p -> List(\\\"are\\\", 'ADJ),\\n  'NP_s -> List(\\\"Matko\\\"),\\n  'VP_s -> List(\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\"),\\n  'ADJ -> \\\"silly\\\")\\ncfg \",\"import scala.collection.mutable.{ArrayBuffer,ListBuffer}\\nval rand = new scala.util.Random(0) // 0 is the seed\\n@scala.annotation.tailrec //annotation that ensures tail recursive optimization\\ndef generateDeriv(cfg: CFG, sentence:Seq[RHS], result:Seq[Seq[RHS]] = Seq.empty):Seq[Seq[RHS]] = \\n  // finds the first element of the sentence which is a NonTerminal symbol\\n  sentence.zipWithIndex.collectFirst { case r@(n:NonTerminal,_) => r } match {\\n    // for element that's a NonTerminal symbol\\n    case Some((n,index)) =>\\n      // find all rules whose lhs is that symbol\\n      val rules =  cfg.R.filter(_.lhs == n)\\n      // randomly pick one rule out of them\\n      val sampled = rules(rand.nextInt(rules.length))\\n      // replace that element with the rule's rhs\\n      val next = sentence.patch(index,sampled.rhs,1)\\n      // recursively repeat again\\n      generateDeriv(cfg, next, result.get :+ next)\\n    // didn't find such rule\\n    case None => result \\n  }\",\"generateDeriv(cfg,Seq(cfg.S)) \",\"sealed trait ParseTree { def node: RHS}\\ncase class Node(node:NonTerminal, children:List[ParseTree]) extends ParseTree\\ncase class Leaf(node:Terminal) extends ParseTree\",\"import ml.wolfe.nlp.syntax._\\ndef toRenderTree(tree:ParseTree):RenderTree = tree match {\\n  case Leaf(Terminal(w)) => RenderTree(w,\\\"terminal\\\")\\n  case Node(NonTerminal(l),children) => RenderTree(l.toString, \\\"nonterminal\\\",children map toRenderTree)\\n}\\nimplicit def treeToHTML(tree:ParseTree) = renderParseTree(toRenderTree(tree))\\n\",\"Node('S, List(Node('NP_p, List(Leaf(\\\"Matko\\\"), Leaf(\\\"raps\\\"))),\\n              Node('VP_p,List(Leaf(\\\"are\\\"), Leaf(\\\"silly\\\")))))\",\"def generateTree(cfg:CFG, rhs:RHS):ParseTree = rhs match {\\n  case t:Terminal => Leaf(t)\\n  case n:NonTerminal =>\\n    val rules =  cfg.R.filter(_.lhs == n)\\n    val sampled = rules(rand.nextInt(rules.length))\\n    val children = sampled.rhs.map(generateTree(cfg,_))\\n    Node(n,children)\\n} \",\"generateTree(cfg,'S)     \",\"type Stack = List[ParseTree]\\ntype Buffer = List[String]\\ncase class State(stack:Stack, buffer:Buffer, rules:List[Rule])\\ncase class Transition(state:State, op:Symbol)\\n\\ndef bottomUpParse(cfg:CFG, sentence:List[String]) = {\\n  var history:List[State] = Nil\\n  var state = State(Nil,sentence,Nil)\\n  var transitions = Transition(state,'Init) :: Nil\\n  def reduce() {\\n    while (state.rules.nonEmpty) {\\n      val rule = state.rules.head\\n      val top = state.stack.take(rule.rhs.length).reverse\\n      if (top.map(_.node) == rule.rhs) {\\n        history = state :: history \\n        state = state.copy(\\n          stack = Node(rule.lhs, top) :: state.stack.drop(rule.rhs.length),\\n          rules = cfg.R\\n        )\\n        transitions = Transition(state,'Reduce) :: transitions\\n\\n      } else state = state.copy(rules = state.rules.tail)\\n    }   \\n  }\\n  def shift() {\\n    state = state.copy(\\n      stack = Leaf(state.buffer.head) :: state.stack,  \\n      buffer = state.buffer.tail, \\n      rules = cfg.R\\n    )\\n    transitions = Transition(state,'Shift) :: transitions\\n  }\\n  def backtrack() {\\n    state = history.head.copy(rules = history.head.rules.tail) \\n    transitions = Transition(state,'Backtrack) :: transitions\\n    history = history.tail\\n  }\\n  while (state.buffer.nonEmpty || (state.stack.length > 1 && history.nonEmpty) || state.rules.nonEmpty) {\\n    if (state.rules.nonEmpty) reduce()\\n    if (state.buffer.nonEmpty) shift() \\n    else if (state.stack.length > 1) backtrack()\\n  }\\n  transitions \\n} \",\"def treeToString(tree:ParseTree):String = tree match {\\n  case Node(NonTerminal(n), children) => s\\\"($n ${children.map(treeToString).mkString(\\\" \\\")})\\\"\\n  case Leaf(Terminal(w)) => w\\n}\\nimplicit def transitionsToHTML(transitions:List[Transition]) = {\\n  def toRow(t:Transition) = Seq(t.op, t.state.stack.reverse.map(treeToString).mkString(\\\" | \\\"),t.state.buffer.mkString(\\\" \\\"))\\n  table(transitions.map(toRow))\\n}\\ndef filterNonTerminalsRecursive(N:Set[NonTerminal])(tree: ParseTree):List[ParseTree] = tree match {\\n   case Node(n, children) if !N(n) => children flatMap filterNonTerminalsRecursive(N)\\n   case Node(n, children) => Node(n,children flatMap filterNonTerminalsRecursive(N))::Nil\\n   case _ => List(tree)\\n} \\ndef filterNonTerminals(N:Set[NonTerminal], tree: ParseTree) = filterNonTerminalsRecursive(N)(tree).head\",\"bottomUpParse(cfg, List(\\\"MCRiedel\\\", \\\"raps\\\", \\\"are\\\", \\\"silly\\\")).reverse     \",\"@scala.annotation.tailrec\\ndef toCNF(cfg:CFG, result:CFG = CFG(Set.empty, Set.empty, Nil,'S), id:Int = 0):CFG = {\\n  cfg.R match {\\n    case Rule(lhs,rhs) :: tail if (rhs.length > 2) =>\\n      val leftN = NonTerminal(Symbol(lhs.name.toString + id))\\n      val rule1 = Rule(lhs, leftN :: rhs.drop(2))\\n      val rule2 = Rule(leftN, rhs.take(2))\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case Rule(lhs, (l1:Terminal) :: l2 :: Nil) :: tail => \\n      val n = NonTerminal(Symbol(l1.name + id))\\n      val rule1 = Rule(lhs, n :: l2 :: Nil)\\n      val rule2 = Rule(n,l1 :: Nil)\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case Rule(lhs,l1 :: (l2:Terminal) :: Nil) :: tail => \\n      val n = NonTerminal(Symbol(l2.name + id))\\n      val rule1 = Rule(lhs, l1 :: n :: Nil)\\n      val rule2 = Rule(n, l2 :: Nil)\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case h :: tail => toCNF(cfg.copy(R = tail), result.copy(R = h :: result.R),id)\\n    case Nil => result  \\n  }    \\n} \\nval cnf = toCNF(cfg) \",\"type Chart = Map[(Int,Int),List[ParseTree]]\\ndef cyk(cfg:CFG, s:IndexedSeq[String]) = {\\n  var chart:Chart = Map.empty withDefaultValue Nil\\n  var charts:List[Chart] = Nil\\n  val n = s.length\\n  //init\\n  for (i <- 0 until n) {\\n    chart +=  (i,i) -> cfg.R.collect { \\n        case Rule(rhs,(t@Terminal(w)) :: Nil) if w == s(i) => Node(rhs, Leaf(t) :: Nil)}\\n    charts ::= chart  \\n  }\\n  for (l <- 1 until n; b <- 0 until n - l; e = b + l; m <- b until e) {\\n    val trees = for (left@Node(nl,_) <- chart(b,m); \\n                     right@Node(nr,_) <- chart(m + 1,e);\\n                     rule <- cfg.R.filter(_.rhs == nl :: nr :: Nil)) yield {\\n      Node(rule.lhs, left :: right :: Nil)      \\n    } \\n    chart += (b,e) -> (trees ::: chart(b,e))\\n    charts ::= chart\\n  }\\n  charts\\n}\\n\",\"cyk(cnf, Vector(\\\"Matko\\\",\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\")).head(0,3).head \"]"}};
        var id = 30;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nThe example is an instance of _prepositional phrase attachment ambiguity_: the \"in his pyjamas\" phrase could both be part of the verb phrase, meaning that the shooting happened in pyjamas, or part of the noun phrase \"the elephant\", meaning that the elephant was in pyjamas. Both readings make syntactic sense, so there is nothing wrong with the grammar. However, we would like the machine to return the preferred reading when such sentence is parsed. For this we need to find a way to assign different readings different probabilities. <span class=\"summary\">Can we assign the better parse a higher _probability_?</span> \n\n<div class=\"newslide\"></div>\n### Probabilistic Context Free Grammars\n[Probabilistic Context Free Grammars](http://www.cs.columbia.edu/~mcollins/courses/nlp2011/notes/pcfgs.pdf) (PFCGs) are Context Free Grammars in which rules have probabilities. More formally, a PCFG consists of \n\n* A Context Free Grammar \\\\(G(N,\\Sigma,R,S)\\\\).\n* A parameter \\\\(q(\\alpha \\rightarrow \\beta)\\\\) for each rule  \\\\(\\alpha \\rightarrow \\beta \\in R\\\\). For each possible left hand side \\\\(\\alpha \\in N\\\\) we require \\\\(\\sum_\\beta q(\\alpha \\rightarrow \\beta) = 1\\\\).\n\nA PCFG defines a probability distribution over parse trees as follows. Given a parse tree \\\\(\\mathbf{t}\\\\) that contains the rules \\\\(\\alpha_1 \\rightarrow \\beta_1, \\ldots, \\alpha_n \\rightarrow \\beta_n\\\\), the probability of this tree under the PCFG is:\n$$\n  \\newcommand{parse}{\\mathbf{t}}\n  p(\\parse) = \\prod_i^n q(\\alpha_i \\rightarrow \\beta_i) \n$$\n\nNotice that we can develop and operate parsers with the structured prediction recipe. We have model \\\\(p\\\\), some parameters \\\\(\\params\\\\) that need to be estimated on a training set, and the prediction/search problem of finding the most likely parse tree given a sentence. The next sections will cover these aspects.\n\n<div class=\"newslide\"></div>\nBefore we show examples, let us define a scala data structure for\nPCFGs.    \n","extraFields":{}};
        var id = 31;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"case class ProbRule(lhs:NonTerminal, rhs: List[RHS],prob:Double)\ncase class PCFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[ProbRule],S:NonTerminal)","extraFields":{"aggregatedCells":"[\"// sealed trait can be extended only in the same file\\nsealed trait RHS\\n// Symbol represents a closed set of identifiers, enabling quick comparison\\ncase class NonTerminal(name:Symbol) extends RHS \\ncase class Terminal(name:String) extends RHS \\ncase class Rule(lhs:NonTerminal,rhs:List[RHS])\\ncase class CFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[Rule],S:NonTerminal)\\n1\",\"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\\nimplicit def toTerm(word:String) = Terminal(word)\\nval anyToRhs:PartialFunction[Any,RHS] = {\\n  case s:String => toTerm(s) \\n  case s:Symbol => toNonTerm(s) \\n}\\nimplicit def toRule1(rule:(Symbol,List[Any])) = \\n  Rule(rule._1,rule._2.collect(anyToRhs)) \\n\\nimplicit def toRule2(rule:(Symbol,Any)) = \\n  Rule(rule._1,List(anyToRhs(rule._2))) \\n    \\ndef rhsToString(rhs:RHS) = rhs match {\\n  case NonTerminal(n) => n.toString\\n  case Terminal(w) => w\\n}    \\nimplicit def toHTML(cfg:CFG) = {\\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\\n      if (x == cfg.S) -1 else if (y == cfg.S) 1 else x.name.toString.compareTo(y.name.toString)\\n    }  \\n  }      \\n  table(cfg.R.sortBy(_.lhs)(lhsOrdering).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\nimplicit def derivToHTML(deriv:Seq[Seq[RHS]]) = {\\n  table(deriv.map(d => Seq(d.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\ndef cfgFromRules(start:NonTerminal, rules:Rule*) = {\\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\\n  CFG(nonTerminals,terminals,rules.toList,start)\\n}  \",\"// def cfgFromRules(start:NonTerminal, rules:Rule*)\\nval cfg = cfgFromRules('S,\\n  'S -> List('NP_p,'VP_p), 'S -> List('NP_s, 'VP_s),   \\n  'NP_p -> List(\\\"Matko\\\",\\\"raps\\\"),\\n  'VP_p -> List(\\\"are\\\", 'ADJ),\\n  'NP_s -> List(\\\"Matko\\\"),\\n  'VP_s -> List(\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\"),\\n  'ADJ -> \\\"silly\\\")\\ncfg \",\"import scala.collection.mutable.{ArrayBuffer,ListBuffer}\\nval rand = new scala.util.Random(0) // 0 is the seed\\n@scala.annotation.tailrec //annotation that ensures tail recursive optimization\\ndef generateDeriv(cfg: CFG, sentence:Seq[RHS], result:Seq[Seq[RHS]] = Seq.empty):Seq[Seq[RHS]] = \\n  // finds the first element of the sentence which is a NonTerminal symbol\\n  sentence.zipWithIndex.collectFirst { case r@(n:NonTerminal,_) => r } match {\\n    // for element that's a NonTerminal symbol\\n    case Some((n,index)) =>\\n      // find all rules whose lhs is that symbol\\n      val rules =  cfg.R.filter(_.lhs == n)\\n      // randomly pick one rule out of them\\n      val sampled = rules(rand.nextInt(rules.length))\\n      // replace that element with the rule's rhs\\n      val next = sentence.patch(index,sampled.rhs,1)\\n      // recursively repeat again\\n      generateDeriv(cfg, next, result.get :+ next)\\n    // didn't find such rule\\n    case None => result \\n  }\",\"generateDeriv(cfg,Seq(cfg.S)) \",\"sealed trait ParseTree { def node: RHS}\\ncase class Node(node:NonTerminal, children:List[ParseTree]) extends ParseTree\\ncase class Leaf(node:Terminal) extends ParseTree\",\"import ml.wolfe.nlp.syntax._\\ndef toRenderTree(tree:ParseTree):RenderTree = tree match {\\n  case Leaf(Terminal(w)) => RenderTree(w,\\\"terminal\\\")\\n  case Node(NonTerminal(l),children) => RenderTree(l.toString, \\\"nonterminal\\\",children map toRenderTree)\\n}\\nimplicit def treeToHTML(tree:ParseTree) = renderParseTree(toRenderTree(tree))\\n\",\"Node('S, List(Node('NP_p, List(Leaf(\\\"Matko\\\"), Leaf(\\\"raps\\\"))),\\n              Node('VP_p,List(Leaf(\\\"are\\\"), Leaf(\\\"silly\\\")))))\",\"def generateTree(cfg:CFG, rhs:RHS):ParseTree = rhs match {\\n  case t:Terminal => Leaf(t)\\n  case n:NonTerminal =>\\n    val rules =  cfg.R.filter(_.lhs == n)\\n    val sampled = rules(rand.nextInt(rules.length))\\n    val children = sampled.rhs.map(generateTree(cfg,_))\\n    Node(n,children)\\n} \",\"generateTree(cfg,'S)     \",\"type Stack = List[ParseTree]\\ntype Buffer = List[String]\\ncase class State(stack:Stack, buffer:Buffer, rules:List[Rule])\\ncase class Transition(state:State, op:Symbol)\\n\\ndef bottomUpParse(cfg:CFG, sentence:List[String]) = {\\n  var history:List[State] = Nil\\n  var state = State(Nil,sentence,Nil)\\n  var transitions = Transition(state,'Init) :: Nil\\n  def reduce() {\\n    while (state.rules.nonEmpty) {\\n      val rule = state.rules.head\\n      val top = state.stack.take(rule.rhs.length).reverse\\n      if (top.map(_.node) == rule.rhs) {\\n        history = state :: history \\n        state = state.copy(\\n          stack = Node(rule.lhs, top) :: state.stack.drop(rule.rhs.length),\\n          rules = cfg.R\\n        )\\n        transitions = Transition(state,'Reduce) :: transitions\\n\\n      } else state = state.copy(rules = state.rules.tail)\\n    }   \\n  }\\n  def shift() {\\n    state = state.copy(\\n      stack = Leaf(state.buffer.head) :: state.stack,  \\n      buffer = state.buffer.tail, \\n      rules = cfg.R\\n    )\\n    transitions = Transition(state,'Shift) :: transitions\\n  }\\n  def backtrack() {\\n    state = history.head.copy(rules = history.head.rules.tail) \\n    transitions = Transition(state,'Backtrack) :: transitions\\n    history = history.tail\\n  }\\n  while (state.buffer.nonEmpty || (state.stack.length > 1 && history.nonEmpty) || state.rules.nonEmpty) {\\n    if (state.rules.nonEmpty) reduce()\\n    if (state.buffer.nonEmpty) shift() \\n    else if (state.stack.length > 1) backtrack()\\n  }\\n  transitions \\n} \",\"def treeToString(tree:ParseTree):String = tree match {\\n  case Node(NonTerminal(n), children) => s\\\"($n ${children.map(treeToString).mkString(\\\" \\\")})\\\"\\n  case Leaf(Terminal(w)) => w\\n}\\nimplicit def transitionsToHTML(transitions:List[Transition]) = {\\n  def toRow(t:Transition) = Seq(t.op, t.state.stack.reverse.map(treeToString).mkString(\\\" | \\\"),t.state.buffer.mkString(\\\" \\\"))\\n  table(transitions.map(toRow))\\n}\\ndef filterNonTerminalsRecursive(N:Set[NonTerminal])(tree: ParseTree):List[ParseTree] = tree match {\\n   case Node(n, children) if !N(n) => children flatMap filterNonTerminalsRecursive(N)\\n   case Node(n, children) => Node(n,children flatMap filterNonTerminalsRecursive(N))::Nil\\n   case _ => List(tree)\\n} \\ndef filterNonTerminals(N:Set[NonTerminal], tree: ParseTree) = filterNonTerminalsRecursive(N)(tree).head\",\"bottomUpParse(cfg, List(\\\"MCRiedel\\\", \\\"raps\\\", \\\"are\\\", \\\"silly\\\")).reverse     \",\"@scala.annotation.tailrec\\ndef toCNF(cfg:CFG, result:CFG = CFG(Set.empty, Set.empty, Nil,'S), id:Int = 0):CFG = {\\n  cfg.R match {\\n    case Rule(lhs,rhs) :: tail if (rhs.length > 2) =>\\n      val leftN = NonTerminal(Symbol(lhs.name.toString + id))\\n      val rule1 = Rule(lhs, leftN :: rhs.drop(2))\\n      val rule2 = Rule(leftN, rhs.take(2))\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case Rule(lhs, (l1:Terminal) :: l2 :: Nil) :: tail => \\n      val n = NonTerminal(Symbol(l1.name + id))\\n      val rule1 = Rule(lhs, n :: l2 :: Nil)\\n      val rule2 = Rule(n,l1 :: Nil)\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case Rule(lhs,l1 :: (l2:Terminal) :: Nil) :: tail => \\n      val n = NonTerminal(Symbol(l2.name + id))\\n      val rule1 = Rule(lhs, l1 :: n :: Nil)\\n      val rule2 = Rule(n, l2 :: Nil)\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case h :: tail => toCNF(cfg.copy(R = tail), result.copy(R = h :: result.R),id)\\n    case Nil => result  \\n  }    \\n} \\nval cnf = toCNF(cfg) \",\"type Chart = Map[(Int,Int),List[ParseTree]]\\ndef cyk(cfg:CFG, s:IndexedSeq[String]) = {\\n  var chart:Chart = Map.empty withDefaultValue Nil\\n  var charts:List[Chart] = Nil\\n  val n = s.length\\n  //init\\n  for (i <- 0 until n) {\\n    chart +=  (i,i) -> cfg.R.collect { \\n        case Rule(rhs,(t@Terminal(w)) :: Nil) if w == s(i) => Node(rhs, Leaf(t) :: Nil)}\\n    charts ::= chart  \\n  }\\n  for (l <- 1 until n; b <- 0 until n - l; e = b + l; m <- b until e) {\\n    val trees = for (left@Node(nl,_) <- chart(b,m); \\n                     right@Node(nr,_) <- chart(m + 1,e);\\n                     rule <- cfg.R.filter(_.rhs == nl :: nr :: Nil)) yield {\\n      Node(rule.lhs, left :: right :: Nil)      \\n    } \\n    chart += (b,e) -> (trees ::: chart(b,e))\\n    charts ::= chart\\n  }\\n  charts\\n}\\n\",\"cyk(cnf, Vector(\\\"Matko\\\",\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\")).head(0,3).head \",\"val ambCFG = cfgFromRules('S,\\n  'S -> List('Subj,'VP),\\n  'Subj -> \\\"He\\\",\\n  'Verb -> \\\"shot\\\",\\n  'VP -> List('Verb,'Obj), 'VP -> List('Verb,'Obj,'PP),\\n  'PP -> List(\\\"in\\\",\\\"his\\\",\\\"pyjamas\\\"),\\n  'Obj -> List(\\\"the\\\",\\\"elephant\\\"), 'Obj -> List(\\\"the\\\",\\\"elephant\\\",'PP)\\n) \\nfilterNonTerminals(ambCFG.N,cyk(toCNF(ambCFG), Vector(\\\"He\\\", \\\"shot\\\", \\\"the\\\", \\\"elephant\\\", \\\"in\\\", \\\"his\\\", \\\"pyjamas\\\")).head(0,6)(0)) \"]","hide_output":"true"}};
        var id = 32;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nLet us now create an example PCFG. ","extraFields":{}};
        var id = 33;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\nimplicit def toTerm(word:String) = Terminal(word)\nval anyToRhs:PartialFunction[Any,RHS] = {\n  case s:String => toTerm(s) \n  case s:Symbol => toNonTerm(s) \n}\nimplicit def toPRule1(rule:(Symbol,(List[Any],Double))) = \n  ProbRule(rule._1,rule._2._1.collect(anyToRhs), rule._2._2) \n\nimplicit def toPRule2(rule:(Symbol,(List[Symbol],Double))) = \n  ProbRule(rule._1,rule._2._1.collect(anyToRhs), rule._2._2) \n\n\nimplicit def toPRule3(rule:(Symbol,(Any,Double))) = \n  ProbRule(rule._1,List(anyToRhs(rule._2._1)),rule._2._2) \n    \nimplicit def toHTML(pcfg:PCFG) = {\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\n      if (x == pcfg.S) -1 else if (y == pcfg.S) 1 else x.name.toString.compareTo(y.name.toString)\n    }  \n  }      \n  table(pcfg.R.sortBy(_.lhs).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\" \"),r.prob)))    \n}\ndef pcfgFromRules(start:NonTerminal, rules:ProbRule*) = {\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\n  PCFG(nonTerminals,terminals,rules.toList,start)\n} \n\n@scala.annotation.tailrec\ndef toPCNF(cfg:PCFG, result:PCFG = PCFG(Set.empty, Set.empty, Nil,'S), id:Int = 0):PCFG = {\n  cfg.R match {\n    case ProbRule(lhs,rhs,p) :: tail if (rhs.length > 2) =>\n      val leftN = NonTerminal(Symbol(lhs.name.toString + id))\n      val rule1 = ProbRule(lhs, leftN :: rhs.drop(2),p)\n      val rule2 = ProbRule(leftN, rhs.take(2),1.0)\n      toPCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\n    case ProbRule(lhs, (l1:Terminal) :: l2 :: Nil,p) :: tail => \n      val n = NonTerminal(Symbol(l1.name + id))\n      val rule1 = ProbRule(lhs, n :: l2 :: Nil, p)\n      val rule2 = ProbRule(n,l1 :: Nil, 1.0)\n      toPCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\n    case ProbRule(lhs,l1 :: (l2:Terminal) :: Nil, p) :: tail => \n      val n = NonTerminal(Symbol(l2.name + id))\n      val rule1 = ProbRule(lhs, l1 :: n :: Nil, p)\n      val rule2 = ProbRule(n, l2 :: Nil, 1.0)\n      toPCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\n    case h :: tail => toPCNF(cfg.copy(R = tail), result.copy(R = h :: result.R),id)\n    case Nil => result  \n  }    \n} \n","extraFields":{"hide":"true","hide_output":"true","aggregatedCells":"[\"// sealed trait can be extended only in the same file\\nsealed trait RHS\\n// Symbol represents a closed set of identifiers, enabling quick comparison\\ncase class NonTerminal(name:Symbol) extends RHS \\ncase class Terminal(name:String) extends RHS \\ncase class Rule(lhs:NonTerminal,rhs:List[RHS])\\ncase class CFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[Rule],S:NonTerminal)\\n1\",\"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\\nimplicit def toTerm(word:String) = Terminal(word)\\nval anyToRhs:PartialFunction[Any,RHS] = {\\n  case s:String => toTerm(s) \\n  case s:Symbol => toNonTerm(s) \\n}\\nimplicit def toRule1(rule:(Symbol,List[Any])) = \\n  Rule(rule._1,rule._2.collect(anyToRhs)) \\n\\nimplicit def toRule2(rule:(Symbol,Any)) = \\n  Rule(rule._1,List(anyToRhs(rule._2))) \\n    \\ndef rhsToString(rhs:RHS) = rhs match {\\n  case NonTerminal(n) => n.toString\\n  case Terminal(w) => w\\n}    \\nimplicit def toHTML(cfg:CFG) = {\\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\\n      if (x == cfg.S) -1 else if (y == cfg.S) 1 else x.name.toString.compareTo(y.name.toString)\\n    }  \\n  }      \\n  table(cfg.R.sortBy(_.lhs)(lhsOrdering).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\nimplicit def derivToHTML(deriv:Seq[Seq[RHS]]) = {\\n  table(deriv.map(d => Seq(d.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\ndef cfgFromRules(start:NonTerminal, rules:Rule*) = {\\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\\n  CFG(nonTerminals,terminals,rules.toList,start)\\n}  \",\"// def cfgFromRules(start:NonTerminal, rules:Rule*)\\nval cfg = cfgFromRules('S,\\n  'S -> List('NP_p,'VP_p), 'S -> List('NP_s, 'VP_s),   \\n  'NP_p -> List(\\\"Matko\\\",\\\"raps\\\"),\\n  'VP_p -> List(\\\"are\\\", 'ADJ),\\n  'NP_s -> List(\\\"Matko\\\"),\\n  'VP_s -> List(\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\"),\\n  'ADJ -> \\\"silly\\\")\\ncfg \",\"import scala.collection.mutable.{ArrayBuffer,ListBuffer}\\nval rand = new scala.util.Random(0) // 0 is the seed\\n@scala.annotation.tailrec //annotation that ensures tail recursive optimization\\ndef generateDeriv(cfg: CFG, sentence:Seq[RHS], result:Seq[Seq[RHS]] = Seq.empty):Seq[Seq[RHS]] = \\n  // finds the first element of the sentence which is a NonTerminal symbol\\n  sentence.zipWithIndex.collectFirst { case r@(n:NonTerminal,_) => r } match {\\n    // for element that's a NonTerminal symbol\\n    case Some((n,index)) =>\\n      // find all rules whose lhs is that symbol\\n      val rules =  cfg.R.filter(_.lhs == n)\\n      // randomly pick one rule out of them\\n      val sampled = rules(rand.nextInt(rules.length))\\n      // replace that element with the rule's rhs\\n      val next = sentence.patch(index,sampled.rhs,1)\\n      // recursively repeat again\\n      generateDeriv(cfg, next, result.get :+ next)\\n    // didn't find such rule\\n    case None => result \\n  }\",\"generateDeriv(cfg,Seq(cfg.S)) \",\"sealed trait ParseTree { def node: RHS}\\ncase class Node(node:NonTerminal, children:List[ParseTree]) extends ParseTree\\ncase class Leaf(node:Terminal) extends ParseTree\",\"import ml.wolfe.nlp.syntax._\\ndef toRenderTree(tree:ParseTree):RenderTree = tree match {\\n  case Leaf(Terminal(w)) => RenderTree(w,\\\"terminal\\\")\\n  case Node(NonTerminal(l),children) => RenderTree(l.toString, \\\"nonterminal\\\",children map toRenderTree)\\n}\\nimplicit def treeToHTML(tree:ParseTree) = renderParseTree(toRenderTree(tree))\\n\",\"Node('S, List(Node('NP_p, List(Leaf(\\\"Matko\\\"), Leaf(\\\"raps\\\"))),\\n              Node('VP_p,List(Leaf(\\\"are\\\"), Leaf(\\\"silly\\\")))))\",\"def generateTree(cfg:CFG, rhs:RHS):ParseTree = rhs match {\\n  case t:Terminal => Leaf(t)\\n  case n:NonTerminal =>\\n    val rules =  cfg.R.filter(_.lhs == n)\\n    val sampled = rules(rand.nextInt(rules.length))\\n    val children = sampled.rhs.map(generateTree(cfg,_))\\n    Node(n,children)\\n} \",\"generateTree(cfg,'S)     \",\"type Stack = List[ParseTree]\\ntype Buffer = List[String]\\ncase class State(stack:Stack, buffer:Buffer, rules:List[Rule])\\ncase class Transition(state:State, op:Symbol)\\n\\ndef bottomUpParse(cfg:CFG, sentence:List[String]) = {\\n  var history:List[State] = Nil\\n  var state = State(Nil,sentence,Nil)\\n  var transitions = Transition(state,'Init) :: Nil\\n  def reduce() {\\n    while (state.rules.nonEmpty) {\\n      val rule = state.rules.head\\n      val top = state.stack.take(rule.rhs.length).reverse\\n      if (top.map(_.node) == rule.rhs) {\\n        history = state :: history \\n        state = state.copy(\\n          stack = Node(rule.lhs, top) :: state.stack.drop(rule.rhs.length),\\n          rules = cfg.R\\n        )\\n        transitions = Transition(state,'Reduce) :: transitions\\n\\n      } else state = state.copy(rules = state.rules.tail)\\n    }   \\n  }\\n  def shift() {\\n    state = state.copy(\\n      stack = Leaf(state.buffer.head) :: state.stack,  \\n      buffer = state.buffer.tail, \\n      rules = cfg.R\\n    )\\n    transitions = Transition(state,'Shift) :: transitions\\n  }\\n  def backtrack() {\\n    state = history.head.copy(rules = history.head.rules.tail) \\n    transitions = Transition(state,'Backtrack) :: transitions\\n    history = history.tail\\n  }\\n  while (state.buffer.nonEmpty || (state.stack.length > 1 && history.nonEmpty) || state.rules.nonEmpty) {\\n    if (state.rules.nonEmpty) reduce()\\n    if (state.buffer.nonEmpty) shift() \\n    else if (state.stack.length > 1) backtrack()\\n  }\\n  transitions \\n} \",\"def treeToString(tree:ParseTree):String = tree match {\\n  case Node(NonTerminal(n), children) => s\\\"($n ${children.map(treeToString).mkString(\\\" \\\")})\\\"\\n  case Leaf(Terminal(w)) => w\\n}\\nimplicit def transitionsToHTML(transitions:List[Transition]) = {\\n  def toRow(t:Transition) = Seq(t.op, t.state.stack.reverse.map(treeToString).mkString(\\\" | \\\"),t.state.buffer.mkString(\\\" \\\"))\\n  table(transitions.map(toRow))\\n}\\ndef filterNonTerminalsRecursive(N:Set[NonTerminal])(tree: ParseTree):List[ParseTree] = tree match {\\n   case Node(n, children) if !N(n) => children flatMap filterNonTerminalsRecursive(N)\\n   case Node(n, children) => Node(n,children flatMap filterNonTerminalsRecursive(N))::Nil\\n   case _ => List(tree)\\n} \\ndef filterNonTerminals(N:Set[NonTerminal], tree: ParseTree) = filterNonTerminalsRecursive(N)(tree).head\",\"bottomUpParse(cfg, List(\\\"MCRiedel\\\", \\\"raps\\\", \\\"are\\\", \\\"silly\\\")).reverse     \",\"@scala.annotation.tailrec\\ndef toCNF(cfg:CFG, result:CFG = CFG(Set.empty, Set.empty, Nil,'S), id:Int = 0):CFG = {\\n  cfg.R match {\\n    case Rule(lhs,rhs) :: tail if (rhs.length > 2) =>\\n      val leftN = NonTerminal(Symbol(lhs.name.toString + id))\\n      val rule1 = Rule(lhs, leftN :: rhs.drop(2))\\n      val rule2 = Rule(leftN, rhs.take(2))\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case Rule(lhs, (l1:Terminal) :: l2 :: Nil) :: tail => \\n      val n = NonTerminal(Symbol(l1.name + id))\\n      val rule1 = Rule(lhs, n :: l2 :: Nil)\\n      val rule2 = Rule(n,l1 :: Nil)\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case Rule(lhs,l1 :: (l2:Terminal) :: Nil) :: tail => \\n      val n = NonTerminal(Symbol(l2.name + id))\\n      val rule1 = Rule(lhs, l1 :: n :: Nil)\\n      val rule2 = Rule(n, l2 :: Nil)\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case h :: tail => toCNF(cfg.copy(R = tail), result.copy(R = h :: result.R),id)\\n    case Nil => result  \\n  }    \\n} \\nval cnf = toCNF(cfg) \",\"type Chart = Map[(Int,Int),List[ParseTree]]\\ndef cyk(cfg:CFG, s:IndexedSeq[String]) = {\\n  var chart:Chart = Map.empty withDefaultValue Nil\\n  var charts:List[Chart] = Nil\\n  val n = s.length\\n  //init\\n  for (i <- 0 until n) {\\n    chart +=  (i,i) -> cfg.R.collect { \\n        case Rule(rhs,(t@Terminal(w)) :: Nil) if w == s(i) => Node(rhs, Leaf(t) :: Nil)}\\n    charts ::= chart  \\n  }\\n  for (l <- 1 until n; b <- 0 until n - l; e = b + l; m <- b until e) {\\n    val trees = for (left@Node(nl,_) <- chart(b,m); \\n                     right@Node(nr,_) <- chart(m + 1,e);\\n                     rule <- cfg.R.filter(_.rhs == nl :: nr :: Nil)) yield {\\n      Node(rule.lhs, left :: right :: Nil)      \\n    } \\n    chart += (b,e) -> (trees ::: chart(b,e))\\n    charts ::= chart\\n  }\\n  charts\\n}\\n\",\"cyk(cnf, Vector(\\\"Matko\\\",\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\")).head(0,3).head \",\"val ambCFG = cfgFromRules('S,\\n  'S -> List('Subj,'VP),\\n  'Subj -> \\\"He\\\",\\n  'Verb -> \\\"shot\\\",\\n  'VP -> List('Verb,'Obj), 'VP -> List('Verb,'Obj,'PP),\\n  'PP -> List(\\\"in\\\",\\\"his\\\",\\\"pyjamas\\\"),\\n  'Obj -> List(\\\"the\\\",\\\"elephant\\\"), 'Obj -> List(\\\"the\\\",\\\"elephant\\\",'PP)\\n) \\nfilterNonTerminals(ambCFG.N,cyk(toCNF(ambCFG), Vector(\\\"He\\\", \\\"shot\\\", \\\"the\\\", \\\"elephant\\\", \\\"in\\\", \\\"his\\\", \\\"pyjamas\\\")).head(0,6)(0)) \",\"case class ProbRule(lhs:NonTerminal, rhs: List[RHS],prob:Double)\\ncase class PCFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[ProbRule],S:NonTerminal)\"]"}};
        var id = 34;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"val pcfg = pcfgFromRules('S,\n  'S -> (List('Subj,'VP), 1.0),\n  'Subj -> (\"He\", 1.0),\n  'Verb -> (\"shot\", 1.0),\n  'VP -> (List('Verb,'Obj), 0.7) , 'VP -> (List('Verb,'Obj,'PP), 0.3),\n  'PP -> (List(\"in\",\"his\",\"pyjamas\"), 1.0),\n  'Obj -> (List(\"the\",\"elephant\"), 0.5), 'Obj -> (List(\"the\",\"elephant\",'PP), 0.5)\n) \npcfg","extraFields":{"aggregatedCells":"[\"// sealed trait can be extended only in the same file\\nsealed trait RHS\\n// Symbol represents a closed set of identifiers, enabling quick comparison\\ncase class NonTerminal(name:Symbol) extends RHS \\ncase class Terminal(name:String) extends RHS \\ncase class Rule(lhs:NonTerminal,rhs:List[RHS])\\ncase class CFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[Rule],S:NonTerminal)\\n1\",\"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\\nimplicit def toTerm(word:String) = Terminal(word)\\nval anyToRhs:PartialFunction[Any,RHS] = {\\n  case s:String => toTerm(s) \\n  case s:Symbol => toNonTerm(s) \\n}\\nimplicit def toRule1(rule:(Symbol,List[Any])) = \\n  Rule(rule._1,rule._2.collect(anyToRhs)) \\n\\nimplicit def toRule2(rule:(Symbol,Any)) = \\n  Rule(rule._1,List(anyToRhs(rule._2))) \\n    \\ndef rhsToString(rhs:RHS) = rhs match {\\n  case NonTerminal(n) => n.toString\\n  case Terminal(w) => w\\n}    \\nimplicit def toHTML(cfg:CFG) = {\\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\\n      if (x == cfg.S) -1 else if (y == cfg.S) 1 else x.name.toString.compareTo(y.name.toString)\\n    }  \\n  }      \\n  table(cfg.R.sortBy(_.lhs)(lhsOrdering).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\nimplicit def derivToHTML(deriv:Seq[Seq[RHS]]) = {\\n  table(deriv.map(d => Seq(d.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\ndef cfgFromRules(start:NonTerminal, rules:Rule*) = {\\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\\n  CFG(nonTerminals,terminals,rules.toList,start)\\n}  \",\"// def cfgFromRules(start:NonTerminal, rules:Rule*)\\nval cfg = cfgFromRules('S,\\n  'S -> List('NP_p,'VP_p), 'S -> List('NP_s, 'VP_s),   \\n  'NP_p -> List(\\\"Matko\\\",\\\"raps\\\"),\\n  'VP_p -> List(\\\"are\\\", 'ADJ),\\n  'NP_s -> List(\\\"Matko\\\"),\\n  'VP_s -> List(\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\"),\\n  'ADJ -> \\\"silly\\\")\\ncfg \",\"import scala.collection.mutable.{ArrayBuffer,ListBuffer}\\nval rand = new scala.util.Random(0) // 0 is the seed\\n@scala.annotation.tailrec //annotation that ensures tail recursive optimization\\ndef generateDeriv(cfg: CFG, sentence:Seq[RHS], result:Seq[Seq[RHS]] = Seq.empty):Seq[Seq[RHS]] = \\n  // finds the first element of the sentence which is a NonTerminal symbol\\n  sentence.zipWithIndex.collectFirst { case r@(n:NonTerminal,_) => r } match {\\n    // for element that's a NonTerminal symbol\\n    case Some((n,index)) =>\\n      // find all rules whose lhs is that symbol\\n      val rules =  cfg.R.filter(_.lhs == n)\\n      // randomly pick one rule out of them\\n      val sampled = rules(rand.nextInt(rules.length))\\n      // replace that element with the rule's rhs\\n      val next = sentence.patch(index,sampled.rhs,1)\\n      // recursively repeat again\\n      generateDeriv(cfg, next, result.get :+ next)\\n    // didn't find such rule\\n    case None => result \\n  }\",\"generateDeriv(cfg,Seq(cfg.S)) \",\"sealed trait ParseTree { def node: RHS}\\ncase class Node(node:NonTerminal, children:List[ParseTree]) extends ParseTree\\ncase class Leaf(node:Terminal) extends ParseTree\",\"import ml.wolfe.nlp.syntax._\\ndef toRenderTree(tree:ParseTree):RenderTree = tree match {\\n  case Leaf(Terminal(w)) => RenderTree(w,\\\"terminal\\\")\\n  case Node(NonTerminal(l),children) => RenderTree(l.toString, \\\"nonterminal\\\",children map toRenderTree)\\n}\\nimplicit def treeToHTML(tree:ParseTree) = renderParseTree(toRenderTree(tree))\\n\",\"Node('S, List(Node('NP_p, List(Leaf(\\\"Matko\\\"), Leaf(\\\"raps\\\"))),\\n              Node('VP_p,List(Leaf(\\\"are\\\"), Leaf(\\\"silly\\\")))))\",\"def generateTree(cfg:CFG, rhs:RHS):ParseTree = rhs match {\\n  case t:Terminal => Leaf(t)\\n  case n:NonTerminal =>\\n    val rules =  cfg.R.filter(_.lhs == n)\\n    val sampled = rules(rand.nextInt(rules.length))\\n    val children = sampled.rhs.map(generateTree(cfg,_))\\n    Node(n,children)\\n} \",\"generateTree(cfg,'S)     \",\"type Stack = List[ParseTree]\\ntype Buffer = List[String]\\ncase class State(stack:Stack, buffer:Buffer, rules:List[Rule])\\ncase class Transition(state:State, op:Symbol)\\n\\ndef bottomUpParse(cfg:CFG, sentence:List[String]) = {\\n  var history:List[State] = Nil\\n  var state = State(Nil,sentence,Nil)\\n  var transitions = Transition(state,'Init) :: Nil\\n  def reduce() {\\n    while (state.rules.nonEmpty) {\\n      val rule = state.rules.head\\n      val top = state.stack.take(rule.rhs.length).reverse\\n      if (top.map(_.node) == rule.rhs) {\\n        history = state :: history \\n        state = state.copy(\\n          stack = Node(rule.lhs, top) :: state.stack.drop(rule.rhs.length),\\n          rules = cfg.R\\n        )\\n        transitions = Transition(state,'Reduce) :: transitions\\n\\n      } else state = state.copy(rules = state.rules.tail)\\n    }   \\n  }\\n  def shift() {\\n    state = state.copy(\\n      stack = Leaf(state.buffer.head) :: state.stack,  \\n      buffer = state.buffer.tail, \\n      rules = cfg.R\\n    )\\n    transitions = Transition(state,'Shift) :: transitions\\n  }\\n  def backtrack() {\\n    state = history.head.copy(rules = history.head.rules.tail) \\n    transitions = Transition(state,'Backtrack) :: transitions\\n    history = history.tail\\n  }\\n  while (state.buffer.nonEmpty || (state.stack.length > 1 && history.nonEmpty) || state.rules.nonEmpty) {\\n    if (state.rules.nonEmpty) reduce()\\n    if (state.buffer.nonEmpty) shift() \\n    else if (state.stack.length > 1) backtrack()\\n  }\\n  transitions \\n} \",\"def treeToString(tree:ParseTree):String = tree match {\\n  case Node(NonTerminal(n), children) => s\\\"($n ${children.map(treeToString).mkString(\\\" \\\")})\\\"\\n  case Leaf(Terminal(w)) => w\\n}\\nimplicit def transitionsToHTML(transitions:List[Transition]) = {\\n  def toRow(t:Transition) = Seq(t.op, t.state.stack.reverse.map(treeToString).mkString(\\\" | \\\"),t.state.buffer.mkString(\\\" \\\"))\\n  table(transitions.map(toRow))\\n}\\ndef filterNonTerminalsRecursive(N:Set[NonTerminal])(tree: ParseTree):List[ParseTree] = tree match {\\n   case Node(n, children) if !N(n) => children flatMap filterNonTerminalsRecursive(N)\\n   case Node(n, children) => Node(n,children flatMap filterNonTerminalsRecursive(N))::Nil\\n   case _ => List(tree)\\n} \\ndef filterNonTerminals(N:Set[NonTerminal], tree: ParseTree) = filterNonTerminalsRecursive(N)(tree).head\",\"bottomUpParse(cfg, List(\\\"MCRiedel\\\", \\\"raps\\\", \\\"are\\\", \\\"silly\\\")).reverse     \",\"@scala.annotation.tailrec\\ndef toCNF(cfg:CFG, result:CFG = CFG(Set.empty, Set.empty, Nil,'S), id:Int = 0):CFG = {\\n  cfg.R match {\\n    case Rule(lhs,rhs) :: tail if (rhs.length > 2) =>\\n      val leftN = NonTerminal(Symbol(lhs.name.toString + id))\\n      val rule1 = Rule(lhs, leftN :: rhs.drop(2))\\n      val rule2 = Rule(leftN, rhs.take(2))\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case Rule(lhs, (l1:Terminal) :: l2 :: Nil) :: tail => \\n      val n = NonTerminal(Symbol(l1.name + id))\\n      val rule1 = Rule(lhs, n :: l2 :: Nil)\\n      val rule2 = Rule(n,l1 :: Nil)\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case Rule(lhs,l1 :: (l2:Terminal) :: Nil) :: tail => \\n      val n = NonTerminal(Symbol(l2.name + id))\\n      val rule1 = Rule(lhs, l1 :: n :: Nil)\\n      val rule2 = Rule(n, l2 :: Nil)\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case h :: tail => toCNF(cfg.copy(R = tail), result.copy(R = h :: result.R),id)\\n    case Nil => result  \\n  }    \\n} \\nval cnf = toCNF(cfg) \",\"type Chart = Map[(Int,Int),List[ParseTree]]\\ndef cyk(cfg:CFG, s:IndexedSeq[String]) = {\\n  var chart:Chart = Map.empty withDefaultValue Nil\\n  var charts:List[Chart] = Nil\\n  val n = s.length\\n  //init\\n  for (i <- 0 until n) {\\n    chart +=  (i,i) -> cfg.R.collect { \\n        case Rule(rhs,(t@Terminal(w)) :: Nil) if w == s(i) => Node(rhs, Leaf(t) :: Nil)}\\n    charts ::= chart  \\n  }\\n  for (l <- 1 until n; b <- 0 until n - l; e = b + l; m <- b until e) {\\n    val trees = for (left@Node(nl,_) <- chart(b,m); \\n                     right@Node(nr,_) <- chart(m + 1,e);\\n                     rule <- cfg.R.filter(_.rhs == nl :: nr :: Nil)) yield {\\n      Node(rule.lhs, left :: right :: Nil)      \\n    } \\n    chart += (b,e) -> (trees ::: chart(b,e))\\n    charts ::= chart\\n  }\\n  charts\\n}\\n\",\"cyk(cnf, Vector(\\\"Matko\\\",\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\")).head(0,3).head \",\"val ambCFG = cfgFromRules('S,\\n  'S -> List('Subj,'VP),\\n  'Subj -> \\\"He\\\",\\n  'Verb -> \\\"shot\\\",\\n  'VP -> List('Verb,'Obj), 'VP -> List('Verb,'Obj,'PP),\\n  'PP -> List(\\\"in\\\",\\\"his\\\",\\\"pyjamas\\\"),\\n  'Obj -> List(\\\"the\\\",\\\"elephant\\\"), 'Obj -> List(\\\"the\\\",\\\"elephant\\\",'PP)\\n) \\nfilterNonTerminals(ambCFG.N,cyk(toCNF(ambCFG), Vector(\\\"He\\\", \\\"shot\\\", \\\"the\\\", \\\"elephant\\\", \\\"in\\\", \\\"his\\\", \\\"pyjamas\\\")).head(0,6)(0)) \",\"case class ProbRule(lhs:NonTerminal, rhs: List[RHS],prob:Double)\\ncase class PCFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[ProbRule],S:NonTerminal)\",\"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\\nimplicit def toTerm(word:String) = Terminal(word)\\nval anyToRhs:PartialFunction[Any,RHS] = {\\n  case s:String => toTerm(s) \\n  case s:Symbol => toNonTerm(s) \\n}\\nimplicit def toPRule1(rule:(Symbol,(List[Any],Double))) = \\n  ProbRule(rule._1,rule._2._1.collect(anyToRhs), rule._2._2) \\n\\nimplicit def toPRule2(rule:(Symbol,(List[Symbol],Double))) = \\n  ProbRule(rule._1,rule._2._1.collect(anyToRhs), rule._2._2) \\n\\n\\nimplicit def toPRule3(rule:(Symbol,(Any,Double))) = \\n  ProbRule(rule._1,List(anyToRhs(rule._2._1)),rule._2._2) \\n    \\nimplicit def toHTML(pcfg:PCFG) = {\\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\\n      if (x == pcfg.S) -1 else if (y == pcfg.S) 1 else x.name.toString.compareTo(y.name.toString)\\n    }  \\n  }      \\n  table(pcfg.R.sortBy(_.lhs).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\\\" \\\"),r.prob)))    \\n}\\ndef pcfgFromRules(start:NonTerminal, rules:ProbRule*) = {\\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\\n  PCFG(nonTerminals,terminals,rules.toList,start)\\n} \\n\\n@scala.annotation.tailrec\\ndef toPCNF(cfg:PCFG, result:PCFG = PCFG(Set.empty, Set.empty, Nil,'S), id:Int = 0):PCFG = {\\n  cfg.R match {\\n    case ProbRule(lhs,rhs,p) :: tail if (rhs.length > 2) =>\\n      val leftN = NonTerminal(Symbol(lhs.name.toString + id))\\n      val rule1 = ProbRule(lhs, leftN :: rhs.drop(2),p)\\n      val rule2 = ProbRule(leftN, rhs.take(2),1.0)\\n      toPCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case ProbRule(lhs, (l1:Terminal) :: l2 :: Nil,p) :: tail => \\n      val n = NonTerminal(Symbol(l1.name + id))\\n      val rule1 = ProbRule(lhs, n :: l2 :: Nil, p)\\n      val rule2 = ProbRule(n,l1 :: Nil, 1.0)\\n      toPCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case ProbRule(lhs,l1 :: (l2:Terminal) :: Nil, p) :: tail => \\n      val n = NonTerminal(Symbol(l2.name + id))\\n      val rule1 = ProbRule(lhs, l1 :: n :: Nil, p)\\n      val rule2 = ProbRule(n, l2 :: Nil, 1.0)\\n      toPCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case h :: tail => toPCNF(cfg.copy(R = tail), result.copy(R = h :: result.R),id)\\n    case Nil => result  \\n  }    \\n} \\n\"]","hide_output":"false"}};
        var id = 35;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nLet us first focus on the prediction task: given a sentence, find the highest scoring parse tree. In a way, we have already solved a variant of this problem. We can consider a CFG as a deterministic distribution over trees, and finding _a_ highest scoring parse is equivalent to finding any legal tree&mdash;our bottom-up and dynamic program based algorithms hence performed a structured prediction.\n\n<div class=\"newslide\"></div>\n#### CYK for PCFGs\nHere we present a probabilistic variant of the CYK algorithm. Notice that again we require normalization to CNF. Exercise: how to incorporate the rule probabilities during normalization? \n","extraFields":{}};
        var id = 36;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"type PChart = Map[(Int,Int),List[(ParseTree,Double)]]\ndef pcyk(cfg:PCFG, s:IndexedSeq[String]) = {\n  var chart:PChart = Map.empty withDefaultValue Nil\n  var charts:List[PChart] = Nil\n  val n = s.length\n  def unify(trees:List[(ParseTree,Double)]) = \n    trees.groupBy(_._1.node).mapValues(_.maxBy(_._2)).values.toList\n  //init\n  for (i <- 0 until n) {\n    chart +=  (i,i) -> unify(cfg.R.collect { \n        case ProbRule(rhs,(t@Terminal(w)) :: Nil, p) if w == s(i) => (Node(rhs, Leaf(t) :: Nil), math.log(p))})\n    charts ::= chart  \n  }\n  for (l <- 1 until n; b <- 0 until n - l; e = b + l; m <- b until e) {\n    val trees = for ((left@Node(nl,_),pl) <- chart(b,m); \n                     (right@Node(nr,_),pr) <- chart(m + 1,e);\n                     rule <- cfg.R.filter(_.rhs == nl :: nr :: Nil)) yield {\n    // notice the probability multiplication\n      (Node(rule.lhs, left :: right :: Nil), pl + pr + math.log(rule.prob))\n    } \n    chart += (b,e) -> unify((trees ::: chart(b,e)))\n    charts ::= chart\n  }\n  charts\n}\n","extraFields":{"aggregatedCells":"[\"// sealed trait can be extended only in the same file\\nsealed trait RHS\\n// Symbol represents a closed set of identifiers, enabling quick comparison\\ncase class NonTerminal(name:Symbol) extends RHS \\ncase class Terminal(name:String) extends RHS \\ncase class Rule(lhs:NonTerminal,rhs:List[RHS])\\ncase class CFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[Rule],S:NonTerminal)\\n1\",\"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\\nimplicit def toTerm(word:String) = Terminal(word)\\nval anyToRhs:PartialFunction[Any,RHS] = {\\n  case s:String => toTerm(s) \\n  case s:Symbol => toNonTerm(s) \\n}\\nimplicit def toRule1(rule:(Symbol,List[Any])) = \\n  Rule(rule._1,rule._2.collect(anyToRhs)) \\n\\nimplicit def toRule2(rule:(Symbol,Any)) = \\n  Rule(rule._1,List(anyToRhs(rule._2))) \\n    \\ndef rhsToString(rhs:RHS) = rhs match {\\n  case NonTerminal(n) => n.toString\\n  case Terminal(w) => w\\n}    \\nimplicit def toHTML(cfg:CFG) = {\\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\\n      if (x == cfg.S) -1 else if (y == cfg.S) 1 else x.name.toString.compareTo(y.name.toString)\\n    }  \\n  }      \\n  table(cfg.R.sortBy(_.lhs)(lhsOrdering).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\nimplicit def derivToHTML(deriv:Seq[Seq[RHS]]) = {\\n  table(deriv.map(d => Seq(d.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\ndef cfgFromRules(start:NonTerminal, rules:Rule*) = {\\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\\n  CFG(nonTerminals,terminals,rules.toList,start)\\n}  \",\"// def cfgFromRules(start:NonTerminal, rules:Rule*)\\nval cfg = cfgFromRules('S,\\n  'S -> List('NP_p,'VP_p), 'S -> List('NP_s, 'VP_s),   \\n  'NP_p -> List(\\\"Matko\\\",\\\"raps\\\"),\\n  'VP_p -> List(\\\"are\\\", 'ADJ),\\n  'NP_s -> List(\\\"Matko\\\"),\\n  'VP_s -> List(\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\"),\\n  'ADJ -> \\\"silly\\\")\\ncfg \",\"import scala.collection.mutable.{ArrayBuffer,ListBuffer}\\nval rand = new scala.util.Random(0) // 0 is the seed\\n@scala.annotation.tailrec //annotation that ensures tail recursive optimization\\ndef generateDeriv(cfg: CFG, sentence:Seq[RHS], result:Seq[Seq[RHS]] = Seq.empty):Seq[Seq[RHS]] = \\n  // finds the first element of the sentence which is a NonTerminal symbol\\n  sentence.zipWithIndex.collectFirst { case r@(n:NonTerminal,_) => r } match {\\n    // for element that's a NonTerminal symbol\\n    case Some((n,index)) =>\\n      // find all rules whose lhs is that symbol\\n      val rules =  cfg.R.filter(_.lhs == n)\\n      // randomly pick one rule out of them\\n      val sampled = rules(rand.nextInt(rules.length))\\n      // replace that element with the rule's rhs\\n      val next = sentence.patch(index,sampled.rhs,1)\\n      // recursively repeat again\\n      generateDeriv(cfg, next, result.get :+ next)\\n    // didn't find such rule\\n    case None => result \\n  }\",\"generateDeriv(cfg,Seq(cfg.S)) \",\"sealed trait ParseTree { def node: RHS}\\ncase class Node(node:NonTerminal, children:List[ParseTree]) extends ParseTree\\ncase class Leaf(node:Terminal) extends ParseTree\",\"import ml.wolfe.nlp.syntax._\\ndef toRenderTree(tree:ParseTree):RenderTree = tree match {\\n  case Leaf(Terminal(w)) => RenderTree(w,\\\"terminal\\\")\\n  case Node(NonTerminal(l),children) => RenderTree(l.toString, \\\"nonterminal\\\",children map toRenderTree)\\n}\\nimplicit def treeToHTML(tree:ParseTree) = renderParseTree(toRenderTree(tree))\\n\",\"Node('S, List(Node('NP_p, List(Leaf(\\\"Matko\\\"), Leaf(\\\"raps\\\"))),\\n              Node('VP_p,List(Leaf(\\\"are\\\"), Leaf(\\\"silly\\\")))))\",\"def generateTree(cfg:CFG, rhs:RHS):ParseTree = rhs match {\\n  case t:Terminal => Leaf(t)\\n  case n:NonTerminal =>\\n    val rules =  cfg.R.filter(_.lhs == n)\\n    val sampled = rules(rand.nextInt(rules.length))\\n    val children = sampled.rhs.map(generateTree(cfg,_))\\n    Node(n,children)\\n} \",\"generateTree(cfg,'S)     \",\"type Stack = List[ParseTree]\\ntype Buffer = List[String]\\ncase class State(stack:Stack, buffer:Buffer, rules:List[Rule])\\ncase class Transition(state:State, op:Symbol)\\n\\ndef bottomUpParse(cfg:CFG, sentence:List[String]) = {\\n  var history:List[State] = Nil\\n  var state = State(Nil,sentence,Nil)\\n  var transitions = Transition(state,'Init) :: Nil\\n  def reduce() {\\n    while (state.rules.nonEmpty) {\\n      val rule = state.rules.head\\n      val top = state.stack.take(rule.rhs.length).reverse\\n      if (top.map(_.node) == rule.rhs) {\\n        history = state :: history \\n        state = state.copy(\\n          stack = Node(rule.lhs, top) :: state.stack.drop(rule.rhs.length),\\n          rules = cfg.R\\n        )\\n        transitions = Transition(state,'Reduce) :: transitions\\n\\n      } else state = state.copy(rules = state.rules.tail)\\n    }   \\n  }\\n  def shift() {\\n    state = state.copy(\\n      stack = Leaf(state.buffer.head) :: state.stack,  \\n      buffer = state.buffer.tail, \\n      rules = cfg.R\\n    )\\n    transitions = Transition(state,'Shift) :: transitions\\n  }\\n  def backtrack() {\\n    state = history.head.copy(rules = history.head.rules.tail) \\n    transitions = Transition(state,'Backtrack) :: transitions\\n    history = history.tail\\n  }\\n  while (state.buffer.nonEmpty || (state.stack.length > 1 && history.nonEmpty) || state.rules.nonEmpty) {\\n    if (state.rules.nonEmpty) reduce()\\n    if (state.buffer.nonEmpty) shift() \\n    else if (state.stack.length > 1) backtrack()\\n  }\\n  transitions \\n} \",\"def treeToString(tree:ParseTree):String = tree match {\\n  case Node(NonTerminal(n), children) => s\\\"($n ${children.map(treeToString).mkString(\\\" \\\")})\\\"\\n  case Leaf(Terminal(w)) => w\\n}\\nimplicit def transitionsToHTML(transitions:List[Transition]) = {\\n  def toRow(t:Transition) = Seq(t.op, t.state.stack.reverse.map(treeToString).mkString(\\\" | \\\"),t.state.buffer.mkString(\\\" \\\"))\\n  table(transitions.map(toRow))\\n}\\ndef filterNonTerminalsRecursive(N:Set[NonTerminal])(tree: ParseTree):List[ParseTree] = tree match {\\n   case Node(n, children) if !N(n) => children flatMap filterNonTerminalsRecursive(N)\\n   case Node(n, children) => Node(n,children flatMap filterNonTerminalsRecursive(N))::Nil\\n   case _ => List(tree)\\n} \\ndef filterNonTerminals(N:Set[NonTerminal], tree: ParseTree) = filterNonTerminalsRecursive(N)(tree).head\",\"bottomUpParse(cfg, List(\\\"MCRiedel\\\", \\\"raps\\\", \\\"are\\\", \\\"silly\\\")).reverse     \",\"@scala.annotation.tailrec\\ndef toCNF(cfg:CFG, result:CFG = CFG(Set.empty, Set.empty, Nil,'S), id:Int = 0):CFG = {\\n  cfg.R match {\\n    case Rule(lhs,rhs) :: tail if (rhs.length > 2) =>\\n      val leftN = NonTerminal(Symbol(lhs.name.toString + id))\\n      val rule1 = Rule(lhs, leftN :: rhs.drop(2))\\n      val rule2 = Rule(leftN, rhs.take(2))\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case Rule(lhs, (l1:Terminal) :: l2 :: Nil) :: tail => \\n      val n = NonTerminal(Symbol(l1.name + id))\\n      val rule1 = Rule(lhs, n :: l2 :: Nil)\\n      val rule2 = Rule(n,l1 :: Nil)\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case Rule(lhs,l1 :: (l2:Terminal) :: Nil) :: tail => \\n      val n = NonTerminal(Symbol(l2.name + id))\\n      val rule1 = Rule(lhs, l1 :: n :: Nil)\\n      val rule2 = Rule(n, l2 :: Nil)\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case h :: tail => toCNF(cfg.copy(R = tail), result.copy(R = h :: result.R),id)\\n    case Nil => result  \\n  }    \\n} \\nval cnf = toCNF(cfg) \",\"type Chart = Map[(Int,Int),List[ParseTree]]\\ndef cyk(cfg:CFG, s:IndexedSeq[String]) = {\\n  var chart:Chart = Map.empty withDefaultValue Nil\\n  var charts:List[Chart] = Nil\\n  val n = s.length\\n  //init\\n  for (i <- 0 until n) {\\n    chart +=  (i,i) -> cfg.R.collect { \\n        case Rule(rhs,(t@Terminal(w)) :: Nil) if w == s(i) => Node(rhs, Leaf(t) :: Nil)}\\n    charts ::= chart  \\n  }\\n  for (l <- 1 until n; b <- 0 until n - l; e = b + l; m <- b until e) {\\n    val trees = for (left@Node(nl,_) <- chart(b,m); \\n                     right@Node(nr,_) <- chart(m + 1,e);\\n                     rule <- cfg.R.filter(_.rhs == nl :: nr :: Nil)) yield {\\n      Node(rule.lhs, left :: right :: Nil)      \\n    } \\n    chart += (b,e) -> (trees ::: chart(b,e))\\n    charts ::= chart\\n  }\\n  charts\\n}\\n\",\"cyk(cnf, Vector(\\\"Matko\\\",\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\")).head(0,3).head \",\"val ambCFG = cfgFromRules('S,\\n  'S -> List('Subj,'VP),\\n  'Subj -> \\\"He\\\",\\n  'Verb -> \\\"shot\\\",\\n  'VP -> List('Verb,'Obj), 'VP -> List('Verb,'Obj,'PP),\\n  'PP -> List(\\\"in\\\",\\\"his\\\",\\\"pyjamas\\\"),\\n  'Obj -> List(\\\"the\\\",\\\"elephant\\\"), 'Obj -> List(\\\"the\\\",\\\"elephant\\\",'PP)\\n) \\nfilterNonTerminals(ambCFG.N,cyk(toCNF(ambCFG), Vector(\\\"He\\\", \\\"shot\\\", \\\"the\\\", \\\"elephant\\\", \\\"in\\\", \\\"his\\\", \\\"pyjamas\\\")).head(0,6)(0)) \",\"case class ProbRule(lhs:NonTerminal, rhs: List[RHS],prob:Double)\\ncase class PCFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[ProbRule],S:NonTerminal)\",\"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\\nimplicit def toTerm(word:String) = Terminal(word)\\nval anyToRhs:PartialFunction[Any,RHS] = {\\n  case s:String => toTerm(s) \\n  case s:Symbol => toNonTerm(s) \\n}\\nimplicit def toPRule1(rule:(Symbol,(List[Any],Double))) = \\n  ProbRule(rule._1,rule._2._1.collect(anyToRhs), rule._2._2) \\n\\nimplicit def toPRule2(rule:(Symbol,(List[Symbol],Double))) = \\n  ProbRule(rule._1,rule._2._1.collect(anyToRhs), rule._2._2) \\n\\n\\nimplicit def toPRule3(rule:(Symbol,(Any,Double))) = \\n  ProbRule(rule._1,List(anyToRhs(rule._2._1)),rule._2._2) \\n    \\nimplicit def toHTML(pcfg:PCFG) = {\\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\\n      if (x == pcfg.S) -1 else if (y == pcfg.S) 1 else x.name.toString.compareTo(y.name.toString)\\n    }  \\n  }      \\n  table(pcfg.R.sortBy(_.lhs).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\\\" \\\"),r.prob)))    \\n}\\ndef pcfgFromRules(start:NonTerminal, rules:ProbRule*) = {\\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\\n  PCFG(nonTerminals,terminals,rules.toList,start)\\n} \\n\\n@scala.annotation.tailrec\\ndef toPCNF(cfg:PCFG, result:PCFG = PCFG(Set.empty, Set.empty, Nil,'S), id:Int = 0):PCFG = {\\n  cfg.R match {\\n    case ProbRule(lhs,rhs,p) :: tail if (rhs.length > 2) =>\\n      val leftN = NonTerminal(Symbol(lhs.name.toString + id))\\n      val rule1 = ProbRule(lhs, leftN :: rhs.drop(2),p)\\n      val rule2 = ProbRule(leftN, rhs.take(2),1.0)\\n      toPCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case ProbRule(lhs, (l1:Terminal) :: l2 :: Nil,p) :: tail => \\n      val n = NonTerminal(Symbol(l1.name + id))\\n      val rule1 = ProbRule(lhs, n :: l2 :: Nil, p)\\n      val rule2 = ProbRule(n,l1 :: Nil, 1.0)\\n      toPCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case ProbRule(lhs,l1 :: (l2:Terminal) :: Nil, p) :: tail => \\n      val n = NonTerminal(Symbol(l2.name + id))\\n      val rule1 = ProbRule(lhs, l1 :: n :: Nil, p)\\n      val rule2 = ProbRule(n, l2 :: Nil, 1.0)\\n      toPCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case h :: tail => toPCNF(cfg.copy(R = tail), result.copy(R = h :: result.R),id)\\n    case Nil => result  \\n  }    \\n} \\n\",\"val pcfg = pcfgFromRules('S,\\n  'S -> (List('Subj,'VP), 1.0),\\n  'Subj -> (\\\"He\\\", 1.0),\\n  'Verb -> (\\\"shot\\\", 1.0),\\n  'VP -> (List('Verb,'Obj), 0.7) , 'VP -> (List('Verb,'Obj,'PP), 0.3),\\n  'PP -> (List(\\\"in\\\",\\\"his\\\",\\\"pyjamas\\\"), 1.0),\\n  'Obj -> (List(\\\"the\\\",\\\"elephant\\\"), 0.5), 'Obj -> (List(\\\"the\\\",\\\"elephant\\\",'PP), 0.5)\\n) \\npcfg\"]","hide_output":"true"}};
        var id = 37;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nThe above algorithm now returns only a single parse for the given sentence: the one with the higher probability. You can adapt to return all parses by changing the `unify` method to return the input as is.","extraFields":{}};
        var id = 38;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"filterNonTerminals(pcfg.N, pcyk(toPCNF(pcfg), Vector(\"He\", \"shot\", \"the\", \"elephant\", \"in\", \"his\", \"pyjamas\")).head(0,6)(0)._1)","extraFields":{"aggregatedCells":"[\"// sealed trait can be extended only in the same file\\nsealed trait RHS\\n// Symbol represents a closed set of identifiers, enabling quick comparison\\ncase class NonTerminal(name:Symbol) extends RHS \\ncase class Terminal(name:String) extends RHS \\ncase class Rule(lhs:NonTerminal,rhs:List[RHS])\\ncase class CFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[Rule],S:NonTerminal)\\n1\",\"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\\nimplicit def toTerm(word:String) = Terminal(word)\\nval anyToRhs:PartialFunction[Any,RHS] = {\\n  case s:String => toTerm(s) \\n  case s:Symbol => toNonTerm(s) \\n}\\nimplicit def toRule1(rule:(Symbol,List[Any])) = \\n  Rule(rule._1,rule._2.collect(anyToRhs)) \\n\\nimplicit def toRule2(rule:(Symbol,Any)) = \\n  Rule(rule._1,List(anyToRhs(rule._2))) \\n    \\ndef rhsToString(rhs:RHS) = rhs match {\\n  case NonTerminal(n) => n.toString\\n  case Terminal(w) => w\\n}    \\nimplicit def toHTML(cfg:CFG) = {\\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\\n      if (x == cfg.S) -1 else if (y == cfg.S) 1 else x.name.toString.compareTo(y.name.toString)\\n    }  \\n  }      \\n  table(cfg.R.sortBy(_.lhs)(lhsOrdering).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\nimplicit def derivToHTML(deriv:Seq[Seq[RHS]]) = {\\n  table(deriv.map(d => Seq(d.map(rhsToString).mkString(\\\" \\\"))))    \\n}\\ndef cfgFromRules(start:NonTerminal, rules:Rule*) = {\\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\\n  CFG(nonTerminals,terminals,rules.toList,start)\\n}  \",\"// def cfgFromRules(start:NonTerminal, rules:Rule*)\\nval cfg = cfgFromRules('S,\\n  'S -> List('NP_p,'VP_p), 'S -> List('NP_s, 'VP_s),   \\n  'NP_p -> List(\\\"Matko\\\",\\\"raps\\\"),\\n  'VP_p -> List(\\\"are\\\", 'ADJ),\\n  'NP_s -> List(\\\"Matko\\\"),\\n  'VP_s -> List(\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\"),\\n  'ADJ -> \\\"silly\\\")\\ncfg \",\"import scala.collection.mutable.{ArrayBuffer,ListBuffer}\\nval rand = new scala.util.Random(0) // 0 is the seed\\n@scala.annotation.tailrec //annotation that ensures tail recursive optimization\\ndef generateDeriv(cfg: CFG, sentence:Seq[RHS], result:Seq[Seq[RHS]] = Seq.empty):Seq[Seq[RHS]] = \\n  // finds the first element of the sentence which is a NonTerminal symbol\\n  sentence.zipWithIndex.collectFirst { case r@(n:NonTerminal,_) => r } match {\\n    // for element that's a NonTerminal symbol\\n    case Some((n,index)) =>\\n      // find all rules whose lhs is that symbol\\n      val rules =  cfg.R.filter(_.lhs == n)\\n      // randomly pick one rule out of them\\n      val sampled = rules(rand.nextInt(rules.length))\\n      // replace that element with the rule's rhs\\n      val next = sentence.patch(index,sampled.rhs,1)\\n      // recursively repeat again\\n      generateDeriv(cfg, next, result.get :+ next)\\n    // didn't find such rule\\n    case None => result \\n  }\",\"generateDeriv(cfg,Seq(cfg.S)) \",\"sealed trait ParseTree { def node: RHS}\\ncase class Node(node:NonTerminal, children:List[ParseTree]) extends ParseTree\\ncase class Leaf(node:Terminal) extends ParseTree\",\"import ml.wolfe.nlp.syntax._\\ndef toRenderTree(tree:ParseTree):RenderTree = tree match {\\n  case Leaf(Terminal(w)) => RenderTree(w,\\\"terminal\\\")\\n  case Node(NonTerminal(l),children) => RenderTree(l.toString, \\\"nonterminal\\\",children map toRenderTree)\\n}\\nimplicit def treeToHTML(tree:ParseTree) = renderParseTree(toRenderTree(tree))\\n\",\"Node('S, List(Node('NP_p, List(Leaf(\\\"Matko\\\"), Leaf(\\\"raps\\\"))),\\n              Node('VP_p,List(Leaf(\\\"are\\\"), Leaf(\\\"silly\\\")))))\",\"def generateTree(cfg:CFG, rhs:RHS):ParseTree = rhs match {\\n  case t:Terminal => Leaf(t)\\n  case n:NonTerminal =>\\n    val rules =  cfg.R.filter(_.lhs == n)\\n    val sampled = rules(rand.nextInt(rules.length))\\n    val children = sampled.rhs.map(generateTree(cfg,_))\\n    Node(n,children)\\n} \",\"generateTree(cfg,'S)     \",\"type Stack = List[ParseTree]\\ntype Buffer = List[String]\\ncase class State(stack:Stack, buffer:Buffer, rules:List[Rule])\\ncase class Transition(state:State, op:Symbol)\\n\\ndef bottomUpParse(cfg:CFG, sentence:List[String]) = {\\n  var history:List[State] = Nil\\n  var state = State(Nil,sentence,Nil)\\n  var transitions = Transition(state,'Init) :: Nil\\n  def reduce() {\\n    while (state.rules.nonEmpty) {\\n      val rule = state.rules.head\\n      val top = state.stack.take(rule.rhs.length).reverse\\n      if (top.map(_.node) == rule.rhs) {\\n        history = state :: history \\n        state = state.copy(\\n          stack = Node(rule.lhs, top) :: state.stack.drop(rule.rhs.length),\\n          rules = cfg.R\\n        )\\n        transitions = Transition(state,'Reduce) :: transitions\\n\\n      } else state = state.copy(rules = state.rules.tail)\\n    }   \\n  }\\n  def shift() {\\n    state = state.copy(\\n      stack = Leaf(state.buffer.head) :: state.stack,  \\n      buffer = state.buffer.tail, \\n      rules = cfg.R\\n    )\\n    transitions = Transition(state,'Shift) :: transitions\\n  }\\n  def backtrack() {\\n    state = history.head.copy(rules = history.head.rules.tail) \\n    transitions = Transition(state,'Backtrack) :: transitions\\n    history = history.tail\\n  }\\n  while (state.buffer.nonEmpty || (state.stack.length > 1 && history.nonEmpty) || state.rules.nonEmpty) {\\n    if (state.rules.nonEmpty) reduce()\\n    if (state.buffer.nonEmpty) shift() \\n    else if (state.stack.length > 1) backtrack()\\n  }\\n  transitions \\n} \",\"def treeToString(tree:ParseTree):String = tree match {\\n  case Node(NonTerminal(n), children) => s\\\"($n ${children.map(treeToString).mkString(\\\" \\\")})\\\"\\n  case Leaf(Terminal(w)) => w\\n}\\nimplicit def transitionsToHTML(transitions:List[Transition]) = {\\n  def toRow(t:Transition) = Seq(t.op, t.state.stack.reverse.map(treeToString).mkString(\\\" | \\\"),t.state.buffer.mkString(\\\" \\\"))\\n  table(transitions.map(toRow))\\n}\\ndef filterNonTerminalsRecursive(N:Set[NonTerminal])(tree: ParseTree):List[ParseTree] = tree match {\\n   case Node(n, children) if !N(n) => children flatMap filterNonTerminalsRecursive(N)\\n   case Node(n, children) => Node(n,children flatMap filterNonTerminalsRecursive(N))::Nil\\n   case _ => List(tree)\\n} \\ndef filterNonTerminals(N:Set[NonTerminal], tree: ParseTree) = filterNonTerminalsRecursive(N)(tree).head\",\"bottomUpParse(cfg, List(\\\"MCRiedel\\\", \\\"raps\\\", \\\"are\\\", \\\"silly\\\")).reverse     \",\"@scala.annotation.tailrec\\ndef toCNF(cfg:CFG, result:CFG = CFG(Set.empty, Set.empty, Nil,'S), id:Int = 0):CFG = {\\n  cfg.R match {\\n    case Rule(lhs,rhs) :: tail if (rhs.length > 2) =>\\n      val leftN = NonTerminal(Symbol(lhs.name.toString + id))\\n      val rule1 = Rule(lhs, leftN :: rhs.drop(2))\\n      val rule2 = Rule(leftN, rhs.take(2))\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case Rule(lhs, (l1:Terminal) :: l2 :: Nil) :: tail => \\n      val n = NonTerminal(Symbol(l1.name + id))\\n      val rule1 = Rule(lhs, n :: l2 :: Nil)\\n      val rule2 = Rule(n,l1 :: Nil)\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case Rule(lhs,l1 :: (l2:Terminal) :: Nil) :: tail => \\n      val n = NonTerminal(Symbol(l2.name + id))\\n      val rule1 = Rule(lhs, l1 :: n :: Nil)\\n      val rule2 = Rule(n, l2 :: Nil)\\n      toCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case h :: tail => toCNF(cfg.copy(R = tail), result.copy(R = h :: result.R),id)\\n    case Nil => result  \\n  }    \\n} \\nval cnf = toCNF(cfg) \",\"type Chart = Map[(Int,Int),List[ParseTree]]\\ndef cyk(cfg:CFG, s:IndexedSeq[String]) = {\\n  var chart:Chart = Map.empty withDefaultValue Nil\\n  var charts:List[Chart] = Nil\\n  val n = s.length\\n  //init\\n  for (i <- 0 until n) {\\n    chart +=  (i,i) -> cfg.R.collect { \\n        case Rule(rhs,(t@Terminal(w)) :: Nil) if w == s(i) => Node(rhs, Leaf(t) :: Nil)}\\n    charts ::= chart  \\n  }\\n  for (l <- 1 until n; b <- 0 until n - l; e = b + l; m <- b until e) {\\n    val trees = for (left@Node(nl,_) <- chart(b,m); \\n                     right@Node(nr,_) <- chart(m + 1,e);\\n                     rule <- cfg.R.filter(_.rhs == nl :: nr :: Nil)) yield {\\n      Node(rule.lhs, left :: right :: Nil)      \\n    } \\n    chart += (b,e) -> (trees ::: chart(b,e))\\n    charts ::= chart\\n  }\\n  charts\\n}\\n\",\"cyk(cnf, Vector(\\\"Matko\\\",\\\"raps\\\", \\\"in\\\", \\\"StatNLP\\\")).head(0,3).head \",\"val ambCFG = cfgFromRules('S,\\n  'S -> List('Subj,'VP),\\n  'Subj -> \\\"He\\\",\\n  'Verb -> \\\"shot\\\",\\n  'VP -> List('Verb,'Obj), 'VP -> List('Verb,'Obj,'PP),\\n  'PP -> List(\\\"in\\\",\\\"his\\\",\\\"pyjamas\\\"),\\n  'Obj -> List(\\\"the\\\",\\\"elephant\\\"), 'Obj -> List(\\\"the\\\",\\\"elephant\\\",'PP)\\n) \\nfilterNonTerminals(ambCFG.N,cyk(toCNF(ambCFG), Vector(\\\"He\\\", \\\"shot\\\", \\\"the\\\", \\\"elephant\\\", \\\"in\\\", \\\"his\\\", \\\"pyjamas\\\")).head(0,6)(0)) \",\"case class ProbRule(lhs:NonTerminal, rhs: List[RHS],prob:Double)\\ncase class PCFG(N:Set[NonTerminal],Sigma:Set[Terminal],R:List[ProbRule],S:NonTerminal)\",\"implicit def toNonTerm(name:Symbol) = NonTerminal(name)\\nimplicit def toTerm(word:String) = Terminal(word)\\nval anyToRhs:PartialFunction[Any,RHS] = {\\n  case s:String => toTerm(s) \\n  case s:Symbol => toNonTerm(s) \\n}\\nimplicit def toPRule1(rule:(Symbol,(List[Any],Double))) = \\n  ProbRule(rule._1,rule._2._1.collect(anyToRhs), rule._2._2) \\n\\nimplicit def toPRule2(rule:(Symbol,(List[Symbol],Double))) = \\n  ProbRule(rule._1,rule._2._1.collect(anyToRhs), rule._2._2) \\n\\n\\nimplicit def toPRule3(rule:(Symbol,(Any,Double))) = \\n  ProbRule(rule._1,List(anyToRhs(rule._2._1)),rule._2._2) \\n    \\nimplicit def toHTML(pcfg:PCFG) = {\\n  implicit val lhsOrdering = new Ordering[NonTerminal] {\\n    override def compare(x: NonTerminal, y: NonTerminal): Int = {\\n      if (x == pcfg.S) -1 else if (y == pcfg.S) 1 else x.name.toString.compareTo(y.name.toString)\\n    }  \\n  }      \\n  table(pcfg.R.sortBy(_.lhs).map(r => Seq(r.lhs.name,r.rhs.map(rhsToString).mkString(\\\" \\\"),r.prob)))    \\n}\\ndef pcfgFromRules(start:NonTerminal, rules:ProbRule*) = {\\n  val terminals = rules.flatMap(_.rhs).collect{ case n:Terminal => n}.toSet\\n  val nonTerminals = (rules.flatMap(r => r.lhs :: r.rhs)).collect{ case n:NonTerminal => n}.toSet\\n  PCFG(nonTerminals,terminals,rules.toList,start)\\n} \\n\\n@scala.annotation.tailrec\\ndef toPCNF(cfg:PCFG, result:PCFG = PCFG(Set.empty, Set.empty, Nil,'S), id:Int = 0):PCFG = {\\n  cfg.R match {\\n    case ProbRule(lhs,rhs,p) :: tail if (rhs.length > 2) =>\\n      val leftN = NonTerminal(Symbol(lhs.name.toString + id))\\n      val rule1 = ProbRule(lhs, leftN :: rhs.drop(2),p)\\n      val rule2 = ProbRule(leftN, rhs.take(2),1.0)\\n      toPCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case ProbRule(lhs, (l1:Terminal) :: l2 :: Nil,p) :: tail => \\n      val n = NonTerminal(Symbol(l1.name + id))\\n      val rule1 = ProbRule(lhs, n :: l2 :: Nil, p)\\n      val rule2 = ProbRule(n,l1 :: Nil, 1.0)\\n      toPCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case ProbRule(lhs,l1 :: (l2:Terminal) :: Nil, p) :: tail => \\n      val n = NonTerminal(Symbol(l2.name + id))\\n      val rule1 = ProbRule(lhs, l1 :: n :: Nil, p)\\n      val rule2 = ProbRule(n, l2 :: Nil, 1.0)\\n      toPCNF(cfg.copy(R = rule1::rule2::tail), result, id + 1)\\n    case h :: tail => toPCNF(cfg.copy(R = tail), result.copy(R = h :: result.R),id)\\n    case Nil => result  \\n  }    \\n} \\n\",\"val pcfg = pcfgFromRules('S,\\n  'S -> (List('Subj,'VP), 1.0),\\n  'Subj -> (\\\"He\\\", 1.0),\\n  'Verb -> (\\\"shot\\\", 1.0),\\n  'VP -> (List('Verb,'Obj), 0.7) , 'VP -> (List('Verb,'Obj,'PP), 0.3),\\n  'PP -> (List(\\\"in\\\",\\\"his\\\",\\\"pyjamas\\\"), 1.0),\\n  'Obj -> (List(\\\"the\\\",\\\"elephant\\\"), 0.5), 'Obj -> (List(\\\"the\\\",\\\"elephant\\\",'PP), 0.5)\\n) \\npcfg\",\"type PChart = Map[(Int,Int),List[(ParseTree,Double)]]\\ndef pcyk(cfg:PCFG, s:IndexedSeq[String]) = {\\n  var chart:PChart = Map.empty withDefaultValue Nil\\n  var charts:List[PChart] = Nil\\n  val n = s.length\\n  def unify(trees:List[(ParseTree,Double)]) = \\n    trees.groupBy(_._1.node).mapValues(_.maxBy(_._2)).values.toList\\n  //init\\n  for (i <- 0 until n) {\\n    chart +=  (i,i) -> unify(cfg.R.collect { \\n        case ProbRule(rhs,(t@Terminal(w)) :: Nil, p) if w == s(i) => (Node(rhs, Leaf(t) :: Nil), math.log(p))})\\n    charts ::= chart  \\n  }\\n  for (l <- 1 until n; b <- 0 until n - l; e = b + l; m <- b until e) {\\n    val trees = for ((left@Node(nl,_),pl) <- chart(b,m); \\n                     (right@Node(nr,_),pr) <- chart(m + 1,e);\\n                     rule <- cfg.R.filter(_.rhs == nl :: nr :: Nil)) yield {\\n      (Node(rule.lhs, left :: right :: Nil), pl + pr + math.log(rule.prob))      \\n    } \\n    chart += (b,e) -> unify((trees ::: chart(b,e)))\\n    charts ::= chart\\n  }\\n  charts\\n}\\n\"]"}};
        var id = 39;
        //createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
    compileAll(doc,compilers);
    enableAceScalaCompletion();
</script>

            </div>
        </section>
        <script src="../assets/javascripts/scrollReveal.min.js" type="text/javascript"></script>
        <script>

      var bratSVGScale = 1.8;

      window.setTimeout(function() {
        //get all cell wrappers and add data-sr fields
        /*
        $(".cellWrapper").each(function (){
          $(this).attr('data-sr','')
        });
        $(".srdiv").each(function() {
            $(this).replaceWith($('<div data-sr>' + this.innerHTML + '</div>'));
        });
        */
        //increase the size of brat examples
//        $(".bratsvg").each(function() {scaleSVG($(this),2)});

        //in paragraphs with summary elements, remove everything else
        $("p").has('.summary').contents().filter(function(){return(this.nodeType === 3)}).remove();
        $("p").has('.summary').children().not('.summary').remove();
        $('.book-start').nextUntil('.slide-start').andSelf().remove();


        //create divs at the start of each slide
        $(".newslide").after("<div class='slideStart'></div>");
        var anchors = $(".slideStart")

        //add anchors for slides
        var i = 0;
        anchors.each(function(){ $(this).attr("id","slide" + i); i++; });

        //function to return the closest slideStart element to current scrollTop
        function closestSlideStartIndex() {
          var top = $(document).scrollTop() ;
          //if top is before first slide return -1
          //console.log(top);
          //console.log(window.scrollY);
          //console.log("===");
          //console.log($(anchors[0]).offset().top);
          //console.log(anchors[0].offsetTop);
          if ($(anchors[0]).offset().top - 2> top) return -1;
          for (var i = 0; i < anchors.length; i++) {
            var current = $(anchors[i]).offset().top;
            //console.log("---");
            //console.log(current);
            //console.log(anchors[i].offsetTop);
            if (current >= top) return i;
          }
          return anchors.length-1;
        }

        //scroll to slides
        $(document).keydown(function(e){
            if (e.keyCode == 39) {
                var index = closestSlideStartIndex()
                console.log(index);
                if (index + 1 < anchors.length) {
                    var top = $(anchors[index + 1]).offset().top;
                    $("html, body").animate({scrollTop: top }, 500);
                }
            }
            if (e.keyCode == 37) {
                var index = closestSlideStartIndex()
                console.log(index);
                if (index > 0) {
                    var top = $(anchors[index - 1]).offset().top;
                    $("html, body").animate({scrollTop: top}, 500);
                } else $("html, body").animate({scrollTop: 0}, 500);
            }
        });

        /*
        var config = {
          enter:  'top',
          move:   '0px',
          flip:   '0deg',
          spin:   '0deg',
          roll:   '0deg',
          reset:  true,
          vFactor:  0.01,
          //viewport: document.getElementById('viewport')
        }

        window.sr = new scrollReveal(config);
        */
        console.log("Test");
      }, 5000);

    </script>
    


<div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; padding: 0px; border: 0px; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: bold; font-style: italic; font-family: STIXGeneral, sans-serif;"></div></div></body></html>