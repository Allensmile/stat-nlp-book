<!DOCTYPE html>
<!-- saved from url=(0061)http://localhost:9000/template/statnlpbook/01_tasks/02_wordmt -->
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Word-based Machine Translation</title>
        

<script src="../assets/javascripts/jquery-1.9.0.min.js" type="text/javascript"></script>
<link rel="stylesheet" media="screen" href="../assets/stylesheets/normalize.css">

<!-- Moro imports -->
<script src="../assets/javascripts/document.js" type="text/javascript"></script>
<script src="../assets/javascripts/moro.js" type="text/javascript"></script>
<script src="../assets/javascripts/moro-cellconfig.js" type="text/javascript"></script>
<script src="../assets/javascripts/editor.js" type="text/javascript"></script>
<script src="../assets/javascripts/moro-static.js" type="text/javascript"></script>

<link rel="stylesheet" media="screen" href="../assets/stylesheets/moro.css">
<link rel="stylesheet" media="screen" href="../assets/stylesheets/static.css">

<!-- ACE editor -->
<script src="../assets/javascripts/ace/ace.js" type="text/javascript" charset="utf-8"></script><style id="ace_editor">.ace_editor {position: relative;overflow: hidden;font: 12px/normal 'Monaco', 'Menlo', 'Ubuntu Mono', 'Consolas', 'source-code-pro', monospace;direction: ltr;}.ace_scroller {position: absolute;overflow: hidden;top: 0;bottom: 0;background-color: inherit;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;cursor: text;}.ace_content {position: absolute;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;min-width: 100%;}.ace_dragging .ace_scroller:before{position: absolute;top: 0;left: 0;right: 0;bottom: 0;content: '';background: rgba(250, 250, 250, 0.01);z-index: 1000;}.ace_dragging.ace_dark .ace_scroller:before{background: rgba(0, 0, 0, 0.01);}.ace_selecting, .ace_selecting * {cursor: text !important;}.ace_gutter {position: absolute;overflow : hidden;width: auto;top: 0;bottom: 0;left: 0;cursor: default;z-index: 4;-ms-user-select: none;-moz-user-select: none;-webkit-user-select: none;user-select: none;}.ace_gutter-active-line {position: absolute;left: 0;right: 0;}.ace_scroller.ace_scroll-left {box-shadow: 17px 0 16px -16px rgba(0, 0, 0, 0.4) inset;}.ace_gutter-cell {padding-left: 19px;padding-right: 6px;background-repeat: no-repeat;}.ace_gutter-cell.ace_error {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABOFBMVEX/////////QRswFAb/Ui4wFAYwFAYwFAaWGAfDRymzOSH/PxswFAb/SiUwFAYwFAbUPRvjQiDllog5HhHdRybsTi3/Tyv9Tir+Syj/UC3////XurebMBIwFAb/RSHbPx/gUzfdwL3kzMivKBAwFAbbvbnhPx66NhowFAYwFAaZJg8wFAaxKBDZurf/RB6mMxb/SCMwFAYwFAbxQB3+RB4wFAb/Qhy4Oh+4QifbNRcwFAYwFAYwFAb/QRzdNhgwFAYwFAbav7v/Uy7oaE68MBK5LxLewr/r2NXewLswFAaxJw4wFAbkPRy2PyYwFAaxKhLm1tMwFAazPiQwFAaUGAb/QBrfOx3bvrv/VC/maE4wFAbRPBq6MRO8Qynew8Dp2tjfwb0wFAbx6eju5+by6uns4uH9/f36+vr/GkHjAAAAYnRSTlMAGt+64rnWu/bo8eAA4InH3+DwoN7j4eLi4xP99Nfg4+b+/u9B/eDs1MD1mO7+4PHg2MXa347g7vDizMLN4eG+Pv7i5evs/v79yu7S3/DV7/498Yv24eH+4ufQ3Ozu/v7+y13sRqwAAADLSURBVHjaZc/XDsFgGIBhtDrshlitmk2IrbHFqL2pvXf/+78DPokj7+Fz9qpU/9UXJIlhmPaTaQ6QPaz0mm+5gwkgovcV6GZzd5JtCQwgsxoHOvJO15kleRLAnMgHFIESUEPmawB9ngmelTtipwwfASilxOLyiV5UVUyVAfbG0cCPHig+GBkzAENHS0AstVF6bacZIOzgLmxsHbt2OecNgJC83JERmePUYq8ARGkJx6XtFsdddBQgZE2nPR6CICZhawjA4Fb/chv+399kfR+MMMDGOQAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: 2px center;}.ace_gutter-cell.ace_warning {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAmVBMVEX///8AAAD///8AAAAAAABPSzb/5sAAAAB/blH/73z/ulkAAAAAAAD85pkAAAAAAAACAgP/vGz/rkDerGbGrV7/pkQICAf////e0IsAAAD/oED/qTvhrnUAAAD/yHD/njcAAADuv2r/nz//oTj/p064oGf/zHAAAAA9Nir/tFIAAAD/tlTiuWf/tkIAAACynXEAAAAAAAAtIRW7zBpBAAAAM3RSTlMAABR1m7RXO8Ln31Z36zT+neXe5OzooRDfn+TZ4p3h2hTf4t3k3ucyrN1K5+Xaks52Sfs9CXgrAAAAjklEQVR42o3PbQ+CIBQFYEwboPhSYgoYunIqqLn6/z8uYdH8Vmdnu9vz4WwXgN/xTPRD2+sgOcZjsge/whXZgUaYYvT8QnuJaUrjrHUQreGczuEafQCO/SJTufTbroWsPgsllVhq3wJEk2jUSzX3CUEDJC84707djRc5MTAQxoLgupWRwW6UB5fS++NV8AbOZgnsC7BpEAAAAABJRU5ErkJggg==");background-position: 2px center;}.ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAAAAAA6mKC9AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAAJ0Uk5TAAB2k804AAAAPklEQVQY02NgIB68QuO3tiLznjAwpKTgNyDbMegwisCHZUETUZV0ZqOquBpXj2rtnpSJT1AEnnRmL2OgGgAAIKkRQap2htgAAAAASUVORK5CYII=");background-position: 2px center;}.ace_dark .ace_gutter-cell.ace_info {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAChoaGAgIAqKiq+vr6tra1ZWVmUlJSbm5s8PDxubm56enrdgzg3AAAAAXRSTlMAQObYZgAAAClJREFUeNpjYMAPdsMYHegyJZFQBlsUlMFVCWUYKkAZMxZAGdxlDMQBAG+TBP4B6RyJAAAAAElFTkSuQmCC");}.ace_scrollbar {position: absolute;right: 0;bottom: 0;z-index: 6;}.ace_scrollbar-inner {position: absolute;cursor: text;left: 0;top: 0;}.ace_scrollbar-v{overflow-x: hidden;overflow-y: scroll;top: 0;}.ace_scrollbar-h {overflow-x: scroll;overflow-y: hidden;left: 0;}.ace_print-margin {position: absolute;height: 100%;}.ace_text-input {position: absolute;z-index: 0;width: 0.5em;height: 1em;opacity: 0;background: transparent;-moz-appearance: none;appearance: none;border: none;resize: none;outline: none;overflow: hidden;font: inherit;padding: 0 1px;margin: 0 -1px;text-indent: -1em;-ms-user-select: text;-moz-user-select: text;-webkit-user-select: text;user-select: text;}.ace_text-input.ace_composition {background: inherit;color: inherit;z-index: 1000;opacity: 1;text-indent: 0;}.ace_layer {z-index: 1;position: absolute;overflow: hidden;white-space: pre;height: 100%;width: 100%;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;pointer-events: none;}.ace_gutter-layer {position: relative;width: auto;text-align: right;pointer-events: auto;}.ace_text-layer {font: inherit !important;}.ace_cjk {display: inline-block;text-align: center;}.ace_cursor-layer {z-index: 4;}.ace_cursor {z-index: 4;position: absolute;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;border-left: 2px solid}.ace_slim-cursors .ace_cursor {border-left-width: 1px;}.ace_overwrite-cursors .ace_cursor {border-left-width: 0;border-bottom: 1px solid;}.ace_hidden-cursors .ace_cursor {opacity: 0.2;}.ace_smooth-blinking .ace_cursor {-webkit-transition: opacity 0.18s;transition: opacity 0.18s;}.ace_editor.ace_multiselect .ace_cursor {border-left-width: 1px;}.ace_marker-layer .ace_step, .ace_marker-layer .ace_stack {position: absolute;z-index: 3;}.ace_marker-layer .ace_selection {position: absolute;z-index: 5;}.ace_marker-layer .ace_bracket {position: absolute;z-index: 6;}.ace_marker-layer .ace_active-line {position: absolute;z-index: 2;}.ace_marker-layer .ace_selected-word {position: absolute;z-index: 4;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;}.ace_line .ace_fold {-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;display: inline-block;height: 11px;margin-top: -2px;vertical-align: middle;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACJJREFUeNpi+P//fxgTAwPDBxDxD078RSX+YeEyDFMCIMAAI3INmXiwf2YAAAAASUVORK5CYII=");background-repeat: no-repeat, repeat-x;background-position: center center, top left;color: transparent;border: 1px solid black;border-radius: 2px;cursor: pointer;pointer-events: auto;}.ace_dark .ace_fold {}.ace_fold:hover{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAAJCAYAAADU6McMAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAJpJREFUeNpi/P//PwOlgAXGYGRklAVSokD8GmjwY1wasKljQpYACtpCFeADcHVQfQyMQAwzwAZI3wJKvCLkfKBaMSClBlR7BOQikCFGQEErIH0VqkabiGCAqwUadAzZJRxQr/0gwiXIal8zQQPnNVTgJ1TdawL0T5gBIP1MUJNhBv2HKoQHHjqNrA4WO4zY0glyNKLT2KIfIMAAQsdgGiXvgnYAAAAASUVORK5CYII="),url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAA3CAYAAADNNiA5AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACBJREFUeNpi+P//fz4TAwPDZxDxD5X4i5fLMEwJgAADAEPVDbjNw87ZAAAAAElFTkSuQmCC");}.ace_tooltip {background-color: #FFF;background-image: -webkit-linear-gradient(top, transparent, rgba(0, 0, 0, 0.1));background-image: linear-gradient(to bottom, transparent, rgba(0, 0, 0, 0.1));border: 1px solid gray;border-radius: 1px;box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);color: black;max-width: 100%;padding: 3px 4px;position: fixed;z-index: 999999;-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;cursor: default;white-space: pre;word-wrap: break-word;line-height: normal;font-style: normal;font-weight: normal;letter-spacing: normal;pointer-events: none;}.ace_folding-enabled > .ace_gutter-cell {padding-right: 13px;}.ace_fold-widget {-moz-box-sizing: border-box;-webkit-box-sizing: border-box;box-sizing: border-box;margin: 0 -12px 0 1px;display: none;width: 11px;vertical-align: top;background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42mWKsQ0AMAzC8ixLlrzQjzmBiEjp0A6WwBCSPgKAXoLkqSot7nN3yMwR7pZ32NzpKkVoDBUxKAAAAABJRU5ErkJggg==");background-repeat: no-repeat;background-position: center;border-radius: 3px;border: 1px solid transparent;cursor: pointer;}.ace_folding-enabled .ace_fold-widget {display: inline-block;   }.ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAANElEQVR42m3HwQkAMAhD0YzsRchFKI7sAikeWkrxwScEB0nh5e7KTPWimZki4tYfVbX+MNl4pyZXejUO1QAAAABJRU5ErkJggg==");}.ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAGCAYAAAAG5SQMAAAAOUlEQVR42jXKwQkAMAgDwKwqKD4EwQ26sSOkVWjgIIHAzPiCgaqiqnJHZnKICBERHN194O5b9vbLuAVRL+l0YWnZAAAAAElFTkSuQmCCXA==");}.ace_fold-widget:hover {border: 1px solid rgba(0, 0, 0, 0.3);background-color: rgba(255, 255, 255, 0.2);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.7);}.ace_fold-widget:active {border: 1px solid rgba(0, 0, 0, 0.4);background-color: rgba(0, 0, 0, 0.05);box-shadow: 0 1px 1px rgba(255, 255, 255, 0.8);}.ace_dark .ace_fold-widget {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHklEQVQIW2P4//8/AzoGEQ7oGCaLLAhWiSwB146BAQCSTPYocqT0AAAAAElFTkSuQmCC");}.ace_dark .ace_fold-widget.ace_end {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAH0lEQVQIW2P4//8/AxQ7wNjIAjDMgC4AxjCVKBirIAAF0kz2rlhxpAAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget.ace_closed {background-image: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAAFCAYAAACAcVaiAAAAHElEQVQIW2P4//+/AxAzgDADlOOAznHAKgPWAwARji8UIDTfQQAAAABJRU5ErkJggg==");}.ace_dark .ace_fold-widget:hover {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);background-color: rgba(255, 255, 255, 0.1);}.ace_dark .ace_fold-widget:active {box-shadow: 0 1px 1px rgba(255, 255, 255, 0.2);}.ace_fold-widget.ace_invalid {background-color: #FFB4B4;border-color: #DE5555;}.ace_fade-fold-widgets .ace_fold-widget {-webkit-transition: opacity 0.4s ease 0.05s;transition: opacity 0.4s ease 0.05s;opacity: 0;}.ace_fade-fold-widgets:hover .ace_fold-widget {-webkit-transition: opacity 0.05s ease 0.05s;transition: opacity 0.05s ease 0.05s;opacity:1;}.ace_underline {text-decoration: underline;}.ace_bold {font-weight: bold;}.ace_nobold .ace_bold {font-weight: normal;}.ace_italic {font-style: italic;}.ace_error-marker {background-color: rgba(255, 0, 0,0.2);position: absolute;z-index: 9;}.ace_highlight-marker {background-color: rgba(255, 255, 0,0.2);position: absolute;z-index: 8;}</style><style id="ace-tm">.ace-tm .ace_gutter {background: #f0f0f0;color: #333;}.ace-tm .ace_print-margin {width: 1px;background: #e8e8e8;}.ace-tm .ace_fold {background-color: #6B72E6;}.ace-tm {background-color: #FFFFFF;color: black;}.ace-tm .ace_cursor {color: black;}.ace-tm .ace_invisible {color: rgb(191, 191, 191);}.ace-tm .ace_storage,.ace-tm .ace_keyword {color: blue;}.ace-tm .ace_constant {color: rgb(197, 6, 11);}.ace-tm .ace_constant.ace_buildin {color: rgb(88, 72, 246);}.ace-tm .ace_constant.ace_language {color: rgb(88, 92, 246);}.ace-tm .ace_constant.ace_library {color: rgb(6, 150, 14);}.ace-tm .ace_invalid {background-color: rgba(255, 0, 0, 0.1);color: red;}.ace-tm .ace_support.ace_function {color: rgb(60, 76, 114);}.ace-tm .ace_support.ace_constant {color: rgb(6, 150, 14);}.ace-tm .ace_support.ace_type,.ace-tm .ace_support.ace_class {color: rgb(109, 121, 222);}.ace-tm .ace_keyword.ace_operator {color: rgb(104, 118, 135);}.ace-tm .ace_string {color: rgb(3, 106, 7);}.ace-tm .ace_comment {color: rgb(76, 136, 107);}.ace-tm .ace_comment.ace_doc {color: rgb(0, 102, 255);}.ace-tm .ace_comment.ace_doc.ace_tag {color: rgb(128, 159, 191);}.ace-tm .ace_constant.ace_numeric {color: rgb(0, 0, 205);}.ace-tm .ace_variable {color: rgb(49, 132, 149);}.ace-tm .ace_xml-pe {color: rgb(104, 104, 91);}.ace-tm .ace_entity.ace_name.ace_function {color: #0000A2;}.ace-tm .ace_heading {color: rgb(12, 7, 255);}.ace-tm .ace_list {color:rgb(185, 6, 144);}.ace-tm .ace_meta.ace_tag {color:rgb(0, 22, 142);}.ace-tm .ace_string.ace_regex {color: rgb(255, 0, 0)}.ace-tm .ace_marker-layer .ace_selection {background: rgb(181, 213, 255);}.ace-tm.ace_multiselect .ace_selection.ace_start {box-shadow: 0 0 3px 0px white;border-radius: 2px;}.ace-tm .ace_marker-layer .ace_step {background: rgb(252, 255, 0);}.ace-tm .ace_marker-layer .ace_stack {background: rgb(164, 229, 101);}.ace-tm .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid rgb(192, 192, 192);}.ace-tm .ace_marker-layer .ace_active-line {background: rgba(0, 0, 0, 0.07);}.ace-tm .ace_gutter-active-line {background-color : #dcdcdc;}.ace-tm .ace_marker-layer .ace_selected-word {background: rgb(250, 250, 255);border: 1px solid rgb(200, 200, 250);}.ace-tm .ace_indent-guide {background: url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAACCAYAAACZgbYnAAAAE0lEQVQImWP4////f4bLly//BwAmVgd1/w11/gAAAABJRU5ErkJggg==") right repeat-y;}</style><style>    .error_widget_wrapper {        background: inherit;        color: inherit;        border:none    }    .error_widget {        border-top: solid 2px;        border-bottom: solid 2px;        margin: 5px 0;        padding: 10px 40px;        white-space: pre-wrap;    }    .error_widget.ace_error, .error_widget_arrow.ace_error{        border-color: #ff5a5a    }    .error_widget.ace_warning, .error_widget_arrow.ace_warning{        border-color: #F1D817    }    .error_widget.ace_info, .error_widget_arrow.ace_info{        border-color: #5a5a5a    }    .error_widget.ace_ok, .error_widget_arrow.ace_ok{        border-color: #5aaa5a    }    .error_widget_arrow {        position: absolute;        border: solid 5px;        border-top-color: transparent!important;        border-right-color: transparent!important;        border-left-color: transparent!important;        top: -5px;    }</style>
<script src="../assets/javascripts/ace/ext-language_tools.js" type="text/javascript" charset="utf-8"></script><style>.ace_snippet-marker {    -moz-box-sizing: border-box;    box-sizing: border-box;    background: rgba(194, 193, 208, 0.09);    border: 1px dotted rgba(211, 208, 235, 0.62);    position: absolute;}</style><style>.ace_editor.ace_autocomplete .ace_marker-layer .ace_active-line {    background-color: #CAD6FA;    z-index: 1;}.ace_editor.ace_autocomplete .ace_line-hover {    border: 1px solid #abbffe;    margin-top: -1px;    background: rgba(233,233,253,0.4);}.ace_editor.ace_autocomplete .ace_line-hover {    position: absolute;    z-index: 2;}.ace_editor.ace_autocomplete .ace_scroller {   background: none;   border: none;   box-shadow: none;}.ace_rightAlignedText {    color: gray;    display: inline-block;    position: absolute;    right: 4px;    text-align: right;    z-index: -1;}.ace_editor.ace_autocomplete .ace_completion-highlight{    color: #000;    text-shadow: 0 0 0.01em;}.ace_editor.ace_autocomplete {    width: 280px;    z-index: 200000;    background: #fbfbfb;    color: #444;    border: 1px lightgray solid;    position: fixed;    box-shadow: 2px 3px 5px rgba(0,0,0,.2);    line-height: 1.4;}</style>

<!-- Bootstrap -->
<link href="../assets/javascripts/bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
<script src="../assets/javascripts/bootstrap/js/bootstrap.js" type="text/javascript"></script>

<!-- Icons, etc.-->
<link href="../assets/stylesheets/font-awesome/css/font-awesome.min.css" rel="stylesheet">
<link href="../assets/stylesheets/octicons/octicons.css" rel="stylesheet">

<!-- MathJax -->
<script type="text/x-mathjax-config;executed=true">
  MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} }, "HTML-CSS": { linebreaks: {automatic: true} } });
</script>
<script type="text/javascript" src="../assets/javascripts/MathJax.js"></script>
<!--script type="text/javascript" src="/assets/javascripts/MathJax-2.5-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script-->

<!-- Highlight.js -->
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/styles/tomorrow.min.css">
<script src="http://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/highlight.min.js"></script>

<!-- HTMLGEN -->
<script type="text/javascript" src="../assets/javascripts/d3.min.js"></script>
<script type="text/javascript" src="../assets/javascripts/raphael-min.js"></script>
<script type="text/javascript" src="../assets/javascripts/nv.d3.min.js"></script>
<script src="../assets/javascripts/htmlgen/d3utils.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript" src="../assets/javascripts/brat/client/lib/head.load.min.js"></script>

<script type="text/javascript" src="../assets/javascripts/dagre-d3.js"></script><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style>

<link href="../assets/stylesheets/nv.d3.css" rel="stylesheet">
<link rel="stylesheet" media="screen" href="../assets/stylesheets/htmlgen.css">

        

<link rel="icon" type="image/x-icon" href="../assets/images/wolfe-logo-black.png">

<link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic,900">
<link rel="stylesheet" media="screen" href="../assets/stylesheets/gridism.css">
<link rel="stylesheet" media="screen" href="../assets/stylesheets/normalize.css">
<link rel="stylesheet" media="screen" href="../assets/stylesheets/wolfe.css">

        <link rel="stylesheet" media="screen, print" href="../assets/stylesheets/statnlpbook.css">
    <script src="../assets/javascripts/ace/snippets/text.js"></script><script src="../assets/javascripts/ace/theme-chaos.js"></script><script src="../assets/javascripts/ace/mode-markdown.js"></script><script src="../assets/javascripts/ace/mode-scala.js"></script><script src="../assets/javascripts/ace/mode-html.js"></script><style id="ace-chaos">.ace-chaos .ace_gutter {background: #141414;color: #595959;border-right: 1px solid #282828;}.ace-chaos .ace_gutter-cell.ace_warning {background-image: none;background: #FC0;border-left: none;padding-left: 0;color: #000;}.ace-chaos .ace_gutter-cell.ace_error {background-position: -6px center;background-image: none;background: #F10;border-left: none;padding-left: 0;color: #000;}.ace-chaos .ace_print-margin {border-left: 1px solid #555;right: 0;background: #1D1D1D;}.ace-chaos {background-color: #161616;color: #E6E1DC;}.ace-chaos .ace_cursor {border-left: 2px solid #FFFFFF;}.ace-chaos .ace_cursor.ace_overwrite {border-left: 0px;border-bottom: 1px solid #FFFFFF;}.ace-chaos .ace_marker-layer .ace_selection {background: #494836;}.ace-chaos .ace_marker-layer .ace_step {background: rgb(198, 219, 174);}.ace-chaos .ace_marker-layer .ace_bracket {margin: -1px 0 0 -1px;border: 1px solid #FCE94F;}.ace-chaos .ace_marker-layer .ace_active-line {background: #333;}.ace-chaos .ace_gutter-active-line {background-color: #222;}.ace-chaos .ace_invisible {color: #404040;}.ace-chaos .ace_keyword {color:#00698F;}.ace-chaos .ace_keyword.ace_operator {color:#FF308F;}.ace-chaos .ace_constant {color:#1EDAFB;}.ace-chaos .ace_constant.ace_language {color:#FDC251;}.ace-chaos .ace_constant.ace_library {color:#8DFF0A;}.ace-chaos .ace_constant.ace_numeric {color:#58C554;}.ace-chaos .ace_invalid {color:#FFFFFF;background-color:#990000;}.ace-chaos .ace_invalid.ace_deprecated {color:#FFFFFF;background-color:#990000;}.ace-chaos .ace_support {color: #999;}.ace-chaos .ace_support.ace_function {color:#00AEEF;}.ace-chaos .ace_function {color:#00AEEF;}.ace-chaos .ace_string {color:#58C554;}.ace-chaos .ace_comment {color:#555;font-style:italic;padding-bottom: 0px;}.ace-chaos .ace_variable {color:#997744;}.ace-chaos .ace_meta.ace_tag {color:#BE53E6;}.ace-chaos .ace_entity.ace_other.ace_attribute-name {color:#FFFF89;}.ace-chaos .ace_markup.ace_underline {text-decoration: underline;}.ace-chaos .ace_fold-widget {text-align: center;}.ace-chaos .ace_fold-widget:hover {color: #777;}.ace-chaos .ace_fold-widget.ace_start,.ace-chaos .ace_fold-widget.ace_end,.ace-chaos .ace_fold-widget.ace_closed{background: none;border: none;box-shadow: none;}.ace-chaos .ace_fold-widget.ace_start:after {content: '▾'}.ace-chaos .ace_fold-widget.ace_end:after {content: '▴'}.ace-chaos .ace_fold-widget.ace_closed:after {content: '‣'}.ace-chaos .ace_indent-guide {border-right:1px dotted #333;margin-right:-1px;}.ace-chaos .ace_fold { background: #222; border-radius: 3px; color: #7AF; border: none; }.ace-chaos .ace_fold:hover {background: #CCC; color: #000;}</style><script src="../assets/javascripts/ace/snippets/scala.js"></script><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><script src="../assets/javascripts/ace/snippets/markdown.js"></script><script src="../assets/javascripts/ace/snippets/html.js"></script><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none}
.MathJax .MathJax_EmBox {display: block!important; overflow: hidden; width: 1px; height: 60em; min-height: 0; max-height: none}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Blank; src: url('about:blank')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>
    <body class="wrap" style="zoom: 1;"><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div></div><div id="MathJax_Message" style="display: none;"></div>
        <header>
            <nav class="mobile-nav show-on-mobiles">
                    <!--{% include primary-nav-items.html %}-->
            </nav>
            <div class="grid">
                <div class="center-on-mobiles">
                    <h1>
                        <a href="../00_intro.html">
                            <h1 class="logo-text">StatNLP</h1>
                        </a>
                    </h1>
                    <div id="slidesButton">[<a id="toggle-view" href="../01_tasks/02_wordmt_slides.html">Slides</a>]</div>
                </div>
            </div>
        </header>
        <section>
            <div class="grid">
                <div>
                
                    
                
                    
                
                    
                
                    
<span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; /&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" role="math" style="width: 0.002em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.002em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(3.867em 1000em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mrow" id="MathJax-Span-2"></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"></math></span></span><script type="math/tex" id="MathJax-Element-1">
  \def\prob{p}
  \def\vocab{V}
  \def\params{\boldsymbol{\theta}}
  \def\argmax{\mathop{\arg\,\max}}
  \def\param{\theta}
  \def\bpi{\boldsymbol{\pi}}
  \def\balpha{\boldsymbol{\alpha}}
  \def\bbeta{\boldsymbol{\beta}}
  \def\perplexity{PP}
  \def\x{\mathbf{x}}
  \def\y{\mathbf{y}}
  \def\Xs{\mathcal{X}}
  \def\Ys{\mathcal{Y}}
  \def\perplexity{PP}
  \def\train{\mathcal{D}_\mathit{train}}
  \def\counts#1#2{\#_{#1}(#2)}
  \def\RR{\bf R}
  \def\length#1{\mathop{length}(#1)}
  \def\aligns{\mathbf{a}}
  \def\align{a}
  \def\source{\mathbf{s}}
  \def\ssource{s}
  \def\target{\mathbf{t}}
  \def\starget{t}
</script>
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                    
                
                </div>
                <div id="static_content" class="unit center-on-mobiles">
                    <h1>Word-based Machine Translation</h1>
                <div id="cell0" class="cellWrapper"><div id="editCell0" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor0" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode0" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay0" class="cell"><div class="newslide"></div><p>Machine Translation (MT) is one of the canonical NLP applications, and one that nowadays most people are familiar with, primarily through online translation services of the major search engine providers. While there is still some way to go before machines can provide fluent and flawless translations, in particular for more distant language pairs like English and Japanese, progress in this field has been remarkable. <span class="summary">MT is one of the most widely used NLP application. It is an example of <strong>end-to-end NLP</strong>, and MT-like architectures can be found in many other applications.</span> </p>
<div class="newslide"></div><p>In this chapter we will illustrate the foundations of this progress, and focus on word-based machine translation models. In such models words are the basic unit of translation. Nowadays the field has mostly moved to phrase and syntax-based approaches, but the word-based approach is still important, both from a foundational point of view, and as sub-component in more complex approaches. <span class="summary">We focus on <strong>word-based</strong> MT which is not the state-of-the-art anymore, but a <strong>foundation and blueprint</strong> for modern mechanisms.</span> </p>
<div class="newslide"></div><h3>MT as <a href="../02_methods/00_structuredprediction.html">Structured Prediction</a></h3><p>Formally we will see MT as the task of translating a <em>source</em> sentence <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-3" role="math" style="width: 0.534em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.437em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.886em 1000.39em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-4"><span class="texatom" id="MathJax-Span-5"><span class="mrow" id="MathJax-Span-6"><span class="mi" id="MathJax-Span-7" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-2">\source</script> to a <em>target</em> sentence <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-8" role="math" style="width: 0.389em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.341em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.742em 1000.34em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-9"><span class="texatom" id="MathJax-Span-10"><span class="mrow" id="MathJax-Span-11"><span class="mi" id="MathJax-Span-12" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.836em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-3">\target</script>. We can tackle the problem using the <a href="../02_methods/00_structuredprediction.html">structured prediction recipe</a>: We define a parametrised model <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-13" role="math" style="width: 3.094em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.659em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1002.61em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-14"><span class="msubsup" id="MathJax-Span-15"><span style="display: inline-block; position: relative; width: 0.824em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.39em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-16" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.389em;"><span class="mi" id="MathJax-Span-17" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-18" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-19"><span class="mrow" id="MathJax-Span-20"><span class="mi" id="MathJax-Span-21" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-22" style="font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-23" style="padding-left: 0.196em;"><span class="mrow" id="MathJax-Span-24"><span class="mi" id="MathJax-Span-25" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-26" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>s</mi><mi mathvariant="bold-italic">θ</mi></msub><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-4">s_\params(\target,\source)</script> that measures how well a target <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-27" role="math" style="width: 0.389em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.341em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.742em 1000.34em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-28"><span class="texatom" id="MathJax-Span-29"><span class="mrow" id="MathJax-Span-30"><span class="mi" id="MathJax-Span-31" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.836em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-5">\target</script> sentence matches a source sentence <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-32" role="math" style="width: 0.534em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.437em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.886em 1000.39em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-33"><span class="texatom" id="MathJax-Span-34"><span class="mrow" id="MathJax-Span-35"><span class="mi" id="MathJax-Span-36" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-6">\source</script>, learn the parameters <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-37" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.53em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-38"><span class="mi" id="MathJax-Span-39" style="font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.947em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-7">\params</script> from training data, and then find <span class="summary">Define a parametrised model <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-40" role="math" style="width: 3.094em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.659em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1002.61em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-41"><span class="msubsup" id="MathJax-Span-42"><span style="display: inline-block; position: relative; width: 0.824em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.39em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-43" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.389em;"><span class="mi" id="MathJax-Span-44" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-45" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-46"><span class="mrow" id="MathJax-Span-47"><span class="mi" id="MathJax-Span-48" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-49" style="font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-50" style="padding-left: 0.196em;"><span class="mrow" id="MathJax-Span-51"><span class="mi" id="MathJax-Span-52" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-53" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>s</mi><mi mathvariant="bold-italic">θ</mi></msub><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-8">s_\params(\target,\source)</script> measuring how well a <strong>target</strong> sentence <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-54" role="math" style="width: 0.389em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.341em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.742em 1000.34em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-55"><span class="texatom" id="MathJax-Span-56"><span class="mrow" id="MathJax-Span-57"><span class="mi" id="MathJax-Span-58" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.836em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-9">\target</script> matches a <strong>source</strong> sentence <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-59" role="math" style="width: 0.534em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.437em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.886em 1000.39em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-60"><span class="texatom" id="MathJax-Span-61"><span class="mrow" id="MathJax-Span-62"><span class="mi" id="MathJax-Span-63" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-10">\source</script>, learn the parameters <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-64" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.53em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-65"><span class="mi" id="MathJax-Span-66" style="font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.947em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-11">\params</script> from training data, and find</span> </p><p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display"><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable displaystyle=&quot;true&quot;&gt;&lt;mlabeledtr&gt;&lt;mtd id=&quot;mjx-eqn-decode-mt&quot;&gt;&lt;mtext&gt;(1)&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;munder&gt;&lt;mrow class=&quot;MJX-TeXAtom-OP&quot;&gt;&lt;mi&gt;arg&lt;/mi&gt;&lt;mspace width=&quot;thinmathspace&quot; /&gt;&lt;mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;&gt;max&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mlabeledtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="width: 100%; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-67" role="math" style="width: 100%; display: inline-block; min-width: 10.389em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; font-size: 115%; min-width: 10.389em;"><span style="position: absolute; clip: rect(2.708em 1006.19em 4.785em -999.998em); top: -4.007em; left: 0.002em; width: 100%;"><span class="mrow" id="MathJax-Span-68"><span class="mtable" id="MathJax-Span-69" style="min-width: 10.389em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; min-width: 10.389em;"><span style="display: inline-block; position: absolute; width: 6.234em; height: 0px; clip: rect(-1.302em 1006.19em 0.775em -999.998em); top: 0.002em; left: 50%; margin-left: -3.089em;"><span style="position: absolute; clip: rect(2.853em 1006.19em 4.785em -999.998em); top: -4.007em; left: 0.002em;"><span style="display: inline-block; position: relative; width: 6.234em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1006.19em 5.171em -999.998em); top: -4.345em; left: 50%; margin-left: -3.089em;"><span class="mtd" id="MathJax-Span-73"><span class="mrow" id="MathJax-Span-74"><span class="munderover" id="MathJax-Span-75"><span style="display: inline-block; position: relative; width: 3.384em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1003.38em 4.399em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-76"><span class="mrow" id="MathJax-Span-77"><span class="mi" id="MathJax-Span-78" style="font-family: STIXGeneral-Regular;">arg</span><span class="mspace" id="MathJax-Span-79" style="height: 0.002em; vertical-align: 0.002em; width: 0.196em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-80" style="font-family: STIXGeneral-Regular; padding-left: 0.196em;">max</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.432em 1000.24em 4.254em -999.998em); top: -3.138em; left: 1.597em;"><span class="texatom" id="MathJax-Span-81"><span class="mrow" id="MathJax-Span-82"><span class="mi" id="MathJax-Span-83" style="font-size: 70.7%; font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-84"></span><span class="msubsup" id="MathJax-Span-85" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 0.824em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.39em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-86" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.389em;"><span class="mi" id="MathJax-Span-87" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-88" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-89"><span class="mrow" id="MathJax-Span-90"><span class="mi" id="MathJax-Span-91" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-92" style="font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-93" style="padding-left: 0.196em;"><span class="mrow" id="MathJax-Span-94"><span class="mi" id="MathJax-Span-95" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-96" style="font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span><span style="display: inline-block; position: absolute; width: 1.162em; height: 0px; clip: rect(-1.157em 1001.11em -0.046em -999.998em); top: 0.002em; right: 0.002em; margin-right: 0.002em;"><span style="position: absolute; clip: rect(3.191em 1001.11em 4.35em -999.998em); top: -4.345em; right: 0.002em;"><span class="mtd" id="mjx-eqn-decode-mt"><span class="mrow" id="MathJax-Span-71"><span class="mtext" id="MathJax-Span-72" style="font-family: STIXGeneral-Regular;">(1)</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.775em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 2.169em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true"><mlabeledtr><mtd id="mjx-eqn-decode-mt"><mtext>(1)</mtext></mtd><mtd><munder><mrow class="MJX-TeXAtom-OP"><mi>arg</mi><mspace width="thinmathspace"></mspace><mo movablelimits="true" form="prefix">max</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow></munder><mo>⁡</mo><msub><mi>s</mi><mi mathvariant="bold-italic">θ</mi></msub><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo stretchy="false">)</mo></mtd></mlabeledtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-12">\begin{equation}  \label{decode-mt}  \argmax_\target s_\params(\target,\source) \end{equation}</script></p><p>as translation of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-97" role="math" style="width: 0.534em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.437em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.886em 1000.39em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-98"><span class="texatom" id="MathJax-Span-99"><span class="mrow" id="MathJax-Span-100"><span class="mi" id="MathJax-Span-101" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-13">\source</script>. Different <em>statistical</em> MT approaches, in this view, differ primarily in how <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-102" role="math" style="width: 0.534em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.437em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.935em 1000.44em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-103"><span class="mi" id="MathJax-Span-104" style="font-family: STIXGeneral-Italic;">s</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.614em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-14">s</script> is defined, <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-105" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.53em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-106"><span class="mi" id="MathJax-Span-107" style="font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.947em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-15">\params</script> are learned, and how the <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-OP&quot;&gt;&lt;mi&gt;arg&lt;/mi&gt;&lt;mspace width=&quot;thinmathspace&quot; /&gt;&lt;mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;&gt;max&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-108" role="math" style="width: 3.964em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.432em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.886em 1003.43em 2.901em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-109"><span class="texatom" id="MathJax-Span-110"><span class="mrow" id="MathJax-Span-111"><span class="mi" id="MathJax-Span-112" style="font-family: STIXGeneral-Regular;">arg</span><span class="mspace" id="MathJax-Span-113" style="height: 0.002em; vertical-align: 0.002em; width: 0.196em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-114" style="font-family: STIXGeneral-Regular; padding-left: 0.196em;">max</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.331em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.892em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-OP"><mi>arg</mi><mspace width="thinmathspace"></mspace><mo movablelimits="true" form="prefix">max</mo></mrow></math></span></span><script type="math/tex" id="MathJax-Element-16">\argmax</script> is found. <span class="summary"></span></p></div></div><div id="cell1" class="cellWrapper"><div id="editCell1" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor1" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode1" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay1" class="cell"><div class="newslide"></div><h3>Noisy Channel Model for MT</h3>
<div class="book-start"></div><p>Many Word-based MT systems, as well as those based on more advanced representations, rely on a <a href="https://www.dropbox.com/s/gfucv538m6anmgd/NoisyChannel.pdf?dl=0">Noisy Channel</a> model as choice for the scoring function <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-115" role="math" style="width: 1.017em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.872em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.597em 1000.87em 2.466em -999.998em); top: -2.171em; left: 0.002em;"><span class="mrow" id="MathJax-Span-116"><span class="msubsup" id="MathJax-Span-117"><span style="display: inline-block; position: relative; width: 0.824em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.39em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-118" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.389em;"><span class="mi" id="MathJax-Span-119" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.176em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.219em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.781em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>s</mi><mi mathvariant="bold-italic">θ</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-17">s_\params</script>. In this approach to MT we effectively model the translation process <em>in reverse</em>. That is, we assume that a probabilistic process (the speaker's brain) first generates the target sentence <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-120" role="math" style="width: 0.389em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.341em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.742em 1000.34em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-121"><span class="texatom" id="MathJax-Span-122"><span class="mrow" id="MathJax-Span-123"><span class="mi" id="MathJax-Span-124" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.836em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-18">\target</script> according to the distribution <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-125" role="math" style="width: 1.79em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.548em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1001.5em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-126"><span class="mi" id="MathJax-Span-127" style="font-family: STIXGeneral-Italic;">p</span><span class="mo" id="MathJax-Span-128" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-129"><span class="mrow" id="MathJax-Span-130"><span class="mi" id="MathJax-Span-131" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-132" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-19">\prob(\target)</script>. Then the target sentence <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-133" role="math" style="width: 0.389em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.341em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.742em 1000.34em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-134"><span class="texatom" id="MathJax-Span-135"><span class="mrow" id="MathJax-Span-136"><span class="mi" id="MathJax-Span-137" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.836em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-20">\target</script> is transmitted through a <em>noisy channel</em> <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-138" role="math" style="width: 2.466em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.128em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1002.08em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-139"><span class="mi" id="MathJax-Span-140" style="font-family: STIXGeneral-Italic;">p</span><span class="mo" id="MathJax-Span-141" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-142"><span class="mrow" id="MathJax-Span-143"><span class="mi" id="MathJax-Span-144" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="texatom" id="MathJax-Span-145"><span class="mrow" id="MathJax-Span-146"><span class="mo" id="MathJax-Span-147" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-148"><span class="mrow" id="MathJax-Span-149"><span class="mi" id="MathJax-Span-150" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-151" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-21">\prob(\source|\target)</script> that translates <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-22-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-152" role="math" style="width: 0.389em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.341em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.742em 1000.34em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-153"><span class="texatom" id="MathJax-Span-154"><span class="mrow" id="MathJax-Span-155"><span class="mi" id="MathJax-Span-156" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.836em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-22">\target</script> into <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-23-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-157" role="math" style="width: 0.534em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.437em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.886em 1000.39em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-158"><span class="texatom" id="MathJax-Span-159"><span class="mrow" id="MathJax-Span-160"><span class="mi" id="MathJax-Span-161" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-23">\source</script>. </p>


<div class="slide-end"></div>
<div class="newslide"></div><p>Hence translation is seen as adding noise to a clean <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-29-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-199" role="math" style="width: 0.389em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.341em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.742em 1000.34em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-200"><span class="texatom" id="MathJax-Span-201"><span class="mrow" id="MathJax-Span-202"><span class="mi" id="MathJax-Span-203" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.836em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-29">\target</script>. This <em>generative story</em> defines a <em>joint distribution</em> over target and source sentences <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-30-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-204" role="math" style="width: 8.312em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.2em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1007.15em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-205"><span class="mi" id="MathJax-Span-206" style="font-family: STIXGeneral-Italic;">p</span><span class="mo" id="MathJax-Span-207" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-208"><span class="mrow" id="MathJax-Span-209"><span class="mi" id="MathJax-Span-210" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-211" style="font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-212" style="padding-left: 0.196em;"><span class="mrow" id="MathJax-Span-213"><span class="mi" id="MathJax-Span-214" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-215" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-216" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">=</span><span class="mi" id="MathJax-Span-217" style="font-family: STIXGeneral-Italic; padding-left: 0.292em;">p</span><span class="mo" id="MathJax-Span-218" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-219"><span class="mrow" id="MathJax-Span-220"><span class="mi" id="MathJax-Span-221" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-222" style="font-family: STIXGeneral-Regular;">)</span><span class="mi" id="MathJax-Span-223" style="font-family: STIXGeneral-Italic;">p</span><span class="mo" id="MathJax-Span-224" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-225"><span class="mrow" id="MathJax-Span-226"><span class="mi" id="MathJax-Span-227" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="texatom" id="MathJax-Span-228"><span class="mrow" id="MathJax-Span-229"><span class="mo" id="MathJax-Span-230" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-231"><span class="mrow" id="MathJax-Span-232"><span class="mi" id="MathJax-Span-233" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-234" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><mi>p</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo><mi>p</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-30">\prob(\source,\target) = \prob(\target) \prob(\source|\target) </script>. We can in turn operate this distribution in the direction we actually care about: to infer a target sentence <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-31-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-235" role="math" style="width: 0.389em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.341em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.742em 1000.34em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-236"><span class="texatom" id="MathJax-Span-237"><span class="mrow" id="MathJax-Span-238"><span class="mi" id="MathJax-Span-239" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.836em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-31">\target</script> given a source sentence <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-32-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-240" role="math" style="width: 0.534em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.437em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.886em 1000.39em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-241"><span class="texatom" id="MathJax-Span-242"><span class="mrow" id="MathJax-Span-243"><span class="mi" id="MathJax-Span-244" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-32">\source</script> we find the <em>maximum a posteriori</em> sentence <span class="summary">The distribution over target words and the channel noise model define a joint distribution <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-33-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-245" role="math" style="width: 8.312em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.2em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1007.15em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-246"><span class="mi" id="MathJax-Span-247" style="font-family: STIXGeneral-Italic;">p</span><span class="mo" id="MathJax-Span-248" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-249"><span class="mrow" id="MathJax-Span-250"><span class="mi" id="MathJax-Span-251" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-252" style="font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-253" style="padding-left: 0.196em;"><span class="mrow" id="MathJax-Span-254"><span class="mi" id="MathJax-Span-255" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-256" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-257" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">=</span><span class="mi" id="MathJax-Span-258" style="font-family: STIXGeneral-Italic; padding-left: 0.292em;">p</span><span class="mo" id="MathJax-Span-259" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-260"><span class="mrow" id="MathJax-Span-261"><span class="mi" id="MathJax-Span-262" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-263" style="font-family: STIXGeneral-Regular;">)</span><span class="mi" id="MathJax-Span-264" style="font-family: STIXGeneral-Italic;">p</span><span class="mo" id="MathJax-Span-265" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-266"><span class="mrow" id="MathJax-Span-267"><span class="mi" id="MathJax-Span-268" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="texatom" id="MathJax-Span-269"><span class="mrow" id="MathJax-Span-270"><span class="mo" id="MathJax-Span-271" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-272"><span class="mrow" id="MathJax-Span-273"><span class="mi" id="MathJax-Span-274" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-275" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><mi>p</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo><mi>p</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-33">\prob(\source,\target) = \prob(\target) \prob(\source|\target) </script>. To use it for translation we operate it <strong>backwards</strong>: </span></p><p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display"><span class="MathJax" id="MathJax-Element-34-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable displaystyle=&quot;true&quot;&gt;&lt;mlabeledtr&gt;&lt;mtd id=&quot;mjx-eqn-decode-nc&quot;&gt;&lt;mtext&gt;(2)&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;msup&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;munder&gt;&lt;mrow class=&quot;MJX-TeXAtom-OP&quot;&gt;&lt;mi&gt;arg&lt;/mi&gt;&lt;mspace width=&quot;thinmathspace&quot; /&gt;&lt;mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;&gt;max&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;munder&gt;&lt;mrow class=&quot;MJX-TeXAtom-OP&quot;&gt;&lt;mi&gt;arg&lt;/mi&gt;&lt;mspace width=&quot;thinmathspace&quot; /&gt;&lt;mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;&gt;max&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mspace width=&quot;thinmathspace&quot; /&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/mtd&gt;&lt;/mlabeledtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="width: 100%; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-276" role="math" style="width: 100%; display: inline-block; min-width: 20.727em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; font-size: 115%; min-width: 20.727em;"><span style="position: absolute; clip: rect(2.708em 1016.52em 4.785em -999.998em); top: -4.007em; left: 0.002em; width: 100%;"><span class="mrow" id="MathJax-Span-277"><span class="mtable" id="MathJax-Span-278" style="min-width: 20.727em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; min-width: 20.727em;"><span style="display: inline-block; position: absolute; width: 16.621em; height: 0px; clip: rect(-1.302em 1016.52em 0.775em -999.998em); top: 0.002em; left: 50%; margin-left: -8.307em;"><span style="position: absolute; clip: rect(2.756em 1016.52em 4.785em -999.998em); top: -4.007em; left: 0.002em;"><span style="display: inline-block; position: relative; width: 16.621em; height: 0px;"><span style="position: absolute; clip: rect(3.143em 1016.52em 5.171em -999.998em); top: -4.345em; left: 50%; margin-left: -8.307em;"><span class="mtd" id="MathJax-Span-282"><span class="mrow" id="MathJax-Span-283"><span class="msubsup" id="MathJax-Span-284"><span style="display: inline-block; position: relative; width: 0.775em; height: 0px;"><span style="position: absolute; clip: rect(3.239em 1000.34em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-285"><span class="mrow" id="MathJax-Span-286"><span class="mi" id="MathJax-Span-287" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -4.442em; left: 0.341em;"><span class="mo" id="MathJax-Span-288" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">∗</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-289" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">=</span><span class="munderover" id="MathJax-Span-290" style="padding-left: 0.292em;"><span style="display: inline-block; position: relative; width: 3.384em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1003.38em 4.399em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-291"><span class="mrow" id="MathJax-Span-292"><span class="mi" id="MathJax-Span-293" style="font-family: STIXGeneral-Regular;">arg</span><span class="mspace" id="MathJax-Span-294" style="height: 0.002em; vertical-align: 0.002em; width: 0.196em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-295" style="font-family: STIXGeneral-Regular; padding-left: 0.196em;">max</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.432em 1000.24em 4.254em -999.998em); top: -3.138em; left: 1.597em;"><span class="texatom" id="MathJax-Span-296"><span class="mrow" id="MathJax-Span-297"><span class="mi" id="MathJax-Span-298" style="font-size: 70.7%; font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-299"></span><span class="mi" id="MathJax-Span-300" style="font-family: STIXGeneral-Italic; padding-left: 0.196em;">p</span><span class="mo" id="MathJax-Span-301" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-302"><span class="mrow" id="MathJax-Span-303"><span class="mi" id="MathJax-Span-304" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="texatom" id="MathJax-Span-305"><span class="mrow" id="MathJax-Span-306"><span class="mo" id="MathJax-Span-307" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-308"><span class="mrow" id="MathJax-Span-309"><span class="mi" id="MathJax-Span-310" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-311" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-312" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">=</span><span class="munderover" id="MathJax-Span-313" style="padding-left: 0.292em;"><span style="display: inline-block; position: relative; width: 3.384em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1003.38em 4.399em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-314"><span class="mrow" id="MathJax-Span-315"><span class="mi" id="MathJax-Span-316" style="font-family: STIXGeneral-Regular;">arg</span><span class="mspace" id="MathJax-Span-317" style="height: 0.002em; vertical-align: 0.002em; width: 0.196em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-318" style="font-family: STIXGeneral-Regular; padding-left: 0.196em;">max</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.432em 1000.24em 4.254em -999.998em); top: -3.138em; left: 1.597em;"><span class="texatom" id="MathJax-Span-319"><span class="mrow" id="MathJax-Span-320"><span class="mi" id="MathJax-Span-321" style="font-size: 70.7%; font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-322"></span><span class="mi" id="MathJax-Span-323" style="font-family: STIXGeneral-Italic; padding-left: 0.196em;">p</span><span class="mo" id="MathJax-Span-324" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-325"><span class="mrow" id="MathJax-Span-326"><span class="mi" id="MathJax-Span-327" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-328" style="font-family: STIXGeneral-Regular;">)</span><span class="mspace" id="MathJax-Span-329" style="height: 0.002em; vertical-align: 0.002em; width: 0.196em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-330" style="font-family: STIXGeneral-Italic;">p</span><span class="mo" id="MathJax-Span-331" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-332"><span class="mrow" id="MathJax-Span-333"><span class="mi" id="MathJax-Span-334" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="texatom" id="MathJax-Span-335"><span class="mrow" id="MathJax-Span-336"><span class="mo" id="MathJax-Span-337" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-338"><span class="mrow" id="MathJax-Span-339"><span class="mi" id="MathJax-Span-340" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-341" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-342" style="font-family: STIXGeneral-Regular;">.</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span><span style="display: inline-block; position: absolute; width: 1.162em; height: 0px; clip: rect(-1.157em 1001.11em -0.046em -999.998em); top: 0.002em; right: 0.002em; margin-right: 0.002em;"><span style="position: absolute; clip: rect(3.191em 1001.11em 4.35em -999.998em); top: -4.345em; right: 0.002em;"><span class="mtd" id="mjx-eqn-decode-nc"><span class="mrow" id="MathJax-Span-280"><span class="mtext" id="MathJax-Span-281" style="font-family: STIXGeneral-Regular;">(2)</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.775em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 2.169em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true"><mlabeledtr><mtd id="mjx-eqn-decode-nc"><mtext>(2)</mtext></mtd><mtd><msup><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo>∗</mo></msup><mo>=</mo><munder><mrow class="MJX-TeXAtom-OP"><mi>arg</mi><mspace width="thinmathspace"></mspace><mo movablelimits="true" form="prefix">max</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow></munder><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><munder><mrow class="MJX-TeXAtom-OP"><mi>arg</mi><mspace width="thinmathspace"></mspace><mo movablelimits="true" form="prefix">max</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow></munder><mo>⁡</mo><mi>p</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo><mspace width="thinmathspace"></mspace><mi>p</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo><mo>.</mo></mtd></mlabeledtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-34">\begin{equation} \label{decode-nc} \target^* = \argmax_\target \prob(\target | \source) = \argmax_\target \prob(\target) \, \prob(\source | \target). \end{equation}</script></p><p>For the structured prediction recipe this means setting </p><p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-35-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mspace width=&quot;thinmathspace&quot; /&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-343" role="math" style="width: 9.181em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.973em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1007.92em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-344"><span class="msubsup" id="MathJax-Span-345"><span style="display: inline-block; position: relative; width: 0.824em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.39em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-346" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.389em;"><span class="mi" id="MathJax-Span-347" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-348" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-349"><span class="mrow" id="MathJax-Span-350"><span class="mi" id="MathJax-Span-351" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-352" style="font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-353" style="padding-left: 0.196em;"><span class="mrow" id="MathJax-Span-354"><span class="mi" id="MathJax-Span-355" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-356" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-357" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">=</span><span class="mi" id="MathJax-Span-358" style="font-family: STIXGeneral-Italic; padding-left: 0.292em;">p</span><span class="mo" id="MathJax-Span-359" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-360"><span class="mrow" id="MathJax-Span-361"><span class="mi" id="MathJax-Span-362" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-363" style="font-family: STIXGeneral-Regular;">)</span><span class="mspace" id="MathJax-Span-364" style="height: 0.002em; vertical-align: 0.002em; width: 0.196em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-365" style="font-family: STIXGeneral-Italic;">p</span><span class="mo" id="MathJax-Span-366" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-367"><span class="mrow" id="MathJax-Span-368"><span class="mi" id="MathJax-Span-369" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="texatom" id="MathJax-Span-370"><span class="mrow" id="MathJax-Span-371"><span class="mo" id="MathJax-Span-372" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-373"><span class="mrow" id="MathJax-Span-374"><span class="mi" id="MathJax-Span-375" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-376" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-377" style="font-family: STIXGeneral-Regular;">.</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>s</mi><mi mathvariant="bold-italic">θ</mi></msub><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><mi>p</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo><mspace width="thinmathspace"></mspace><mi>p</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo><mo>.</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-35"> s_\params(\target,\source) = \prob(\target) \, \prob(\source | \target). </script></p>
<div class="newslide"></div>
<div class="book-start"></div><p>In the noisy channel approach for MT the distribution <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-36-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-378" role="math" style="width: 1.79em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.548em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1001.5em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-379"><span class="mi" id="MathJax-Span-380" style="font-family: STIXGeneral-Italic;">p</span><span class="mo" id="MathJax-Span-381" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-382"><span class="mrow" id="MathJax-Span-383"><span class="mi" id="MathJax-Span-384" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-385" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-36">\prob(\target)</script> that generates the target sentence is usually referred to as <a href="../01_tasks/01_languagemodels.html">language model</a>, and the noisy channel is called the <em>translation model</em>. As we have discussed language models earlier, in this chapter we focus on the translation model <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-37-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-386" role="math" style="width: 2.466em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.128em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1002.08em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-387"><span class="mi" id="MathJax-Span-388" style="font-family: STIXGeneral-Italic;">p</span><span class="mo" id="MathJax-Span-389" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-390"><span class="mrow" id="MathJax-Span-391"><span class="mi" id="MathJax-Span-392" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="texatom" id="MathJax-Span-393"><span class="mrow" id="MathJax-Span-394"><span class="mo" id="MathJax-Span-395" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-396"><span class="mrow" id="MathJax-Span-397"><span class="mi" id="MathJax-Span-398" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-399" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-37">\prob(\source|\target)</script>. </p>

<div class="slide-end"></div>
<div class="newslide"></div><h3>A Naive Baseline Translation Model</h3><p>The most straightforward translation model translates words one-by-one, in the order of appearance: <span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-40-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msubsup&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mtext&gt;Naive&lt;/mtext&gt;&lt;/msubsup&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x220F;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-OP&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-422" role="math" style="width: 10.872em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.423em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(0.534em 1009.42em 3.915em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-423"><span class="msubsup" id="MathJax-Span-424"><span style="display: inline-block; position: relative; width: 2.273em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.49em 4.35em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-425" style="font-family: STIXGeneral-Italic;">p</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1001.79em 4.157em -999.998em); top: -4.345em; left: 0.486em;"><span class="mtext" id="MathJax-Span-426" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">Naive</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1000.44em 4.157em -999.998em); top: -3.669em; left: 0.486em;"><span class="mi" id="MathJax-Span-427" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-428" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-429" style="font-family: STIXGeneral-Italic;">s</span><span class="texatom" id="MathJax-Span-430"><span class="mrow" id="MathJax-Span-431"><span class="mo" id="MathJax-Span-432" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="mi" id="MathJax-Span-433" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-434" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-435" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">=</span><span class="munderover" id="MathJax-Span-436" style="padding-left: 0.292em;"><span style="display: inline-block; position: relative; width: 2.514em; height: 0px;"><span style="position: absolute; clip: rect(2.901em 1001.31em 4.64em -999.998em); top: -4.007em; left: 0.582em;"><span class="mo" id="MathJax-Span-437" style="font-family: STIXSizeOneSym; vertical-align: -0.529em;">∏</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1000.2em 4.254em -999.998em); top: -2.848em; left: 1.162em;"><span class="mi" id="MathJax-Span-438" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.287em 1002.51em 4.302em -999.998em); top: -5.263em; left: 0.002em;"><span class="texatom" id="MathJax-Span-439"><span class="mrow" id="MathJax-Span-440"><span class="texatom" id="MathJax-Span-441"><span class="mrow" id="MathJax-Span-442"><span class="mi" id="MathJax-Span-443" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-444" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">e</span><span class="mi" id="MathJax-Span-445" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">n</span><span class="mi" id="MathJax-Span-446" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">g</span><span class="mi" id="MathJax-Span-447" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-448" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">h</span></span></span><span class="mo" id="MathJax-Span-449" style="font-size: 70.7%;"></span><span class="mo" id="MathJax-Span-450" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-451"><span class="mrow" id="MathJax-Span-452"><span class="mi" id="MathJax-Span-453" style="font-size: 70.7%; font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-454" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-455" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 1.597em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.49em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-456" style="font-family: STIXGeneral-Italic;">θ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.486em;"><span class="texatom" id="MathJax-Span-457"><span class="mrow" id="MathJax-Span-458"><span class="msubsup" id="MathJax-Span-459"><span style="display: inline-block; position: relative; width: 0.486em; height: 0px;"><span style="position: absolute; clip: rect(3.577em 1000.24em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-460" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.292em;"><span class="mi" id="MathJax-Span-461" style="font-size: 50%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-462" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-463"><span style="display: inline-block; position: relative; width: 0.389em; height: 0px;"><span style="position: absolute; clip: rect(3.481em 1000.2em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-464" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.196em;"><span class="mi" id="MathJax-Span-465" style="font-size: 50%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.497em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 3.669em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msubsup><mi>p</mi><mi mathvariant="bold-italic">θ</mi><mtext>Naive</mtext></msubsup><mo stretchy="false">(</mo><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><munderover><mo>∏</mo><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-OP"><mi>l</mi><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi></mrow><mo>⁡</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo stretchy="false">)</mo></mrow></munderover><msub><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>s</mi><mi>i</mi></msub><mo>,</mo><msub><mi>t</mi><mi>i</mi></msub></mrow></msub></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-40"> \prob_\params^\text{Naive}(\ssource|\starget) = \prod_i^{\length{\source}} \param_{\ssource_i,\starget_i} </script> where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-41-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-466" role="math" style="width: 1.452em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.258em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.355em 1001.26em 2.563em -999.998em); top: -2.171em; left: 0.002em;"><span class="mrow" id="MathJax-Span-467"><span class="msubsup" id="MathJax-Span-468"><span style="display: inline-block; position: relative; width: 1.21em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.49em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-469" style="font-family: STIXGeneral-Italic;">θ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.486em;"><span class="texatom" id="MathJax-Span-470"><span class="mrow" id="MathJax-Span-471"><span class="mi" id="MathJax-Span-472" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">s</span><span class="mo" id="MathJax-Span-473" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-474" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.176em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.331em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.169em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><mi>s</mi><mo>,</mo><mi>t</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-41">\param_{\ssource,\starget} </script> is the probability of translating <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-42-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-475" role="math" style="width: 0.341em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.292em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.838em 1000.29em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-476"><span class="mi" id="MathJax-Span-477" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.781em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-42">\starget</script> as <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-43-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-478" role="math" style="width: 0.534em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.437em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.935em 1000.44em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-479"><span class="mi" id="MathJax-Span-480" style="font-family: STIXGeneral-Italic;">s</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.614em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-43">\ssource</script>. <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-44-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-481" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.53em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-482"><span class="mi" id="MathJax-Span-483" style="font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.947em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-44">\params</script> is often referred to as <em>translation table</em>.</p>
<div class="newslide"></div><p>For many language pairs one can acquire training sets <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-45-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;D&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;t&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;r&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;a&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;i&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msubsup&gt;&lt;mrow&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;mo&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;mo&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msubsup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-484" role="math" style="width: 8.891em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.732em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.645em 1007.73em 2.949em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-485"><span class="msubsup" id="MathJax-Span-486"><span style="display: inline-block; position: relative; width: 2.273em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.77em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-487"><span class="mrow" id="MathJax-Span-488"><span class="mi" id="MathJax-Span-489" style="font-family: STIXNonUnicode-Italic;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.824em;"><span class="texatom" id="MathJax-Span-490"><span class="mrow" id="MathJax-Span-491"><span class="mi" id="MathJax-Span-492" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t</span><span class="mi" id="MathJax-Span-493" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">r</span><span class="mi" id="MathJax-Span-494" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-495" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span class="mi" id="MathJax-Span-496" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">n</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-497" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">=</span><span class="msubsup" id="MathJax-Span-498" style="padding-left: 0.292em;"><span style="display: inline-block; position: relative; width: 4.157em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1003em 4.35em -999.998em); top: -4.007em; left: 0.002em;"><span class="mrow" id="MathJax-Span-499"><span class="mo" id="MathJax-Span-500" style="font-family: STIXGeneral-Regular;">(</span><span class="mo" id="MathJax-Span-501" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-502"><span style="display: inline-block; position: relative; width: 0.679em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1000.34em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-503"><span class="mrow" id="MathJax-Span-504"><span class="mi" id="MathJax-Span-505" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.389em;"><span class="mi" id="MathJax-Span-506" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-507" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-508" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 0.63em; height: 0px;"><span style="position: absolute; clip: rect(3.239em 1000.34em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-509"><span class="mrow" id="MathJax-Span-510"><span class="mi" id="MathJax-Span-511" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.341em;"><span class="mi" id="MathJax-Span-512" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-513" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-514" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.577em 1000.44em 4.157em -999.998em); top: -4.394em; left: 3.046em;"><span class="mi" id="MathJax-Span-515" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">n</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1001.11em 4.157em -999.998em); top: -3.766em; left: 3.046em;"><span class="texatom" id="MathJax-Span-516"><span class="mrow" id="MathJax-Span-517"><span class="mi" id="MathJax-Span-518" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-519" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">=</span><span class="mn" id="MathJax-Span-520" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.386em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.225em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">D</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">t</mi><mi class="MJX-tex-mathit" mathvariant="italic">r</mi><mi class="MJX-tex-mathit" mathvariant="italic">a</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">n</mi></mrow></msub><mo>=</mo><msubsup><mrow><mo>(</mo><mo>(</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mi>i</mi></msub><mo>,</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mi>i</mi></msub><mo>)</mo><mo>)</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mo>=</mo><mn>1</mn></mrow><mi>n</mi></msubsup></math></span></span><script type="math/tex" id="MathJax-Element-45">\train=\left( \left(\source_i,\target_i\right) \right)_{i=1}^n </script> of paired source and target sentences. For example, for French and English the <a href="http://www.isi.edu/natural-language/download/hansard/">Aligned Hansards</a> of the Parliament of Canada can be used. Given such a training set <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-46-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;D&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;t&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;r&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;a&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;i&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-521" role="math" style="width: 2.659em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.321em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.355em 1002.32em 2.466em -999.998em); top: -2.171em; left: 0.002em;"><span class="mrow" id="MathJax-Span-522"><span class="msubsup" id="MathJax-Span-523"><span style="display: inline-block; position: relative; width: 2.273em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.77em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-524"><span class="mrow" id="MathJax-Span-525"><span class="mi" id="MathJax-Span-526" style="font-family: STIXNonUnicode-Italic;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.824em;"><span class="texatom" id="MathJax-Span-527"><span class="mrow" id="MathJax-Span-528"><span class="mi" id="MathJax-Span-529" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t</span><span class="mi" id="MathJax-Span-530" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">r</span><span class="mi" id="MathJax-Span-531" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-532" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span class="mi" id="MathJax-Span-533" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">n</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.176em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.219em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.058em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">D</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">t</mi><mi class="MJX-tex-mathit" mathvariant="italic">r</mi><mi class="MJX-tex-mathit" mathvariant="italic">a</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">n</mi></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-46">\train</script> we can learn the parameters <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-47-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-534" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.53em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-535"><span class="mi" id="MathJax-Span-536" style="font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.947em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-47">\params</script> using the <a href="../02_methods/0x_mle.html">Maximum Likelhood estimator</a>. In the case of our Naive model this amounts to setting <span class="summary">Using <strong>parallel</strong> data of paired source and target sentences, we can train the model using the <strong>Maximum Likelihood Estimator</strong>:</span></p><p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-48-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0023;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;D&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;t&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;r&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;a&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;i&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0023;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;D&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;t&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;r&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;a&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;i&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-537" role="math" style="width: 7.829em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.814em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(0.969em 1006.81em 3.626em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-538"><span class="msubsup" id="MathJax-Span-539"><span style="display: inline-block; position: relative; width: 1.21em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.49em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-540" style="font-family: STIXGeneral-Italic;">θ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.486em;"><span class="texatom" id="MathJax-Span-541"><span class="mrow" id="MathJax-Span-542"><span class="mi" id="MathJax-Span-543" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">s</span><span class="mo" id="MathJax-Span-544" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-545" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-546" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">=</span><span class="mfrac" id="MathJax-Span-547" style="padding-left: 0.292em;"><span style="display: inline-block; position: relative; width: 4.109em; height: 0px; margin-right: 0.099em; margin-left: 0.099em;"><span style="position: absolute; clip: rect(3.191em 1003.91em 4.399em -999.998em); top: -4.732em; left: 50%; margin-left: -1.978em;"><span class="mrow" id="MathJax-Span-548"><span class="msubsup" id="MathJax-Span-549"><span style="display: inline-block; position: relative; width: 2.176em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.49em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-550" style="font-family: STIXGeneral-Regular;">#</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.486em;"><span class="texatom" id="MathJax-Span-551"><span class="mrow" id="MathJax-Span-552"><span class="msubsup" id="MathJax-Span-553"><span style="display: inline-block; position: relative; width: 1.597em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1000.58em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-554"><span class="mrow" id="MathJax-Span-555"><span class="mi" id="MathJax-Span-556" style="font-size: 70.7%; font-family: STIXNonUnicode-Italic;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.582em;"><span class="texatom" id="MathJax-Span-557"><span class="mrow" id="MathJax-Span-558"><span class="mi" id="MathJax-Span-559" style="font-size: 50%; font-family: STIXGeneral-Italic;">t</span><span class="mi" id="MathJax-Span-560" style="font-size: 50%; font-family: STIXGeneral-Italic;">r</span><span class="mi" id="MathJax-Span-561" style="font-size: 50%; font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-562" style="font-size: 50%; font-family: STIXGeneral-Italic;">i</span><span class="mi" id="MathJax-Span-563" style="font-size: 50%; font-family: STIXGeneral-Italic;">n</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-564" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-565" style="font-family: STIXGeneral-Italic;">s</span><span class="mo" id="MathJax-Span-566" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-567" style="font-family: STIXGeneral-Italic; padding-left: 0.196em;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-568" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.191em 1003.09em 4.399em -999.998em); top: -3.331em; left: 50%; margin-left: -1.543em;"><span class="mrow" id="MathJax-Span-569"><span class="msubsup" id="MathJax-Span-570"><span style="display: inline-block; position: relative; width: 2.176em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.49em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-571" style="font-family: STIXGeneral-Regular;">#</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.486em;"><span class="texatom" id="MathJax-Span-572"><span class="mrow" id="MathJax-Span-573"><span class="msubsup" id="MathJax-Span-574"><span style="display: inline-block; position: relative; width: 1.597em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1000.58em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-575"><span class="mrow" id="MathJax-Span-576"><span class="mi" id="MathJax-Span-577" style="font-size: 70.7%; font-family: STIXNonUnicode-Italic;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.582em;"><span class="texatom" id="MathJax-Span-578"><span class="mrow" id="MathJax-Span-579"><span class="mi" id="MathJax-Span-580" style="font-size: 50%; font-family: STIXGeneral-Italic;">t</span><span class="mi" id="MathJax-Span-581" style="font-size: 50%; font-family: STIXGeneral-Italic;">r</span><span class="mi" id="MathJax-Span-582" style="font-size: 50%; font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-583" style="font-size: 50%; font-family: STIXGeneral-Italic;">i</span><span class="mi" id="MathJax-Span-584" style="font-size: 50%; font-family: STIXGeneral-Italic;">n</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-585" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-586" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-587" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(0.872em 1004.11em 1.21em -999.998em); top: -1.302em; left: 0.002em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0.002em; border-top-width: 1.3px; border-top-style: solid; width: 4.109em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.065em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.164em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 2.836em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msub><mi>θ</mi><mrow class="MJX-TeXAtom-ORD"><mi>s</mi><mo>,</mo><mi>t</mi></mrow></msub><mo>=</mo><mfrac><mrow><msub><mi mathvariant="normal">#</mi><mrow class="MJX-TeXAtom-ORD"><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">D</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">t</mi><mi class="MJX-tex-mathit" mathvariant="italic">r</mi><mi class="MJX-tex-mathit" mathvariant="italic">a</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">n</mi></mrow></msub></mrow></msub><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>t</mi><mo stretchy="false">)</mo></mrow><mrow><msub><mi mathvariant="normal">#</mi><mrow class="MJX-TeXAtom-ORD"><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">D</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">t</mi><mi class="MJX-tex-mathit" mathvariant="italic">r</mi><mi class="MJX-tex-mathit" mathvariant="italic">a</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">n</mi></mrow></msub></mrow></msub><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-48"> \param_{\ssource,\starget} = \frac{\counts{\train}{s,t}}{\counts{\train}{t}} </script></p><p>Here <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-49-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0023;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;D&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;t&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;r&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;a&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;i&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-588" role="math" style="width: 4.592em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.964em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1003.91em 2.901em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-589"><span class="msubsup" id="MathJax-Span-590"><span style="display: inline-block; position: relative; width: 2.176em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.49em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-591" style="font-family: STIXGeneral-Regular;">#</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.486em;"><span class="texatom" id="MathJax-Span-592"><span class="mrow" id="MathJax-Span-593"><span class="msubsup" id="MathJax-Span-594"><span style="display: inline-block; position: relative; width: 1.597em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1000.58em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-595"><span class="mrow" id="MathJax-Span-596"><span class="mi" id="MathJax-Span-597" style="font-size: 70.7%; font-family: STIXNonUnicode-Italic;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.582em;"><span class="texatom" id="MathJax-Span-598"><span class="mrow" id="MathJax-Span-599"><span class="mi" id="MathJax-Span-600" style="font-size: 50%; font-family: STIXGeneral-Italic;">t</span><span class="mi" id="MathJax-Span-601" style="font-size: 50%; font-family: STIXGeneral-Italic;">r</span><span class="mi" id="MathJax-Span-602" style="font-size: 50%; font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-603" style="font-size: 50%; font-family: STIXGeneral-Italic;">i</span><span class="mi" id="MathJax-Span-604" style="font-size: 50%; font-family: STIXGeneral-Italic;">n</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-605" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-606" style="font-family: STIXGeneral-Italic;">s</span><span class="mo" id="MathJax-Span-607" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-608" style="font-family: STIXGeneral-Italic; padding-left: 0.196em;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-609" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.331em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.169em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi mathvariant="normal">#</mi><mrow class="MJX-TeXAtom-ORD"><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">D</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">t</mi><mi class="MJX-tex-mathit" mathvariant="italic">r</mi><mi class="MJX-tex-mathit" mathvariant="italic">a</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">n</mi></mrow></msub></mrow></msub><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><mi>t</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-49">\counts{\train}{s,t}</script> is the number of times we see target word <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-50-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-610" role="math" style="width: 0.341em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.292em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.838em 1000.29em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-611"><span class="mi" id="MathJax-Span-612" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.781em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-50">t</script> translated as source word <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-51-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-613" role="math" style="width: 0.534em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.437em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.935em 1000.44em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-614"><span class="mi" id="MathJax-Span-615" style="font-family: STIXGeneral-Italic;">s</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.614em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-51">s</script>, and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-52-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x0023;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;D&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;t&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;r&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;a&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;i&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-616" role="math" style="width: 3.626em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.143em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1003.09em 2.901em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-617"><span class="msubsup" id="MathJax-Span-618"><span style="display: inline-block; position: relative; width: 2.176em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.49em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-619" style="font-family: STIXGeneral-Regular;">#</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.486em;"><span class="texatom" id="MathJax-Span-620"><span class="mrow" id="MathJax-Span-621"><span class="msubsup" id="MathJax-Span-622"><span style="display: inline-block; position: relative; width: 1.597em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1000.58em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-623"><span class="mrow" id="MathJax-Span-624"><span class="mi" id="MathJax-Span-625" style="font-size: 70.7%; font-family: STIXNonUnicode-Italic;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.582em;"><span class="texatom" id="MathJax-Span-626"><span class="mrow" id="MathJax-Span-627"><span class="mi" id="MathJax-Span-628" style="font-size: 50%; font-family: STIXGeneral-Italic;">t</span><span class="mi" id="MathJax-Span-629" style="font-size: 50%; font-family: STIXGeneral-Italic;">r</span><span class="mi" id="MathJax-Span-630" style="font-size: 50%; font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-631" style="font-size: 50%; font-family: STIXGeneral-Italic;">i</span><span class="mi" id="MathJax-Span-632" style="font-size: 50%; font-family: STIXGeneral-Italic;">n</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-633" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-634" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-635" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.331em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.169em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi mathvariant="normal">#</mi><mrow class="MJX-TeXAtom-ORD"><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">D</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">t</mi><mi class="MJX-tex-mathit" mathvariant="italic">r</mi><mi class="MJX-tex-mathit" mathvariant="italic">a</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">n</mi></mrow></msub></mrow></msub><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-52">\counts{\train}{t}</script> the number of times we the target word <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-53-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-636" role="math" style="width: 0.341em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.292em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.838em 1000.29em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-637"><span class="mi" id="MathJax-Span-638" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.781em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-53">t</script> in total.</p>
<!--
<div class="exercise">
  <div class="exname">Exercise</div>
  <div class="extext">Derive the maximum likelhood estimate for \\(\prob_\params^\text{Naive}\\) for training data \\(\train=\left( \left(\source_i,\target_i\right) \right)_{i=1}^n \\). </div>
</div>
-->
<div class="newslide"></div><h4>Training the Naive Model</h4><p>Let us prepare some toy data to show how train this naive model.</p></div></div><div id="cell2" class="cellWrapper"><div id="editCell2" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor2" class="cell editor ace_editor ace-chaos ace_dark" style="height: 132px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 16px; width: 7.20125px; left: 124.214px; top: 106px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 164px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div><div class="ace_gutter-cell " style="height: 16px;">2</div><div class="ace_gutter-cell " style="height: 16px;">3</div><div class="ace_gutter-cell " style="height: 16px;">4</div><div class="ace_gutter-cell " style="height: 16px;">5</div><div class="ace_gutter-cell " style="height: 16px;">6</div><div class="ace_gutter-cell " style="height: 16px;">7</div></div><div class="ace_gutter-active-line" style="top: 106px; height: 16px;"></div></div><div class="ace_scroller" style="left: 41px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 833px; height: 164px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">train</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_support ace_function">Seq</span><span class="ace_paren ace_lparen">(</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_string">"the&nbsp;house&nbsp;is&nbsp;small"</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_string">"das&nbsp;Haus&nbsp;ist&nbsp;klein"</span>,</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_string">"the&nbsp;house&nbsp;is&nbsp;small"</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_string">"klein&nbsp;ist&nbsp;das&nbsp;Haus"</span>,</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_string">"a&nbsp;man&nbsp;is&nbsp;tall"</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_string">"ein&nbsp;Mann&nbsp;ist&nbsp;groß"</span>,</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_string">"my&nbsp;house&nbsp;is&nbsp;small"</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_string">"klein&nbsp;ist&nbsp;mein&nbsp;Haus"</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_identifier">map</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">p</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_identifier">segment</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">p</span>.<span class="ace_identifier">_1</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">sentences</span>.<span class="ace_identifier">head</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_identifier">segment</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">p</span>.<span class="ace_identifier">_2</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">sentences</span>.<span class="ace_identifier">head</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_identifier">train</span>.<span class="ace_identifier">size</span>&nbsp;</div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 83.2138px; top: 96px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 132px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 41px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 833px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode2" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay2" class="cell"><div class="string-result"><span class="asString String">4</span></div></div></div><div id="cell3" class="cellWrapper"><div id="editCell3" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor3" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode3" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay3" class="cell"><div class="newslide"></div><p>Notice how we transformed raw strings into Document objects via <code>segment</code>, and how we then fill the training set with Sentence objects by extracting the documents <code>head</code> sentence from each document. This dataset can be used to train the naive model as follows. <span class="summary">We can train the naive model as follows.</span></p></div></div><div id="cell4" class="cellWrapper"><div id="editCell4" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor4" class="cell editor ace_editor ace-chaos ace_dark" style="height: 292px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 16px; width: 7.20125px; left: 66.4025px; top: 266px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 324px; width: 48px;"><div class="ace_gutter-cell " style="height: 16px;">1</div><div class="ace_gutter-cell " style="height: 16px;">2</div><div class="ace_gutter-cell " style="height: 16px;">3</div><div class="ace_gutter-cell " style="height: 16px;">4<span class="ace_fold-widget ace_start ace_open" style="height: 16px;"></span></div><div class="ace_gutter-cell " style="height: 16px;">5</div><div class="ace_gutter-cell " style="height: 16px;">6</div><div class="ace_gutter-cell " style="height: 16px;">7</div><div class="ace_gutter-cell " style="height: 16px;">8</div><div class="ace_gutter-cell " style="height: 16px;">9<span class="ace_fold-widget ace_start ace_open" style="height: 16px;"></span></div><div class="ace_gutter-cell " style="height: 16px;">10<span class="ace_fold-widget ace_start ace_open" style="height: 16px;"></span></div><div class="ace_gutter-cell " style="height: 16px;">11</div><div class="ace_gutter-cell " style="height: 16px;">12</div><div class="ace_gutter-cell " style="height: 16px;">13</div><div class="ace_gutter-cell " style="height: 16px;">14</div><div class="ace_gutter-cell " style="height: 16px;">15</div><div class="ace_gutter-cell " style="height: 16px;">16</div><div class="ace_gutter-cell " style="height: 16px;">17</div></div><div class="ace_gutter-active-line" style="top: 266px; height: 16px;"></div></div><div class="ace_scroller" style="left: 48px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 826px; height: 324px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">import</span>&nbsp;<span class="ace_identifier">scala</span>.<span class="ace_identifier">collection</span>.<span class="ace_identifier">mutable</span>.<span class="ace_identifier">HashMap</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">case</span>&nbsp;<span class="ace_keyword">class</span>&nbsp;<span class="ace_identifier">Param</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">src</span>:<span class="ace_support ace_function">String</span>,&nbsp;<span class="ace_identifier">tgt</span>:&nbsp;<span class="ace_support ace_function">String</span>,&nbsp;<span class="ace_identifier">prob</span>:&nbsp;<span class="ace_support ace_function">Double</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">type</span>&nbsp;<span class="ace_identifier">NaiveModel</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_support ace_function">Seq</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">Param</span><span class="ace_paren ace_rparen">]</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">learn</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">data</span>:<span class="ace_support ace_function">Seq</span><span class="ace_paren ace_lparen">[(</span><span class="ace_identifier">Sentence</span>,<span class="ace_identifier">Sentence</span><span class="ace_paren ace_rparen">)])</span>:<span class="ace_identifier">NaiveModel</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_comment">//data&nbsp;structures&nbsp;to&nbsp;store&nbsp;counts&nbsp;in&nbsp;nominator&nbsp;and&nbsp;denominator</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">norm</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_keyword">new</span>&nbsp;<span class="ace_identifier">HashMap</span><span class="ace_paren ace_lparen">[</span><span class="ace_support ace_function">String</span>,<span class="ace_support ace_function">Double</span><span class="ace_paren ace_rparen">]</span>&nbsp;<span class="ace_identifier">withDefaultValue</span>&nbsp;<span class="ace_constant ace_numeric">0.0</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">counts</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_keyword">new</span>&nbsp;<span class="ace_identifier">HashMap</span><span class="ace_paren ace_lparen">[(</span><span class="ace_support ace_function">String</span>,<span class="ace_support ace_function">String</span><span class="ace_paren ace_rparen">)</span>,<span class="ace_support ace_function">Double</span><span class="ace_paren ace_rparen">]</span>&nbsp;<span class="ace_identifier">withDefaultValue</span>&nbsp;<span class="ace_constant ace_numeric">0.0</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_comment">//do&nbsp;the&nbsp;counting</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">for</span>&nbsp;<span class="ace_paren ace_lparen">((</span><span class="ace_identifier">target</span>,<span class="ace_identifier">source</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_identifier">data</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">for</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">i</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_constant ace_numeric">0</span>&nbsp;<span class="ace_identifier">until</span>&nbsp;<span class="ace_identifier">target</span>.<span class="ace_identifier">tokens</span>.<span class="ace_identifier">length</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_identifier">norm</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">target</span>.<span class="ace_identifier">tokens</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">i</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">word</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">+=</span>&nbsp;<span class="ace_constant ace_numeric">1.0</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_identifier">counts</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">source</span>.<span class="ace_identifier">tokens</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">i</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">word</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_identifier">target</span>.<span class="ace_identifier">tokens</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">i</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">word</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">+=</span>&nbsp;<span class="ace_constant ace_numeric">1.0</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span>&nbsp;&nbsp;&nbsp;&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_comment">//convert&nbsp;the&nbsp;map&nbsp;to&nbsp;a&nbsp;sequence&nbsp;of&nbsp;parameters</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_identifier">counts</span>.<span class="ace_identifier">toSeq</span>&nbsp;<span class="ace_identifier">map</span>&nbsp;<span class="ace_paren ace_lparen">{</span><span class="ace_keyword">case</span>&nbsp;<span class="ace_paren ace_lparen">((</span><span class="ace_identifier">source</span>,<span class="ace_identifier">target</span><span class="ace_paren ace_rparen">)</span>,<span class="ace_identifier">count</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_identifier">Param</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">source</span>,<span class="ace_identifier">target</span>,<span class="ace_identifier">count</span>/<span class="ace_identifier">norm</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">target</span><span class="ace_paren ace_rparen">))</span>&nbsp;<span class="ace_paren ace_rparen">}</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_paren ace_rparen">}</span>&nbsp;</div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 18.4025px; top: 256px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 292px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 48px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 826px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode4" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay4" class="cell" style="display: none;"><div class="text-center"><i class="fa fa-refresh fa-spin fa-lg"></i></div></div></div><div id="cell5" class="cellWrapper"><div id="editCell5" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor5" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode5" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay5" class="cell"><div class="newslide"></div><p>Let us train on the toy dataset:</p></div></div><div id="cell6" class="cellWrapper"><div id="editCell6" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor6" class="cell editor ace_editor ace-chaos ace_dark" style="height: 52px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 16px; width: 7.20125px; left: 592.295px; top: 26px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 84px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div><div class="ace_gutter-cell " style="height: 16px;">2</div></div><div class="ace_gutter-active-line" style="top: 26px; height: 16px;"></div></div><div class="ace_scroller" style="left: 41px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 833px; height: 84px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">model</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">learn</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">train</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_identifier">barChart</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">model</span>&nbsp;<span class="ace_identifier">map</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">p</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">p</span>.<span class="ace_identifier">src</span>,<span class="ace_identifier">p</span>.<span class="ace_identifier">tgt</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_identifier">p</span>.<span class="ace_identifier">prob</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_identifier">filter</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">_1</span>.<span class="ace_identifier">_2</span>&nbsp;<span class="ace_keyword ace_operator">==</span>&nbsp;<span class="ace_string">"is"</span><span class="ace_paren ace_rparen">))</span>&nbsp;</div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 551.295px; top: 16px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 52px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 41px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 833px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode6" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay6" class="cell"><div class="string-result"><div id="d3bar1867283823" class="wolfe-nvd3">
<svg class="nvd3-svg"><g class="nvd3 nv-wrap nv-discreteBarWithAxes"><g transform="translate(60,15)"><defs><clippath id="nv-x-label-clip-7268"><rect width="394.83870967741933" height="16" x="-197.41935483870967"></rect></clippath></defs><g class="nv-x nv-axis nvd3-svg" transform="translate(0,85)"><g class="nvd3 nv-wrap nv-axis"><g><g class="tick zero" transform="translate(120.64516129032258,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,5)" x="0" style="text-anchor: middle;">(das,is)</text></g><g class="tick zero" transform="translate(340,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,17)" x="0" style="text-anchor: middle;">(mein,is)</text></g><g class="tick zero" transform="translate(559.3548387096774,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,5)" x="0" style="text-anchor: middle;">(ist,is)</text></g><path class="domain" d="M0,0V0H680V0"></path><text class="nv-axislabel" text-anchor="middle" y="36" x="340" transform="translate(0,17)"></text></g></g></g><g class="nv-y nv-axis nvd3-svg"><g class="nv-zeroLine"><line x1="0" x2="680" y1="85" y2="85"></line></g><g class="nvd3 nv-wrap nv-axis"><g><g class="tick zero" transform="translate(0,85)" style="opacity: 1;"><line x2="680" y2="0"></line><text dy=".32em" x="-3" opacity="0" style="text-anchor: end;" y="0">0.0</text></g><g class="tick" transform="translate(0,55.8)" style="opacity: 1;"><line x2="680" y2="0"></line><text dy=".32em" x="-3" opacity="1" style="text-anchor: end;" y="0">0.2</text></g><g class="tick" transform="translate(0,26.599999999999998)" style="opacity: 1;"><line x2="680" y2="0"></line><text dy=".32em" x="-3" opacity="1" style="text-anchor: end;" y="0">0.4</text></g><path class="domain" d="M0,12H0V85H0"></path><text class="nv-axislabel" transform="rotate(-90)" y="-50" x="-42.5" style="text-anchor: middle;"></text></g><g class="nv-axisMaxMin nv-axisMaxMin-y nv-axisMin-y" transform="translate(0,85)"><text dy=".32em" y="0" x="-3" text-anchor="end" style="opacity: 1;">0.0</text></g><g class="nv-axisMaxMin nv-axisMaxMin-y nv-axisMax-y" transform="translate(0,12)"><text dy=".32em" y="0" x="-3" text-anchor="end" style="opacity: 1;">0.5</text></g></g></g><g class="nv-barsWrap nvd3-svg"><g class="nvd3 nv-wrap nv-discretebar" transform="translate(0,0)"><g><g class="nv-groups"><g class="nv-group nv-series-0" style="stroke-opacity: 1; fill-opacity: 0.75;"><g transform="translate(31.80645179748535,48.5)" class="nv-bar positive" style="fill: rgb(31, 119, 180); stroke: rgb(31, 119, 180);"><rect height="36.5" width="177.6774193548387" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="88.83870967741935">0.25</text></g><g transform="translate(251.16128540039062,48.5)" class="nv-bar positive" style="fill: rgb(174, 199, 232); stroke: rgb(174, 199, 232);"><rect height="36.5" width="177.6774193548387" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="88.83870967741935">0.25</text></g><g transform="translate(470.5161437988281,12)" class="nv-bar positive" style="fill: rgb(255, 127, 14); stroke: rgb(255, 127, 14);"><rect height="73" width="177.6774193548387" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="88.83870967741935">0.50</text></g></g></g></g></g></g></g></g></svg>
</div>

<script>
console.log("Clearing svg");
$('#d3bar1867283823 svg').empty();
console.log(d3.select('#d3bar1867283823 svg').length);
console.log("Calling addGraph");
/*These lines are all chart setup.  Pick and choose which chart features you want to utilize. */

  nv.addGraph(function() {
  var chart = nv.models.discreteBarChart()
      .x(function(d) { return d.label })    //Specify the data accessors.
      .y(function(d) { return d.value })
      .staggerLabels(true)    //Too many bars and not enough room? Try staggering labels.
      .tooltips(false)        //Don't show tooltips
      .showValues(true)       //...instead, show the bar value right on top of each bar.

      ;
  console.log(chart);
  console.log("Inside addGraph");
  console.log(d3.select('#d3bar1867283823 svg'));
  d3.select('#d3bar1867283823 svg')
      .datum(
[{
key: "Whatever",
values: [{label:"(das,is)", value:0.25},{label:"(mein,is)", value:0.25},{label:"(ist,is)", value:0.5}],
}]
    )
      .transition().duration(350)
      .call(chart);

  nv.utils.windowResize(chart.update);

  return chart;
});
</script></div></div></div><div id="cell7" class="cellWrapper"><div id="editCell7" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor7" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode7" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay7" class="cell"><!--
<div class="newslide"></div>
##### Exercise
Implement an non-procedural [functional](https://www.coursera.org/course/progfun) version of this code.

##### Exercise
Make this work even when sentences don't have the same length. 

##### Exercise
Which sentences make the problem easier, which harder?
-->
<div class="newslide"></div><h4>Decoding with the Naive Model</h4>
<div class="book-start"></div><p><em>Decoding</em> in MT is the task of finding the solution to equation <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-54-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MathJax_ref&quot; href=&quot;#mjx-eqn-decode-mt&quot;&gt;&lt;mtext&gt;1&lt;/mtext&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-639" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.44em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-640"><a href="../01_tasks/02_wordmt.html#mjx-eqn-decode-mt"><span class="mrow MathJax_ref" id="MathJax-Span-641"><span class="mtext" id="MathJax-Span-642" style="font-family: STIXGeneral-Regular;">1</span></span></a></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.892em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MathJax_ref" href="#mjx-eqn-decode-mt"><mtext>1</mtext></mrow></math></span></span><script type="math/tex" id="MathJax-Element-54">\ref{decode-mt}</script>. That is, we need to find that target sentence with maximum a posteriori probability, which is equivalent to finding the target sentence with maximum likelihood as per equation <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-55-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MathJax_ref&quot; href=&quot;#mjx-eqn-decode-nc&quot;&gt;&lt;mtext&gt;2&lt;/mtext&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-643" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.49em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-644"><a href="../01_tasks/02_wordmt.html#mjx-eqn-decode-nc"><span class="mrow MathJax_ref" id="MathJax-Span-645"><span class="mtext" id="MathJax-Span-646" style="font-family: STIXGeneral-Regular;">2</span></span></a></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.892em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MathJax_ref" href="#mjx-eqn-decode-nc"><mtext>2</mtext></mrow></math></span></span><script type="math/tex" id="MathJax-Element-55">\ref{decode-nc}</script>. The phrase "decoding" relates to the noisy channel analogy. Somebody generated a message, the channel encodes (translates) this message and the receiver needs to find out what the original message was. </p><p>In the naive model decoding is trivial if we assume a unigram language model. We need to choose, for each source word, the target word with maximal product of translation and language model probability. For more complex models this is not sufficient, and we discuss a more powerful decoding method later.</p>
<div class="slide-end"></div><p></p>
<div class="newslide"></div></div></div><div id="cell8" class="cellWrapper"><div id="editCell8" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor8" class="cell editor ace_editor ace-chaos ace_dark" style="height: 308px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 16px; width: 7.20125px; left: 152.817px; top: 282px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 340px; width: 48px;"><div class="ace_gutter-cell " style="height: 16px;">1</div><div class="ace_gutter-cell " style="height: 16px;">2</div><div class="ace_gutter-cell " style="height: 16px;">3<span class="ace_fold-widget ace_start ace_open" style="height: 16px;"></span></div><div class="ace_gutter-cell " style="height: 16px;">4</div><div class="ace_gutter-cell " style="height: 16px;">5</div><div class="ace_gutter-cell " style="height: 16px;">6<span class="ace_fold-widget ace_start ace_open" style="height: 16px;"></span></div><div class="ace_gutter-cell " style="height: 16px;">7</div><div class="ace_gutter-cell " style="height: 16px;">8</div><div class="ace_gutter-cell " style="height: 16px;">9</div><div class="ace_gutter-cell " style="height: 16px;">10</div><div class="ace_gutter-cell " style="height: 16px;">11</div><div class="ace_gutter-cell " style="height: 16px;">12</div><div class="ace_gutter-cell " style="height: 16px;">13</div><div class="ace_gutter-cell " style="height: 16px;">14</div><div class="ace_gutter-cell " style="height: 16px;">15</div><div class="ace_gutter-cell " style="height: 16px;">16</div><div class="ace_gutter-cell " style="height: 16px;">17</div><div class="ace_gutter-cell " style="height: 16px;">18</div></div><div class="ace_gutter-active-line" style="top: 282px; height: 16px;"></div></div><div class="ace_scroller" style="left: 48px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 826px; height: 340px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">import</span>&nbsp;<span class="ace_identifier">uk</span>.<span class="ace_identifier">ac</span>.<span class="ace_identifier">ucl</span>.<span class="ace_identifier">cs</span>.<span class="ace_identifier">mr</span>.<span class="ace_identifier">statnlpbook</span>.<span class="ace_identifier">chapter</span>.<span class="ace_identifier">languagemodels</span>.<span class="ace_identifier">_</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">decode</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">source</span>:<span class="ace_identifier">Sentence</span>,&nbsp;<span class="ace_identifier">model</span>:<span class="ace_identifier">NaiveModel</span>,&nbsp;<span class="ace_identifier">lm</span>:<span class="ace_identifier">LanguageModel</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_comment">//create&nbsp;a&nbsp;mapping&nbsp;from&nbsp;source&nbsp;words&nbsp;to&nbsp;relevant&nbsp;parameters</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">source2targets</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">model</span>&nbsp;<span class="ace_identifier">groupBy</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">src</span><span class="ace_paren ace_rparen">)</span>&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">translate</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">token</span>:<span class="ace_identifier">Token</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">candidates</span>:<span class="ace_support ace_function">Seq</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">Param</span><span class="ace_paren ace_rparen">]</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">source2targets</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">token</span>.<span class="ace_identifier">word</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">scoredByLM</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">candidates</span>&nbsp;<span class="ace_identifier">map</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">p</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_identifier">p</span>.<span class="ace_identifier">copy</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">prob</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">p</span>.<span class="ace_identifier">prob</span>&nbsp;<span class="ace_keyword ace_operator">*</span>&nbsp;<span class="ace_identifier">lm</span>.<span class="ace_identifier">probability</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">p</span>.<span class="ace_identifier">tgt</span><span class="ace_paren ace_rparen">)))</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">scoredByLM</span>.<span class="ace_identifier">maxBy</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">prob</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">tgt</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_comment">//translate&nbsp;word-by-word&nbsp;(for&nbsp;which&nbsp;LM&nbsp;does&nbsp;this&nbsp;work?)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">words</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">source</span>.<span class="ace_identifier">tokens</span>&nbsp;<span class="ace_identifier">map</span>&nbsp;<span class="ace_identifier">translate</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_identifier">Document</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">IndexedSeq</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">words</span><span class="ace_paren ace_rparen">))</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_paren ace_rparen">}</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">source</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">train</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">_2</span>&nbsp;<span class="ace_comment">//"klein&nbsp;ist&nbsp;das&nbsp;Haus"</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">lm</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">UniformLM</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">model</span>.<span class="ace_identifier">map</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">tgt</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">toSet</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">target</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">decode</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">source</span>,&nbsp;<span class="ace_identifier">model</span>,&nbsp;<span class="ace_identifier">lm</span><span class="ace_paren ace_rparen">)</span>&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_identifier">target</span>.<span class="ace_identifier">toText</span>&nbsp;</div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 104.817px; top: 272px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 308px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 48px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 826px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode8" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay8" class="cell"><div class="string-result"><span class="asString String">my house the small</span></div></div></div><div id="cell9" class="cellWrapper"><div id="editCell9" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor9" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode9" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay9" class="cell"><div class="newslide"></div><p>The naive model is broken in several ways. Most severely, it ignores the fact that word order can differ and still yield (roughly) the same meaning. </p>
<div class="newslide"></div><h3>IBM Model 2</h3><p>The IBM Model 2 is one of the most influential translation models, even though these days it is only indirectly used in actual MT systems, for example to initialize translation and alignment models. As IBM Model 2 can be understood as generalization of IBM Model 1, we omit the latter for now and briefly illustrate it afterward our introduction of Model 2. Notice that parts of these exposition are based on the excellent <a href="http://www.cs.columbia.edu/~mcollins/courses/nlp2011/notes/ibm12.pdf">lecture notes on IBM Model 1 and 2</a> of Mike Collins. <span class="summary">IBM Model 2 is one of the most influential translation models, even though these days it is only indirectly used in actual MT systems, for example to initialize translation and alignment models.</span> </p>
<div class="newslide"></div><h4>Alignment</h4>
<div class="book-start"></div><p>The core difference of Model 2 to our naive baseline model is the introduction of <em>latent</em> auxiliary variables: the word to word <em>alignment</em> <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-57-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-678" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.886em 1000.53em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-679"><span class="texatom" id="MathJax-Span-680"><span class="mrow" id="MathJax-Span-681"><span class="mi" id="MathJax-Span-682" style="font-family: STIXGeneral; font-weight: bold;">a</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-57">\aligns</script> between words. In particular, we introduce a variable <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-58-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-OP&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-683" role="math" style="width: 9.326em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.118em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1008.02em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-684"><span class="msubsup" id="MathJax-Span-685"><span style="display: inline-block; position: relative; width: 0.775em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.49em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-686" style="font-family: STIXGeneral-Italic;">a</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.486em;"><span class="mi" id="MathJax-Span-687" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-688" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">∈</span><span class="mo" id="MathJax-Span-689" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">[</span><span class="mn" id="MathJax-Span-690" style="font-family: STIXGeneral-Regular;">0</span><span class="mo" id="MathJax-Span-691" style="font-family: STIXGeneral-Regular; padding-left: 0.196em;">…</span><span class="texatom" id="MathJax-Span-692" style="padding-left: 0.196em;"><span class="mrow" id="MathJax-Span-693"><span class="mi" id="MathJax-Span-694" style="font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-695" style="font-family: STIXGeneral-Italic;">e</span><span class="mi" id="MathJax-Span-696" style="font-family: STIXGeneral-Italic;">n</span><span class="mi" id="MathJax-Span-697" style="font-family: STIXGeneral-Italic;">g</span><span class="mi" id="MathJax-Span-698" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-699" style="font-family: STIXGeneral-Italic;">h</span></span></span><span class="mo" id="MathJax-Span-700"></span><span class="mo" id="MathJax-Span-701" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-702"><span class="mrow" id="MathJax-Span-703"><span class="mi" id="MathJax-Span-704" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-705" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-706" style="font-family: STIXGeneral-Regular;">]</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>a</mi><mi>i</mi></msub><mo>∈</mo><mo stretchy="false">[</mo><mn>0</mn><mo>…</mo><mrow class="MJX-TeXAtom-OP"><mi>l</mi><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi></mrow><mo>⁡</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-58">a_i \in [0 \ldots \length{\target}]</script> for each source sentence index <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-59-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;[&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-OP&quot;&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;g&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;h&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;]&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-707" role="math" style="width: 8.843em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.684em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1007.59em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-708"><span class="mi" id="MathJax-Span-709" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-710" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">∈</span><span class="mo" id="MathJax-Span-711" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">[</span><span class="mn" id="MathJax-Span-712" style="font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-713" style="font-family: STIXGeneral-Regular; padding-left: 0.196em;">…</span><span class="texatom" id="MathJax-Span-714" style="padding-left: 0.196em;"><span class="mrow" id="MathJax-Span-715"><span class="mi" id="MathJax-Span-716" style="font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-717" style="font-family: STIXGeneral-Italic;">e</span><span class="mi" id="MathJax-Span-718" style="font-family: STIXGeneral-Italic;">n</span><span class="mi" id="MathJax-Span-719" style="font-family: STIXGeneral-Italic;">g</span><span class="mi" id="MathJax-Span-720" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-721" style="font-family: STIXGeneral-Italic;">h</span></span></span><span class="mo" id="MathJax-Span-722"></span><span class="mo" id="MathJax-Span-723" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-724"><span class="mrow" id="MathJax-Span-725"><span class="mi" id="MathJax-Span-726" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-727" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-728" style="font-family: STIXGeneral-Regular;">]</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi><mo>∈</mo><mo stretchy="false">[</mo><mn>1</mn><mo>…</mo><mrow class="MJX-TeXAtom-OP"><mi>l</mi><mi>e</mi><mi>n</mi><mi>g</mi><mi>t</mi><mi>h</mi></mrow><mo>⁡</mo><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo stretchy="false">)</mo><mo stretchy="false">]</mo></math></span></span><script type="math/tex" id="MathJax-Element-59">i \in [1 \ldots \length{\source}]</script>. The word alignment <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-60-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-729" role="math" style="width: 2.659em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.321em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.742em 1002.32em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-730"><span class="msubsup" id="MathJax-Span-731"><span style="display: inline-block; position: relative; width: 0.775em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.49em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-732" style="font-family: STIXGeneral-Italic;">a</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.486em;"><span class="mi" id="MathJax-Span-733" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-734" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">=</span><span class="mi" id="MathJax-Span-735" style="font-family: STIXGeneral-Italic; padding-left: 0.292em;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>a</mi><mi>i</mi></msub><mo>=</mo><mi>j</mi></math></span></span><script type="math/tex" id="MathJax-Element-60">a_i = j </script> means that the source word at token <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-61-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-736" role="math" style="width: 0.341em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.292em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.29em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-737"><span class="mi" id="MathJax-Span-738" style="font-family: STIXGeneral-Italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.892em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-61">i</script> is <em>aligned</em> with the target word at index <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-62-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-739" role="math" style="width: 0.341em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.292em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.742em 1000.29em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-740"><span class="mi" id="MathJax-Span-741" style="font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>j</mi></math></span></span><script type="math/tex" id="MathJax-Element-62">j</script>. </p><p>Notice that <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-63-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-742" role="math" style="width: 0.969em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.824em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.597em 1000.82em 2.466em -999.998em); top: -2.171em; left: 0.002em;"><span class="mrow" id="MathJax-Span-743"><span class="msubsup" id="MathJax-Span-744"><span style="display: inline-block; position: relative; width: 0.775em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.49em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-745" style="font-family: STIXGeneral-Italic;">a</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.486em;"><span class="mi" id="MathJax-Span-746" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.176em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.219em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.781em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>a</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-63">\align_i</script> can be <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-64-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-747" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.53em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-748"><span class="mn" id="MathJax-Span-749" style="font-family: STIXGeneral-Regular;">0</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.892em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-64">0</script>. This corresponds to a imaginary <em>NULL</em> token <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-65-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-750" role="math" style="width: 0.92em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.775em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.5em 1000.77em 2.466em -999.998em); top: -2.171em; left: 0.002em;"><span class="mrow" id="MathJax-Span-751"><span class="msubsup" id="MathJax-Span-752"><span style="display: inline-block; position: relative; width: 0.727em; height: 0px;"><span style="position: absolute; clip: rect(3.336em 1000.29em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-753" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.292em;"><span class="mn" id="MathJax-Span-754" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">0</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.176em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.219em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.947em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>t</mi><mn>0</mn></msub></math></span></span><script type="math/tex" id="MathJax-Element-65">\starget_0</script> in the target sentence and allows source words to be omitted in an alignment. </p>


<div class="slide-end"></div>
<!--
<p class="exercise">
How can _target_ words be omitted in an alignment?
</p>
-->
<div class="newslide"></div><p>Below you see a simple example of an alignment.</p></div></div><div id="cell10" class="cellWrapper"><div id="editCell10" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor10" class="cell editor ace_editor ace-chaos ace_dark" style="height: 68px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 16px; width: 7.20125px; left: 505.88px; top: 42px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 100px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div><div class="ace_gutter-cell " style="height: 16px;">2</div><div class="ace_gutter-cell " style="height: 16px;">3</div></div><div class="ace_gutter-active-line" style="top: 42px; height: 16px;"></div></div><div class="ace_scroller" style="left: 41px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 833px; height: 100px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"><div class="ace_bracket ace_start" style="height:16px;width:7.20125px;top:32px;left:176.82999999999998px;"></div></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">target</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">segment</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"NULL&nbsp;the&nbsp;house&nbsp;is&nbsp;small"</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">sentences</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">source</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">segment</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"klein&nbsp;ist&nbsp;das&nbsp;Haus"</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">sentences</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_identifier">Renderer</span>.<span class="ace_identifier">renderAlignment</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">target</span>,<span class="ace_identifier">source</span>,<span class="ace_support ace_function">Seq</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">1</span><span class="ace_keyword ace_operator">-&gt;</span><span class="ace_constant ace_numeric">2</span>,<span class="ace_constant ace_numeric">2</span><span class="ace_keyword ace_operator">-&gt;</span><span class="ace_constant ace_numeric">3</span>,<span class="ace_constant ace_numeric">3</span><span class="ace_keyword ace_operator">-&gt;</span><span class="ace_constant ace_numeric">1</span>,<span class="ace_constant ace_numeric">4</span><span class="ace_keyword ace_operator">-&gt;</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">))</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 464.88px; top: 32px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 68px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 41px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 833px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode10" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay10" class="cell"><div class="string-result"><div id="align99ef0ffb-8b92-42cc-b838-75995832dae8" class="aligner">
<svg><g><text x="20" y="20">NULL</text><text x="60.6796875" y="20">the</text><text x="87.361328125" y="20">house</text><text x="130.056640625" y="20">is</text><text x="148.72265625" y="20">small</text></g><g><text x="20" y="100">klein</text><text x="54.6796875" y="100">ist</text><text x="76.6796875" y="100">das</text><text x="106.02734375" y="100">Haus</text></g><line x1="69.0078125" y1="22.5" x2="86.34375" y2="89" stroke-width="2" stroke="black" stroke-opacity="1"></line><line x1="103.703125" y1="22.5" x2="120.015625" y2="89" stroke-width="2" stroke="black" stroke-opacity="1"></line><line x1="134.375" y1="22.5" x2="60.671875" y2="89" stroke-width="2" stroke="black" stroke-opacity="1"></line><line x1="162.71875" y1="22.5" x2="32.3359375" y2="89" stroke-width="2" stroke="black" stroke-opacity="1"></line></svg>
</div>
<script>
  var s1Data = ["NULL","the","house","is","small"];
  var s2Data = ["klein","ist","das","Haus"];
  var connData = [{'i1':1, 'i2':2, 'weight':1.0 },{'i1':2, 'i2':3, 'weight':1.0 },{'i1':3, 'i2':1, 'weight':1.0 },{'i1':4, 'i2':0, 'weight':1.0 }]
  var svg = d3.select('#align99ef0ffb-8b92-42cc-b838-75995832dae8 svg')

  function buildSentenceGroup(parent,data,y) {
    var groupElement = parent.append("g");
    var text = groupElement.selectAll("text")
      .data(data)
      .enter()
      .append("text");
    var textLabels = text
      .attr("x",function(d) { return 0; })
      .attr("y",function(d) { return y; })
      .text(function(d) {return d;});
    var current = 20;
    var gap = 10;
    var tokenOffsets = [current];
    for (i = 0; i < textLabels[0].length - 1; i++) {
      current += textLabels[0][i].getComputedTextLength() + gap;
      tokenOffsets.push(current);
    }
    console.log(tokenOffsets);
    textLabels
      .attr("x", function(d,i) { return tokenOffsets[i];});
    return groupElement;
  }

  var s1Group = buildSentenceGroup(svg,s1Data,20);
  var s2Group = buildSentenceGroup(svg,s2Data,100);

  var s1TokenTexts = s1Group[0][0].childNodes;
  var s2TokenTexts = s2Group[0][0].childNodes;

  var connections = svg.selectAll("line")
    .data(connData)
    .enter()
    .append("line")
    .attr("x1", function(d) { return s1TokenTexts[d.i1].getBBox().x + s1TokenTexts[d.i1].getBBox().width / 2; })
    .attr("y1", function(d) { return s1TokenTexts[d.i1].getBBox().y + s1TokenTexts[d.i1].getBBox().height; })
    .attr("x2", function(d) { return s2TokenTexts[d.i2].getBBox().x + s2TokenTexts[d.i2].getBBox().width / 2; })
    .attr("y2", function(d) { return s2TokenTexts[d.i2].getBBox().y; })
    .attr("stroke-width", 2)
    .attr("stroke", "black")
    .attr("stroke-opacity", function(d) { return 0; })
    .transition()
    .attr("stroke-opacity", function(d) { return d.weight; } );

  console.log(s1Group);
  console.log(s1TokenTexts);

</script></div></div></div><div id="cell11" class="cellWrapper"><div id="editCell11" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor11" class="cell editor ace_editor ace-chaos ace_dark" style="height: 68px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 16px; width: 7.20125px; left: 599.496px; top: 42px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 100px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div><div class="ace_gutter-cell " style="height: 16px;">2</div><div class="ace_gutter-cell " style="height: 16px;">3</div></div><div class="ace_gutter-active-line" style="top: 42px; height: 16px;"></div></div><div class="ace_scroller" style="left: 41px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 833px; height: 100px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"><div class="ace_bracket ace_start" style="height:16px;width:7.20125px;top:32px;left:176.82999999999998px;"></div></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">target2</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">segment</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"NULL&nbsp;<span class="ace_cjk" style="width:14.4025px">家</span>&nbsp;<span class="ace_cjk" style="width:14.4025px">わ</span>&nbsp;<span class="ace_cjk" style="width:14.4025px">小</span><span class="ace_cjk" style="width:14.4025px">さ</span><span class="ace_cjk" style="width:14.4025px">い</span><span class="ace_cjk" style="width:14.4025px">い</span>&nbsp;<span class="ace_cjk" style="width:14.4025px">で</span><span class="ace_cjk" style="width:14.4025px">す</span>"</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">sentences</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">source2</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">segment</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"The&nbsp;house&nbsp;is&nbsp;small"</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">sentences</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_identifier">Renderer</span>.<span class="ace_identifier">renderAlignment</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">target2</span>,<span class="ace_identifier">source2</span>,<span class="ace_support ace_function">Seq</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_constant ace_numeric">0</span>,&nbsp;<span class="ace_constant ace_numeric">1</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_constant ace_numeric">1</span>,&nbsp;<span class="ace_constant ace_numeric">3</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_constant ace_numeric">3</span>,&nbsp;<span class="ace_constant ace_numeric">4</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">))</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 558.496px; top: 32px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 68px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 41px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 833px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode11" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay11" class="cell"><div class="string-result"><div id="alignf095fdff-c213-418d-8811-1eabace542fb" class="aligner">
<svg><g><text x="20" y="20">NULL</text><text x="60.6796875" y="20">家</text><text x="82.6796875" y="20">わ</text><text x="104.6796875" y="20">小さいい</text><text x="162.6796875" y="20">です</text></g><g><text x="20" y="100">The</text><text x="50.677734375" y="100">house</text><text x="93.373046875" y="100">is</text><text x="112.0390625" y="100">small</text></g><line x1="35.3359375" y1="22.5" x2="30.3359375" y2="89" stroke-width="2" stroke="black" stroke-opacity="1"></line><line x1="66.671875" y1="22.5" x2="67.015625" y2="89" stroke-width="2" stroke="black" stroke-opacity="1"></line><line x1="128.671875" y1="22.5" x2="126.03125" y2="89" stroke-width="2" stroke="black" stroke-opacity="1"></line><line x1="174.671875" y1="22.5" x2="97.6875" y2="89" stroke-width="2" stroke="black" stroke-opacity="1"></line></svg>
</div>
<script>
  var s1Data = ["NULL","家","わ","小さいい","です"];
  var s2Data = ["The","house","is","small"];
  var connData = [{'i1':0, 'i2':0, 'weight':1.0 },{'i1':1, 'i2':1, 'weight':1.0 },{'i1':3, 'i2':3, 'weight':1.0 },{'i1':4, 'i2':2, 'weight':1.0 }]
  var svg = d3.select('#alignf095fdff-c213-418d-8811-1eabace542fb svg')

  function buildSentenceGroup(parent,data,y) {
    var groupElement = parent.append("g");
    var text = groupElement.selectAll("text")
      .data(data)
      .enter()
      .append("text");
    var textLabels = text
      .attr("x",function(d) { return 0; })
      .attr("y",function(d) { return y; })
      .text(function(d) {return d;});
    var current = 20;
    var gap = 10;
    var tokenOffsets = [current];
    for (i = 0; i < textLabels[0].length - 1; i++) {
      current += textLabels[0][i].getComputedTextLength() + gap;
      tokenOffsets.push(current);
    }
    console.log(tokenOffsets);
    textLabels
      .attr("x", function(d,i) { return tokenOffsets[i];});
    return groupElement;
  }

  var s1Group = buildSentenceGroup(svg,s1Data,20);
  var s2Group = buildSentenceGroup(svg,s2Data,100);

  var s1TokenTexts = s1Group[0][0].childNodes;
  var s2TokenTexts = s2Group[0][0].childNodes;

  var connections = svg.selectAll("line")
    .data(connData)
    .enter()
    .append("line")
    .attr("x1", function(d) { return s1TokenTexts[d.i1].getBBox().x + s1TokenTexts[d.i1].getBBox().width / 2; })
    .attr("y1", function(d) { return s1TokenTexts[d.i1].getBBox().y + s1TokenTexts[d.i1].getBBox().height; })
    .attr("x2", function(d) { return s2TokenTexts[d.i2].getBBox().x + s2TokenTexts[d.i2].getBBox().width / 2; })
    .attr("y2", function(d) { return s2TokenTexts[d.i2].getBBox().y; })
    .attr("stroke-width", 2)
    .attr("stroke", "black")
    .attr("stroke-opacity", function(d) { return 0; })
    .transition()
    .attr("stroke-opacity", function(d) { return d.weight; } );

  console.log(s1Group);
  console.log(s1TokenTexts);

</script></div></div></div><div id="cell12" class="cellWrapper"><div id="editCell12" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor12" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode12" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay12" class="cell"><div class="newslide"></div><p>IBM Model 2 defines a conditional distribution <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-74-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-827" role="math" style="width: 3.529em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.046em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1003em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-828"><span class="mi" id="MathJax-Span-829" style="font-family: STIXGeneral-Italic;">p</span><span class="mo" id="MathJax-Span-830" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-831"><span class="mrow" id="MathJax-Span-832"><span class="mi" id="MathJax-Span-833" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-834" style="font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-835" style="padding-left: 0.196em;"><span class="mrow" id="MathJax-Span-836"><span class="mi" id="MathJax-Span-837" style="font-family: STIXGeneral; font-weight: bold;">a</span></span></span><span class="texatom" id="MathJax-Span-838"><span class="mrow" id="MathJax-Span-839"><span class="mo" id="MathJax-Span-840" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-841"><span class="mrow" id="MathJax-Span-842"><span class="mi" id="MathJax-Span-843" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-844" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-74">\prob(\source,\aligns|\target)</script> over both the source sentence <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-75-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-845" role="math" style="width: 0.534em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.437em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.886em 1000.39em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-846"><span class="texatom" id="MathJax-Span-847"><span class="mrow" id="MathJax-Span-848"><span class="mi" id="MathJax-Span-849" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-75">\source</script> and its alignment <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-76-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-850" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.886em 1000.53em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-851"><span class="texatom" id="MathJax-Span-852"><span class="mrow" id="MathJax-Span-853"><span class="mi" id="MathJax-Span-854" style="font-family: STIXGeneral; font-weight: bold;">a</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-76">\aligns</script> to the target sentence <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-77-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-855" role="math" style="width: 0.389em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.341em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.742em 1000.34em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-856"><span class="texatom" id="MathJax-Span-857"><span class="mrow" id="MathJax-Span-858"><span class="mi" id="MathJax-Span-859" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.836em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-77">\target</script>. Such a model can be used as translation model <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-78-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-860" role="math" style="width: 2.466em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.128em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1002.08em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-861"><span class="mi" id="MathJax-Span-862" style="font-family: STIXGeneral-Italic;">p</span><span class="mo" id="MathJax-Span-863" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-864"><span class="mrow" id="MathJax-Span-865"><span class="mi" id="MathJax-Span-866" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="texatom" id="MathJax-Span-867"><span class="mrow" id="MathJax-Span-868"><span class="mo" id="MathJax-Span-869" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-870"><span class="mrow" id="MathJax-Span-871"><span class="mi" id="MathJax-Span-872" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-873" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-78">\prob(\source|\target)</script>, as defined above, by marginalizing out the alignment <span class="summary"> Model 2 defines a distribution <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-79-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-874" role="math" style="width: 3.529em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.046em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1003em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-875"><span class="mi" id="MathJax-Span-876" style="font-family: STIXGeneral-Italic;">p</span><span class="mo" id="MathJax-Span-877" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-878"><span class="mrow" id="MathJax-Span-879"><span class="mi" id="MathJax-Span-880" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-881" style="font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-882" style="padding-left: 0.196em;"><span class="mrow" id="MathJax-Span-883"><span class="mi" id="MathJax-Span-884" style="font-family: STIXGeneral; font-weight: bold;">a</span></span></span><span class="texatom" id="MathJax-Span-885"><span class="mrow" id="MathJax-Span-886"><span class="mo" id="MathJax-Span-887" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-888"><span class="mrow" id="MathJax-Span-889"><span class="mi" id="MathJax-Span-890" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-891" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-79">\prob(\source,\aligns|\target)</script>. A <strong>translation model</strong> can be derived by marginalizing out the alignments</span></p><p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-80-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-892" role="math" style="width: 9.423em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.167em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.403em 1008.12em 3.915em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-893"><span class="mi" id="MathJax-Span-894" style="font-family: STIXGeneral-Italic;">p</span><span class="mo" id="MathJax-Span-895" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-896"><span class="mrow" id="MathJax-Span-897"><span class="mi" id="MathJax-Span-898" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="texatom" id="MathJax-Span-899"><span class="mrow" id="MathJax-Span-900"><span class="mo" id="MathJax-Span-901" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-902"><span class="mrow" id="MathJax-Span-903"><span class="mi" id="MathJax-Span-904" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-905" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-906" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">=</span><span class="munderover" id="MathJax-Span-907" style="padding-left: 0.292em;"><span style="display: inline-block; position: relative; width: 1.307em; height: 0px;"><span style="position: absolute; clip: rect(2.901em 1001.21em 4.64em -999.998em); top: -4.007em; left: 0.002em;"><span class="mo" id="MathJax-Span-908" style="font-family: STIXSizeOneSym; vertical-align: -0.529em;">∑</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.529em 1000.34em 4.254em -999.998em); top: -2.848em; left: 0.486em;"><span class="texatom" id="MathJax-Span-909"><span class="mrow" id="MathJax-Span-910"><span class="texatom" id="MathJax-Span-911"><span class="mrow" id="MathJax-Span-912"><span class="mi" id="MathJax-Span-913" style="font-size: 70.7%; font-family: STIXGeneral; font-weight: bold;">a</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mi" id="MathJax-Span-914" style="font-family: STIXGeneral-Italic; padding-left: 0.196em;">p</span><span class="mo" id="MathJax-Span-915" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-916"><span class="mrow" id="MathJax-Span-917"><span class="mi" id="MathJax-Span-918" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-919" style="font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-920" style="padding-left: 0.196em;"><span class="mrow" id="MathJax-Span-921"><span class="mi" id="MathJax-Span-922" style="font-family: STIXGeneral; font-weight: bold;">a</span></span></span><span class="texatom" id="MathJax-Span-923"><span class="mrow" id="MathJax-Span-924"><span class="mo" id="MathJax-Span-925" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-926"><span class="mrow" id="MathJax-Span-927"><span class="mi" id="MathJax-Span-928" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-929" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-930" style="font-family: STIXGeneral-Regular;">.</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.497em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 2.669em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>p</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow></mrow></munder><mi>p</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo><mo>.</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-80"> \prob(\source|\target) = \sum_{\aligns} \prob(\source,\aligns|\target). </script></p>
<!--
<div class="newslide"></div>

Notice that pluging this translation model into the argmax problem of equation \\(\ref{decode-nc}\\) results in a nested summation and maximization problem. [Park and Darwiche](http://arxiv.org/pdf/1107.0024.pdf) show that this problem is generally substantially harder than only performing the max. To avoid the computational issues that arise in this setting, it is therefore common to instead maximize over both target and alignment at decoding time: <span class="summary">For computational reasons we often search over both alignments and targets</span>

$$
(\target^*,\aligns^*) = \argmax_{\target,\aligns} \prob(\target, \aligns | \source).
$$

Notice that marginalization happens to be feasible for Model 2, but generally latent alignments models do not have this property. 

-->
<div class="newslide"></div><h4>Model Parametrization</h4>
<div class="book-start"></div><p>IBM Model 2 defines its conditional distribution over source and alignments using two sets of parameters <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-81-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-931" role="math" style="width: 4.592em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.964em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1003.91em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-932"><span class="mi" id="MathJax-Span-933" style="font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span><span class="mo" id="MathJax-Span-934" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">=</span><span class="mo" id="MathJax-Span-935" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">(</span><span class="mi" id="MathJax-Span-936" style="font-family: STIXGeneral; font-style: italic; font-weight: bold;">α</span><span class="mo" id="MathJax-Span-937" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-938" style="font-family: STIXGeneral; font-style: italic; font-weight: bold; padding-left: 0.196em;">β</span><span class="mo" id="MathJax-Span-939" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.169em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">θ</mi><mo>=</mo><mo stretchy="false">(</mo><mi mathvariant="bold-italic">α</mi><mo>,</mo><mi mathvariant="bold-italic">β</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-81">\params=(\balpha,\bbeta)</script>. Here <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-82-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-940" role="math" style="width: 2.466em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.128em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1002.08em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-941"><span class="mi" id="MathJax-Span-942" style="font-family: STIXGeneral-Italic;">α</span><span class="mo" id="MathJax-Span-943" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-944" style="font-family: STIXGeneral-Italic;">s</span><span class="texatom" id="MathJax-Span-945"><span class="mrow" id="MathJax-Span-946"><span class="mo" id="MathJax-Span-947" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="mi" id="MathJax-Span-948" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-949" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi><mo stretchy="false">(</mo><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>t</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-82">\alpha(\ssource|\starget)</script> is a parameter defining the probability of translation target word <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-83-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-950" role="math" style="width: 0.341em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.292em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.838em 1000.29em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-951"><span class="mi" id="MathJax-Span-952" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.781em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-83">\starget</script> into source word <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-84-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-953" role="math" style="width: 0.534em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.437em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.935em 1000.44em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-954"><span class="mi" id="MathJax-Span-955" style="font-family: STIXGeneral-Italic;">s</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.614em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></span></span><script type="math/tex" id="MathJax-Element-84">\ssource</script>, and <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-85-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-956" role="math" style="width: 4.688em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.06em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1004.01em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-957"><span class="mi" id="MathJax-Span-958" style="font-family: STIXGeneral-Italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-959" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-960" style="font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="texatom" id="MathJax-Span-961"><span class="mrow" id="MathJax-Span-962"><span class="mo" id="MathJax-Span-963" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="mi" id="MathJax-Span-964" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-965" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-966" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 0.582em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.29em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-967" style="font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.292em;"><span class="mi" id="MathJax-Span-968" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-969" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-970" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 0.63em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.29em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-971" style="font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.292em;"><span class="mi" id="MathJax-Span-972" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-973" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>β</mi><mo stretchy="false">(</mo><mi>j</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>i</mi><mo>,</mo><msub><mi>l</mi><mi>t</mi></msub><mo>,</mo><msub><mi>l</mi><mi>s</mi></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-85">\beta(j|i,l_\starget,l_\ssource)</script> a parameter that defines the probability of aligning the source word at token <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-86-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-974" role="math" style="width: 0.341em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.292em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.29em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-975"><span class="mi" id="MathJax-Span-976" style="font-family: STIXGeneral-Italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.892em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-86">i</script> with the target word at token <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-87-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-977" role="math" style="width: 0.341em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.292em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.742em 1000.29em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-978"><span class="mi" id="MathJax-Span-979" style="font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>j</mi></math></span></span><script type="math/tex" id="MathJax-Element-87">j</script>, conditioned on the length <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-88-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-980" role="math" style="width: 0.727em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.63em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.355em 1000.63em 2.466em -999.998em); top: -2.171em; left: 0.002em;"><span class="mrow" id="MathJax-Span-981"><span class="msubsup" id="MathJax-Span-982"><span style="display: inline-block; position: relative; width: 0.582em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.29em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-983" style="font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.292em;"><span class="mi" id="MathJax-Span-984" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.176em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.219em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.058em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>l</mi><mi>t</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-88">l_\starget</script> of the target sentence, and the length <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-89-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-985" role="math" style="width: 0.775em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.679em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.355em 1000.68em 2.466em -999.998em); top: -2.171em; left: 0.002em;"><span class="mrow" id="MathJax-Span-986"><span class="msubsup" id="MathJax-Span-987"><span style="display: inline-block; position: relative; width: 0.63em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.29em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-988" style="font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.292em;"><span class="mi" id="MathJax-Span-989" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.176em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.219em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.058em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>l</mi><mi>s</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-89">l_\ssource</script> of the source sentence. </p>


<div class="slide-end"></div>
<div class="newslide"></div><p>With the above parameters, IBM Model 2 defines a conditional distribution over source sentences and alignments, conditioned on a target sentence <em>and a desired source sentence length</em> <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-99-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1049" role="math" style="width: 0.775em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.679em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.355em 1000.68em 2.466em -999.998em); top: -2.171em; left: 0.002em;"><span class="mrow" id="MathJax-Span-1050"><span class="msubsup" id="MathJax-Span-1051"><span style="display: inline-block; position: relative; width: 0.63em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.29em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1052" style="font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.292em;"><span class="mi" id="MathJax-Span-1053" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.176em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.219em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.058em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>l</mi><mi>s</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-99">l_\ssource</script>: <span class="summary">Model 2 defines a conditional distribution over source sentences and alignments, conditioned on a target sentence <em>and a desired source sentence length</em></span></p><p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display"><span class="MathJax" id="MathJax-Element-100-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable displaystyle=&quot;true&quot;&gt;&lt;mlabeledtr&gt;&lt;mtd id=&quot;mjx-eqn-ibm2&quot;&gt;&lt;mtext&gt;(3)&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;msubsup&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mtext&gt;IBM2&lt;/mtext&gt;&lt;/msubsup&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/msub&gt;&lt;mo&gt;&amp;#x2026;&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x220F;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mlabeledtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="width: 100%; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1054" role="math" style="width: 100%; display: inline-block; min-width: 28.408em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; font-size: 115%; min-width: 28.408em;"><span style="position: absolute; clip: rect(2.128em 1024.2em 5.461em -999.998em); top: -4.056em; left: 0.002em; width: 100%;"><span class="mrow" id="MathJax-Span-1055"><span class="mtable" id="MathJax-Span-1056" style="min-width: 28.408em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; min-width: 28.408em;"><span style="display: inline-block; position: absolute; width: 24.254em; height: 0px; clip: rect(-1.93em 1024.2em 1.403em -999.998em); top: 0.002em; left: 50%; margin-left: -12.123em;"><span style="position: absolute; clip: rect(2.128em 1024.2em 5.461em -999.998em); top: -4.056em; left: 0.002em;"><span style="display: inline-block; position: relative; width: 24.254em; height: 0px;"><span style="position: absolute; clip: rect(2.128em 1024.2em 5.461em -999.998em); top: -4.056em; left: 50%; margin-left: -12.123em;"><span class="mtd" id="MathJax-Span-1060"><span class="mrow" id="MathJax-Span-1061"><span class="msubsup" id="MathJax-Span-1062"><span style="display: inline-block; position: relative; width: 2.273em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.49em 4.35em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1063" style="font-family: STIXGeneral-Italic;">p</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1001.79em 4.157em -999.998em); top: -4.345em; left: 0.486em;"><span class="mtext" id="MathJax-Span-1064" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">IBM2</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1000.44em 4.157em -999.998em); top: -3.669em; left: 0.486em;"><span class="mi" id="MathJax-Span-1065" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1066" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-1067"><span style="display: inline-block; position: relative; width: 0.824em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.39em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1068" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.389em;"><span class="mn" id="MathJax-Span-1069" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1070" style="font-family: STIXGeneral-Regular; padding-left: 0.196em;">…</span><span class="msubsup" id="MathJax-Span-1071" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 0.92em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.39em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1072" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.389em;"><span class="texatom" id="MathJax-Span-1073"><span class="mrow" id="MathJax-Span-1074"><span class="msubsup" id="MathJax-Span-1075"><span style="display: inline-block; position: relative; width: 0.437em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1000.2em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1076" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.196em;"><span class="mi" id="MathJax-Span-1077" style="font-size: 50%; font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1078" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-1079" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 0.92em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.49em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1080" style="font-family: STIXGeneral-Italic;">a</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.486em;"><span class="mn" id="MathJax-Span-1081" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1082" style="font-family: STIXGeneral-Regular; padding-left: 0.196em;">…</span><span class="msubsup" id="MathJax-Span-1083" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 1.017em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.49em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1084" style="font-family: STIXGeneral-Italic;">a</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.486em;"><span class="texatom" id="MathJax-Span-1085"><span class="mrow" id="MathJax-Span-1086"><span class="msubsup" id="MathJax-Span-1087"><span style="display: inline-block; position: relative; width: 0.437em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1000.2em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1088" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.196em;"><span class="mi" id="MathJax-Span-1089" style="font-size: 50%; font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="texatom" id="MathJax-Span-1090"><span class="mrow" id="MathJax-Span-1091"><span class="mo" id="MathJax-Span-1092" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="msubsup" id="MathJax-Span-1093"><span style="display: inline-block; position: relative; width: 0.727em; height: 0px;"><span style="position: absolute; clip: rect(3.336em 1000.29em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1094" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.292em;"><span class="mn" id="MathJax-Span-1095" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1096" style="font-family: STIXGeneral-Regular; padding-left: 0.196em;">…</span><span class="msubsup" id="MathJax-Span-1097" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 0.775em; height: 0px;"><span style="position: absolute; clip: rect(3.336em 1000.29em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1098" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.292em;"><span class="texatom" id="MathJax-Span-1099"><span class="mrow" id="MathJax-Span-1100"><span class="msubsup" id="MathJax-Span-1101"><span style="display: inline-block; position: relative; width: 0.389em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1000.2em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1102" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.196em;"><span class="mi" id="MathJax-Span-1103" style="font-size: 50%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1104" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-1105" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 0.63em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.29em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1106" style="font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.292em;"><span class="mi" id="MathJax-Span-1107" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1108" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-1109" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">=</span><span class="munderover" id="MathJax-Span-1110" style="padding-left: 0.292em;"><span style="display: inline-block; position: relative; width: 1.355em; height: 0px;"><span style="position: absolute; clip: rect(2.901em 1001.31em 4.64em -999.998em); top: -4.007em; left: 0.002em;"><span class="mo" id="MathJax-Span-1111" style="font-family: STIXSizeOneSym; vertical-align: -0.529em;">∏</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1000.2em 4.254em -999.998em); top: -2.848em; left: 0.582em;"><span class="mi" id="MathJax-Span-1112" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.287em 1000.44em 4.254em -999.998em); top: -5.215em; left: 0.437em;"><span class="texatom" id="MathJax-Span-1113"><span class="mrow" id="MathJax-Span-1114"><span class="msubsup" id="MathJax-Span-1115"><span style="display: inline-block; position: relative; width: 0.437em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1000.2em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1116" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.196em;"><span class="mi" id="MathJax-Span-1117" style="font-size: 50%; font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mi" id="MathJax-Span-1118" style="font-family: STIXGeneral-Italic; padding-left: 0.196em;">α</span><span class="mo" id="MathJax-Span-1119" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-1120"><span style="display: inline-block; position: relative; width: 0.679em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.39em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1121" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.389em;"><span class="mi" id="MathJax-Span-1122" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="texatom" id="MathJax-Span-1123"><span class="mrow" id="MathJax-Span-1124"><span class="mo" id="MathJax-Span-1125" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="msubsup" id="MathJax-Span-1126"><span style="display: inline-block; position: relative; width: 0.92em; height: 0px;"><span style="position: absolute; clip: rect(3.336em 1000.29em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1127" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.292em;"><span class="texatom" id="MathJax-Span-1128"><span class="mrow" id="MathJax-Span-1129"><span class="msubsup" id="MathJax-Span-1130"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px;"><span style="position: absolute; clip: rect(3.577em 1000.34em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1131" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">a</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.341em;"><span class="mi" id="MathJax-Span-1132" style="font-size: 50%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1133" style="font-family: STIXGeneral-Regular;">)</span><span class="mi" id="MathJax-Span-1134" style="font-family: STIXGeneral-Italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-1135" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-1136"><span style="display: inline-block; position: relative; width: 0.775em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.49em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1137" style="font-family: STIXGeneral-Italic;">a</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.486em;"><span class="mi" id="MathJax-Span-1138" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="texatom" id="MathJax-Span-1139"><span class="mrow" id="MathJax-Span-1140"><span class="mo" id="MathJax-Span-1141" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="mi" id="MathJax-Span-1142" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-1143" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-1144" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 0.582em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.29em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1145" style="font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.292em;"><span class="mi" id="MathJax-Span-1146" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1147" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-1148" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 0.63em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.29em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1149" style="font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.292em;"><span class="mi" id="MathJax-Span-1150" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1151" style="font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.06em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.06em;"></span></span></span><span style="display: inline-block; position: absolute; width: 1.162em; height: 0px; clip: rect(-0.819em 1001.11em 0.341em -999.998em); top: 0.002em; right: 0.002em; margin-right: 0.002em;"><span style="position: absolute; clip: rect(3.191em 1001.11em 4.35em -999.998em); top: -4.007em; right: 0.002em;"><span class="mtd" id="mjx-eqn-ibm2"><span class="mrow" id="MathJax-Span-1058"><span class="mtext" id="MathJax-Span-1059" style="font-family: STIXGeneral-Regular;">(3)</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.06em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.497em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 3.614em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true"><mlabeledtr><mtd id="mjx-eqn-ibm2"><mtext>(3)</mtext></mtd><mtd><msubsup><mi>p</mi><mi mathvariant="bold-italic">θ</mi><mtext>IBM2</mtext></msubsup><mo stretchy="false">(</mo><msub><mi>s</mi><mn>1</mn></msub><mo>…</mo><msub><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>l</mi><mi>s</mi></msub></mrow></msub><mo>,</mo><msub><mi>a</mi><mn>1</mn></msub><mo>…</mo><msub><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>l</mi><mi>s</mi></msub></mrow></msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msub><mi>t</mi><mn>1</mn></msub><mo>…</mo><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>l</mi><mi>t</mi></msub></mrow></msub><mo>,</mo><msub><mi>l</mi><mi>s</mi></msub><mo stretchy="false">)</mo><mo>=</mo><munderover><mo>∏</mo><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>l</mi><mi>s</mi></msub></mrow></munderover><mi>α</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mi>i</mi></msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>a</mi><mi>i</mi></msub></mrow></msub><mo stretchy="false">)</mo><mi>β</mi><mo stretchy="false">(</mo><msub><mi>a</mi><mi>i</mi></msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>i</mi><mo>,</mo><msub><mi>l</mi><mi>t</mi></msub><mo>,</mo><msub><mi>l</mi><mi>s</mi></msub><mo stretchy="false">)</mo></mtd></mlabeledtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-100">\begin{equation} \label{ibm2}  p_\params^\text{IBM2}(\ssource_1 \ldots \ssource_{l_\ssource},\align_1 \ldots \align_{l_\ssource}|\starget_1 \ldots \starget_{l_\starget}, l_\ssource) = \prod_i^{l_\ssource} \alpha(\ssource_i|\starget_{a_i}) \beta(a_i|i,l_\starget,l_\ssource) \end{equation}</script></p></div></div><div id="cell13" class="cellWrapper"><div id="editCell13" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor13" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode13" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay13" class="cell"><div class="newslide"></div><h3>Training IBM Model 2 with the EM Algorithm</h3>
<div class="book-start"></div><p>Training IBM Model 2 is less straightforward than training our naive baseline. The main reason is the lack of <em>gold alignments</em> in the training data. That is, while we can quite easily find, or heuristically construct, <em>sentence-aligned</em> corpora like our toy dataset, we generally do not have <em>word aligned</em> sentences.</p>


<div class="slide-end"></div>
<div class="newslide"></div><p>To overcome this problem, IBM Model can be trained using the Expectation Maximization (EM) Algorithm, a general recipe when learning with partially observed data—in our case the data is partially observed because we observe the source and target sentences, but not their alignments. The EM algorithm maximizes a lower bound of the log-likelihood of the data. The log-likelihood of the data is <span class="summary">The Expectation Maximization (EM) Algorithm is a standard training algorithm for <strong>partially observed data</strong>. It maximizes a lower bound of the likelihood</span>:</p><p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-101-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;D&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;t&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;r&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;a&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;i&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mtext&gt;IBM2&lt;/mtext&gt;&lt;/msubsup&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;D&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;t&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;r&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;a&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;i&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;msubsup&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mtext&gt;IBM2&lt;/mtext&gt;&lt;/msubsup&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1152" role="math" style="width: 26.669em; display: inline-block;"><span style="display: inline-block; position: relative; width: 23.191em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.403em 1023.14em 4.012em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-1153"><span class="munderover" id="MathJax-Span-1154"><span style="display: inline-block; position: relative; width: 3.626em; height: 0px;"><span style="position: absolute; clip: rect(2.901em 1001.21em 4.64em -999.998em); top: -4.007em; left: 1.162em;"><span class="mo" id="MathJax-Span-1155" style="font-family: STIXSizeOneSym; vertical-align: -0.529em;">∑</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1003.63em 4.399em -999.998em); top: -2.848em; left: 0.002em;"><span class="texatom" id="MathJax-Span-1156"><span class="mrow" id="MathJax-Span-1157"><span class="mo" id="MathJax-Span-1158" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-1159"><span style="display: inline-block; position: relative; width: 0.437em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.24em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-1160"><span class="mrow" id="MathJax-Span-1161"><span class="mi" id="MathJax-Span-1162" style="font-size: 70.7%; font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.244em;"><span class="mi" id="MathJax-Span-1163" style="font-size: 50%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1164" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-1165"><span style="display: inline-block; position: relative; width: 0.486em; height: 0px;"><span style="position: absolute; clip: rect(3.529em 1000.24em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-1166"><span class="mrow" id="MathJax-Span-1167"><span class="mi" id="MathJax-Span-1168" style="font-size: 70.7%; font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.292em;"><span class="mi" id="MathJax-Span-1169" style="font-size: 50%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1170" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-1171" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">∈</span><span class="msubsup" id="MathJax-Span-1172"><span style="display: inline-block; position: relative; width: 1.597em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1000.58em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-1173"><span class="mrow" id="MathJax-Span-1174"><span class="mi" id="MathJax-Span-1175" style="font-size: 70.7%; font-family: STIXNonUnicode-Italic;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.582em;"><span class="texatom" id="MathJax-Span-1176"><span class="mrow" id="MathJax-Span-1177"><span class="mi" id="MathJax-Span-1178" style="font-size: 50%; font-family: STIXGeneral-Italic;">t</span><span class="mi" id="MathJax-Span-1179" style="font-size: 50%; font-family: STIXGeneral-Italic;">r</span><span class="mi" id="MathJax-Span-1180" style="font-size: 50%; font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-1181" style="font-size: 50%; font-family: STIXGeneral-Italic;">i</span><span class="mi" id="MathJax-Span-1182" style="font-size: 50%; font-family: STIXGeneral-Italic;">n</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mi" id="MathJax-Span-1183" style="font-family: STIXGeneral-Regular; padding-left: 0.196em;">log</span><span class="mo" id="MathJax-Span-1184"></span><span class="msubsup" id="MathJax-Span-1185" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 2.273em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.49em 4.35em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1186" style="font-family: STIXGeneral-Italic;">p</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1001.79em 4.157em -999.998em); top: -4.345em; left: 0.486em;"><span class="mtext" id="MathJax-Span-1187" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">IBM2</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1000.44em 4.157em -999.998em); top: -3.669em; left: 0.486em;"><span class="mi" id="MathJax-Span-1188" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1189" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-1190"><span style="display: inline-block; position: relative; width: 0.679em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1000.34em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-1191"><span class="mrow" id="MathJax-Span-1192"><span class="mi" id="MathJax-Span-1193" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.389em;"><span class="mi" id="MathJax-Span-1194" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="texatom" id="MathJax-Span-1195"><span class="mrow" id="MathJax-Span-1196"><span class="mo" id="MathJax-Span-1197" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="msubsup" id="MathJax-Span-1198"><span style="display: inline-block; position: relative; width: 0.63em; height: 0px;"><span style="position: absolute; clip: rect(3.239em 1000.34em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-1199"><span class="mrow" id="MathJax-Span-1200"><span class="mi" id="MathJax-Span-1201" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.341em;"><span class="mi" id="MathJax-Span-1202" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1203" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-1204" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">=</span><span class="munderover" id="MathJax-Span-1205" style="padding-left: 0.292em;"><span style="display: inline-block; position: relative; width: 3.626em; height: 0px;"><span style="position: absolute; clip: rect(2.901em 1001.21em 4.64em -999.998em); top: -4.007em; left: 1.162em;"><span class="mo" id="MathJax-Span-1206" style="font-family: STIXSizeOneSym; vertical-align: -0.529em;">∑</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1003.63em 4.399em -999.998em); top: -2.848em; left: 0.002em;"><span class="texatom" id="MathJax-Span-1207"><span class="mrow" id="MathJax-Span-1208"><span class="mo" id="MathJax-Span-1209" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-1210"><span style="display: inline-block; position: relative; width: 0.437em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.24em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-1211"><span class="mrow" id="MathJax-Span-1212"><span class="mi" id="MathJax-Span-1213" style="font-size: 70.7%; font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.244em;"><span class="mi" id="MathJax-Span-1214" style="font-size: 50%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1215" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-1216"><span style="display: inline-block; position: relative; width: 0.486em; height: 0px;"><span style="position: absolute; clip: rect(3.529em 1000.24em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-1217"><span class="mrow" id="MathJax-Span-1218"><span class="mi" id="MathJax-Span-1219" style="font-size: 70.7%; font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.292em;"><span class="mi" id="MathJax-Span-1220" style="font-size: 50%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1221" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-1222" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">∈</span><span class="msubsup" id="MathJax-Span-1223"><span style="display: inline-block; position: relative; width: 1.597em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1000.58em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-1224"><span class="mrow" id="MathJax-Span-1225"><span class="mi" id="MathJax-Span-1226" style="font-size: 70.7%; font-family: STIXNonUnicode-Italic;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.582em;"><span class="texatom" id="MathJax-Span-1227"><span class="mrow" id="MathJax-Span-1228"><span class="mi" id="MathJax-Span-1229" style="font-size: 50%; font-family: STIXGeneral-Italic;">t</span><span class="mi" id="MathJax-Span-1230" style="font-size: 50%; font-family: STIXGeneral-Italic;">r</span><span class="mi" id="MathJax-Span-1231" style="font-size: 50%; font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-1232" style="font-size: 50%; font-family: STIXGeneral-Italic;">i</span><span class="mi" id="MathJax-Span-1233" style="font-size: 50%; font-family: STIXGeneral-Italic;">n</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mi" id="MathJax-Span-1234" style="font-family: STIXGeneral-Regular; padding-left: 0.196em;">log</span><span class="mo" id="MathJax-Span-1235"></span><span class="munderover" id="MathJax-Span-1236" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 1.307em; height: 0px;"><span style="position: absolute; clip: rect(2.901em 1001.21em 4.64em -999.998em); top: -4.007em; left: 0.002em;"><span class="mo" id="MathJax-Span-1237" style="font-family: STIXSizeOneSym; vertical-align: -0.529em;">∑</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.529em 1000.34em 4.254em -999.998em); top: -2.848em; left: 0.486em;"><span class="texatom" id="MathJax-Span-1238"><span class="mrow" id="MathJax-Span-1239"><span class="texatom" id="MathJax-Span-1240"><span class="mrow" id="MathJax-Span-1241"><span class="mi" id="MathJax-Span-1242" style="font-size: 70.7%; font-family: STIXGeneral; font-weight: bold;">a</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-1243" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 2.273em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.49em 4.35em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1244" style="font-family: STIXGeneral-Italic;">p</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1001.79em 4.157em -999.998em); top: -4.345em; left: 0.486em;"><span class="mtext" id="MathJax-Span-1245" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">IBM2</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1000.44em 4.157em -999.998em); top: -3.669em; left: 0.486em;"><span class="mi" id="MathJax-Span-1246" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1247" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-1248"><span style="display: inline-block; position: relative; width: 0.679em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1000.34em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-1249"><span class="mrow" id="MathJax-Span-1250"><span class="mi" id="MathJax-Span-1251" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.389em;"><span class="mi" id="MathJax-Span-1252" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1253" style="font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-1254" style="padding-left: 0.196em;"><span class="mrow" id="MathJax-Span-1255"><span class="mi" id="MathJax-Span-1256" style="font-family: STIXGeneral; font-weight: bold;">a</span></span></span><span class="texatom" id="MathJax-Span-1257"><span class="mrow" id="MathJax-Span-1258"><span class="mo" id="MathJax-Span-1259" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="msubsup" id="MathJax-Span-1260"><span style="display: inline-block; position: relative; width: 0.63em; height: 0px;"><span style="position: absolute; clip: rect(3.239em 1000.34em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-1261"><span class="mrow" id="MathJax-Span-1262"><span class="mi" id="MathJax-Span-1263" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.341em;"><span class="mi" id="MathJax-Span-1264" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1265" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.608em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 2.836em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">(</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mi>i</mi></msub><mo>,</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mi>i</mi></msub><mo stretchy="false">)</mo><mo>∈</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">D</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">t</mi><mi class="MJX-tex-mathit" mathvariant="italic">r</mi><mi class="MJX-tex-mathit" mathvariant="italic">a</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">n</mi></mrow></msub></mrow></munder><mi>log</mi><mo>⁡</mo><msubsup><mi>p</mi><mi mathvariant="bold-italic">θ</mi><mtext>IBM2</mtext></msubsup><mo stretchy="false">(</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mi>i</mi></msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">(</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mi>i</mi></msub><mo>,</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mi>i</mi></msub><mo stretchy="false">)</mo><mo>∈</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">D</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">t</mi><mi class="MJX-tex-mathit" mathvariant="italic">r</mi><mi class="MJX-tex-mathit" mathvariant="italic">a</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">n</mi></mrow></msub></mrow></munder><mi>log</mi><mo>⁡</mo><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow></mrow></munder><msubsup><mi>p</mi><mi mathvariant="bold-italic">θ</mi><mtext>IBM2</mtext></msubsup><mo stretchy="false">(</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mi>i</mi></msub><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msub><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mi>i</mi></msub><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-101">  \sum_{(\target_i,\source_i) \in \train} \log p_\params^\text{IBM2}(\source_i|\target_i) = \sum_{(\target_i,\source_i) \in \train} \log \sum_{\aligns} p_\params^\text{IBM2}(\source_i,\aligns|\target_i) </script></p><p>EM can be be seen as <a href="https://www.dropbox.com/s/vrsefe3m57bxpgv/EMforTM.pdf?dl=0">block coordinate descent</a> on this bound.</p>
<div class="newslide"></div><p>The EM algorithm is an iterative method that iterates between two steps, the E-step (Expectation) and the M-Step (Maximization), until convergence. For the case of IBM Model 2 the E and M steps are instantiated as follows: <span class="summary">EM for Model 2 iterates between:</span> </p>
<ul>
  <li><strong>E-Step</strong>: given a current set of parameters <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-102-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1266" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.53em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-1267"><span class="mi" id="MathJax-Span-1268" style="font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.947em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-102">\params</script>, calculate the <strong>expectations</strong> <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-103-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03C0;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1269" role="math" style="width: 0.679em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.582em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.935em 1000.58em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-1270"><span class="mi" id="MathJax-Span-1271" style="font-family: STIXGeneral-Italic;">π<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.051em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.614em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>π</mi></math></span></span><script type="math/tex" id="MathJax-Element-103">\pi</script> of the latent alignment variables under the model <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-104-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msubsup&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mtext&gt;IBM2&lt;/mtext&gt;&lt;/msubsup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1272" role="math" style="width: 2.659em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.321em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.21em 1002.32em 2.659em -999.998em); top: -2.171em; left: 0.002em;"><span class="mrow" id="MathJax-Span-1273"><span class="msubsup" id="MathJax-Span-1274"><span style="display: inline-block; position: relative; width: 2.273em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.49em 4.35em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1275" style="font-family: STIXGeneral-Italic;">p</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1001.79em 4.157em -999.998em); top: -4.345em; left: 0.486em;"><span class="mtext" id="MathJax-Span-1276" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">IBM2</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1000.44em 4.157em -999.998em); top: -3.669em; left: 0.486em;"><span class="mi" id="MathJax-Span-1277" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.176em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.442em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.447em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msubsup><mi>p</mi><mi mathvariant="bold-italic">θ</mi><mtext>IBM2</mtext></msubsup></math></span></span><script type="math/tex" id="MathJax-Element-104">p_\params^\text{IBM2}</script> — this amounts to estimating a <em>soft alignment</em> for each sentence.</li>
  <li><strong>M-Step</strong>: Given training set of soft alignments <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-105-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03C0;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1278" role="math" style="width: 0.679em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.582em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.935em 1000.58em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-1279"><span class="mi" id="MathJax-Span-1280" style="font-family: STIXGeneral-Italic;">π<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.051em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.614em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>π</mi></math></span></span><script type="math/tex" id="MathJax-Element-105">\pi</script>, find new parameters <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-106-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1281" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.53em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-1282"><span class="mi" id="MathJax-Span-1283" style="font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.947em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-106">\params</script> that <strong>maximize</strong> the log likelihood of this (weighted) training set. This amounts to soft counting.</li>
</ul>
<div class="newslide"></div><h4>E-Step</h4>
<div class="book-start"></div><p>The E-Step calculates the distribution</p><p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-107-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;&amp;#x03C0;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mtext&gt;IBM2&lt;/mtext&gt;&lt;/msubsup&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1284" role="math" style="width: 10.582em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.181em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.548em 1009.13em 2.998em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-1285"><span class="mi" id="MathJax-Span-1286" style="font-family: STIXGeneral-Italic;">π<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.051em;"></span></span><span class="mo" id="MathJax-Span-1287" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-1288"><span class="mrow" id="MathJax-Span-1289"><span class="mi" id="MathJax-Span-1290" style="font-family: STIXGeneral; font-weight: bold;">a</span></span></span><span class="texatom" id="MathJax-Span-1291"><span class="mrow" id="MathJax-Span-1292"><span class="mo" id="MathJax-Span-1293" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-1294"><span class="mrow" id="MathJax-Span-1295"><span class="mi" id="MathJax-Span-1296" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-1297" style="font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-1298" style="padding-left: 0.196em;"><span class="mrow" id="MathJax-Span-1299"><span class="mi" id="MathJax-Span-1300" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-1301" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-1302" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">=</span><span class="msubsup" id="MathJax-Span-1303" style="padding-left: 0.292em;"><span style="display: inline-block; position: relative; width: 2.273em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.49em 4.35em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1304" style="font-family: STIXGeneral-Italic;">p</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1001.79em 4.157em -999.998em); top: -4.345em; left: 0.486em;"><span class="mtext" id="MathJax-Span-1305" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">IBM2</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1000.44em 4.157em -999.998em); top: -3.669em; left: 0.486em;"><span class="mi" id="MathJax-Span-1306" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1307" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-1308"><span class="mrow" id="MathJax-Span-1309"><span class="mi" id="MathJax-Span-1310" style="font-family: STIXGeneral; font-weight: bold;">a</span></span></span><span class="texatom" id="MathJax-Span-1311"><span class="mrow" id="MathJax-Span-1312"><span class="mo" id="MathJax-Span-1313" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-1314"><span class="mrow" id="MathJax-Span-1315"><span class="mi" id="MathJax-Span-1316" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-1317" style="font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-1318" style="padding-left: 0.196em;"><span class="mrow" id="MathJax-Span-1319"><span class="mi" id="MathJax-Span-1320" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-1321" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.442em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.447em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>π</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><msubsup><mi>p</mi><mi mathvariant="bold-italic">θ</mi><mtext>IBM2</mtext></msubsup><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-107"> \pi(\aligns|\source,\target) = p_\params^\text{IBM2}(\aligns|\source,\target) </script></p><p>for the current parameters <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-108-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1322" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.53em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-1323"><span class="mi" id="MathJax-Span-1324" style="font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.947em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-108">\params</script>. For Model 2 this distribution has a very simple form:</p><p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-109-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;&amp;#x03C0;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x220F;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;mi&gt;&amp;#x03C0;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x220F;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1325" role="math" style="width: 24.592em; display: inline-block;"><span style="display: inline-block; position: relative; width: 21.355em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(0.582em 1021.36em 4.012em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-1326"><span class="mi" id="MathJax-Span-1327" style="font-family: STIXGeneral-Italic;">π<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.051em;"></span></span><span class="mo" id="MathJax-Span-1328" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-1329"><span class="mrow" id="MathJax-Span-1330"><span class="mi" id="MathJax-Span-1331" style="font-family: STIXGeneral; font-weight: bold;">a</span></span></span><span class="texatom" id="MathJax-Span-1332"><span class="mrow" id="MathJax-Span-1333"><span class="mo" id="MathJax-Span-1334" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-1335"><span class="mrow" id="MathJax-Span-1336"><span class="mi" id="MathJax-Span-1337" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-1338" style="font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-1339" style="padding-left: 0.196em;"><span class="mrow" id="MathJax-Span-1340"><span class="mi" id="MathJax-Span-1341" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-1342" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-1343" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">=</span><span class="munderover" id="MathJax-Span-1344" style="padding-left: 0.292em;"><span style="display: inline-block; position: relative; width: 1.355em; height: 0px;"><span style="position: absolute; clip: rect(2.901em 1001.31em 4.64em -999.998em); top: -4.007em; left: 0.002em;"><span class="mo" id="MathJax-Span-1345" style="font-family: STIXSizeOneSym; vertical-align: -0.529em;">∏</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1000.2em 4.254em -999.998em); top: -2.848em; left: 0.582em;"><span class="mi" id="MathJax-Span-1346" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.287em 1000.44em 4.254em -999.998em); top: -5.215em; left: 0.437em;"><span class="texatom" id="MathJax-Span-1347"><span class="mrow" id="MathJax-Span-1348"><span class="msubsup" id="MathJax-Span-1349"><span style="display: inline-block; position: relative; width: 0.437em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1000.2em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1350" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.196em;"><span class="texatom" id="MathJax-Span-1351"><span class="mrow" id="MathJax-Span-1352"><span class="mi" id="MathJax-Span-1353" style="font-size: 50%; font-family: STIXGeneral-Italic;">s</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mi" id="MathJax-Span-1354" style="font-family: STIXGeneral-Italic; padding-left: 0.196em;">π<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.051em;"></span></span><span class="mo" id="MathJax-Span-1355" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-1356"><span style="display: inline-block; position: relative; width: 0.775em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.49em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1357" style="font-family: STIXGeneral-Italic;">a</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.486em;"><span class="mi" id="MathJax-Span-1358" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="texatom" id="MathJax-Span-1359"><span class="mrow" id="MathJax-Span-1360"><span class="mo" id="MathJax-Span-1361" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-1362"><span class="mrow" id="MathJax-Span-1363"><span class="mi" id="MathJax-Span-1364" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-1365" style="font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-1366" style="padding-left: 0.196em;"><span class="mrow" id="MathJax-Span-1367"><span class="mi" id="MathJax-Span-1368" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-1369" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-1370" style="font-family: STIXGeneral-Italic; padding-left: 0.196em;">i</span><span class="mo" id="MathJax-Span-1371" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-1372" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">=</span><span class="munderover" id="MathJax-Span-1373" style="padding-left: 0.292em;"><span style="display: inline-block; position: relative; width: 1.355em; height: 0px;"><span style="position: absolute; clip: rect(2.901em 1001.31em 4.64em -999.998em); top: -4.007em; left: 0.002em;"><span class="mo" id="MathJax-Span-1374" style="font-family: STIXSizeOneSym; vertical-align: -0.529em;">∏</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1000.2em 4.254em -999.998em); top: -2.848em; left: 0.582em;"><span class="mi" id="MathJax-Span-1375" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.287em 1000.44em 4.254em -999.998em); top: -5.215em; left: 0.437em;"><span class="texatom" id="MathJax-Span-1376"><span class="mrow" id="MathJax-Span-1377"><span class="msubsup" id="MathJax-Span-1378"><span style="display: inline-block; position: relative; width: 0.437em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1000.2em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1379" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.196em;"><span class="texatom" id="MathJax-Span-1380"><span class="mrow" id="MathJax-Span-1381"><span class="mi" id="MathJax-Span-1382" style="font-size: 50%; font-family: STIXGeneral-Italic;">s</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mfrac" id="MathJax-Span-1383" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 8.36em; height: 0px; margin-right: 0.099em; margin-left: 0.099em;"><span style="position: absolute; clip: rect(3.191em 1007.44em 4.399em -999.998em); top: -4.732em; left: 50%; margin-left: -3.766em;"><span class="mrow" id="MathJax-Span-1384"><span class="mi" id="MathJax-Span-1385" style="font-family: STIXGeneral-Italic;">α</span><span class="mo" id="MathJax-Span-1386" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-1387"><span style="display: inline-block; position: relative; width: 0.679em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.39em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1388" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.389em;"><span class="mi" id="MathJax-Span-1389" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="texatom" id="MathJax-Span-1390"><span class="mrow" id="MathJax-Span-1391"><span class="mo" id="MathJax-Span-1392" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="msubsup" id="MathJax-Span-1393"><span style="display: inline-block; position: relative; width: 0.92em; height: 0px;"><span style="position: absolute; clip: rect(3.336em 1000.29em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1394" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.292em;"><span class="texatom" id="MathJax-Span-1395"><span class="mrow" id="MathJax-Span-1396"><span class="msubsup" id="MathJax-Span-1397"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px;"><span style="position: absolute; clip: rect(3.577em 1000.34em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1398" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">a</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.341em;"><span class="mi" id="MathJax-Span-1399" style="font-size: 50%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1400" style="font-family: STIXGeneral-Regular;">)</span><span class="mi" id="MathJax-Span-1401" style="font-family: STIXGeneral-Italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-1402" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-1403"><span style="display: inline-block; position: relative; width: 0.775em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.49em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1404" style="font-family: STIXGeneral-Italic;">a</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.486em;"><span class="mi" id="MathJax-Span-1405" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="texatom" id="MathJax-Span-1406"><span class="mrow" id="MathJax-Span-1407"><span class="mo" id="MathJax-Span-1408" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="mi" id="MathJax-Span-1409" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-1410" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-1411" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 0.582em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.29em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1412" style="font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.292em;"><span class="mi" id="MathJax-Span-1413" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1414" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-1415" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 0.63em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.29em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1416" style="font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.292em;"><span class="mi" id="MathJax-Span-1417" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1418" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(2.901em 1008.17em 4.592em -999.998em); top: -3.089em; left: 50%; margin-left: -4.104em;"><span class="mrow" id="MathJax-Span-1419"><span class="munderover" id="MathJax-Span-1420"><span style="display: inline-block; position: relative; width: 1.403em; height: 0px;"><span style="position: absolute; clip: rect(3.094em 1000.87em 4.399em -999.998em); top: -4.007em; left: 0.002em;"><span class="mo" id="MathJax-Span-1421" style="font-family: STIXGeneral-Regular; vertical-align: 0.002em;">∑</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1000.49em 4.254em -999.998em); top: -4.49em; left: 0.92em;"><span class="texatom" id="MathJax-Span-1422"><span class="mrow" id="MathJax-Span-1423"><span class="msubsup" id="MathJax-Span-1424"><span style="display: inline-block; position: relative; width: 0.389em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1000.2em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1425" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.196em;"><span class="texatom" id="MathJax-Span-1426"><span class="mrow" id="MathJax-Span-1427"><span class="mi" id="MathJax-Span-1428" style="font-size: 50%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1000.29em 4.302em -999.998em); top: -3.717em; left: 0.92em;"><span class="mi" id="MathJax-Span-1429" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mi" id="MathJax-Span-1430" style="font-family: STIXGeneral-Italic; padding-left: 0.196em;">α</span><span class="mo" id="MathJax-Span-1431" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-1432"><span style="display: inline-block; position: relative; width: 0.679em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.39em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1433" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.389em;"><span class="mi" id="MathJax-Span-1434" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="texatom" id="MathJax-Span-1435"><span class="mrow" id="MathJax-Span-1436"><span class="mo" id="MathJax-Span-1437" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="msubsup" id="MathJax-Span-1438"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px;"><span style="position: absolute; clip: rect(3.336em 1000.29em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1439" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.292em;"><span class="mi" id="MathJax-Span-1440" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1441" style="font-family: STIXGeneral-Regular;">)</span><span class="mi" id="MathJax-Span-1442" style="font-family: STIXGeneral-Italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-1443" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-1444" style="font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="texatom" id="MathJax-Span-1445"><span class="mrow" id="MathJax-Span-1446"><span class="mo" id="MathJax-Span-1447" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="mi" id="MathJax-Span-1448" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-1449" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-1450" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 0.582em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.29em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1451" style="font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.292em;"><span class="mi" id="MathJax-Span-1452" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1453" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-1454" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 0.63em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.29em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1455" style="font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.292em;"><span class="mi" id="MathJax-Span-1456" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1457" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(0.872em 1008.36em 1.21em -999.998em); top: -1.302em; left: 0.002em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0.002em; border-top-width: 1.3px; border-top-style: solid; width: 8.36em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.065em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.608em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 3.781em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>π</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><munderover><mo>∏</mo><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>l</mi><mrow class="MJX-TeXAtom-ORD"><mi>s</mi></mrow></msub></mrow></munderover><mi>π</mi><mo stretchy="false">(</mo><msub><mi>a</mi><mi>i</mi></msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo>,</mo><mi>i</mi><mo stretchy="false">)</mo><mo>=</mo><munderover><mo>∏</mo><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>l</mi><mrow class="MJX-TeXAtom-ORD"><mi>s</mi></mrow></msub></mrow></munderover><mfrac><mrow><mi>α</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mi>i</mi></msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msub><mi>t</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>a</mi><mi>i</mi></msub></mrow></msub><mo stretchy="false">)</mo><mi>β</mi><mo stretchy="false">(</mo><msub><mi>a</mi><mi>i</mi></msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>i</mi><mo>,</mo><msub><mi>l</mi><mi>t</mi></msub><mo>,</mo><msub><mi>l</mi><mi>s</mi></msub><mo stretchy="false">)</mo></mrow><mrow><munderover><mo>∑</mo><mi>j</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>l</mi><mrow class="MJX-TeXAtom-ORD"><mi>t</mi></mrow></msub></mrow></munderover><mi>α</mi><mo stretchy="false">(</mo><msub><mi>s</mi><mi>i</mi></msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msub><mi>t</mi><mi>j</mi></msub><mo stretchy="false">)</mo><mi>β</mi><mo stretchy="false">(</mo><mi>j</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>i</mi><mo>,</mo><msub><mi>l</mi><mi>t</mi></msub><mo>,</mo><msub><mi>l</mi><mi>s</mi></msub><mo stretchy="false">)</mo></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-109"> \pi(\aligns|\source,\target) = \prod_i^{l_{\ssource}} \pi(a_i|\source,\target,i) = \prod_i^{l_{\ssource}}  \frac  {\alpha(\ssource_i|\starget_{a_i}) \beta(a_i|i,l_\starget,l_\ssource)}  {\sum_j^{l_{\starget}} \alpha(\ssource_i|\starget_j) \beta(j|i,l_\starget,l_\ssource) } </script></p><p>Importantly, the distribution over alignments <em>factorizes</em> in a per-source-token fashion, and hence we only need to calculate, for each source token <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-110-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1458" role="math" style="width: 0.341em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.292em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.29em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-1459"><span class="mi" id="MathJax-Span-1460" style="font-family: STIXGeneral-Italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.892em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></span></span><script type="math/tex" id="MathJax-Element-110">i</script> and each possible alignment <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-111-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1461" role="math" style="width: 0.969em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.824em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.597em 1000.82em 2.466em -999.998em); top: -2.171em; left: 0.002em;"><span class="mrow" id="MathJax-Span-1462"><span class="msubsup" id="MathJax-Span-1463"><span style="display: inline-block; position: relative; width: 0.775em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.49em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1464" style="font-family: STIXGeneral-Italic;">a</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.486em;"><span class="mi" id="MathJax-Span-1465" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.176em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.219em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.781em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>a</mi><mi>i</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-111">a_i</script>, the probability (or expectation) <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-112-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03C0;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1466" role="math" style="width: 4.737em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.109em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1004.06em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-1467"><span class="mi" id="MathJax-Span-1468" style="font-family: STIXGeneral-Italic;">π<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.051em;"></span></span><span class="mo" id="MathJax-Span-1469" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-1470"><span style="display: inline-block; position: relative; width: 0.775em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.49em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1471" style="font-family: STIXGeneral-Italic;">a</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.486em;"><span class="mi" id="MathJax-Span-1472" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="texatom" id="MathJax-Span-1473"><span class="mrow" id="MathJax-Span-1474"><span class="mo" id="MathJax-Span-1475" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-1476"><span class="mrow" id="MathJax-Span-1477"><span class="mi" id="MathJax-Span-1478" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-1479" style="font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-1480" style="padding-left: 0.196em;"><span class="mrow" id="MathJax-Span-1481"><span class="mi" id="MathJax-Span-1482" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-1483" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-1484" style="font-family: STIXGeneral-Italic; padding-left: 0.196em;">i</span><span class="mo" id="MathJax-Span-1485" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>π</mi><mo stretchy="false">(</mo><msub><mi>a</mi><mi>i</mi></msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo>,</mo><mi>i</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-112">\pi(a_i|\source,\target,i)</script>.</p>



<div class="slide-end"></div>
<div class="newslide"></div><p>Before we look at the implementation of this algorithm we will set up the training data to be compatible with our formulation. This involves introducing a 'NULL' token to each target sentence to allow source tokens to remain unaligned. We also gather a few statistics that will be useful in our implementation later on. <span class="summary">First we create some toy data:</span> </p></div></div><div id="cell14" class="cellWrapper"><div id="editCell14" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor14" class="cell editor ace_editor ace-chaos ace_dark" style="height: 132px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 16px; width: 7.20125px; left: 577.893px; top: 106px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 164px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div><div class="ace_gutter-cell " style="height: 16px;">2</div><div class="ace_gutter-cell " style="height: 16px;">3</div><div class="ace_gutter-cell " style="height: 16px;">4</div><div class="ace_gutter-cell " style="height: 16px;">5</div><div class="ace_gutter-cell " style="height: 16px;">6</div><div class="ace_gutter-cell " style="height: 16px;">7</div></div><div class="ace_gutter-active-line" style="top: 106px; height: 16px;"></div></div><div class="ace_scroller" style="left: 41px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 833px; height: 164px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">trainM2</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_support ace_function">Seq</span><span class="ace_paren ace_lparen">(</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_string">"NULL&nbsp;the&nbsp;house&nbsp;is&nbsp;small"</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_string">"klein&nbsp;ist&nbsp;das&nbsp;Haus"</span>,</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_string">"NULL&nbsp;a&nbsp;man&nbsp;is&nbsp;tall"</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_string">"groß&nbsp;ist&nbsp;ein&nbsp;Mann"</span>,</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_string">"NULL&nbsp;my&nbsp;house&nbsp;is&nbsp;small"</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_string">"klein&nbsp;ist&nbsp;mein&nbsp;Haus"</span>,</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_string">"NULL&nbsp;the&nbsp;building&nbsp;is&nbsp;big"</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_string">"groß&nbsp;ist&nbsp;das&nbsp;Gebäude"</span>,</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_string">"NULL&nbsp;the&nbsp;building&nbsp;is&nbsp;long"</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_string">"lang&nbsp;ist&nbsp;das&nbsp;Gebäude"</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_identifier">map</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">p</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_identifier">segment</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">p</span>&nbsp;<span class="ace_identifier">_1</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">sentences</span>.<span class="ace_identifier">head</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_identifier">segment</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">p</span>&nbsp;<span class="ace_identifier">_2</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">sentences</span>.<span class="ace_identifier">head</span><span class="ace_paren ace_rparen">)</span>&nbsp;</div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 536.893px; top: 96px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 132px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 41px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 833px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode14" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay14" class="cell" style="display: none;"><div class="text-center"><i class="fa fa-refresh fa-spin fa-lg"></i></div></div></div><div id="cell15" class="cellWrapper"><div id="editCell15" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor15" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode15" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay15" class="cell"><div class="newslide"></div><p>We can now implement the E-Step.</p></div></div><div id="cell16" class="cellWrapper"><div id="editCell16" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor16" class="cell editor ace_editor ace-chaos ace_dark" style="height: 372px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 16px; width: 7.20125px; left: 59.2013px; top: 346px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 404px; width: 48px;"><div class="ace_gutter-cell " style="height: 16px;">1</div><div class="ace_gutter-cell " style="height: 16px;">2</div><div class="ace_gutter-cell " style="height: 16px;">3</div><div class="ace_gutter-cell " style="height: 16px;">4</div><div class="ace_gutter-cell " style="height: 16px;">5</div><div class="ace_gutter-cell " style="height: 16px;">6</div><div class="ace_gutter-cell " style="height: 16px;">7</div><div class="ace_gutter-cell " style="height: 16px;">8</div><div class="ace_gutter-cell " style="height: 16px;">9</div><div class="ace_gutter-cell " style="height: 16px;">10</div><div class="ace_gutter-cell " style="height: 16px;">11</div><div class="ace_gutter-cell " style="height: 16px;">12</div><div class="ace_gutter-cell " style="height: 16px;">13</div><div class="ace_gutter-cell " style="height: 16px;">14<span class="ace_fold-widget ace_start ace_open" style="height: 16px;"></span></div><div class="ace_gutter-cell " style="height: 16px;">15<span class="ace_fold-widget ace_start ace_open" style="height: 16px;"></span></div><div class="ace_gutter-cell " style="height: 16px;">16</div><div class="ace_gutter-cell " style="height: 16px;">17</div><div class="ace_gutter-cell " style="height: 16px;">18</div><div class="ace_gutter-cell " style="height: 16px;">19</div><div class="ace_gutter-cell " style="height: 16px;">20</div><div class="ace_gutter-cell " style="height: 16px;">21</div><div class="ace_gutter-cell " style="height: 16px;">22</div></div><div class="ace_gutter-active-line" style="top: 346px; height: 16px;"></div></div><div class="ace_scroller" style="left: 48px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 826px; height: 404px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"><div class="ace_bracket ace_start" style="height:16px;width:7.20125px;top:208px;left:486.48375px;"></div></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_comment">//Each&nbsp;element&nbsp;in&nbsp;the&nbsp;sequence&nbsp;corresponds&nbsp;to&nbsp;one&nbsp;source&nbsp;token,</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_comment">//and&nbsp;each&nbsp;element&nbsp;in&nbsp;the&nbsp;nested&nbsp;sequence&nbsp;to&nbsp;a&nbsp;target&nbsp;token.</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">type</span>&nbsp;<span class="ace_identifier">Align</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">IndexedSeq</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">IndexedSeq</span><span class="ace_paren ace_lparen">[</span><span class="ace_support ace_function">Double</span><span class="ace_paren ace_rparen">]]</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_comment">//Model&nbsp;parameters</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">case</span>&nbsp;<span class="ace_keyword">class</span>&nbsp;<span class="ace_identifier">Model</span><span class="ace_paren ace_lparen">(</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_identifier">alpha</span>:<span class="ace_identifier">Map</span><span class="ace_paren ace_lparen">[(</span><span class="ace_support ace_function">String</span>,<span class="ace_support ace_function">String</span><span class="ace_paren ace_rparen">)</span>,<span class="ace_support ace_function">Double</span><span class="ace_paren ace_rparen">]</span>,</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_identifier">beta</span>:<span class="ace_identifier">Map</span><span class="ace_paren ace_lparen">[(</span><span class="ace_support ace_function">Int</span>,<span class="ace_support ace_function">Int</span>,<span class="ace_support ace_function">Int</span>,<span class="ace_support ace_function">Int</span><span class="ace_paren ace_rparen">)</span>,<span class="ace_support ace_function">Double</span><span class="ace_paren ace_rparen">])</span>&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_comment">//normalizing&nbsp;a&nbsp;distribution</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">norm</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">v</span>:<span class="ace_identifier">IndexedSeq</span><span class="ace_paren ace_lparen">[</span><span class="ace_support ace_function">Double</span><span class="ace_paren ace_rparen">])</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_paren ace_lparen">{</span>&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">s</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">v</span>.<span class="ace_identifier">sum</span>;&nbsp;<span class="ace_identifier">v</span>&nbsp;<span class="ace_identifier">map</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>&nbsp;/&nbsp;<span class="ace_identifier">s</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_paren ace_rparen">}</span>&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_comment">//estimate&nbsp;new&nbsp;soft&nbsp;alignments</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">eStep</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">model</span>:<span class="ace_identifier">Model</span>,&nbsp;<span class="ace_identifier">data</span>:<span class="ace_support ace_function">Seq</span><span class="ace_paren ace_lparen">[(</span><span class="ace_identifier">Sentence</span>,<span class="ace_identifier">Sentence</span><span class="ace_paren ace_rparen">)])</span>:<span class="ace_support ace_function">Seq</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">Align</span><span class="ace_paren ace_rparen">]</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">for</span>&nbsp;<span class="ace_paren ace_lparen">((</span><span class="ace_identifier">target</span>,<span class="ace_identifier">source</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_identifier">data</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword">yield</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">score</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">si</span>:<span class="ace_support ace_function">Int</span>,&nbsp;<span class="ace_identifier">ti</span>:<span class="ace_support ace_function">Int</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_identifier">model</span>.<span class="ace_identifier">alpha</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">source</span>.<span class="ace_identifier">tokens</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">si</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">word</span>,<span class="ace_identifier">target</span>.<span class="ace_identifier">tokens</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ti</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">word</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">*</span>&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_identifier">model</span>.<span class="ace_identifier">beta</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ti</span>,<span class="ace_identifier">si</span>,<span class="ace_identifier">target</span>.<span class="ace_identifier">tokens</span>.<span class="ace_identifier">length</span>,&nbsp;<span class="ace_identifier">source</span>.<span class="ace_identifier">tokens</span>.<span class="ace_identifier">length</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">for</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">si</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_identifier">source</span>.<span class="ace_identifier">tokens</span>.<span class="ace_identifier">indices</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword">yield</span>&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_identifier">norm</span><span class="ace_paren ace_lparen">(</span><span class="ace_keyword">for</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ti</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_identifier">target</span>.<span class="ace_identifier">tokens</span>.<span class="ace_identifier">indices</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword">yield</span>&nbsp;<span class="ace_identifier">score</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">si</span>,<span class="ace_identifier">ti</span><span class="ace_paren ace_rparen">))</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_paren ace_rparen">}</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 11.2012px; top: 336px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 372px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 48px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 826px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode16" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay16" class="cell" style="display: none;"><div class="text-center"><i class="fa fa-refresh fa-spin fa-lg"></i></div></div></div><div id="cell17" class="cellWrapper"><div id="editCell17" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor17" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode17" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay17" class="cell"><div class="newslide"></div><p>Let us run this code:</p></div></div><div id="cell18" class="cellWrapper"><div id="editCell18" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor18" class="cell editor ace_editor ace-chaos ace_dark" style="height: 132px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 16px; width: 7.20125px; left: 599.496px; top: 106px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 164px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div><div class="ace_gutter-cell " style="height: 16px;">2</div><div class="ace_gutter-cell " style="height: 16px;">3</div><div class="ace_gutter-cell " style="height: 16px;">4</div><div class="ace_gutter-cell " style="height: 16px;">5</div><div class="ace_gutter-cell " style="height: 16px;">6</div><div class="ace_gutter-cell " style="height: 16px;">7</div></div><div class="ace_gutter-active-line" style="top: 106px; height: 16px;"></div></div><div class="ace_scroller" style="left: 41px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 833px; height: 164px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"><div class="ace_bracket ace_start" style="height:16px;width:7.20125px;top:96px;left:234.44px;"></div></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">sourceVocab</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">trainM2</span>.<span class="ace_identifier">flatMap</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">_2</span>.<span class="ace_identifier">tokens</span>.<span class="ace_identifier">map</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">word</span><span class="ace_paren ace_rparen">))</span>.<span class="ace_identifier">toSet</span>&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">init</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">Model</span><span class="ace_paren ace_lparen">(</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">Map</span>.<span class="ace_identifier">empty</span>&nbsp;<span class="ace_identifier">withDefaultValue</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">1.0</span>&nbsp;/&nbsp;<span class="ace_identifier">sourceVocab</span>.<span class="ace_identifier">size</span><span class="ace_paren ace_rparen">)</span>,</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">Map</span>.<span class="ace_identifier">empty</span>&nbsp;<span class="ace_identifier">withDefault</span>&nbsp;<span class="ace_paren ace_lparen">{</span><span class="ace_keyword">case</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ti</span>,<span class="ace_identifier">si</span>,<span class="ace_identifier">lt</span>,<span class="ace_identifier">ls</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_constant ace_numeric">1.0</span>&nbsp;/&nbsp;<span class="ace_identifier">lt</span>&nbsp;<span class="ace_paren ace_rparen">})</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">alignments</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">eStep</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">init</span>,<span class="ace_identifier">trainM2</span><span class="ace_paren ace_rparen">)</span>&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_identifier">Renderer</span>.<span class="ace_identifier">renderWeightedAlignment</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">trainM2</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">_1</span>,&nbsp;<span class="ace_identifier">trainM2</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">_2</span>,&nbsp;<span class="ace_identifier">alignments</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">))</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 558.496px; top: 96px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 132px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 41px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 833px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode18" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay18" class="cell"><div class="string-result"><div id="align1a289f22-7f5a-44b2-948b-c8c293c85646" class="aligner">
<svg><g><text x="20" y="20">NULL</text><text x="60.6796875" y="20">the</text><text x="87.361328125" y="20">house</text><text x="130.056640625" y="20">is</text><text x="148.72265625" y="20">small</text></g><g><text x="20" y="100">klein</text><text x="54.6796875" y="100">ist</text><text x="76.6796875" y="100">das</text><text x="106.02734375" y="100">Haus</text></g><line x1="35.3359375" y1="22.5" x2="32.3359375" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.2"></line><line x1="69.0078125" y1="22.5" x2="32.3359375" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.2"></line><line x1="103.703125" y1="22.5" x2="32.3359375" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.2"></line><line x1="134.375" y1="22.5" x2="32.3359375" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.2"></line><line x1="162.71875" y1="22.5" x2="32.3359375" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.2"></line><line x1="35.3359375" y1="22.5" x2="60.671875" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.2"></line><line x1="69.0078125" y1="22.5" x2="60.671875" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.2"></line><line x1="103.703125" y1="22.5" x2="60.671875" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.2"></line><line x1="134.375" y1="22.5" x2="60.671875" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.2"></line><line x1="162.71875" y1="22.5" x2="60.671875" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.2"></line><line x1="35.3359375" y1="22.5" x2="86.34375" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.2"></line><line x1="69.0078125" y1="22.5" x2="86.34375" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.2"></line><line x1="103.703125" y1="22.5" x2="86.34375" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.2"></line><line x1="134.375" y1="22.5" x2="86.34375" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.2"></line><line x1="162.71875" y1="22.5" x2="86.34375" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.2"></line><line x1="35.3359375" y1="22.5" x2="120.015625" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.2"></line><line x1="69.0078125" y1="22.5" x2="120.015625" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.2"></line><line x1="103.703125" y1="22.5" x2="120.015625" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.2"></line><line x1="134.375" y1="22.5" x2="120.015625" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.2"></line><line x1="162.71875" y1="22.5" x2="120.015625" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.2"></line></svg>
</div>
<script>
  var s1Data = ["NULL","the","house","is","small"];
  var s2Data = ["klein","ist","das","Haus"];
  var connData = [{'i1':0, 'i2':0, 'weight':0.2 },{'i1':1, 'i2':0, 'weight':0.2 },{'i1':2, 'i2':0, 'weight':0.2 },{'i1':3, 'i2':0, 'weight':0.2 },{'i1':4, 'i2':0, 'weight':0.2 },{'i1':0, 'i2':1, 'weight':0.2 },{'i1':1, 'i2':1, 'weight':0.2 },{'i1':2, 'i2':1, 'weight':0.2 },{'i1':3, 'i2':1, 'weight':0.2 },{'i1':4, 'i2':1, 'weight':0.2 },{'i1':0, 'i2':2, 'weight':0.2 },{'i1':1, 'i2':2, 'weight':0.2 },{'i1':2, 'i2':2, 'weight':0.2 },{'i1':3, 'i2':2, 'weight':0.2 },{'i1':4, 'i2':2, 'weight':0.2 },{'i1':0, 'i2':3, 'weight':0.2 },{'i1':1, 'i2':3, 'weight':0.2 },{'i1':2, 'i2':3, 'weight':0.2 },{'i1':3, 'i2':3, 'weight':0.2 },{'i1':4, 'i2':3, 'weight':0.2 }]
  var svg = d3.select('#align1a289f22-7f5a-44b2-948b-c8c293c85646 svg')

  function buildSentenceGroup(parent,data,y) {
    var groupElement = parent.append("g");
    var text = groupElement.selectAll("text")
      .data(data)
      .enter()
      .append("text");
    var textLabels = text
      .attr("x",function(d) { return 0; })
      .attr("y",function(d) { return y; })
      .text(function(d) {return d;});
    var current = 20;
    var gap = 10;
    var tokenOffsets = [current];
    for (i = 0; i < textLabels[0].length - 1; i++) {
      current += textLabels[0][i].getComputedTextLength() + gap;
      tokenOffsets.push(current);
    }
    console.log(tokenOffsets);
    textLabels
      .attr("x", function(d,i) { return tokenOffsets[i];});
    return groupElement;
  }

  var s1Group = buildSentenceGroup(svg,s1Data,20);
  var s2Group = buildSentenceGroup(svg,s2Data,100);

  var s1TokenTexts = s1Group[0][0].childNodes;
  var s2TokenTexts = s2Group[0][0].childNodes;

  var connections = svg.selectAll("line")
    .data(connData)
    .enter()
    .append("line")
    .attr("x1", function(d) { return s1TokenTexts[d.i1].getBBox().x + s1TokenTexts[d.i1].getBBox().width / 2; })
    .attr("y1", function(d) { return s1TokenTexts[d.i1].getBBox().y + s1TokenTexts[d.i1].getBBox().height; })
    .attr("x2", function(d) { return s2TokenTexts[d.i2].getBBox().x + s2TokenTexts[d.i2].getBBox().width / 2; })
    .attr("y2", function(d) { return s2TokenTexts[d.i2].getBBox().y; })
    .attr("stroke-width", 2)
    .attr("stroke", "black")
    .attr("stroke-opacity", function(d) { return 0; })
    .transition()
    .attr("stroke-opacity", function(d) { return d.weight; } );

  console.log(s1Group);
  console.log(s1TokenTexts);

</script></div></div></div><div id="cell19" class="cellWrapper"><div id="editCell19" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor19" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode19" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay19" class="cell"><p>You can play around with the initialization of <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-115-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1657" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.53em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-1658"><span class="mi" id="MathJax-Span-1659" style="font-family: STIXGeneral; font-style: italic; font-weight: bold;">β</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.169em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">β</mi></math></span></span><script type="math/tex" id="MathJax-Element-115">\bbeta</script> to see how the alignments react to changes of the word-to-word translation probabilities.</p>
<div class="newslide"></div><h4>M-Step</h4>
<div class="book-start"></div><p>The M-Step optimizes a <em>weighted</em> or <em>expected</em> version of the log-likelihood of the data, using the distribution <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-116-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03C0;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1660" role="math" style="width: 0.679em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.582em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.935em 1000.58em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-1661"><span class="mi" id="MathJax-Span-1662" style="font-family: STIXGeneral-Italic;">π<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.051em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.614em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>π</mi></math></span></span><script type="math/tex" id="MathJax-Element-116">\pi</script> from the last E-Step:</p><p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-117-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;msup&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo&gt;&amp;#x2217;&lt;/mo&gt;&lt;/msup&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;munder&gt;&lt;mrow class=&quot;MJX-TeXAtom-OP&quot;&gt;&lt;mi&gt;arg&lt;/mi&gt;&lt;mspace width=&quot;thinmathspace&quot; /&gt;&lt;mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;&gt;max&lt;/mo&gt;&lt;/mrow&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/munder&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;&amp;#x2208;&lt;/mo&gt;&lt;msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;D&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;t&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;r&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;a&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;i&lt;/mi&gt;&lt;mi class=&quot;MJX-tex-mathit&quot; mathvariant=&quot;italic&quot;&gt;n&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;mi&gt;&amp;#x03C0;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;log&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mtext&gt;IBM2&lt;/mtext&gt;&lt;/msubsup&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1663" role="math" style="width: 23.384em; display: inline-block;"><span style="display: inline-block; position: relative; width: 20.341em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.403em 1020.29em 4.012em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-1664"><span class="msubsup" id="MathJax-Span-1665"><span style="display: inline-block; position: relative; width: 0.969em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.49em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1666" style="font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -4.442em; left: 0.486em;"><span class="mo" id="MathJax-Span-1667" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">∗</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1668" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">=</span><span class="munderover" id="MathJax-Span-1669" style="padding-left: 0.292em;"><span style="display: inline-block; position: relative; width: 3.384em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1003.38em 4.399em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-1670"><span class="mrow" id="MathJax-Span-1671"><span class="mi" id="MathJax-Span-1672" style="font-family: STIXGeneral-Regular;">arg</span><span class="mspace" id="MathJax-Span-1673" style="height: 0.002em; vertical-align: 0.002em; width: 0.196em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-1674" style="font-family: STIXGeneral-Regular; padding-left: 0.196em;">max</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1000.34em 4.254em -999.998em); top: -3.089em; left: 1.5em;"><span class="mi" id="MathJax-Span-1675" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1676"></span><span class="munderover" id="MathJax-Span-1677" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 3.239em; height: 0px;"><span style="position: absolute; clip: rect(2.901em 1001.21em 4.64em -999.998em); top: -4.007em; left: 0.969em;"><span class="mo" id="MathJax-Span-1678" style="font-family: STIXSizeOneSym; vertical-align: -0.529em;">∑</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1003.24em 4.399em -999.998em); top: -2.848em; left: 0.002em;"><span class="texatom" id="MathJax-Span-1679"><span class="mrow" id="MathJax-Span-1680"><span class="mo" id="MathJax-Span-1681" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-1682"><span class="mrow" id="MathJax-Span-1683"><span class="mi" id="MathJax-Span-1684" style="font-size: 70.7%; font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-1685" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-1686"><span class="mrow" id="MathJax-Span-1687"><span class="mi" id="MathJax-Span-1688" style="font-size: 70.7%; font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-1689" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-1690" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">∈</span><span class="msubsup" id="MathJax-Span-1691"><span style="display: inline-block; position: relative; width: 1.597em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1000.58em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-1692"><span class="mrow" id="MathJax-Span-1693"><span class="mi" id="MathJax-Span-1694" style="font-size: 70.7%; font-family: STIXNonUnicode-Italic;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.582em;"><span class="texatom" id="MathJax-Span-1695"><span class="mrow" id="MathJax-Span-1696"><span class="mi" id="MathJax-Span-1697" style="font-size: 50%; font-family: STIXGeneral-Italic;">t</span><span class="mi" id="MathJax-Span-1698" style="font-size: 50%; font-family: STIXGeneral-Italic;">r</span><span class="mi" id="MathJax-Span-1699" style="font-size: 50%; font-family: STIXGeneral-Italic;">a</span><span class="mi" id="MathJax-Span-1700" style="font-size: 50%; font-family: STIXGeneral-Italic;">i</span><span class="mi" id="MathJax-Span-1701" style="font-size: 50%; font-family: STIXGeneral-Italic;">n</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="munderover" id="MathJax-Span-1702" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 1.307em; height: 0px;"><span style="position: absolute; clip: rect(2.901em 1001.21em 4.64em -999.998em); top: -4.007em; left: 0.002em;"><span class="mo" id="MathJax-Span-1703" style="font-family: STIXSizeOneSym; vertical-align: -0.529em;">∑</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.529em 1000.34em 4.254em -999.998em); top: -2.848em; left: 0.486em;"><span class="texatom" id="MathJax-Span-1704"><span class="mrow" id="MathJax-Span-1705"><span class="mi" id="MathJax-Span-1706" style="font-size: 70.7%; font-family: STIXGeneral; font-weight: bold;">a</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mi" id="MathJax-Span-1707" style="font-family: STIXGeneral-Italic; padding-left: 0.196em;">π<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.051em;"></span></span><span class="mo" id="MathJax-Span-1708" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-1709"><span class="mrow" id="MathJax-Span-1710"><span class="mi" id="MathJax-Span-1711" style="font-family: STIXGeneral; font-weight: bold;">a</span></span></span><span class="texatom" id="MathJax-Span-1712"><span class="mrow" id="MathJax-Span-1713"><span class="mo" id="MathJax-Span-1714" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-1715"><span class="mrow" id="MathJax-Span-1716"><span class="mi" id="MathJax-Span-1717" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-1718" style="font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-1719" style="padding-left: 0.196em;"><span class="mrow" id="MathJax-Span-1720"><span class="mi" id="MathJax-Span-1721" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-1722" style="font-family: STIXGeneral-Regular;">)</span><span class="mi" id="MathJax-Span-1723" style="font-family: STIXGeneral-Regular; padding-left: 0.196em;">log</span><span class="mo" id="MathJax-Span-1724"></span><span class="msubsup" id="MathJax-Span-1725" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 2.273em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.49em 4.35em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1726" style="font-family: STIXGeneral-Italic;">p</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1001.79em 4.157em -999.998em); top: -4.345em; left: 0.486em;"><span class="mtext" id="MathJax-Span-1727" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">IBM2</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1000.44em 4.157em -999.998em); top: -3.669em; left: 0.486em;"><span class="mi" id="MathJax-Span-1728" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1729" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-1730"><span class="mrow" id="MathJax-Span-1731"><span class="mi" id="MathJax-Span-1732" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-1733" style="font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-1734" style="padding-left: 0.196em;"><span class="mrow" id="MathJax-Span-1735"><span class="mi" id="MathJax-Span-1736" style="font-family: STIXGeneral; font-weight: bold;">a</span></span></span><span class="texatom" id="MathJax-Span-1737"><span class="mrow" id="MathJax-Span-1738"><span class="mo" id="MathJax-Span-1739" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-1740"><span class="mrow" id="MathJax-Span-1741"><span class="mi" id="MathJax-Span-1742" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-1743" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.608em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 2.836em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><msup><mi mathvariant="bold-italic">θ</mi><mo>∗</mo></msup><mo>=</mo><munder><mrow class="MJX-TeXAtom-OP"><mi>arg</mi><mspace width="thinmathspace"></mspace><mo movablelimits="true" form="prefix">max</mo></mrow><mi mathvariant="bold-italic">θ</mi></munder><mo>⁡</mo><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo stretchy="false">)</mo><mo>∈</mo><msub><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">D</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-mathit" mathvariant="italic">t</mi><mi class="MJX-tex-mathit" mathvariant="italic">r</mi><mi class="MJX-tex-mathit" mathvariant="italic">a</mi><mi class="MJX-tex-mathit" mathvariant="italic">i</mi><mi class="MJX-tex-mathit" mathvariant="italic">n</mi></mrow></msub></mrow></munder><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow></munder><mi>π</mi><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo stretchy="false">)</mo><mi>log</mi><mo>⁡</mo><msubsup><mi>p</mi><mi mathvariant="bold-italic">θ</mi><mtext>IBM2</mtext></msubsup><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-117">  \params^* = \argmax_\params \sum_{(\target,\source) \in \train} \sum_\aligns \pi(\aligns|\target,\source) \log \prob _\params^\text{IBM2}(\source,\aligns|\target) </script></p><p>The summing over hidden alignments seems daunting, but because <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-118-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03C0;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1744" role="math" style="width: 0.679em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.582em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.935em 1000.58em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-1745"><span class="mi" id="MathJax-Span-1746" style="font-family: STIXGeneral-Italic;">π<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.051em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.614em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>π</mi></math></span></span><script type="math/tex" id="MathJax-Element-118">\pi</script> factorizes as we discussed above, we again have a simple closed-form solution:</p><p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-119-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;&amp;#x03B1;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;mi&gt;&amp;#x03C0;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;&amp;#x03B4;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mi&gt;&amp;#x03B4;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;munderover&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;/munderover&gt;&lt;mi&gt;&amp;#x03B4;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;j&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1747" role="math" style="width: 18.746em; display: inline-block;"><span style="display: inline-block; position: relative; width: 16.283em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(0.486em 1016.28em 4.012em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-1748"><span class="mi" id="MathJax-Span-1749" style="font-family: STIXGeneral-Italic;">α</span><span class="mo" id="MathJax-Span-1750" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-1751" style="font-family: STIXGeneral-Italic;">s</span><span class="texatom" id="MathJax-Span-1752"><span class="mrow" id="MathJax-Span-1753"><span class="mo" id="MathJax-Span-1754" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="mi" id="MathJax-Span-1755" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-1756" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-1757" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">=</span><span class="mfrac" id="MathJax-Span-1758" style="padding-left: 0.292em;"><span style="display: inline-block; position: relative; width: 12.708em; height: 0px; margin-right: 0.099em; margin-left: 0.099em;"><span style="position: absolute; clip: rect(2.901em 1012.51em 4.592em -999.998em); top: -4.925em; left: 50%; margin-left: -6.278em;"><span class="mrow" id="MathJax-Span-1759"><span class="munderover" id="MathJax-Span-1760"><span style="display: inline-block; position: relative; width: 2.128em; height: 0px;"><span style="position: absolute; clip: rect(3.094em 1000.87em 4.399em -999.998em); top: -4.007em; left: 0.002em;"><span class="mo" id="MathJax-Span-1761" style="font-family: STIXGeneral-Regular; vertical-align: 0.002em;">∑</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.717em; left: 0.92em;"><span class="texatom" id="MathJax-Span-1762"><span class="mrow" id="MathJax-Span-1763"><span class="mo" id="MathJax-Span-1764" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-1765"><span class="mrow" id="MathJax-Span-1766"><span class="mi" id="MathJax-Span-1767" style="font-size: 70.7%; font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-1768" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-1769"><span class="mrow" id="MathJax-Span-1770"><span class="mi" id="MathJax-Span-1771" style="font-size: 70.7%; font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-1772" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="munderover" id="MathJax-Span-1773" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 1.452em; height: 0px;"><span style="position: absolute; clip: rect(3.094em 1000.87em 4.399em -999.998em); top: -4.007em; left: 0.002em;"><span class="mo" id="MathJax-Span-1774" style="font-family: STIXGeneral-Regular; vertical-align: 0.002em;">∑</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1000.53em 4.254em -999.998em); top: -4.49em; left: 0.92em;"><span class="texatom" id="MathJax-Span-1775"><span class="mrow" id="MathJax-Span-1776"><span class="msubsup" id="MathJax-Span-1777"><span style="display: inline-block; position: relative; width: 0.437em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1000.2em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1778" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.196em;"><span class="texatom" id="MathJax-Span-1779"><span class="mrow" id="MathJax-Span-1780"><span class="mi" id="MathJax-Span-1781" style="font-size: 50%; font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1000.29em 4.157em -999.998em); top: -3.717em; left: 0.92em;"><span class="mi" id="MathJax-Span-1782" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="munderover" id="MathJax-Span-1783" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 1.403em; height: 0px;"><span style="position: absolute; clip: rect(3.094em 1000.87em 4.399em -999.998em); top: -4.007em; left: 0.002em;"><span class="mo" id="MathJax-Span-1784" style="font-family: STIXGeneral-Regular; vertical-align: 0.002em;">∑</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1000.49em 4.254em -999.998em); top: -4.49em; left: 0.92em;"><span class="texatom" id="MathJax-Span-1785"><span class="mrow" id="MathJax-Span-1786"><span class="msubsup" id="MathJax-Span-1787"><span style="display: inline-block; position: relative; width: 0.437em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1000.2em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1788" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.196em;"><span class="texatom" id="MathJax-Span-1789"><span class="mrow" id="MathJax-Span-1790"><span class="mi" id="MathJax-Span-1791" style="font-size: 50%; font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1000.29em 4.302em -999.998em); top: -3.717em; left: 0.92em;"><span class="mi" id="MathJax-Span-1792" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mi" id="MathJax-Span-1793" style="font-family: STIXGeneral-Italic; padding-left: 0.196em;">π<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.051em;"></span></span><span class="mo" id="MathJax-Span-1794" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-1795" style="font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="texatom" id="MathJax-Span-1796"><span class="mrow" id="MathJax-Span-1797"><span class="mo" id="MathJax-Span-1798" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="mi" id="MathJax-Span-1799" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-1800" style="font-family: STIXGeneral-Regular;">)</span><span class="mi" id="MathJax-Span-1801" style="font-family: STIXGeneral-Italic;">δ</span><span class="mo" id="MathJax-Span-1802" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-1803" style="font-family: STIXGeneral-Italic;">s</span><span class="mo" id="MathJax-Span-1804" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-1805" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 0.679em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.39em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1806" style="font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.389em;"><span class="mi" id="MathJax-Span-1807" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1808" style="font-family: STIXGeneral-Regular;">)</span><span class="mi" id="MathJax-Span-1809" style="font-family: STIXGeneral-Italic;">δ</span><span class="mo" id="MathJax-Span-1810" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-1811" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-1812" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-1813" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px;"><span style="position: absolute; clip: rect(3.336em 1000.29em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1814" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.292em;"><span class="mi" id="MathJax-Span-1815" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1816" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(2.901em 1006.33em 4.592em -999.998em); top: -3.089em; left: 50%; margin-left: -3.186em;"><span class="mrow" id="MathJax-Span-1817"><span class="munderover" id="MathJax-Span-1818"><span style="display: inline-block; position: relative; width: 2.128em; height: 0px;"><span style="position: absolute; clip: rect(3.094em 1000.87em 4.399em -999.998em); top: -4.007em; left: 0.002em;"><span class="mo" id="MathJax-Span-1819" style="font-family: STIXGeneral-Regular; vertical-align: 0.002em;">∑</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.717em; left: 0.92em;"><span class="texatom" id="MathJax-Span-1820"><span class="mrow" id="MathJax-Span-1821"><span class="mo" id="MathJax-Span-1822" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-1823"><span class="mrow" id="MathJax-Span-1824"><span class="mi" id="MathJax-Span-1825" style="font-size: 70.7%; font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-1826" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-1827"><span class="mrow" id="MathJax-Span-1828"><span class="mi" id="MathJax-Span-1829" style="font-size: 70.7%; font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-1830" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="munderover" id="MathJax-Span-1831" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 1.403em; height: 0px;"><span style="position: absolute; clip: rect(3.094em 1000.87em 4.399em -999.998em); top: -4.007em; left: 0.002em;"><span class="mo" id="MathJax-Span-1832" style="font-family: STIXGeneral-Regular; vertical-align: 0.002em;">∑</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1000.49em 4.254em -999.998em); top: -4.49em; left: 0.92em;"><span class="texatom" id="MathJax-Span-1833"><span class="mrow" id="MathJax-Span-1834"><span class="msubsup" id="MathJax-Span-1835"><span style="display: inline-block; position: relative; width: 0.437em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1000.2em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1836" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.911em; left: 0.196em;"><span class="texatom" id="MathJax-Span-1837"><span class="mrow" id="MathJax-Span-1838"><span class="mi" id="MathJax-Span-1839" style="font-size: 50%; font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1000.29em 4.302em -999.998em); top: -3.717em; left: 0.92em;"><span class="mi" id="MathJax-Span-1840" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mi" id="MathJax-Span-1841" style="font-family: STIXGeneral-Italic; padding-left: 0.196em;">δ</span><span class="mo" id="MathJax-Span-1842" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-1843" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-1844" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-1845" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px;"><span style="position: absolute; clip: rect(3.336em 1000.29em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-1846" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.292em;"><span class="mi" id="MathJax-Span-1847" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-1848" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(0.872em 1012.71em 1.21em -999.998em); top: -1.302em; left: 0.002em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0.002em; border-top-width: 1.3px; border-top-style: solid; width: 12.708em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.065em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.608em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 3.836em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>α</mi><mo stretchy="false">(</mo><mi>s</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><mfrac><mrow><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo stretchy="false">)</mo></mrow></munder><munderover><mo>∑</mo><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>l</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow></msub></mrow></munderover><munderover><mo>∑</mo><mi>j</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>l</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow></msub></mrow></munderover><mi>π</mi><mo stretchy="false">(</mo><mi>j</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>i</mi><mo stretchy="false">)</mo><mi>δ</mi><mo stretchy="false">(</mo><mi>s</mi><mo>,</mo><msub><mi>s</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mi>δ</mi><mo stretchy="false">(</mo><mi>t</mi><mo>,</mo><msub><mi>t</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow><mrow><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo stretchy="false">)</mo></mrow></munder><munderover><mo>∑</mo><mi>j</mi><mrow class="MJX-TeXAtom-ORD"><msub><mi>l</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow></msub></mrow></munderover><mi>δ</mi><mo stretchy="false">(</mo><mi>t</mi><mo>,</mo><msub><mi>t</mi><mi>j</mi></msub><mo stretchy="false">)</mo></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-119">  \alpha(\ssource|\starget) = \frac  {\sum_{(\target,\source)}\sum_i^{l_\source} \sum_j^{l_\target} \pi(j|i) \delta(\ssource,\ssource_i) \delta(\starget,\starget_j) }  {\sum_{(\target,\source)} \sum_j^{l_\target} \delta(\starget,\starget_j) } </script></p><p>where <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-120-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B4;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1849" role="math" style="width: 2.853em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.466em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1002.42em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-1850"><span class="mi" id="MathJax-Span-1851" style="font-family: STIXGeneral-Italic;">δ</span><span class="mo" id="MathJax-Span-1852" style="font-family: STIXGeneral-Regular;">(</span><span class="mi" id="MathJax-Span-1853" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-1854" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-1855" style="font-family: STIXGeneral-Italic; padding-left: 0.196em;">y</span><span class="mo" id="MathJax-Span-1856" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>δ</mi><mo stretchy="false">(</mo><mi>x</mi><mo>,</mo><mi>y</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-120">\delta(x,y)</script> is 1 if <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-121-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1857" role="math" style="width: 2.514em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.176em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.935em 1002.18em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-1858"><span class="mi" id="MathJax-Span-1859" style="font-family: STIXGeneral-Italic;">x<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-1860" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">=</span><span class="mi" id="MathJax-Span-1861" style="font-family: STIXGeneral-Italic; padding-left: 0.292em;">y</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.836em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>=</mo><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-121">x=y</script> and 0 otherwise. The updates for <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-122-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1862" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.53em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-1863"><span class="mi" id="MathJax-Span-1864" style="font-family: STIXGeneral-Italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.114em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>β</mi></math></span></span><script type="math/tex" id="MathJax-Element-122">\beta</script> are similar. </p>



<div class="slide-end"></div>
<div class="newslide"></div><p>Let us implement the M-Step now. In this step we estimate parameters <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-127-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2061" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.53em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-2062"><span class="mi" id="MathJax-Span-2063" style="font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.947em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-127">\params</script> from a given set of (soft) alignments <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-128-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2064" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.886em 1000.53em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-2065"><span class="texatom" id="MathJax-Span-2066"><span class="mrow" id="MathJax-Span-2067"><span class="mi" id="MathJax-Span-2068" style="font-family: STIXGeneral; font-weight: bold;">a</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-128">\aligns</script>. </p></div></div><div id="cell20" class="cellWrapper"><div id="editCell20" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor20" class="cell editor ace_editor ace-chaos ace_dark" style="height: 308px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 16px; width: 7.20125px; left: 52px; top: 282px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 340px; width: 48px;"><div class="ace_gutter-cell " style="height: 16px;">1<span class="ace_fold-widget ace_start ace_open" style="height: 16px;"></span></div><div class="ace_gutter-cell " style="height: 16px;">2</div><div class="ace_gutter-cell " style="height: 16px;">3</div><div class="ace_gutter-cell " style="height: 16px;">4</div><div class="ace_gutter-cell " style="height: 16px;">5</div><div class="ace_gutter-cell " style="height: 16px;">6<span class="ace_fold-widget ace_start ace_open" style="height: 16px;"></span></div><div class="ace_gutter-cell " style="height: 16px;">7<span class="ace_fold-widget ace_start ace_open" style="height: 16px;"></span></div><div class="ace_gutter-cell " style="height: 16px;">8</div><div class="ace_gutter-cell " style="height: 16px;">9</div><div class="ace_gutter-cell " style="height: 16px;">10</div><div class="ace_gutter-cell " style="height: 16px;">11</div><div class="ace_gutter-cell " style="height: 16px;">12</div><div class="ace_gutter-cell " style="height: 16px;">13</div><div class="ace_gutter-cell " style="height: 16px;">14</div><div class="ace_gutter-cell " style="height: 16px;">15</div><div class="ace_gutter-cell " style="height: 16px;">16</div><div class="ace_gutter-cell " style="height: 16px;">17</div><div class="ace_gutter-cell " style="height: 16px;">18</div></div><div class="ace_gutter-active-line" style="top: 282px; height: 16px;"></div></div><div class="ace_scroller" style="left: 48px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 826px; height: 340px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">mStep</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">aligns</span>:<span class="ace_support ace_function">Seq</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">Align</span><span class="ace_paren ace_rparen">]</span>,<span class="ace_identifier">data</span>:<span class="ace_support ace_function">Seq</span><span class="ace_paren ace_lparen">[(</span><span class="ace_identifier">Sentence</span>,<span class="ace_identifier">Sentence</span><span class="ace_paren ace_rparen">)])</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">alpha</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_keyword">new</span>&nbsp;<span class="ace_identifier">HashMap</span><span class="ace_paren ace_lparen">[(</span><span class="ace_support ace_function">String</span>,<span class="ace_support ace_function">String</span><span class="ace_paren ace_rparen">)</span>,<span class="ace_support ace_function">Double</span><span class="ace_paren ace_rparen">]</span>&nbsp;<span class="ace_identifier">withDefaultValue</span>&nbsp;<span class="ace_constant ace_numeric">0.0</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">alphaNorm</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_keyword">new</span>&nbsp;<span class="ace_identifier">HashMap</span><span class="ace_paren ace_lparen">[</span><span class="ace_support ace_function">String</span>,<span class="ace_support ace_function">Double</span><span class="ace_paren ace_rparen">]</span>&nbsp;<span class="ace_identifier">withDefaultValue</span>&nbsp;<span class="ace_constant ace_numeric">0.0</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">beta</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_keyword">new</span>&nbsp;<span class="ace_identifier">HashMap</span><span class="ace_paren ace_lparen">[(</span><span class="ace_support ace_function">Int</span>,<span class="ace_support ace_function">Int</span>,<span class="ace_support ace_function">Int</span>,<span class="ace_support ace_function">Int</span><span class="ace_paren ace_rparen">)</span>,<span class="ace_support ace_function">Double</span><span class="ace_paren ace_rparen">]</span>&nbsp;<span class="ace_identifier">withDefaultValue</span>&nbsp;<span class="ace_constant ace_numeric">0.0</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">betaNorm</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_keyword">new</span>&nbsp;<span class="ace_identifier">HashMap</span><span class="ace_paren ace_lparen">[(</span><span class="ace_support ace_function">Int</span>,<span class="ace_support ace_function">Int</span>,<span class="ace_support ace_function">Int</span><span class="ace_paren ace_rparen">)</span>,<span class="ace_support ace_function">Double</span><span class="ace_paren ace_rparen">]</span>&nbsp;<span class="ace_identifier">withDefaultValue</span>&nbsp;<span class="ace_constant ace_numeric">0.0</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">for</span>&nbsp;<span class="ace_paren ace_lparen">((</span><span class="ace_identifier">pi</span>,<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span>,<span class="ace_identifier">s</span><span class="ace_paren ace_rparen">))</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_identifier">aligns</span>&nbsp;<span class="ace_identifier">zip</span>&nbsp;<span class="ace_identifier">data</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">for</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ti</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_identifier">t</span>.<span class="ace_identifier">tokens</span>.<span class="ace_identifier">indices</span>;&nbsp;<span class="ace_identifier">si</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_identifier">s</span>.<span class="ace_identifier">tokens</span>.<span class="ace_identifier">indices</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_identifier">alpha</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">s</span>.<span class="ace_identifier">tokens</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">si</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">word</span>,<span class="ace_identifier">t</span>.<span class="ace_identifier">tokens</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ti</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">word</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">+=</span>&nbsp;<span class="ace_identifier">pi</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">si</span><span class="ace_paren ace_rparen">)</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ti</span><span class="ace_paren ace_rparen">)</span>&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_identifier">alphaNorm</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span>.<span class="ace_identifier">tokens</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ti</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">word</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">+=</span>&nbsp;<span class="ace_identifier">pi</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">si</span><span class="ace_paren ace_rparen">)</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ti</span><span class="ace_paren ace_rparen">)</span>&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_identifier">beta</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ti</span>,<span class="ace_identifier">si</span>,<span class="ace_identifier">t</span>.<span class="ace_identifier">tokens</span>.<span class="ace_identifier">length</span>,<span class="ace_identifier">s</span>.<span class="ace_identifier">tokens</span>.<span class="ace_identifier">length</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">+=</span>&nbsp;<span class="ace_identifier">pi</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">si</span><span class="ace_paren ace_rparen">)</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ti</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_identifier">betaNorm</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">si</span>,<span class="ace_identifier">t</span>.<span class="ace_identifier">tokens</span>.<span class="ace_identifier">length</span>,<span class="ace_identifier">s</span>.<span class="ace_identifier">tokens</span>.<span class="ace_identifier">length</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">+=</span>&nbsp;<span class="ace_identifier">pi</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">si</span><span class="ace_paren ace_rparen">)</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ti</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span>&nbsp;&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_identifier">Model</span><span class="ace_paren ace_lparen">(</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">alpha</span>.<span class="ace_identifier">toMap</span>&nbsp;<span class="ace_identifier">map</span>&nbsp;<span class="ace_paren ace_lparen">{</span><span class="ace_keyword">case</span>&nbsp;<span class="ace_paren ace_lparen">((</span><span class="ace_identifier">s</span>,<span class="ace_identifier">t</span><span class="ace_paren ace_rparen">)</span>,<span class="ace_identifier">p</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_paren ace_lparen">((</span><span class="ace_identifier">s</span>,<span class="ace_identifier">t</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_identifier">p</span>&nbsp;/&nbsp;<span class="ace_identifier">alphaNorm</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span><span class="ace_paren ace_rparen">))}</span>&nbsp;<span class="ace_identifier">withDefaultValue</span>&nbsp;<span class="ace_constant ace_numeric">0.0</span>,</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">beta</span>.<span class="ace_identifier">toMap</span>&nbsp;<span class="ace_identifier">map</span>&nbsp;<span class="ace_paren ace_lparen">{</span><span class="ace_keyword">case</span>&nbsp;<span class="ace_paren ace_lparen">((</span><span class="ace_identifier">ti</span>,<span class="ace_identifier">si</span>,<span class="ace_identifier">ls</span>,<span class="ace_identifier">lt</span><span class="ace_paren ace_rparen">)</span>,<span class="ace_identifier">p</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_paren ace_lparen">((</span><span class="ace_identifier">ti</span>,<span class="ace_identifier">si</span>,<span class="ace_identifier">ls</span>,<span class="ace_identifier">lt</span><span class="ace_paren ace_rparen">)</span>,<span class="ace_identifier">p</span>&nbsp;/&nbsp;<span class="ace_identifier">betaNorm</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">si</span>,<span class="ace_identifier">ls</span>,<span class="ace_identifier">lt</span><span class="ace_paren ace_rparen">))}</span>&nbsp;<span class="ace_identifier">withDefaultValue</span>&nbsp;<span class="ace_constant ace_numeric">0.0</span><span class="ace_paren ace_rparen">)</span>&nbsp;&nbsp;&nbsp;&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_paren ace_rparen">}</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 4px; top: 272px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 308px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 48px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 826px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode20" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay20" class="cell" style="display: none;"><div class="text-center"><i class="fa fa-refresh fa-spin fa-lg"></i></div></div></div><div id="cell21" class="cellWrapper"><div id="editCell21" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor21" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode21" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay21" class="cell"><div class="newslide"></div><p>Let us run one M-Step on the alignments we estimated earlier.</p></div></div><div id="cell22" class="cellWrapper"><div id="editCell22" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor22" class="cell editor ace_editor ace-chaos ace_dark" style="height: 52px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 16px; width: 7.20125px; left: 376.257px; top: 26px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 84px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div><div class="ace_gutter-cell " style="height: 16px;">2</div></div><div class="ace_gutter-active-line" style="top: 26px; height: 16px;"></div></div><div class="ace_scroller" style="left: 41px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 833px; height: 84px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"><div class="ace_bracket ace_start" style="height:16px;width:7.20125px;top:16px;left:61.61px;"></div></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">theta1</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">mStep</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">alignments</span>,<span class="ace_identifier">trainM2</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_identifier">barChart</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">theta1</span>.<span class="ace_identifier">alpha</span>.<span class="ace_identifier">filter</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">_1</span>.<span class="ace_identifier">_2</span>&nbsp;<span class="ace_keyword ace_operator">==</span>&nbsp;<span class="ace_string">"is"</span><span class="ace_paren ace_rparen">))</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 335.257px; top: 16px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 52px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 41px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 833px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode22" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay22" class="cell"><div class="string-result"><div id="d3bar1871624212" class="wolfe-nvd3">
<svg class="nvd3-svg"><g class="nvd3 nv-wrap nv-discreteBarWithAxes"><g transform="translate(60,15)"><defs><clippath id="nv-x-label-clip-8835"><rect width="121.1881188118812" height="16" x="-60.5940594059406"></rect></clippath></defs><g class="nv-x nv-axis nvd3-svg" transform="translate(0,85)"><g class="nvd3 nv-wrap nv-axis"><g><g class="tick zero" transform="translate(37.02970297029703,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,5)" x="0" style="text-anchor: middle;">(Haus,is)</text></g><g class="tick zero" transform="translate(104.35643564356437,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,17)" x="0" style="text-anchor: middle;">(ein,is)</text></g><g class="tick zero" transform="translate(171.68316831683168,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,5)" x="0" style="text-anchor: middle;">(groß,is)</text></g><g class="tick zero" transform="translate(239.00990099009903,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,17)" x="0" style="text-anchor: middle;">(mein,is)</text></g><g class="tick zero" transform="translate(306.33663366336634,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,5)" x="0" style="text-anchor: middle;">(das,is)</text></g><g class="tick zero" transform="translate(373.66336633663366,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,17)" x="0" style="text-anchor: middle;">(klein,is)</text></g><g class="tick zero" transform="translate(440.99009900990103,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,5)" x="0" style="text-anchor: middle;">(lang,is)</text></g><g class="tick zero" transform="translate(508.31683168316835,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,17)" x="0" style="text-anchor: middle;">(Gebäude,is)</text></g><g class="tick zero" transform="translate(575.6435643564357,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,5)" x="0" style="text-anchor: middle;">(Mann,is)</text></g><g class="tick zero" transform="translate(642.970297029703,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,17)" x="0" style="text-anchor: middle;">(ist,is)</text></g><path class="domain" d="M0,0V0H680V0"></path><text class="nv-axislabel" text-anchor="middle" y="36" x="340" transform="translate(0,17)"></text></g></g></g><g class="nv-y nv-axis nvd3-svg"><g class="nv-zeroLine"><line x1="0" x2="680" y1="85" y2="85"></line></g><g class="nvd3 nv-wrap nv-axis"><g><g class="tick zero" transform="translate(0,85)" style="opacity: 1;"><line x2="680" y2="0"></line><text dy=".32em" x="-3" opacity="0" style="text-anchor: end;" y="0">0.0</text></g><g class="tick" transform="translate(0,55.79999999999999)" style="opacity: 1;"><line x2="680" y2="0"></line><text dy=".32em" x="-3" opacity="1" style="text-anchor: end;" y="0">0.1</text></g><g class="tick" transform="translate(0,26.59999999999998)" style="opacity: 1;"><line x2="680" y2="0"></line><text dy=".32em" x="-3" opacity="1" style="text-anchor: end;" y="0">0.2</text></g><path class="domain" d="M0,12H0V85H0"></path><text class="nv-axislabel" transform="rotate(-90)" y="-50" x="-42.5" style="text-anchor: middle;"></text></g><g class="nv-axisMaxMin nv-axisMaxMin-y nv-axisMin-y" transform="translate(0,85)"><text dy=".32em" y="0" x="-3" text-anchor="end" style="opacity: 1;">0.0</text></g><g class="nv-axisMaxMin nv-axisMaxMin-y nv-axisMax-y" transform="translate(0,12)"><text dy=".32em" y="0" x="-3" text-anchor="end" style="opacity: 1;">0.2</text></g></g></g><g class="nv-barsWrap nvd3-svg"><g class="nvd3 nv-wrap nv-discretebar" transform="translate(0,0)"><g><g class="nv-groups"><g class="nv-group nv-series-0" style="stroke-opacity: 1; fill-opacity: 0.75;"><g transform="translate(9.762375831604004,55.79999923706055)" class="nv-bar positive" style="fill: rgb(31, 119, 180); stroke: rgb(31, 119, 180);"><rect height="29.200000000000003" width="54.53465346534654" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="27.26732673267327">0.10</text></g><g transform="translate(77.089111328125,70.4000015258789)" class="nv-bar positive" style="fill: rgb(174, 199, 232); stroke: rgb(174, 199, 232);"><rect height="14.599999999999994" width="54.53465346534654" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="27.26732673267327">0.05</text></g><g transform="translate(144.4158477783203,55.79999923706055)" class="nv-bar positive" style="fill: rgb(255, 127, 14); stroke: rgb(255, 127, 14);"><rect height="29.200000000000003" width="54.53465346534654" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="27.26732673267327">0.10</text></g><g transform="translate(211.74256896972656,70.4000015258789)" class="nv-bar positive" style="fill: rgb(255, 187, 120); stroke: rgb(255, 187, 120);"><rect height="14.599999999999994" width="54.53465346534654" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="27.26732673267327">0.05</text></g><g transform="translate(279.0693054199219,41.20000076293945)" class="nv-bar positive" style="fill: rgb(44, 160, 44); stroke: rgb(44, 160, 44);"><rect height="43.800000000000004" width="54.53465346534654" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="27.26732673267327">0.15</text></g><g transform="translate(346.3960266113281,55.79999923706055)" class="nv-bar positive" style="fill: rgb(152, 223, 138); stroke: rgb(152, 223, 138);"><rect height="29.200000000000003" width="54.53465346534654" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="27.26732673267327">0.10</text></g><g transform="translate(413.7227783203125,70.4000015258789)" class="nv-bar positive" style="fill: rgb(214, 39, 40); stroke: rgb(214, 39, 40);"><rect height="14.599999999999994" width="54.53465346534654" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="27.26732673267327">0.05</text></g><g transform="translate(481.04949951171875,55.79999923706055)" class="nv-bar positive" style="fill: rgb(255, 152, 150); stroke: rgb(255, 152, 150);"><rect height="29.200000000000003" width="54.53465346534654" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="27.26732673267327">0.10</text></g><g transform="translate(548.376220703125,70.4000015258789)" class="nv-bar positive" style="fill: rgb(148, 103, 189); stroke: rgb(148, 103, 189);"><rect height="14.599999999999994" width="54.53465346534654" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="27.26732673267327">0.05</text></g><g transform="translate(615.7029418945312,12)" class="nv-bar positive" style="fill: rgb(197, 176, 213); stroke: rgb(197, 176, 213);"><rect height="73" width="54.53465346534654" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="27.26732673267327">0.25</text></g></g></g></g></g></g></g></g></svg>
</div>

<script>
console.log("Clearing svg");
$('#d3bar1871624212 svg').empty();
console.log(d3.select('#d3bar1871624212 svg').length);
console.log("Calling addGraph");
/*These lines are all chart setup.  Pick and choose which chart features you want to utilize. */

  nv.addGraph(function() {
  var chart = nv.models.discreteBarChart()
      .x(function(d) { return d.label })    //Specify the data accessors.
      .y(function(d) { return d.value })
      .staggerLabels(true)    //Too many bars and not enough room? Try staggering labels.
      .tooltips(false)        //Don't show tooltips
      .showValues(true)       //...instead, show the bar value right on top of each bar.

      ;
  console.log(chart);
  console.log("Inside addGraph");
  console.log(d3.select('#d3bar1871624212 svg'));
  d3.select('#d3bar1871624212 svg')
      .datum(
[{
key: "Whatever",
values: [{label:"(Haus,is)", value:0.09999999999999998},{label:"(ein,is)", value:0.04999999999999999},{label:"(groß,is)", value:0.09999999999999998},{label:"(mein,is)", value:0.04999999999999999},{label:"(das,is)", value:0.15},{label:"(klein,is)", value:0.09999999999999998},{label:"(lang,is)", value:0.04999999999999999},{label:"(Gebäude,is)", value:0.09999999999999998},{label:"(Mann,is)", value:0.04999999999999999},{label:"(ist,is)", value:0.24999999999999994}],
}]
    )
      .transition().duration(350)
      .call(chart);

  nv.utils.windowResize(chart.update);

  return chart;
});
</script></div></div></div><div id="cell23" class="cellWrapper"><div id="editCell23" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor23" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode23" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay23" class="cell"><p>Notice that the algorithm already figured out that "is" is most likely translated to "ist". This is because it is (softly) aligned with "is" in every sentence, whereas other German words only appear in a subset of the sentences.</p></div></div><div id="cell24" class="cellWrapper"><div id="editCell24" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor24" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode24" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay24" class="cell"><div class="newslide"></div><h4>Initialization (IBM Model 1)</h4><p>We could already iteratively call <code>eStep</code> and <code>mStep</code>until convergence. However, a crucial question is how to initialize the model parameters for the first call to 'eStep'. So far we used a uniform initialization, but given that the EM algorithm's results usually depend significantly on initialization, using a more informed starting point can be useful. <span class="summary">Due to non-convexity of the EM bound, good initialization is crucial. </span></p>
<div class="newslide"></div><p>A common way to initialize EM for IBM Model 2 training is to first train the so called IBM Model 1 using EM. This model really is an instantiation of Model 2 with a specific and <strong>fixed</strong> alignment parameter set <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-129-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2069" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.53em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-2070"><span class="mi" id="MathJax-Span-2071" style="font-family: STIXGeneral; font-style: italic; font-weight: bold;">β</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.169em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">β</mi></math></span></span><script type="math/tex" id="MathJax-Element-129">\bbeta</script>. Instead of estimating <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-130-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2072" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.53em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-2073"><span class="mi" id="MathJax-Span-2074" style="font-family: STIXGeneral; font-style: italic; font-weight: bold;">β</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.169em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">β</mi></math></span></span><script type="math/tex" id="MathJax-Element-130">\bbeta</script> it is set to assign uniform probability to all target tokens with respect to a given length: <span class="summary">We can train <strong>IBM Model 1</strong>, which fixes the distortion parameters <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-131-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2075" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.53em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-2076"><span class="mi" id="MathJax-Span-2077" style="font-family: STIXGeneral; font-style: italic; font-weight: bold;">β</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.169em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">β</mi></math></span></span><script type="math/tex" id="MathJax-Element-131">\bbeta</script> to be uniform:</span></p><p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-132-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;&amp;#x03B2;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/msub&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2078" role="math" style="width: 9.616em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.36em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.017em 1008.36em 3.481em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-2079"><span class="mi" id="MathJax-Span-2080" style="font-family: STIXGeneral-Italic;">β<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-2081" style="font-family: STIXGeneral-Regular;">(</span><span class="msubsup" id="MathJax-Span-2082"><span style="display: inline-block; position: relative; width: 0.775em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.49em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-2083" style="font-family: STIXGeneral-Italic;">a</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.486em;"><span class="mi" id="MathJax-Span-2084" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="texatom" id="MathJax-Span-2085"><span class="mrow" id="MathJax-Span-2086"><span class="mo" id="MathJax-Span-2087" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="mi" id="MathJax-Span-2088" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-2089" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-2090" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 0.582em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.29em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-2091" style="font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.292em;"><span class="mi" id="MathJax-Span-2092" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-2093" style="font-family: STIXGeneral-Regular;">,</span><span class="msubsup" id="MathJax-Span-2094" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 0.63em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.29em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-2095" style="font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.292em;"><span class="mi" id="MathJax-Span-2096" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">s</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-2097" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-2098" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">=</span><span class="mfrac" id="MathJax-Span-2099" style="padding-left: 0.292em;"><span style="display: inline-block; position: relative; width: 2.37em; height: 0px; margin-right: 0.099em; margin-left: 0.099em;"><span style="position: absolute; clip: rect(3.191em 1000.39em 4.157em -999.998em); top: -4.684em; left: 50%; margin-left: -0.239em;"><span class="mn" id="MathJax-Span-2100" style="font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.191em 1002.13em 4.302em -999.998em); top: -3.331em; left: 50%; margin-left: -1.109em;"><span class="mrow" id="MathJax-Span-2101"><span class="msubsup" id="MathJax-Span-2102"><span style="display: inline-block; position: relative; width: 0.582em; height: 0px;"><span style="position: absolute; clip: rect(3.191em 1000.29em 4.157em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-2103" style="font-family: STIXGeneral-Italic;">l<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; top: -3.862em; left: 0.292em;"><span class="mi" id="MathJax-Span-2104" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-2105" style="font-family: STIXGeneral-Regular; padding-left: 0.244em;">+</span><span class="mn" id="MathJax-Span-2106" style="font-family: STIXGeneral-Regular; padding-left: 0.244em;">1</span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(0.872em 1002.37em 1.21em -999.998em); top: -1.302em; left: 0.002em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0.002em; border-top-width: 1.3px; border-top-style: solid; width: 2.37em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.065em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.997em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 2.614em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>β</mi><mo stretchy="false">(</mo><msub><mi>a</mi><mi>i</mi></msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>i</mi><mo>,</mo><msub><mi>l</mi><mi>t</mi></msub><mo>,</mo><msub><mi>l</mi><mi>s</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mfrac><mn>1</mn><mrow><msub><mi>l</mi><mi>t</mi></msub><mo>+</mo><mn>1</mn></mrow></mfrac></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-132">  \beta(a_i|i,l_\starget,l_\ssource) = \frac{1}{l_\starget + 1} </script></p><p>After training the parameters <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-133-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2107" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.53em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-2108"><span class="mi" id="MathJax-Span-2109" style="font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.947em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">θ</mi></math></span></span><script type="math/tex" id="MathJax-Element-133">\params</script> of Model 1 can be used to initialize EM for Model 2. </p>
<div class="newslide"></div><p>Training Model 1 using EM could have the same initialization problem. Fortunately it turns out that with <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-134-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2110" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.53em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-2111"><span class="mi" id="MathJax-Span-2112" style="font-family: STIXGeneral; font-style: italic; font-weight: bold;">β</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.169em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">β</mi></math></span></span><script type="math/tex" id="MathJax-Element-134">\bbeta</script> fixed in this way it can be shown, under mild conditions, that EM will converge to a global optimum, making IBM Model 1 robust to choices of initialization. <span class="summary">EM for IBM Model 1 converges to a global optimum.</span></p>
<div class="newslide"></div><p>Let us train IBM Model 1 now. This amounts to using our previous <code>eStep</code> and <code>mStep</code> methods, initializing <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-135-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B2;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2113" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.53em 2.853em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-2114"><span class="mi" id="MathJax-Span-2115" style="font-family: STIXGeneral; font-style: italic; font-weight: bold;">β</span></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.275em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 1.169em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="bold-italic">β</mi></math></span></span><script type="math/tex" id="MathJax-Element-135">\bbeta</script> as above and not updating it during <code>mStep</code>. </p></div></div><div id="cell25" class="cellWrapper"><div id="editCell25" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor25" class="cell editor ace_editor ace-chaos ace_dark" style="height: 276px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 16px; width: 7.20125px; left: 66.4025px; top: 250px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 308px; width: 48px;"><div class="ace_gutter-cell " style="height: 16px;">1<span class="ace_fold-widget ace_start ace_open" style="height: 16px;"></span></div><div class="ace_gutter-cell " style="height: 16px;">2</div><div class="ace_gutter-cell " style="height: 16px;">3</div><div class="ace_gutter-cell " style="height: 16px;">4</div><div class="ace_gutter-cell " style="height: 16px;">5</div><div class="ace_gutter-cell " style="height: 16px;">6</div><div class="ace_gutter-cell " style="height: 16px;">7<span class="ace_fold-widget ace_start ace_open" style="height: 16px;"></span></div><div class="ace_gutter-cell " style="height: 16px;">8</div><div class="ace_gutter-cell " style="height: 16px;">9</div><div class="ace_gutter-cell " style="height: 16px;">10<span class="ace_fold-widget ace_start ace_open" style="height: 16px;"></span></div><div class="ace_gutter-cell " style="height: 16px;">11</div><div class="ace_gutter-cell " style="height: 16px;">12</div><div class="ace_gutter-cell " style="height: 16px;">13</div><div class="ace_gutter-cell " style="height: 16px;">14</div><div class="ace_gutter-cell " style="height: 16px;">15</div><div class="ace_gutter-cell " style="height: 16px;">16</div></div><div class="ace_gutter-active-line" style="top: 250px; height: 16px;"></div></div><div class="ace_scroller" style="left: 48px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 826px; height: 308px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">change</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">a1</span>:<span class="ace_support ace_function">Seq</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">Align</span><span class="ace_paren ace_rparen">]</span>,<span class="ace_identifier">a2</span>:<span class="ace_support ace_function">Seq</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">Align</span><span class="ace_paren ace_rparen">])</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">flatA1</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">a1</span>.<span class="ace_identifier">flatMap</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">flatten</span><span class="ace_paren ace_rparen">)</span>&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">flatA2</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">a2</span>.<span class="ace_identifier">flatMap</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">flatten</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">diffs</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">flatA1</span>&nbsp;<span class="ace_identifier">zip</span>&nbsp;<span class="ace_identifier">flatA2</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_identifier">map</span>&nbsp;<span class="ace_paren ace_lparen">{</span><span class="ace_keyword">case</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">p1</span>,<span class="ace_identifier">p2</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_identifier">math</span>.<span class="ace_identifier">abs</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">p1</span>&nbsp;<span class="ace_keyword ace_operator">-</span>&nbsp;<span class="ace_identifier">p2</span><span class="ace_paren ace_rparen">)}</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_identifier">diffs</span>.<span class="ace_identifier">sum</span>&nbsp;/&nbsp;<span class="ace_identifier">flatA1</span>.<span class="ace_identifier">length</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_paren ace_rparen">}</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">emModel1</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">init</span>:<span class="ace_identifier">Model</span>,&nbsp;<span class="ace_identifier">data</span>:<span class="ace_support ace_function">Seq</span><span class="ace_paren ace_lparen">[(</span><span class="ace_identifier">Sentence</span>,<span class="ace_identifier">Sentence</span><span class="ace_paren ace_rparen">)]</span>,&nbsp;<span class="ace_identifier">iterations</span>:<span class="ace_support ace_function">Int</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">var</span>&nbsp;<span class="ace_identifier">model</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">init</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">var</span>&nbsp;<span class="ace_identifier">alignments</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">data</span>.<span class="ace_identifier">map</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">d</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_identifier">d</span>.<span class="ace_identifier">_2</span>.<span class="ace_identifier">tokens</span>.<span class="ace_identifier">map</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_identifier">d</span>.<span class="ace_identifier">_1</span>.<span class="ace_identifier">tokens</span>.<span class="ace_identifier">map</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_constant ace_numeric">0.0</span><span class="ace_paren ace_rparen">)))</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">for</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_constant ace_numeric">0</span>&nbsp;<span class="ace_identifier">until</span>&nbsp;<span class="ace_identifier">iterations</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword">yield</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">old</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">alignments</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">alignments</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">eStep</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">model</span>,&nbsp;<span class="ace_identifier">data</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">model</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">mStep</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">alignments</span>,&nbsp;<span class="ace_identifier">data</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">copy</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">beta</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">init</span>.<span class="ace_identifier">beta</span><span class="ace_paren ace_rparen">)</span>&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">alignments</span>,<span class="ace_identifier">model</span>,<span class="ace_identifier">change</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">old</span>,<span class="ace_identifier">alignments</span><span class="ace_paren ace_rparen">))</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_paren ace_rparen">}</span>&nbsp;</div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 18.4025px; top: 240px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 276px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 48px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 826px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode25" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay25" class="cell" style="display: none;"><div class="text-center"><i class="fa fa-refresh fa-spin fa-lg"></i></div></div></div><div id="cell26" class="cellWrapper"><div id="editCell26" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor26" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode26" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay26" class="cell"><div class="newslide"></div><p>You can see below that the alignments converge relatively quickly. </p></div></div><div id="cell27" class="cellWrapper"><div id="editCell27" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor27" class="cell editor ace_editor ace-chaos ace_dark" style="height: 68px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 16px; width: 7.20125px; left: 174.623px; top: 42px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 100px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div><div class="ace_gutter-cell " style="height: 16px;">2</div><div class="ace_gutter-cell " style="height: 16px;">3</div></div><div class="ace_gutter-active-line" style="top: 42px; height: 16px;"></div></div><div class="ace_scroller" style="left: 41px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 833px; height: 100px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">ibm1Iterations</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">emModel1</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">init</span>,&nbsp;<span class="ace_identifier">trainM2</span>,&nbsp;<span class="ace_constant ace_numeric">100</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">xyData</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">ibm1Iterations</span>.<span class="ace_identifier">indices</span>.<span class="ace_identifier">map</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">toDouble</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_identifier">ibm1Iterations</span>.<span class="ace_identifier">map</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">_3</span><span class="ace_paren ace_rparen">)</span>&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_identifier">lineplot</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">xyData</span><span class="ace_paren ace_rparen">)</span>&nbsp;&nbsp;</div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 133.623px; top: 32px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 68px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 41px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 833px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode27" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay27" class="cell"><div class="string-result"><div id="d3line893332492">
<svg class="nvd3-svg"><g class="nvd3 nv-wrap nv-lineChart" transform="translate(100,30)"><g><rect width="550" height="320" style="opacity: 0;"></rect><g class="nv-x nv-axis nvd3-svg" transform="translate(0,320)"><g class="nvd3 nv-wrap nv-axis"><g><g class="tick zero" transform="translate(0,0)" style="opacity: 1;"><line y2="-320" x2="0"></line></g><g class="tick" transform="translate(111.11111111111111,0)" style="opacity: 1;"><line y2="-320" x2="0"></line><text dy=".71em" y="7" x="0" style="text-anchor: middle;">20.00</text></g><g class="tick" transform="translate(222.22222222222223,0)" style="opacity: 1;"><line y2="-320" x2="0"></line><text dy=".71em" y="7" x="0" style="text-anchor: middle;">40.00</text></g><g class="tick" transform="translate(333.3333333333333,0)" style="opacity: 1;"><line y2="-320" x2="0"></line><text dy=".71em" y="7" x="0" style="text-anchor: middle;">60.00</text></g><g class="tick" transform="translate(444.44444444444446,0)" style="opacity: 1;"><line y2="-320" x2="0"></line><text dy=".71em" y="7" x="0" style="text-anchor: middle;">80.00</text></g><path class="domain" d="M0,0V0H550V0"></path><text class="nv-axislabel" text-anchor="middle" y="36" x="275">X</text></g><g class="nv-axisMaxMin nv-axisMaxMin-x nv-axisMin-x" transform="translate(0,0)"><text dy=".71em" y="7" transform="" style="text-anchor: middle;">0.00</text></g><g class="nv-axisMaxMin nv-axisMaxMin-x nv-axisMax-x" transform="translate(550,0)"><text dy=".71em" y="7" transform="" style="text-anchor: middle;">99.00</text></g></g></g><g class="nv-y nv-axis nvd3-svg"><g class="nvd3 nv-wrap nv-axis"><g><g class="tick" transform="translate(0,288.0061663003082)" style="opacity: 1;"><line x2="550" y2="0"></line><text dy=".32em" x="-3" opacity="1" style="text-anchor: end;" y="0">0.02</text></g><g class="tick" transform="translate(0,256.00548115582944)" style="opacity: 1;"><line x2="550" y2="0"></line><text dy=".32em" x="-3" opacity="1" style="text-anchor: end;" y="0">0.04</text></g><g class="tick" transform="translate(0,224.00479601135066)" style="opacity: 1;"><line x2="550" y2="0"></line><text dy=".32em" x="-3" opacity="1" style="text-anchor: end;" y="0">0.06</text></g><g class="tick" transform="translate(0,192.00411086687194)" style="opacity: 1;"><line x2="550" y2="0"></line><text dy=".32em" x="-3" opacity="1" style="text-anchor: end;" y="0">0.08</text></g><g class="tick" transform="translate(0,160.0034257223932)" style="opacity: 1;"><line x2="550" y2="0"></line><text dy=".32em" x="-3" opacity="1" style="text-anchor: end;" y="0">0.10</text></g><g class="tick" transform="translate(0,128.00274057791444)" style="opacity: 1;"><line x2="550" y2="0"></line><text dy=".32em" x="-3" opacity="1" style="text-anchor: end;" y="0">0.12</text></g><g class="tick" transform="translate(0,96.00205543343563)" style="opacity: 1;"><line x2="550" y2="0"></line><text dy=".32em" x="-3" opacity="1" style="text-anchor: end;" y="0">0.14</text></g><g class="tick" transform="translate(0,64.00137028895692)" style="opacity: 1;"><line x2="550" y2="0"></line><text dy=".32em" x="-3" opacity="1" style="text-anchor: end;" y="0">0.16</text></g><g class="tick" transform="translate(0,32.000685144478176)" style="opacity: 1;"><line x2="550" y2="0"></line><text dy=".32em" x="-3" opacity="1" style="text-anchor: end;" y="0">0.18</text></g><path class="domain" d="M0,0H0V320H0"></path><text class="nv-axislabel" transform="rotate(-90)" y="-50" x="-160" style="text-anchor: middle;">Y</text></g><g class="nv-axisMaxMin nv-axisMaxMin-y nv-axisMin-y" transform="translate(0,320)"><text dy=".32em" y="0" x="-3" text-anchor="end" style="opacity: 1;">0.00</text></g><g class="nv-axisMaxMin nv-axisMaxMin-y nv-axisMax-y" transform="translate(0,0)"><text dy=".32em" y="0" x="-3" text-anchor="end" style="opacity: 1;">0.20</text></g></g></g><g class="nv-linesWrap nvd3-svg"><g class="nvd3 nv-wrap nv-line" transform="translate(0,0)"><defs><clippath id="nv-edge-clip-15466"><rect width="550" height="320"></rect></clippath></defs><g clip-path=""><g class="nv-groups"><g class=" nv-group nv-series-0" style="stroke-opacity: 1; stroke-width: 1.5px; fill-opacity: 0.5; fill: rgb(255, 127, 14); stroke: rgb(255, 127, 14);"><path class="nv-line" d="M0,0L5.555555555555556,224.34521219883442L11.111111111111112,256.2734856058566L16.666666666666668,264.52924027425405L22.222222222222225,273.38886886962126L27.77777777777778,282.57231239416467L33.333333333333336,290.8746956263217L38.888888888888886,297.8071626164249L44.44444444444445,303.303932600598L50,307.5141246508753L55.55555555555556,310.6673540723316L61.11111111111111,312.99807030141636L66.66666666666667,314.71064428099317L72.22222222222223,315.96866484497804L77.77777777777777,316.89647097608366L83.33333333333333,317.58556375982175L88.8888888888889,318.1019844082964L94.44444444444444,318.4929155177335L100,318.79195409152146L105.55555555555554,319.0230661683004L111.11111111111111,319.20344279415065L116.66666666666667,319.3455164493616L122.22222222222221,319.45836708982495L127.77777777777777,319.5486975321563L133.33333333333334,319.62151029301117L138.88888888888889,319.6805793142991L144.44444444444446,319.7234425754308L150,319.75685684650495L155.55555555555554,319.78063172855013L161.11111111111111,319.8011961815651L166.66666666666666,319.81915209231914L172.22222222222223,319.83496305991355L177.7777777777778,319.84898917302496L183.33333333333331,319.86151263327025L188.88888888888889,319.8727567423175L194.44444444444446,319.8829000359278L200,319.8920868441156L205.55555555555557,319.90043520520084L211.1111111111111,319.90804281276996L216.66666666666666,319.91499149607176L222.22222222222223,319.92135060478944L227.77777777777777,319.9271795741634L233.33333333333334,319.9325298763205L238.8888888888889,319.9374465116029L244.44444444444443,319.94196915488607L250,319.94613304287884L255.55555555555554,319.94996966670226L261.1111111111111,319.9535073177949L266.6666666666667,319.956771523035L272.22222222222223,319.9597853958677L277.77777777777777,319.96256992342796L283.3333333333333,319.96514420457436L288.8888888888889,319.96752564996564L294.44444444444446,319.96973015249824L300,319.9717722343307L305.55555555555554,319.97366517516934L311.1111111111111,319.97542112534114L316.6666666666667,319.97705120632565L322.22222222222223,319.9785656007921L327.77777777777777,319.9799736337171L333.3333333333333,319.9812838458188L338.88888888888886,319.9825040602808L344.44444444444446,319.9836414435553L350,319.9847025608867L355.5555555555556,319.98569342709266L361.11111111111114,319.98661955305647L366.66666666666663,319.98748445659606L372.22222222222223,319.9882902755631L377.77777777777777,319.98904611997403L383.33333333333337,319.98975626485L388.8888888888889,319.99042403873483L394.4444444444444,319.9910525144052L400,319.9916445274119L405.55555555555554,319.9922026936124L411.11111111111114,319.99272942568007L416.6666666666667,319.9932269485889L422.2222222222222,319.9936973140926L427.77777777777777,319.99414241422585L433.3333333333333,319.9945639938619L438.8888888888889,319.9949636623688L444.44444444444446,319.995342904409L450,319.99570308992804L455.55555555555554,319.99604548338147L461.1111111111111,319.9963712522465L466.6666666666667,319.9966814748652L472.22222222222223,319.9969771476659L477.7777777777778,319.9972591918053L483.3333333333333,319.99752845927395L488.88888888888886,319.9977857385051L494.44444444444446,319.998031759524L500,319.99826719867366L505.5555555555556,319.99849268294975L511.1111111111111,319.99870879397645L516.6666666666667,319.9989160716509L522.2222222222222,319.9991150174845L527.7777777777777,319.99930609766477L533.3333333333334,319.9994897458617L538.8888888888889,319.99966636579893L544.4444444444445,319.9998363336105L550,320"></path></g></g><g class="nv-scatterWrap nvd3-svg" clip-path=""><g class="nvd3 nv-wrap nv-scatter nv-chart-15466" transform="translate(0,0)"><defs><clippath id="nv-edge-clip-15466"><rect width="550" height="320"></rect></clippath></defs><g clip-path=""><g class="nv-groups"><g class="nv-group nv-series-0" style="stroke-opacity: 1; fill-opacity: 0.5; stroke: rgb(255, 127, 14); fill: rgb(255, 127, 14);"><path transform="translate(0,0)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-0 nv-noninteractive"></path><path transform="translate(5.555555555555556,224.34521219883442)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-1 nv-noninteractive"></path><path transform="translate(11.111111111111112,256.2734856058566)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-2 nv-noninteractive"></path><path transform="translate(16.666666666666668,264.52924027425405)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-3 nv-noninteractive"></path><path transform="translate(22.222222222222225,273.38886886962126)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-4 nv-noninteractive"></path><path transform="translate(27.77777777777778,282.57231239416467)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-5 nv-noninteractive"></path><path transform="translate(33.333333333333336,290.8746956263217)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-6 nv-noninteractive"></path><path transform="translate(38.888888888888886,297.8071626164249)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-7 nv-noninteractive"></path><path transform="translate(44.44444444444445,303.303932600598)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-8 nv-noninteractive"></path><path transform="translate(50,307.5141246508753)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-9 nv-noninteractive"></path><path transform="translate(55.55555555555556,310.6673540723316)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-10 nv-noninteractive"></path><path transform="translate(61.11111111111111,312.99807030141636)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-11 nv-noninteractive"></path><path transform="translate(66.66666666666667,314.71064428099317)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-12 nv-noninteractive"></path><path transform="translate(72.22222222222223,315.96866484497804)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-13 nv-noninteractive"></path><path transform="translate(77.77777777777777,316.89647097608366)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-14 nv-noninteractive"></path><path transform="translate(83.33333333333333,317.58556375982175)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-15 nv-noninteractive"></path><path transform="translate(88.8888888888889,318.1019844082964)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-16 nv-noninteractive"></path><path transform="translate(94.44444444444444,318.4929155177335)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-17 nv-noninteractive"></path><path transform="translate(100,318.79195409152146)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-18 nv-noninteractive"></path><path transform="translate(105.55555555555554,319.0230661683004)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-19 nv-noninteractive"></path><path transform="translate(111.11111111111111,319.20344279415065)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-20 nv-noninteractive"></path><path transform="translate(116.66666666666667,319.3455164493616)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-21 nv-noninteractive"></path><path transform="translate(122.22222222222221,319.45836708982495)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-22 nv-noninteractive"></path><path transform="translate(127.77777777777777,319.5486975321563)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-23 nv-noninteractive"></path><path transform="translate(133.33333333333334,319.62151029301117)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-24 nv-noninteractive"></path><path transform="translate(138.88888888888889,319.6805793142991)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-25 nv-noninteractive"></path><path transform="translate(144.44444444444446,319.7234425754308)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-26 nv-noninteractive"></path><path transform="translate(150,319.75685684650495)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-27 nv-noninteractive"></path><path transform="translate(155.55555555555554,319.78063172855013)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-28 nv-noninteractive"></path><path transform="translate(161.11111111111111,319.8011961815651)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-29 nv-noninteractive"></path><path transform="translate(166.66666666666666,319.81915209231914)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-30 nv-noninteractive"></path><path transform="translate(172.22222222222223,319.83496305991355)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-31 nv-noninteractive"></path><path transform="translate(177.7777777777778,319.84898917302496)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-32 nv-noninteractive"></path><path transform="translate(183.33333333333331,319.86151263327025)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-33 nv-noninteractive"></path><path transform="translate(188.88888888888889,319.8727567423175)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-34 nv-noninteractive"></path><path transform="translate(194.44444444444446,319.8829000359278)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-35 nv-noninteractive"></path><path transform="translate(200,319.8920868441156)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-36 nv-noninteractive"></path><path transform="translate(205.55555555555557,319.90043520520084)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-37 nv-noninteractive"></path><path transform="translate(211.1111111111111,319.90804281276996)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-38 nv-noninteractive"></path><path transform="translate(216.66666666666666,319.91499149607176)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-39 nv-noninteractive"></path><path transform="translate(222.22222222222223,319.92135060478944)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-40 nv-noninteractive"></path><path transform="translate(227.77777777777777,319.9271795741634)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-41 nv-noninteractive"></path><path transform="translate(233.33333333333334,319.9325298763205)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-42 nv-noninteractive"></path><path transform="translate(238.8888888888889,319.9374465116029)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-43 nv-noninteractive"></path><path transform="translate(244.44444444444443,319.94196915488607)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-44 nv-noninteractive"></path><path transform="translate(250,319.94613304287884)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-45 nv-noninteractive"></path><path transform="translate(255.55555555555554,319.94996966670226)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-46 nv-noninteractive"></path><path transform="translate(261.1111111111111,319.9535073177949)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-47 nv-noninteractive"></path><path transform="translate(266.6666666666667,319.956771523035)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-48 nv-noninteractive"></path><path transform="translate(272.22222222222223,319.9597853958677)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-49 nv-noninteractive"></path><path transform="translate(277.77777777777777,319.96256992342796)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-50 nv-noninteractive"></path><path transform="translate(283.3333333333333,319.96514420457436)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-51 nv-noninteractive"></path><path transform="translate(288.8888888888889,319.96752564996564)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-52 nv-noninteractive"></path><path transform="translate(294.44444444444446,319.96973015249824)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-53 nv-noninteractive"></path><path transform="translate(300,319.9717722343307)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-54 nv-noninteractive"></path><path transform="translate(305.55555555555554,319.97366517516934)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-55 nv-noninteractive"></path><path transform="translate(311.1111111111111,319.97542112534114)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-56 nv-noninteractive"></path><path transform="translate(316.6666666666667,319.97705120632565)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-57 nv-noninteractive"></path><path transform="translate(322.22222222222223,319.9785656007921)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-58 nv-noninteractive"></path><path transform="translate(327.77777777777777,319.9799736337171)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-59 nv-noninteractive"></path><path transform="translate(333.3333333333333,319.9812838458188)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-60 nv-noninteractive"></path><path transform="translate(338.88888888888886,319.9825040602808)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-61 nv-noninteractive"></path><path transform="translate(344.44444444444446,319.9836414435553)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-62 nv-noninteractive"></path><path transform="translate(350,319.9847025608867)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-63 nv-noninteractive"></path><path transform="translate(355.5555555555556,319.98569342709266)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-64 nv-noninteractive"></path><path transform="translate(361.11111111111114,319.98661955305647)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-65 nv-noninteractive"></path><path transform="translate(366.66666666666663,319.98748445659606)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-66 nv-noninteractive"></path><path transform="translate(372.22222222222223,319.9882902755631)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-67 nv-noninteractive"></path><path transform="translate(377.77777777777777,319.98904611997403)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-68 nv-noninteractive"></path><path transform="translate(383.33333333333337,319.98975626485)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-69 nv-noninteractive"></path><path transform="translate(388.8888888888889,319.99042403873483)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-70 nv-noninteractive"></path><path transform="translate(394.4444444444444,319.9910525144052)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-71 nv-noninteractive"></path><path transform="translate(400,319.9916445274119)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-72 nv-noninteractive"></path><path transform="translate(405.55555555555554,319.9922026936124)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-73 nv-noninteractive"></path><path transform="translate(411.11111111111114,319.99272942568007)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-74 nv-noninteractive"></path><path transform="translate(416.6666666666667,319.9932269485889)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-75 nv-noninteractive"></path><path transform="translate(422.2222222222222,319.9936973140926)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-76 nv-noninteractive"></path><path transform="translate(427.77777777777777,319.99414241422585)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-77 nv-noninteractive"></path><path transform="translate(433.3333333333333,319.9945639938619)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-78 nv-noninteractive"></path><path transform="translate(438.8888888888889,319.9949636623688)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-79 nv-noninteractive"></path><path transform="translate(444.44444444444446,319.995342904409)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-80 nv-noninteractive"></path><path transform="translate(450,319.99570308992804)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-81 nv-noninteractive"></path><path transform="translate(455.55555555555554,319.99604548338147)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-82 nv-noninteractive"></path><path transform="translate(461.1111111111111,319.9963712522465)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-83 nv-noninteractive"></path><path transform="translate(466.6666666666667,319.9966814748652)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-84 nv-noninteractive"></path><path transform="translate(472.22222222222223,319.9969771476659)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-85 nv-noninteractive"></path><path transform="translate(477.7777777777778,319.9972591918053)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-86 nv-noninteractive"></path><path transform="translate(483.3333333333333,319.99752845927395)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-87 nv-noninteractive"></path><path transform="translate(488.88888888888886,319.9977857385051)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-88 nv-noninteractive"></path><path transform="translate(494.44444444444446,319.998031759524)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-89 nv-noninteractive"></path><path transform="translate(500,319.99826719867366)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-90 nv-noninteractive"></path><path transform="translate(505.5555555555556,319.99849268294975)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-91 nv-noninteractive"></path><path transform="translate(511.1111111111111,319.99870879397645)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-92 nv-noninteractive"></path><path transform="translate(516.6666666666667,319.9989160716509)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-93 nv-noninteractive"></path><path transform="translate(522.2222222222222,319.9991150174845)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-94 nv-noninteractive"></path><path transform="translate(527.7777777777777,319.99930609766477)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-95 nv-noninteractive"></path><path transform="translate(533.3333333333334,319.9994897458617)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-96 nv-noninteractive"></path><path transform="translate(538.8888888888889,319.99966636579893)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-97 nv-noninteractive"></path><path transform="translate(544.4444444444445,319.9998363336105)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-98 nv-noninteractive"></path><path transform="translate(550,320)" d="M0,2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,-2.256758334191025A2.256758334191025,2.256758334191025 0 1,1 0,2.256758334191025Z" class="nv-point nv-point-99 nv-noninteractive"></path></g></g><g class="nv-point-paths"></g></g><g class="nv-point-clips"></g></g></g></g></g></g><g class="nv-legendWrap nvd3-svg" transform="translate(0,-30)"><g class="nvd3 nv-legend" transform="translate(0,5)"><g transform="translate(488.638671875,5)"><g class="nv-series" transform="translate(0,5)"><circle class="nv-legend-symbol" r="5" style="stroke-width: 2px; fill: rgb(255, 127, 14); fill-opacity: 1; stroke: rgb(255, 127, 14);"></circle><text text-anchor="start" class="nv-legend-text" dy=".32em" dx="8" fill="#000">Label</text></g></g></g></g><g class="nv-interactive"><g class=" nv-wrap nv-interactiveLineLayer"><g class="nv-interactiveGuideLine"></g></g></g></g></g></svg>
</div>

<style>

svg text {
  fill: #ddd;
}

.tick line {
  stroke: white;
  opacity: 0.1;
}

#d3line893332492 svg {
  height: 400px;
  width: 100%
}

</style>
<script>
console.log("Clearing Plotter");
$('#d3line893332492 svg').empty();

/*These lines are all chart setup.  Pick and choose which chart features you want to utilize. */
nv.addGraph(function() {
var chart = nv.models.lineChart()
 .margin({left: 100, right:100})  //Adjust chart margins to give the x-axis some breathing room.
 .useInteractiveGuideline(true)  //We want nice looking tooltips and a guideline!
 .showLegend(true)       //Show the legend, allowing users to turn on/off line series.
 .showYAxis(true)        //Show the y-axis
 .showXAxis(true)        //Show the x-axis
;


var logFormat = function(i) {
    if (Math.log10(i) % 1 === 0)
        return i
     else
        return "";
};
var linearFormat = d3.format('.02f');



chart.xAxis     //Chart x-axis settings
.axisLabel("X")
.tickFormat(linearFormat);

chart.yAxis     //Chart y-axis settings
.axisLabel("Y")
.tickFormat(linearFormat);




/* Done setting the chart up? Time to render it!*/
var myData = [
{
values: [{x:0.0, y:0.19999999999999962},{x:1.0, y:0.059787244438082005},{x:2.0, y:0.03983250080501893},{x:3.0, y:0.034672764611169415},{x:4.0, y:0.029135615293667518},{x:5.0, y:0.02339608597854104},{x:6.0, y:0.01820720755629923},{x:7.0, y:0.013874508453886832},{x:8.0, y:0.01043910076848515},{x:9.0, y:0.00780778707550083},{x:10.0, y:0.00583706088184598},{x:11.0, y:0.004380394427011097},{x:12.0, y:0.0033100586064842984},{x:13.0, y:0.0025238125881224347},{x:14.0, y:0.0019439461715649662},{x:15.0, y:0.001513272402783517},{x:16.0, y:0.0011905164079396204},{x:17.0, y:9.461896957632423E-4},{x:18.0, y:7.59294588712956E-4},{x:19.0, y:6.148526333388875E-4},{x:20.0, y:5.021196558817784E-4},{x:21.0, y:4.1332552252522077E-4},{x:22.0, y:3.427953823399039E-4},{x:23.0, y:2.863400646343148E-4},{x:24.0, y:2.4083306343977226E-4},{x:25.0, y:2.0391571556344852E-4},{x:26.0, y:1.7712675092836636E-4},{x:27.0, y:1.5624327863812007E-4},{x:28.0, y:1.413842955020934E-4},{x:29.0, y:1.2853178754976383E-4},{x:30.0, y:1.1730958360446839E-4},{x:31.0, y:1.074279404314821E-4},{x:32.0, y:9.866180742648174E-5},{x:33.0, y:9.083481235512034E-5},{x:34.0, y:8.38073946629819E-5},{x:35.0, y:7.746797188845774E-5},{x:36.0, y:7.172633970375816E-5},{x:37.0, y:6.650872573861159E-5},{x:38.0, y:6.175407280870463E-5},{x:39.0, y:5.7411238728456636E-5},{x:40.0, y:5.343688087394989E-5},{x:41.0, y:4.9793853015233775E-5},{x:42.0, y:4.644998576183066E-5},{x:43.0, y:4.337715450196945E-5},{x:44.0, y:4.0550562969504276E-5},{x:45.0, y:3.794818869282396E-5},{x:46.0, y:3.555035014275444E-5},{x:47.0, y:3.333936554871974E-5},{x:48.0, y:3.129928095341861E-5},{x:49.0, y:2.9415650762948634E-5},{x:50.0, y:2.7675358298767803E-5},{x:51.0, y:2.606646702987407E-5},{x:52.0, y:2.4578095527498825E-5},{x:53.0, y:2.3200310944042458E-5},{x:54.0, y:2.192403712477163E-5},{x:55.0, y:2.074097443088449E-5},{x:56.0, y:1.9643529070667053E-5},{x:57.0, y:1.86247502681585E-5},{x:58.0, y:1.7678273991446938E-5},{x:59.0, y:1.6798272254803047E-5},{x:60.0, y:1.597940722379331E-5},{x:61.0, y:1.5216789513267922E-5},{x:62.0, y:1.450594018651614E-5},{x:63.0, y:1.384275605366545E-5},{x:64.0, y:1.3223477934163793E-5},{x:65.0, y:1.2644661599647354E-5},{x:66.0, y:1.2104108461103147E-5},{x:67.0, y:1.1600482389725876E-5},{x:68.0, y:1.1128089747154957E-5},{x:69.0, y:1.068425870247712E-5},{x:70.0, y:1.0266908960208853E-5},{x:71.0, y:9.874120076119484E-6},{x:72.0, y:9.504119868952255E-6},{x:73.0, y:9.155273462682101E-6},{x:74.0, y:8.826072968809629E-6},{x:75.0, y:8.515127808376911E-6},{x:76.0, y:8.221155662726559E-6},{x:77.0, y:7.942974035541332E-6},{x:78.0, y:7.679492404362658E-6},{x:79.0, y:7.429704935692491E-6},{x:80.0, y:7.192683735398102E-6},{x:81.0, y:6.967572605787938E-6},{x:82.0, y:6.753581279092357E-6},{x:83.0, y:6.549980097715616E-6},{x:84.0, y:6.356095112237583E-6},{x:85.0, y:6.1713035683287436E-6},{x:86.0, y:5.9950297553588995E-6},{x:87.0, y:5.826741190623591E-6},{x:88.0, y:5.665945113926293E-6},{x:89.0, y:5.512185269243179E-6},{x:90.0, y:5.365038951232389E-6},{x:91.0, y:5.224114295958103E-6},{x:92.0, y:5.089047796170637E-6},{x:93.0, y:4.959502023313595E-6},{x:94.0, y:4.8351635395005E-6},{x:95.0, y:4.715740983734595E-6},{x:96.0, y:4.600963318139627E-6},{x:97.0, y:4.49057822077962E-6},{x:98.0, y:4.384350612974179E-6},{x:99.0, y:4.282061309639741E-6}],
key: "Label",
color: '#ff7f0e',
area: false
}
       ];   //You need data...

d3.select('#d3line893332492 svg')    //Select the <svg> element you want to render the chart in.
.datum(myData)         //Populate the <svg> element with chart data...
.transition().duration(350)
.call(chart);          //Finally, render the chart!

//Update the chart when window resizes.
nv.utils.windowResize(function() { chart.update() });
return chart;
});
</script></div></div></div><div id="cell28" class="cellWrapper"><div id="editCell28" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor28" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode28" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay28" class="cell"><div class="newslide"></div>
<div class="start-book"></div>
<div class="exercise">
  <div class="exname">Exercise 1</div>
  <div class="extext">Can you think of other reasonable measures for convergence? Hint: consider the formal derivation of EM. </div>
</div>
<div class="start-slide"></div>
<div class="end-slide"></div></div></div><div id="cell29" class="cellWrapper"><div id="editCell29" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor29" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode29" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay29" class="cell"><div class="newslide"></div><p>Let us have a look at the translation table.</p></div></div><div id="cell30" class="cellWrapper"><div id="editCell30" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor30" class="cell editor ace_editor ace-chaos ace_dark" style="height: 36px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 16px; width: 7.20125px; left: 520.283px; top: 10px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 68px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div></div><div class="ace_gutter-active-line" style="top: 10px; height: 16px;"></div></div><div class="ace_scroller" style="left: 41px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 833px; height: 68px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_identifier">barChart</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ibm1Iterations</span>.<span class="ace_identifier">last</span>.<span class="ace_identifier">_2</span>.<span class="ace_identifier">alpha</span>.<span class="ace_identifier">filter</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">_1</span>.<span class="ace_identifier">_2</span>&nbsp;<span class="ace_keyword ace_operator">==</span>&nbsp;<span class="ace_string">"house"</span><span class="ace_paren ace_rparen">))</span>&nbsp;</div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 479.282px; top: 0px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 36px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 41px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 833px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode30" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay30" class="cell"><div class="string-result"><div id="d3bar2097596534" class="wolfe-nvd3">
<svg class="nvd3-svg"><g class="nvd3 nv-wrap nv-discreteBarWithAxes"><g transform="translate(60,15)"><defs><clippath id="nv-x-label-clip-4531"><rect width="239.99999999999997" height="16" x="-119.99999999999999"></rect></clippath></defs><g class="nv-x nv-axis nvd3-svg" transform="translate(0,85)"><g class="nvd3 nv-wrap nv-axis"><g><g class="tick zero" transform="translate(73.33333333333333,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,5)" x="0" style="text-anchor: middle;">(mein,house)</text></g><g class="tick zero" transform="translate(206.66666666666666,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,17)" x="0" style="text-anchor: middle;">(das,house)</text></g><g class="tick zero" transform="translate(339.99999999999994,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,5)" x="0" style="text-anchor: middle;">(Haus,house)</text></g><g class="tick zero" transform="translate(473.33333333333326,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,17)" x="0" style="text-anchor: middle;">(ist,house)</text></g><g class="tick zero" transform="translate(606.6666666666666,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,5)" x="0" style="text-anchor: middle;">(klein,house)</text></g><path class="domain" d="M0,0V0H680V0"></path><text class="nv-axislabel" text-anchor="middle" y="36" x="340" transform="translate(0,17)"></text></g></g></g><g class="nv-y nv-axis nvd3-svg"><g class="nv-zeroLine"><line x1="0" x2="680" y1="85" y2="85"></line></g><g class="nvd3 nv-wrap nv-axis"><g><g class="tick zero" transform="translate(0,85)" style="opacity: 1;"><line x2="680" y2="0"></line><text dy=".32em" x="-3" opacity="0" style="text-anchor: end;" y="0">0.0</text></g><g class="tick" transform="translate(0,55.800000000000004)" style="opacity: 1;"><line x2="680" y2="0"></line><text dy=".32em" x="-3" opacity="1" style="text-anchor: end;" y="0">0.2</text></g><g class="tick" transform="translate(0,26.600000000000012)" style="opacity: 1;"><line x2="680" y2="0"></line><text dy=".32em" x="-3" opacity="1" style="text-anchor: end;" y="0">0.4</text></g><path class="domain" d="M0,12H0V85H0"></path><text class="nv-axislabel" transform="rotate(-90)" y="-50" x="-42.5" style="text-anchor: middle;"></text></g><g class="nv-axisMaxMin nv-axisMaxMin-y nv-axisMin-y" transform="translate(0,85)"><text dy=".32em" y="0" x="-3" text-anchor="end" style="opacity: 1;">0.0</text></g><g class="nv-axisMaxMin nv-axisMaxMin-y nv-axisMax-y" transform="translate(0,12)"><text dy=".32em" y="0" x="-3" text-anchor="end" style="opacity: 1;">0.5</text></g></g></g><g class="nv-barsWrap nvd3-svg"><g class="nvd3 nv-wrap nv-discretebar" transform="translate(0,0)"><g><g class="nv-groups"><g class="nv-group nv-series-0" style="stroke-opacity: 1; fill-opacity: 0.75;"><g transform="translate(19.33333396911621,84)" class="nv-bar positive" style="fill: rgb(31, 119, 180); stroke: rgb(31, 119, 180);"><rect height="1" width="107.99999999999999" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="53.99999999999999">0.00</text></g><g transform="translate(152.6666717529297,84)" class="nv-bar positive" style="fill: rgb(174, 199, 232); stroke: rgb(174, 199, 232);"><rect height="1" width="107.99999999999999" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="53.99999999999999">0.00</text></g><g transform="translate(286,12)" class="nv-bar positive" style="fill: rgb(255, 127, 14); stroke: rgb(255, 127, 14);"><rect height="73" width="107.99999999999999" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="53.99999999999999">0.50</text></g><g transform="translate(419.3333435058594,84)" class="nv-bar positive" style="fill: rgb(255, 187, 120); stroke: rgb(255, 187, 120);"><rect height="1" width="107.99999999999999" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="53.99999999999999">0.00</text></g><g transform="translate(552.6666870117188,12)" class="nv-bar positive" style="fill: rgb(44, 160, 44); stroke: rgb(44, 160, 44);"><rect height="73" width="107.99999999999999" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="53.99999999999999">0.50</text></g></g></g></g></g></g></g></g></svg>
</div>

<script>
console.log("Clearing svg");
$('#d3bar2097596534 svg').empty();
console.log(d3.select('#d3bar2097596534 svg').length);
console.log("Calling addGraph");
/*These lines are all chart setup.  Pick and choose which chart features you want to utilize. */

  nv.addGraph(function() {
  var chart = nv.models.discreteBarChart()
      .x(function(d) { return d.label })    //Specify the data accessors.
      .y(function(d) { return d.value })
      .staggerLabels(true)    //Too many bars and not enough room? Try staggering labels.
      .tooltips(false)        //Don't show tooltips
      .showValues(true)       //...instead, show the bar value right on top of each bar.

      ;
  console.log(chart);
  console.log("Inside addGraph");
  console.log(d3.select('#d3bar2097596534 svg'));
  d3.select('#d3bar2097596534 svg')
      .datum(
[{
key: "Whatever",
values: [{label:"(mein,house)", value:3.824857408868926E-29},{label:"(das,house)", value:2.07971629398023E-35},{label:"(Haus,house)", value:0.5000000000000001},{label:"(ist,house)", value:3.893438958840134E-27},{label:"(klein,house)", value:0.5000000000000001}],
}]
    )
      .transition().duration(350)
      .call(chart);

  nv.utils.windowResize(chart.update);

  return chart;
});
</script></div></div></div><div id="cell31" class="cellWrapper"><div id="editCell31" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor31" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode31" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay31" class="cell"><div class="newslide"></div><p>We can also inspect the alignments generated during EM.</p></div></div><div id="cell32" class="cellWrapper"><div id="editCell32" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor32" class="cell editor ace_editor ace-chaos ace_dark" style="height: 36px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 16px; width: 7.20125px; left: 685.911px; top: 10px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 68px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div></div><div class="ace_gutter-active-line" style="top: 10px; height: 16px;"></div></div><div class="ace_scroller" style="left: 41px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 833px; height: 68px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"><div class="ace_bracket ace_start" style="height:16px;width:7.20125px;top:0px;left:234.44px;"></div></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_identifier">Renderer</span>.<span class="ace_identifier">renderWeightedAlignment</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">trainM2</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">_1</span>,&nbsp;<span class="ace_identifier">trainM2</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">_2</span>,&nbsp;<span class="ace_identifier">ibm1Iterations</span>.<span class="ace_identifier">last</span>.<span class="ace_identifier">_1</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">))</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 644.911px; top: 0px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 36px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 41px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 833px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode32" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay32" class="cell"><div class="string-result"><div id="alignf2c0d6fd-6a75-4d13-8132-06818a995c29" class="aligner">
<svg><g><text x="20" y="20">NULL</text><text x="60.6796875" y="20">the</text><text x="87.361328125" y="20">house</text><text x="130.056640625" y="20">is</text><text x="148.72265625" y="20">small</text></g><g><text x="20" y="100">klein</text><text x="54.6796875" y="100">ist</text><text x="76.6796875" y="100">das</text><text x="106.02734375" y="100">Haus</text></g><line x1="35.3359375" y1="22.5" x2="32.3359375" y2="89" stroke-width="2" stroke="black" stroke-opacity="2.6280259695372476e-14"></line><line x1="69.0078125" y1="22.5" x2="32.3359375" y2="89" stroke-width="2" stroke="black" stroke-opacity="1.863439198452529e-42"></line><line x1="103.703125" y1="22.5" x2="32.3359375" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.4999999999999737"></line><line x1="134.375" y1="22.5" x2="32.3359375" y2="89" stroke-width="2" stroke="black" stroke-opacity="2.6280259695372476e-14"></line><line x1="162.71875" y1="22.5" x2="32.3359375" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.4999999999999737"></line><line x1="35.3359375" y1="22.5" x2="60.671875" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.5"></line><line x1="69.0078125" y1="22.5" x2="60.671875" y2="89" stroke-width="2" stroke="black" stroke-opacity="6.940522787929912e-22"></line><line x1="103.703125" y1="22.5" x2="60.671875" y2="89" stroke-width="2" stroke="black" stroke-opacity="3.88664621703916e-27"></line><line x1="134.375" y1="22.5" x2="60.671875" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.5"></line><line x1="162.71875" y1="22.5" x2="60.671875" y2="89" stroke-width="2" stroke="black" stroke-opacity="3.88664621703916e-27"></line><line x1="35.3359375" y1="22.5" x2="86.34375" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.055552866879861405"></line><line x1="69.0078125" y1="22.5" x2="86.34375" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.8888942662402771"></line><line x1="103.703125" y1="22.5" x2="86.34375" y2="89" stroke-width="2" stroke="black" stroke-opacity="4.152175776717941e-35"></line><line x1="134.375" y1="22.5" x2="86.34375" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.055552866879861405"></line><line x1="162.71875" y1="22.5" x2="86.34375" y2="89" stroke-width="2" stroke="black" stroke-opacity="4.152175776717941e-35"></line><line x1="35.3359375" y1="22.5" x2="120.015625" y2="89" stroke-width="2" stroke="black" stroke-opacity="2.6280259695372476e-14"></line><line x1="69.0078125" y1="22.5" x2="120.015625" y2="89" stroke-width="2" stroke="black" stroke-opacity="1.863439198452529e-42"></line><line x1="103.703125" y1="22.5" x2="120.015625" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.4999999999999737"></line><line x1="134.375" y1="22.5" x2="120.015625" y2="89" stroke-width="2" stroke="black" stroke-opacity="2.6280259695372476e-14"></line><line x1="162.71875" y1="22.5" x2="120.015625" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.4999999999999737"></line></svg>
</div>
<script>
  var s1Data = ["NULL","the","house","is","small"];
  var s2Data = ["klein","ist","das","Haus"];
  var connData = [{'i1':0, 'i2':0, 'weight':2.6280259695372476E-14 },{'i1':1, 'i2':0, 'weight':1.863439198452529E-42 },{'i1':2, 'i2':0, 'weight':0.4999999999999737 },{'i1':3, 'i2':0, 'weight':2.6280259695372476E-14 },{'i1':4, 'i2':0, 'weight':0.4999999999999737 },{'i1':0, 'i2':1, 'weight':0.5 },{'i1':1, 'i2':1, 'weight':6.940522787929912E-22 },{'i1':2, 'i2':1, 'weight':3.88664621703916E-27 },{'i1':3, 'i2':1, 'weight':0.5 },{'i1':4, 'i2':1, 'weight':3.88664621703916E-27 },{'i1':0, 'i2':2, 'weight':0.055552866879861405 },{'i1':1, 'i2':2, 'weight':0.8888942662402771 },{'i1':2, 'i2':2, 'weight':4.152175776717941E-35 },{'i1':3, 'i2':2, 'weight':0.055552866879861405 },{'i1':4, 'i2':2, 'weight':4.152175776717941E-35 },{'i1':0, 'i2':3, 'weight':2.6280259695372476E-14 },{'i1':1, 'i2':3, 'weight':1.863439198452529E-42 },{'i1':2, 'i2':3, 'weight':0.4999999999999737 },{'i1':3, 'i2':3, 'weight':2.6280259695372476E-14 },{'i1':4, 'i2':3, 'weight':0.4999999999999737 }]
  var svg = d3.select('#alignf2c0d6fd-6a75-4d13-8132-06818a995c29 svg')

  function buildSentenceGroup(parent,data,y) {
    var groupElement = parent.append("g");
    var text = groupElement.selectAll("text")
      .data(data)
      .enter()
      .append("text");
    var textLabels = text
      .attr("x",function(d) { return 0; })
      .attr("y",function(d) { return y; })
      .text(function(d) {return d;});
    var current = 20;
    var gap = 10;
    var tokenOffsets = [current];
    for (i = 0; i < textLabels[0].length - 1; i++) {
      current += textLabels[0][i].getComputedTextLength() + gap;
      tokenOffsets.push(current);
    }
    console.log(tokenOffsets);
    textLabels
      .attr("x", function(d,i) { return tokenOffsets[i];});
    return groupElement;
  }

  var s1Group = buildSentenceGroup(svg,s1Data,20);
  var s2Group = buildSentenceGroup(svg,s2Data,100);

  var s1TokenTexts = s1Group[0][0].childNodes;
  var s2TokenTexts = s2Group[0][0].childNodes;

  var connections = svg.selectAll("line")
    .data(connData)
    .enter()
    .append("line")
    .attr("x1", function(d) { return s1TokenTexts[d.i1].getBBox().x + s1TokenTexts[d.i1].getBBox().width / 2; })
    .attr("y1", function(d) { return s1TokenTexts[d.i1].getBBox().y + s1TokenTexts[d.i1].getBBox().height; })
    .attr("x2", function(d) { return s2TokenTexts[d.i2].getBBox().x + s2TokenTexts[d.i2].getBBox().width / 2; })
    .attr("y2", function(d) { return s2TokenTexts[d.i2].getBBox().y; })
    .attr("stroke-width", 2)
    .attr("stroke", "black")
    .attr("stroke-opacity", function(d) { return 0; })
    .transition()
    .attr("stroke-opacity", function(d) { return d.weight; } );

  console.log(s1Group);
  console.log(s1TokenTexts);

</script></div></div></div><div id="cell33" class="cellWrapper"><div id="editCell33" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor33" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode33" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay33" class="cell"><div class="newslide"></div><h4>Training IBM Model 2</h4><p>Now that we have a reasonable initial model we can use it to initialize EM for IBM Model 2. Here is the EM code in full.</p></div></div><div id="cell34" class="cellWrapper"><div id="editCell34" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor34" class="cell editor ace_editor ace-chaos ace_dark" style="height: 180px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 16px; width: 7.20125px; left: 66.4025px; top: 154px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 212px; width: 48px;"><div class="ace_gutter-cell " style="height: 16px;">1<span class="ace_fold-widget ace_start ace_open" style="height: 16px;"></span></div><div class="ace_gutter-cell " style="height: 16px;">2</div><div class="ace_gutter-cell " style="height: 16px;">3</div><div class="ace_gutter-cell " style="height: 16px;">4<span class="ace_fold-widget ace_start ace_open" style="height: 16px;"></span></div><div class="ace_gutter-cell " style="height: 16px;">5</div><div class="ace_gutter-cell " style="height: 16px;">6</div><div class="ace_gutter-cell " style="height: 16px;">7</div><div class="ace_gutter-cell " style="height: 16px;">8</div><div class="ace_gutter-cell " style="height: 16px;">9</div><div class="ace_gutter-cell " style="height: 16px;">10</div></div><div class="ace_gutter-active-line" style="top: 154px; height: 16px;"></div></div><div class="ace_scroller" style="left: 48px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 826px; height: 212px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">emModel2</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">init</span>:<span class="ace_identifier">Model</span>,&nbsp;<span class="ace_identifier">data</span>:<span class="ace_support ace_function">Seq</span><span class="ace_paren ace_lparen">[(</span><span class="ace_identifier">Sentence</span>,<span class="ace_identifier">Sentence</span><span class="ace_paren ace_rparen">)]</span>,&nbsp;<span class="ace_identifier">iterations</span>:<span class="ace_support ace_function">Int</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">var</span>&nbsp;<span class="ace_identifier">model</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">init</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">var</span>&nbsp;<span class="ace_identifier">alignments</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">data</span>.<span class="ace_identifier">map</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">d</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_identifier">d</span>.<span class="ace_identifier">_2</span>.<span class="ace_identifier">tokens</span>.<span class="ace_identifier">map</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">t</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_identifier">d</span>.<span class="ace_identifier">_1</span>.<span class="ace_identifier">tokens</span>.<span class="ace_identifier">map</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_constant ace_numeric">0.0</span><span class="ace_paren ace_rparen">)))</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">for</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_constant ace_numeric">0</span>&nbsp;<span class="ace_identifier">until</span>&nbsp;<span class="ace_identifier">iterations</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword">yield</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">old</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">alignments</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">alignments</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">eStep</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">model</span>,&nbsp;<span class="ace_identifier">data</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">model</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">mStep</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">alignments</span>,&nbsp;<span class="ace_identifier">data</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">alignments</span>,<span class="ace_identifier">model</span>,<span class="ace_identifier">change</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">old</span>,<span class="ace_identifier">alignments</span><span class="ace_paren ace_rparen">))</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_paren ace_rparen">}</span>&nbsp;</div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 18.4025px; top: 144px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 180px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 48px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 826px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode34" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay34" class="cell" style="display: none;"><div class="text-center"><i class="fa fa-refresh fa-spin fa-lg"></i></div></div></div><div id="cell35" class="cellWrapper"><div id="editCell35" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor35" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode35" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay35" class="cell"><div class="newslide"></div><p>Initializing with the IBM Model 1 result gives us: </p></div></div><div id="cell36" class="cellWrapper"><div id="editCell36" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor36" class="cell editor ace_editor ace-chaos ace_dark" style="height: 84px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 16px; width: 7.20125px; left: 390.66px; top: 58px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 116px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div><div class="ace_gutter-cell " style="height: 16px;">2</div><div class="ace_gutter-cell " style="height: 16px;">3</div><div class="ace_gutter-cell " style="height: 16px;">4</div></div><div class="ace_gutter-active-line" style="top: 58px; height: 16px;"></div></div><div class="ace_scroller" style="left: 41px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 833px; height: 116px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">ibm1</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">ibm1Iterations</span>.<span class="ace_identifier">last</span>.<span class="ace_identifier">_2</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">ibm2Iterations</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">emModel2</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ibm1</span>,&nbsp;<span class="ace_identifier">trainM2</span>,&nbsp;<span class="ace_constant ace_numeric">100</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">ibm2</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">ibm2Iterations</span>.<span class="ace_identifier">last</span>.<span class="ace_identifier">_2</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_identifier">barChart</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ibm2</span>.<span class="ace_identifier">alpha</span>.<span class="ace_identifier">filter</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">_1</span>.<span class="ace_identifier">_2</span>&nbsp;<span class="ace_keyword ace_operator">==</span>&nbsp;<span class="ace_string">"house"</span><span class="ace_paren ace_rparen">))</span>&nbsp;</div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 349.66px; top: 48px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 84px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 41px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 833px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode36" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay36" class="cell"><div class="string-result"><div id="d3bar1199144467" class="wolfe-nvd3">
<svg class="nvd3-svg"><g class="nvd3 nv-wrap nv-discreteBarWithAxes"><g transform="translate(60,15)"><defs><clippath id="nv-x-label-clip-3987"><rect width="239.99999999999997" height="16" x="-119.99999999999999"></rect></clippath></defs><g class="nv-x nv-axis nvd3-svg" transform="translate(0,85)"><g class="nvd3 nv-wrap nv-axis"><g><g class="tick zero" transform="translate(73.33333333333333,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,5)" x="0" style="text-anchor: middle;">(mein,house)</text></g><g class="tick zero" transform="translate(206.66666666666666,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,17)" x="0" style="text-anchor: middle;">(das,house)</text></g><g class="tick zero" transform="translate(339.99999999999994,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,5)" x="0" style="text-anchor: middle;">(Haus,house)</text></g><g class="tick zero" transform="translate(473.33333333333326,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,17)" x="0" style="text-anchor: middle;">(ist,house)</text></g><g class="tick zero" transform="translate(606.6666666666666,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,5)" x="0" style="text-anchor: middle;">(klein,house)</text></g><path class="domain" d="M0,0V0H680V0"></path><text class="nv-axislabel" text-anchor="middle" y="36" x="340" transform="translate(0,17)"></text></g></g></g><g class="nv-y nv-axis nvd3-svg"><g class="nv-zeroLine"><line x1="0" x2="680" y1="85" y2="85"></line></g><g class="nvd3 nv-wrap nv-axis"><g><g class="tick zero" transform="translate(0,85)" style="opacity: 1;"><line x2="680" y2="0"></line><text dy=".32em" x="-3" opacity="0" style="text-anchor: end;" y="0">0.0</text></g><g class="tick" transform="translate(0,48.5)" style="opacity: 1;"><line x2="680" y2="0"></line><text dy=".32em" x="-3" opacity="1" style="text-anchor: end;" y="0">0.5</text></g><g class="tick" transform="translate(0,12)" opacity="0" style="opacity: 1;"><line x2="680" y2="0"></line><text dy=".32em" x="-3" opacity="0" style="text-anchor: end;" y="0">1.0</text></g><path class="domain" d="M0,12H0V85H0"></path><text class="nv-axislabel" transform="rotate(-90)" y="-50" x="-42.5" style="text-anchor: middle;"></text></g><g class="nv-axisMaxMin nv-axisMaxMin-y nv-axisMin-y" transform="translate(0,85)"><text dy=".32em" y="0" x="-3" text-anchor="end" style="opacity: 1;">0.0</text></g><g class="nv-axisMaxMin nv-axisMaxMin-y nv-axisMax-y" transform="translate(0,12)"><text dy=".32em" y="0" x="-3" text-anchor="end" style="opacity: 1;">1.0</text></g></g></g><g class="nv-barsWrap nvd3-svg"><g class="nvd3 nv-wrap nv-discretebar" transform="translate(0,0)"><g><g class="nv-groups"><g class="nv-group nv-series-0" style="stroke-opacity: 1; fill-opacity: 0.75;"><g transform="translate(19.33333396911621,84)" class="nv-bar positive" style="fill: rgb(31, 119, 180); stroke: rgb(31, 119, 180);"><rect height="1" width="107.99999999999999" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="53.99999999999999">0.00</text></g><g transform="translate(152.6666717529297,84)" class="nv-bar positive" style="fill: rgb(174, 199, 232); stroke: rgb(174, 199, 232);"><rect height="1" width="107.99999999999999" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="53.99999999999999">0.00</text></g><g transform="translate(286,12)" class="nv-bar positive" style="fill: rgb(255, 127, 14); stroke: rgb(255, 127, 14);"><rect height="73" width="107.99999999999999" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="53.99999999999999">1.00</text></g><g transform="translate(419.3333435058594,84)" class="nv-bar positive" style="fill: rgb(255, 187, 120); stroke: rgb(255, 187, 120);"><rect height="1" width="107.99999999999999" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="53.99999999999999">0.00</text></g><g transform="translate(552.6666870117188,84)" class="nv-bar positive" style="fill: rgb(44, 160, 44); stroke: rgb(44, 160, 44);"><rect height="1" width="107.99999999999999" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="53.99999999999999">0.00</text></g></g></g></g></g></g></g></g></svg>
</div>

<script>
console.log("Clearing svg");
$('#d3bar1199144467 svg').empty();
console.log(d3.select('#d3bar1199144467 svg').length);
console.log("Calling addGraph");
/*These lines are all chart setup.  Pick and choose which chart features you want to utilize. */

  nv.addGraph(function() {
  var chart = nv.models.discreteBarChart()
      .x(function(d) { return d.label })    //Specify the data accessors.
      .y(function(d) { return d.value })
      .staggerLabels(true)    //Too many bars and not enough room? Try staggering labels.
      .tooltips(false)        //Don't show tooltips
      .showValues(true)       //...instead, show the bar value right on top of each bar.

      ;
  console.log(chart);
  console.log("Inside addGraph");
  console.log(d3.select('#d3bar1199144467 svg'));
  d3.select('#d3bar1199144467 svg')
      .datum(
[{
key: "Whatever",
values: [{label:"(mein,house)", value:0.0},{label:"(das,house)", value:0.0},{label:"(Haus,house)", value:1.0},{label:"(ist,house)", value:0.0},{label:"(klein,house)", value:0.0}],
}]
    )
      .transition().duration(350)
      .call(chart);

  nv.utils.windowResize(chart.update);

  return chart;
});
</script></div></div></div><div id="cell37" class="cellWrapper"><div id="editCell37" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor37" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode37" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay37" class="cell"><div class="newslide"></div><p>For alignments we get:</p></div></div><div id="cell38" class="cellWrapper"><div id="editCell38" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor38" class="cell editor ace_editor ace-chaos ace_dark" style="height: 52px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 16px; width: 7.20125px; left: 649.905px; top: 26px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 84px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div><div class="ace_gutter-cell " style="height: 16px;">2</div></div><div class="ace_gutter-active-line" style="top: 26px; height: 16px;"></div></div><div class="ace_scroller" style="left: 41px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 833px; height: 84px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">ibm2Alignments</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">ibm2Iterations</span>.<span class="ace_identifier">last</span>.<span class="ace_identifier">_1</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_identifier">Renderer</span>.<span class="ace_identifier">renderWeightedAlignment</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">trainM2</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">_1</span>,&nbsp;<span class="ace_identifier">trainM2</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">_2</span>,&nbsp;<span class="ace_identifier">ibm2Alignments</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">))</span>&nbsp;&nbsp;&nbsp;</div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 608.905px; top: 16px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 52px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 41px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 833px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode38" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay38" class="cell"><div class="string-result"><div id="align52d99a9d-4067-4394-9ee9-d1f73b761e1b" class="aligner">
<svg><g><text x="20" y="20">NULL</text><text x="60.6796875" y="20">the</text><text x="87.361328125" y="20">house</text><text x="130.056640625" y="20">is</text><text x="148.72265625" y="20">small</text></g><g><text x="20" y="100">klein</text><text x="54.6796875" y="100">ist</text><text x="76.6796875" y="100">das</text><text x="106.02734375" y="100">Haus</text></g><line x1="35.3359375" y1="22.5" x2="32.3359375" y2="89" stroke-width="2" stroke="black" stroke-opacity="0"></line><line x1="69.0078125" y1="22.5" x2="32.3359375" y2="89" stroke-width="2" stroke="black" stroke-opacity="0"></line><line x1="103.703125" y1="22.5" x2="32.3359375" y2="89" stroke-width="2" stroke="black" stroke-opacity="0"></line><line x1="134.375" y1="22.5" x2="32.3359375" y2="89" stroke-width="2" stroke="black" stroke-opacity="0"></line><line x1="162.71875" y1="22.5" x2="32.3359375" y2="89" stroke-width="2" stroke="black" stroke-opacity="1"></line><line x1="35.3359375" y1="22.5" x2="60.671875" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.5"></line><line x1="69.0078125" y1="22.5" x2="60.671875" y2="89" stroke-width="2" stroke="black" stroke-opacity="0"></line><line x1="103.703125" y1="22.5" x2="60.671875" y2="89" stroke-width="2" stroke="black" stroke-opacity="0"></line><line x1="134.375" y1="22.5" x2="60.671875" y2="89" stroke-width="2" stroke="black" stroke-opacity="0.5"></line><line x1="162.71875" y1="22.5" x2="60.671875" y2="89" stroke-width="2" stroke="black" stroke-opacity="0"></line><line x1="35.3359375" y1="22.5" x2="86.34375" y2="89" stroke-width="2" stroke="black" stroke-opacity="0"></line><line x1="69.0078125" y1="22.5" x2="86.34375" y2="89" stroke-width="2" stroke="black" stroke-opacity="1"></line><line x1="103.703125" y1="22.5" x2="86.34375" y2="89" stroke-width="2" stroke="black" stroke-opacity="0"></line><line x1="134.375" y1="22.5" x2="86.34375" y2="89" stroke-width="2" stroke="black" stroke-opacity="0"></line><line x1="162.71875" y1="22.5" x2="86.34375" y2="89" stroke-width="2" stroke="black" stroke-opacity="0"></line><line x1="35.3359375" y1="22.5" x2="120.015625" y2="89" stroke-width="2" stroke="black" stroke-opacity="0"></line><line x1="69.0078125" y1="22.5" x2="120.015625" y2="89" stroke-width="2" stroke="black" stroke-opacity="0"></line><line x1="103.703125" y1="22.5" x2="120.015625" y2="89" stroke-width="2" stroke="black" stroke-opacity="1"></line><line x1="134.375" y1="22.5" x2="120.015625" y2="89" stroke-width="2" stroke="black" stroke-opacity="0"></line><line x1="162.71875" y1="22.5" x2="120.015625" y2="89" stroke-width="2" stroke="black" stroke-opacity="0"></line></svg>
</div>
<script>
  var s1Data = ["NULL","the","house","is","small"];
  var s2Data = ["klein","ist","das","Haus"];
  var connData = [{'i1':0, 'i2':0, 'weight':0.0 },{'i1':1, 'i2':0, 'weight':0.0 },{'i1':2, 'i2':0, 'weight':0.0 },{'i1':3, 'i2':0, 'weight':0.0 },{'i1':4, 'i2':0, 'weight':1.0 },{'i1':0, 'i2':1, 'weight':0.5 },{'i1':1, 'i2':1, 'weight':0.0 },{'i1':2, 'i2':1, 'weight':0.0 },{'i1':3, 'i2':1, 'weight':0.5 },{'i1':4, 'i2':1, 'weight':0.0 },{'i1':0, 'i2':2, 'weight':0.0 },{'i1':1, 'i2':2, 'weight':1.0 },{'i1':2, 'i2':2, 'weight':0.0 },{'i1':3, 'i2':2, 'weight':0.0 },{'i1':4, 'i2':2, 'weight':0.0 },{'i1':0, 'i2':3, 'weight':0.0 },{'i1':1, 'i2':3, 'weight':0.0 },{'i1':2, 'i2':3, 'weight':1.0 },{'i1':3, 'i2':3, 'weight':0.0 },{'i1':4, 'i2':3, 'weight':0.0 }]
  var svg = d3.select('#align52d99a9d-4067-4394-9ee9-d1f73b761e1b svg')

  function buildSentenceGroup(parent,data,y) {
    var groupElement = parent.append("g");
    var text = groupElement.selectAll("text")
      .data(data)
      .enter()
      .append("text");
    var textLabels = text
      .attr("x",function(d) { return 0; })
      .attr("y",function(d) { return y; })
      .text(function(d) {return d;});
    var current = 20;
    var gap = 10;
    var tokenOffsets = [current];
    for (i = 0; i < textLabels[0].length - 1; i++) {
      current += textLabels[0][i].getComputedTextLength() + gap;
      tokenOffsets.push(current);
    }
    console.log(tokenOffsets);
    textLabels
      .attr("x", function(d,i) { return tokenOffsets[i];});
    return groupElement;
  }

  var s1Group = buildSentenceGroup(svg,s1Data,20);
  var s2Group = buildSentenceGroup(svg,s2Data,100);

  var s1TokenTexts = s1Group[0][0].childNodes;
  var s2TokenTexts = s2Group[0][0].childNodes;

  var connections = svg.selectAll("line")
    .data(connData)
    .enter()
    .append("line")
    .attr("x1", function(d) { return s1TokenTexts[d.i1].getBBox().x + s1TokenTexts[d.i1].getBBox().width / 2; })
    .attr("y1", function(d) { return s1TokenTexts[d.i1].getBBox().y + s1TokenTexts[d.i1].getBBox().height; })
    .attr("x2", function(d) { return s2TokenTexts[d.i2].getBBox().x + s2TokenTexts[d.i2].getBBox().width / 2; })
    .attr("y2", function(d) { return s2TokenTexts[d.i2].getBBox().y; })
    .attr("stroke-width", 2)
    .attr("stroke", "black")
    .attr("stroke-opacity", function(d) { return 0; })
    .transition()
    .attr("stroke-opacity", function(d) { return d.weight; } );

  console.log(s1Group);
  console.log(s1TokenTexts);

</script></div></div></div><div id="cell39" class="cellWrapper"><div id="editCell39" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor39" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode39" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay39" class="cell"><div class="newslide"></div><p>Let us look at the distortion probabilities for a given source position and source and target lengths.</p></div></div><div id="cell40" class="cellWrapper"><div id="editCell40" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor40" class="cell editor ace_editor ace-chaos ace_dark" style="height: 52px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 16px; width: 7.20125px; left: 347.452px; top: 26px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 84px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div><div class="ace_gutter-cell " style="height: 16px;">2</div></div><div class="ace_gutter-active-line" style="top: 26px; height: 16px;"></div></div><div class="ace_scroller" style="left: 41px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 833px; height: 84px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"><div class="ace_bracket ace_start" style="height:16px;width:7.20125px;top:16px;left:61.61px;"></div></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">distort</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">si</span>:<span class="ace_support ace_function">Int</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_keyword">for</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ti</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_constant ace_numeric">0</span>&nbsp;<span class="ace_identifier">until</span>&nbsp;<span class="ace_constant ace_numeric">5</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword">yield</span>&nbsp;<span class="ace_identifier">ti</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_identifier">ibm2</span>.<span class="ace_identifier">beta</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ti</span>,<span class="ace_identifier">si</span>,<span class="ace_constant ace_numeric">5</span>,<span class="ace_constant ace_numeric">4</span><span class="ace_paren ace_rparen">)</span>&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_identifier">barChart</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">distort</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">0</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_identifier">color</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">Some</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"#fc0"</span><span class="ace_paren ace_rparen">))</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 306.452px; top: 16px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 52px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 41px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 833px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode40" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay40" class="cell"><div class="string-result"><div id="d3bar73403810" class="wolfe-nvd3">
<svg class="nvd3-svg"><g class="nvd3 nv-wrap nv-discreteBarWithAxes"><g transform="translate(60,15)"><defs><clippath id="nv-x-label-clip-3760"><rect width="239.99999999999997" height="16" x="-119.99999999999999"></rect></clippath></defs><g class="nv-x nv-axis nvd3-svg" transform="translate(0,85)"><g class="nvd3 nv-wrap nv-axis"><g><g class="tick zero" transform="translate(73.33333333333333,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,5)" x="0" style="text-anchor: middle;">0</text></g><g class="tick" transform="translate(206.66666666666666,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,17)" x="0" style="text-anchor: middle;">1</text></g><g class="tick" transform="translate(339.99999999999994,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,5)" x="0" style="text-anchor: middle;">2</text></g><g class="tick" transform="translate(473.33333333333326,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,17)" x="0" style="text-anchor: middle;">3</text></g><g class="tick" transform="translate(606.6666666666666,0)" style="opacity: 1;"><line y2="-85" x2="0"></line><text dy=".71em" y="3" transform="translate(0,5)" x="0" style="text-anchor: middle;">4</text></g><path class="domain" d="M0,0V0H680V0"></path><text class="nv-axislabel" text-anchor="middle" y="36" x="340" transform="translate(0,17)"></text></g></g></g><g class="nv-y nv-axis nvd3-svg"><g class="nv-zeroLine"><line x1="0" x2="680" y1="85" y2="85"></line></g><g class="nvd3 nv-wrap nv-axis"><g><g class="tick zero" transform="translate(0,85)" style="opacity: 1;"><line x2="680" y2="0"></line><text dy=".32em" x="-3" opacity="0" style="text-anchor: end;" y="0">0.0</text></g><g class="tick" transform="translate(0,48.5)" style="opacity: 1;"><line x2="680" y2="0"></line><text dy=".32em" x="-3" opacity="1" style="text-anchor: end;" y="0">0.5</text></g><g class="tick" transform="translate(0,12)" opacity="0" style="opacity: 1;"><line x2="680" y2="0"></line><text dy=".32em" x="-3" opacity="0" style="text-anchor: end;" y="0">1.0</text></g><path class="domain" d="M0,12H0V85H0"></path><text class="nv-axislabel" transform="rotate(-90)" y="-50" x="-42.5" style="text-anchor: middle;"></text></g><g class="nv-axisMaxMin nv-axisMaxMin-y nv-axisMin-y" transform="translate(0,85)"><text dy=".32em" y="0" x="-3" text-anchor="end" style="opacity: 1;">0.0</text></g><g class="nv-axisMaxMin nv-axisMaxMin-y nv-axisMax-y" transform="translate(0,12)"><text dy=".32em" y="0" x="-3" text-anchor="end" style="opacity: 1;">1.0</text></g></g></g><g class="nv-barsWrap nvd3-svg"><g class="nvd3 nv-wrap nv-discretebar" transform="translate(0,0)"><g><g class="nv-groups"><g class="nv-group nv-series-0" style="stroke-opacity: 1; fill-opacity: 0.75;"><g transform="translate(19.33333396911621,84)" class="nv-bar positive" style="fill: rgb(255, 204, 0); stroke: rgb(255, 204, 0);"><rect height="1" width="107.99999999999999" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="53.99999999999999">0.00</text></g><g transform="translate(152.6666717529297,84)" class="nv-bar positive" style="fill: rgb(255, 204, 0); stroke: rgb(255, 204, 0);"><rect height="1" width="107.99999999999999" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="53.99999999999999">0.00</text></g><g transform="translate(286,84)" class="nv-bar positive" style="fill: rgb(255, 204, 0); stroke: rgb(255, 204, 0);"><rect height="1" width="107.99999999999999" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="53.99999999999999">0.00</text></g><g transform="translate(419.3333435058594,84)" class="nv-bar positive" style="fill: rgb(255, 204, 0); stroke: rgb(255, 204, 0);"><rect height="1" width="107.99999999999999" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="53.99999999999999">0.00</text></g><g transform="translate(552.6666870117188,12)" class="nv-bar positive" style="fill: rgb(255, 204, 0); stroke: rgb(255, 204, 0);"><rect height="73" width="107.99999999999999" class="discreteBar"></rect><text text-anchor="middle" y="-4" x="53.99999999999999">1.00</text></g></g></g></g></g></g></g></g></svg>
</div>

<script>
console.log("Clearing svg");
$('#d3bar73403810 svg').empty();
console.log(d3.select('#d3bar73403810 svg').length);
console.log("Calling addGraph");
/*These lines are all chart setup.  Pick and choose which chart features you want to utilize. */

  nv.addGraph(function() {
  var chart = nv.models.discreteBarChart()
      .x(function(d) { return d.label })    //Specify the data accessors.
      .y(function(d) { return d.value })
      .staggerLabels(true)    //Too many bars and not enough room? Try staggering labels.
      .tooltips(false)        //Don't show tooltips
      .showValues(true)       //...instead, show the bar value right on top of each bar.
      .color(['#fc0'])
      ;
  console.log(chart);
  console.log("Inside addGraph");
  console.log(d3.select('#d3bar73403810 svg'));
  d3.select('#d3bar73403810 svg')
      .datum(
[{
key: "Whatever",
values: [{label:"0", value:0.0},{label:"1", value:0.0},{label:"2", value:0.0},{label:"3", value:0.0},{label:"4", value:1.0}],
}]
    )
      .transition().duration(350)
      .call(chart);

  nv.utils.windowResize(chart.update);

  return chart;
});
</script></div></div></div><div id="cell41" class="cellWrapper"><div id="editCell41" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor41" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode41" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay41" class="cell"><div class="newslide"></div><h4>Decoding for IBM Model 2</h4><p>Decoding IBM Model 2 requires us to solve the argmax problem in equation <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-136-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MathJax_ref&quot; href=&quot;#mjx-eqn-decode-nc&quot;&gt;&lt;mtext&gt;2&lt;/mtext&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2116" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.49em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-2117"><a href="../01_tasks/02_wordmt.html#mjx-eqn-decode-nc"><span class="mrow MathJax_ref" id="MathJax-Span-2118"><span class="mtext" id="MathJax-Span-2119" style="font-family: STIXGeneral-Regular;">2</span></span></a></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.892em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MathJax_ref" href="#mjx-eqn-decode-nc"><mtext>2</mtext></mrow></math></span></span><script type="math/tex" id="MathJax-Element-136">\ref{decode-nc}</script>, this time using the conditional probability from equation <span class="MathJax_Preview" style="color: inherit;"></span><span class="MathJax" id="MathJax-Element-137-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MathJax_ref&quot; href=&quot;#mjx-eqn-ibm2&quot;&gt;&lt;mtext&gt;3&lt;/mtext&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2120" role="math" style="width: 0.63em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.534em; height: 0px; font-size: 115%;"><span style="position: absolute; clip: rect(1.693em 1000.49em 2.659em -999.998em); top: -2.51em; left: 0.002em;"><span class="mrow" id="MathJax-Span-2121"><a href="../01_tasks/02_wordmt.html#mjx-eqn-ibm2"><span class="mrow MathJax_ref" id="MathJax-Span-2122"><span class="mtext" id="MathJax-Span-2123" style="font-family: STIXGeneral-Regular;">3</span></span></a></span><span style="display: inline-block; width: 0px; height: 2.514em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 0.892em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MathJax_ref" href="#mjx-eqn-ibm2"><mtext>3</mtext></mrow></math></span></span><script type="math/tex" id="MathJax-Element-137">\ref{ibm2}</script> with the hidden alignments marginalized out: <span class="summary">Decoding IBM Model 2 ideally means:</span></p><p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display"><span class="MathJax" id="MathJax-Element-138-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable displaystyle=&quot;true&quot;&gt;&lt;mlabeledtr&gt;&lt;mtd id=&quot;mjx-eqn-4&quot;&gt;&lt;mtext&gt;(4)&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;munder&gt;&lt;mrow class=&quot;MJX-TeXAtom-OP&quot;&gt;&lt;mi&gt;arg&lt;/mi&gt;&lt;mspace width=&quot;thinmathspace&quot; /&gt;&lt;mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;&gt;max&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mtext&gt;IBM2&lt;/mtext&gt;&lt;/msubsup&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;munder&gt;&lt;mrow class=&quot;MJX-TeXAtom-OP&quot;&gt;&lt;mi&gt;arg&lt;/mi&gt;&lt;mspace width=&quot;thinmathspace&quot; /&gt;&lt;mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;&gt;max&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;msubsup&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mtext&gt;IBM2&lt;/mtext&gt;&lt;/msubsup&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mlabeledtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="width: 100%; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2124" role="math" style="width: 100%; display: inline-block; min-width: 22.708em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; font-size: 115%; min-width: 22.708em;"><span style="position: absolute; clip: rect(2.514em 1018.5em 5.027em -999.998em); top: -4.007em; left: 0.002em; width: 100%;"><span class="mrow" id="MathJax-Span-2125"><span class="mtable" id="MathJax-Span-2126" style="min-width: 22.708em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; min-width: 22.708em;"><span style="display: inline-block; position: absolute; width: 18.553em; height: 0px; clip: rect(-1.495em 1018.5em 1.017em -999.998em); top: 0.002em; left: 50%; margin-left: -9.273em;"><span style="position: absolute; clip: rect(2.514em 1018.5em 5.027em -999.998em); top: -4.007em; left: 0.002em;"><span style="display: inline-block; position: relative; width: 18.553em; height: 0px;"><span style="position: absolute; clip: rect(2.901em 1018.5em 5.413em -999.998em); top: -4.394em; left: 50%; margin-left: -9.273em;"><span class="mtd" id="MathJax-Span-2130"><span class="mrow" id="MathJax-Span-2131"><span class="munderover" id="MathJax-Span-2132"><span style="display: inline-block; position: relative; width: 3.384em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1003.38em 4.399em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-2133"><span class="mrow" id="MathJax-Span-2134"><span class="mi" id="MathJax-Span-2135" style="font-family: STIXGeneral-Regular;">arg</span><span class="mspace" id="MathJax-Span-2136" style="height: 0.002em; vertical-align: 0.002em; width: 0.196em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-2137" style="font-family: STIXGeneral-Regular; padding-left: 0.196em;">max</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.432em 1000.24em 4.254em -999.998em); top: -3.138em; left: 1.597em;"><span class="texatom" id="MathJax-Span-2138"><span class="mrow" id="MathJax-Span-2139"><span class="texatom" id="MathJax-Span-2140"><span class="mrow" id="MathJax-Span-2141"><span class="mi" id="MathJax-Span-2142" style="font-size: 70.7%; font-family: STIXGeneral; font-weight: bold;">t</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-2143"></span><span class="msubsup" id="MathJax-Span-2144" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 2.273em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.49em 4.35em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-2145" style="font-family: STIXGeneral-Italic;">p</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1001.79em 4.157em -999.998em); top: -4.345em; left: 0.486em;"><span class="mtext" id="MathJax-Span-2146" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">IBM2</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1000.44em 4.157em -999.998em); top: -3.669em; left: 0.486em;"><span class="mi" id="MathJax-Span-2147" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-2148" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-2149"><span class="mrow" id="MathJax-Span-2150"><span class="mi" id="MathJax-Span-2151" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="texatom" id="MathJax-Span-2152"><span class="mrow" id="MathJax-Span-2153"><span class="mo" id="MathJax-Span-2154" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-2155"><span class="mrow" id="MathJax-Span-2156"><span class="mi" id="MathJax-Span-2157" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-2158" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-2159" style="font-family: STIXGeneral-Regular; padding-left: 0.292em;">=</span><span class="munderover" id="MathJax-Span-2160" style="padding-left: 0.292em;"><span style="display: inline-block; position: relative; width: 3.384em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1003.38em 4.399em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-2161"><span class="mrow" id="MathJax-Span-2162"><span class="mi" id="MathJax-Span-2163" style="font-family: STIXGeneral-Regular;">arg</span><span class="mspace" id="MathJax-Span-2164" style="height: 0.002em; vertical-align: 0.002em; width: 0.196em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-2165" style="font-family: STIXGeneral-Regular; padding-left: 0.196em;">max</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.432em 1000.24em 4.254em -999.998em); top: -3.138em; left: 1.597em;"><span class="texatom" id="MathJax-Span-2166"><span class="mrow" id="MathJax-Span-2167"><span class="texatom" id="MathJax-Span-2168"><span class="mrow" id="MathJax-Span-2169"><span class="mi" id="MathJax-Span-2170" style="font-size: 70.7%; font-family: STIXGeneral; font-weight: bold;">t</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-2171"></span><span class="munderover" id="MathJax-Span-2172" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 1.307em; height: 0px;"><span style="position: absolute; clip: rect(2.901em 1001.21em 4.64em -999.998em); top: -4.007em; left: 0.002em;"><span class="mo" id="MathJax-Span-2173" style="font-family: STIXSizeOneSym; vertical-align: -0.529em;">∑</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.529em 1000.34em 4.254em -999.998em); top: -2.848em; left: 0.486em;"><span class="texatom" id="MathJax-Span-2174"><span class="mrow" id="MathJax-Span-2175"><span class="texatom" id="MathJax-Span-2176"><span class="mrow" id="MathJax-Span-2177"><span class="mi" id="MathJax-Span-2178" style="font-size: 70.7%; font-family: STIXGeneral; font-weight: bold;">a</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-2179" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 2.273em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.49em 4.35em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-2180" style="font-family: STIXGeneral-Italic;">p</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1001.79em 4.157em -999.998em); top: -4.345em; left: 0.486em;"><span class="mtext" id="MathJax-Span-2181" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">IBM2</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1000.44em 4.157em -999.998em); top: -3.669em; left: 0.486em;"><span class="mi" id="MathJax-Span-2182" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-2183" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-2184"><span class="mrow" id="MathJax-Span-2185"><span class="mi" id="MathJax-Span-2186" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-2187" style="font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-2188" style="padding-left: 0.196em;"><span class="mrow" id="MathJax-Span-2189"><span class="mi" id="MathJax-Span-2190" style="font-family: STIXGeneral; font-weight: bold;">a</span></span></span><span class="texatom" id="MathJax-Span-2191"><span class="mrow" id="MathJax-Span-2192"><span class="mo" id="MathJax-Span-2193" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-2194"><span class="mrow" id="MathJax-Span-2195"><span class="mi" id="MathJax-Span-2196" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-2197" style="font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span><span style="display: inline-block; position: absolute; width: 1.162em; height: 0px; clip: rect(-1.205em 1001.11em -0.046em -999.998em); top: 0.002em; right: 0.002em; margin-right: 0.002em;"><span style="position: absolute; clip: rect(3.191em 1001.11em 4.35em -999.998em); top: -4.394em; right: 0.002em;"><span class="mtd" id="mjx-eqn-4"><span class="mrow" id="MathJax-Span-2128"><span class="mtext" id="MathJax-Span-2129" style="font-family: STIXGeneral-Regular;">(4)</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.053em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 2.669em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true"><mlabeledtr><mtd id="mjx-eqn-4"><mtext>(4)</mtext></mtd><mtd><munder><mrow class="MJX-TeXAtom-OP"><mi>arg</mi><mspace width="thinmathspace"></mspace><mo movablelimits="true" form="prefix">max</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow></mrow></munder><mo>⁡</mo><msubsup><mi>p</mi><mi mathvariant="bold-italic">θ</mi><mtext>IBM2</mtext></msubsup><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo><mo>=</mo><munder><mrow class="MJX-TeXAtom-OP"><mi>arg</mi><mspace width="thinmathspace"></mspace><mo movablelimits="true" form="prefix">max</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow></mrow></munder><mo>⁡</mo><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow></mrow></munder><msubsup><mi>p</mi><mi mathvariant="bold-italic">θ</mi><mtext>IBM2</mtext></msubsup><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo></mtd></mlabeledtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-138">\begin{equation}  \argmax_{\target} p_\params^\text{IBM2}(\source | \target) =  \argmax_{\target} \sum_{\aligns} p_\params^\text{IBM2}(\source,\aligns | \target) \end{equation}</script></p>
<div class="newslide"></div><p>This nested argmax and sum is generally computationally very hard (see <a href="http://arxiv.org/pdf/1107.0024.pdf">Park and Darwiche</a>), and often replaced with the simpler problem of finding a combination of best target sequence and corresponding alignment. <span class="summary">This nested argmax/sum is generally <strong>computationally very hard</strong>. It's easier to argmax over target and alignments: </span> </p><p><span class="MathJax_Preview" style="color: inherit;"></span><div class="MathJax_Display"><span class="MathJax" id="MathJax-Element-139-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mtable displaystyle=&quot;true&quot;&gt;&lt;mlabeledtr&gt;&lt;mtd id=&quot;mjx-eqn-5&quot;&gt;&lt;mtext&gt;(5)&lt;/mtext&gt;&lt;/mtd&gt;&lt;mtd&gt;&lt;munder&gt;&lt;mrow class=&quot;MJX-TeXAtom-OP&quot;&gt;&lt;mi&gt;arg&lt;/mi&gt;&lt;mspace width=&quot;thinmathspace&quot; /&gt;&lt;mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;&gt;max&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/munder&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;msubsup&gt;&lt;mi&gt;p&lt;/mi&gt;&lt;mi mathvariant=&quot;bold-italic&quot;&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mtext&gt;IBM2&lt;/mtext&gt;&lt;/msubsup&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;s&lt;/mi&gt;&lt;/mrow&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;a&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;bold&quot;&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/mtd&gt;&lt;/mlabeledtr&gt;&lt;/mtable&gt;&lt;/math&gt;" role="presentation" style="width: 100%; position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-2198" role="math" style="width: 100%; display: inline-block; min-width: 12.514em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; font-size: 115%; min-width: 12.514em;"><span style="position: absolute; clip: rect(2.659em 1008.31em 4.882em -999.998em); top: -4.007em; left: 0.002em; width: 100%;"><span class="mrow" id="MathJax-Span-2199"><span class="mtable" id="MathJax-Span-2200" style="min-width: 12.514em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; min-width: 12.514em;"><span style="display: inline-block; position: absolute; width: 8.36em; height: 0px; clip: rect(-1.35em 1008.31em 0.872em -999.998em); top: 0.002em; left: 50%; margin-left: -4.2em;"><span style="position: absolute; clip: rect(2.659em 1008.31em 4.882em -999.998em); top: -4.007em; left: 0.002em;"><span style="display: inline-block; position: relative; width: 8.36em; height: 0px;"><span style="position: absolute; clip: rect(3.046em 1008.31em 5.268em -999.998em); top: -4.394em; left: 50%; margin-left: -4.2em;"><span class="mtd" id="MathJax-Span-2204"><span class="mrow" id="MathJax-Span-2205"><span class="munderover" id="MathJax-Span-2206"><span style="display: inline-block; position: relative; width: 3.384em; height: 0px;"><span style="position: absolute; clip: rect(3.384em 1003.38em 4.399em -999.998em); top: -4.007em; left: 0.002em;"><span class="texatom" id="MathJax-Span-2207"><span class="mrow" id="MathJax-Span-2208"><span class="mi" id="MathJax-Span-2209" style="font-family: STIXGeneral-Regular;">arg</span><span class="mspace" id="MathJax-Span-2210" style="height: 0.002em; vertical-align: 0.002em; width: 0.196em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-2211" style="font-family: STIXGeneral-Regular; padding-left: 0.196em;">max</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.432em 1000.77em 4.35em -999.998em); top: -3.138em; left: 1.307em;"><span class="texatom" id="MathJax-Span-2212"><span class="mrow" id="MathJax-Span-2213"><span class="texatom" id="MathJax-Span-2214"><span class="mrow" id="MathJax-Span-2215"><span class="mi" id="MathJax-Span-2216" style="font-size: 70.7%; font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-2217" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-2218"><span class="mrow" id="MathJax-Span-2219"><span class="mi" id="MathJax-Span-2220" style="font-size: 70.7%; font-family: STIXGeneral; font-weight: bold;">a</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-2221"></span><span class="msubsup" id="MathJax-Span-2222" style="padding-left: 0.196em;"><span style="display: inline-block; position: relative; width: 2.273em; height: 0px;"><span style="position: absolute; clip: rect(3.432em 1000.49em 4.35em -999.998em); top: -4.007em; left: 0.002em;"><span class="mi" id="MathJax-Span-2223" style="font-family: STIXGeneral-Italic;">p</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1001.79em 4.157em -999.998em); top: -4.345em; left: 0.486em;"><span class="mtext" id="MathJax-Span-2224" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">IBM2</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span><span style="position: absolute; clip: rect(3.384em 1000.44em 4.157em -999.998em); top: -3.669em; left: 0.486em;"><span class="mi" id="MathJax-Span-2225" style="font-size: 70.7%; font-family: STIXGeneral; font-style: italic; font-weight: bold;">θ</span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span><span class="mo" id="MathJax-Span-2226" style="font-family: STIXGeneral-Regular;">(</span><span class="texatom" id="MathJax-Span-2227"><span class="mrow" id="MathJax-Span-2228"><span class="mi" id="MathJax-Span-2229" style="font-family: STIXGeneral; font-weight: bold;">s</span></span></span><span class="mo" id="MathJax-Span-2230" style="font-family: STIXGeneral-Regular;">,</span><span class="texatom" id="MathJax-Span-2231" style="padding-left: 0.196em;"><span class="mrow" id="MathJax-Span-2232"><span class="mi" id="MathJax-Span-2233" style="font-family: STIXGeneral; font-weight: bold;">a</span></span></span><span class="texatom" id="MathJax-Span-2234"><span class="mrow" id="MathJax-Span-2235"><span class="mo" id="MathJax-Span-2236" style="font-family: STIXGeneral-Regular;">|</span></span></span><span class="texatom" id="MathJax-Span-2237"><span class="mrow" id="MathJax-Span-2238"><span class="mi" id="MathJax-Span-2239" style="font-family: STIXGeneral; font-weight: bold;">t</span></span></span><span class="mo" id="MathJax-Span-2240" style="font-family: STIXGeneral-Regular;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span><span style="display: inline-block; position: absolute; width: 1.162em; height: 0px; clip: rect(-1.205em 1001.11em -0.046em -999.998em); top: 0.002em; right: 0.002em; margin-right: 0.002em;"><span style="position: absolute; clip: rect(3.191em 1001.11em 4.35em -999.998em); top: -4.394em; right: 0.002em;"><span class="mtd" id="mjx-eqn-5"><span class="mrow" id="MathJax-Span-2202"><span class="mtext" id="MathJax-Span-2203" style="font-family: STIXGeneral-Regular;">(5)</span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.012em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.886em; border-left-width: 0px; border-left-style: solid; width: 0px; height: 2.336em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mtable displaystyle="true"><mlabeledtr><mtd id="mjx-eqn-5"><mtext>(5)</mtext></mtd><mtd><munder><mrow class="MJX-TeXAtom-OP"><mi>arg</mi><mspace width="thinmathspace"></mspace><mo movablelimits="true" form="prefix">max</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow></mrow></munder><mo>⁡</mo><msubsup><mi>p</mi><mi mathvariant="bold-italic">θ</mi><mtext>IBM2</mtext></msubsup><mo stretchy="false">(</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">s</mi></mrow><mo>,</mo><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">a</mi></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="bold">t</mi></mrow><mo stretchy="false">)</mo></mtd></mlabeledtr></mtable></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-139">\begin{equation}  \argmax_{\target,\aligns} p_\params^\text{IBM2}(\source,\aligns | \target) \end{equation}</script></p><p>As it turns out for IBM Model 2 the sum can be efficiently calculated, and <a href="http://aclweb.org/anthology/P/P97/P97-1047.pdf">Wang and Waibel</a> show a stack based decoder that does take this into account. <span class="summary"></span> </p>
<div class="newslide"></div><p>However, both for simplicity of exposition and because for most real-world models this marginalization is not possible, we present a decoder that searches over both target and alignment. To simplify the algorithm further we assume that target and source sentences have to have them same length. Of course this is a major restriction, and it is not necessary, but makes the algorithm easier to explain while maintaining the core mechanism. Here we only show only the Scala code and refer the reader to our <a href="https://www.dropbox.com/s/p495n19h5rtk3uf/IBM-decoding.pdf?dl=0">slides</a> for an illustration of how stack and beam based decoders work. <span class="summary">A simplified <strong>same-length</strong> decoder in Scala, using a <a href="https://www.dropbox.com/s/p495n19h5rtk3uf/IBM-decoding.pdf?dl=0">beam</a>:</span> </p></div></div><div id="cell42" class="cellWrapper"><div id="editCell42" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor42" class="cell editor ace_editor ace-chaos ace_dark" style="height: 532px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 16px; width: 7.20125px; left: 66.4025px; top: 506px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 564px; width: 48px;"><div class="ace_gutter-cell " style="height: 16px;">1</div><div class="ace_gutter-cell " style="height: 16px;">2</div><div class="ace_gutter-cell " style="height: 16px;">3</div><div class="ace_gutter-cell " style="height: 16px;">4</div><div class="ace_gutter-cell " style="height: 16px;">5</div><div class="ace_gutter-cell " style="height: 16px;">6</div><div class="ace_gutter-cell " style="height: 16px;">7<span class="ace_fold-widget ace_start ace_open" style="height: 16px;"></span></div><div class="ace_gutter-cell " style="height: 16px;">8</div><div class="ace_gutter-cell " style="height: 16px;">9<span class="ace_fold-widget ace_start ace_open" style="height: 16px;"></span></div><div class="ace_gutter-cell " style="height: 16px;">10</div><div class="ace_gutter-cell " style="height: 16px;">11</div><div class="ace_gutter-cell " style="height: 16px;">12</div><div class="ace_gutter-cell " style="height: 32px;">13</div><div class="ace_gutter-cell " style="height: 16px;">14</div><div class="ace_gutter-cell " style="height: 16px;">15</div><div class="ace_gutter-cell " style="height: 16px;">16<span class="ace_fold-widget ace_start ace_open" style="height: 16px;"></span></div><div class="ace_gutter-cell " style="height: 16px;">17</div><div class="ace_gutter-cell " style="height: 16px;">18</div><div class="ace_gutter-cell " style="height: 16px;">19</div><div class="ace_gutter-cell " style="height: 16px;">20</div><div class="ace_gutter-cell " style="height: 16px;">21</div><div class="ace_gutter-cell " style="height: 16px;">22</div><div class="ace_gutter-cell " style="height: 16px;">23</div><div class="ace_gutter-cell " style="height: 16px;">24</div><div class="ace_gutter-cell " style="height: 16px;">25<span class="ace_fold-widget ace_start ace_open" style="height: 16px;"></span></div><div class="ace_gutter-cell " style="height: 16px;">26</div><div class="ace_gutter-cell " style="height: 16px;">27</div><div class="ace_gutter-cell " style="height: 16px;">28</div><div class="ace_gutter-cell " style="height: 16px;">29</div><div class="ace_gutter-cell " style="height: 16px;">30</div><div class="ace_gutter-cell " style="height: 16px;">31</div></div><div class="ace_gutter-active-line" style="top: 506px; height: 16px;"></div></div><div class="ace_scroller" style="left: 48px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 826px; height: 564px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">case</span>&nbsp;<span class="ace_keyword">class</span>&nbsp;<span class="ace_identifier">Hypothesis</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">target</span>:<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">[</span><span class="ace_support ace_function">String</span><span class="ace_paren ace_rparen">]</span>,&nbsp;<span class="ace_identifier">align</span>:<span class="ace_identifier">Map</span><span class="ace_paren ace_lparen">[</span><span class="ace_support ace_function">Int</span>,<span class="ace_support ace_function">Int</span><span class="ace_paren ace_rparen">]</span>,&nbsp;<span class="ace_identifier">remaining</span>:<span class="ace_identifier">Set</span><span class="ace_paren ace_lparen">[</span><span class="ace_support ace_function">Int</span><span class="ace_paren ace_rparen">]</span>,</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;<span class="ace_identifier">score</span>:<span class="ace_support ace_function">Double</span>,&nbsp;<span class="ace_identifier">parent</span>:<span class="ace_support ace_function">Option</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">Hypothesis</span><span class="ace_paren ace_rparen">]</span><span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">None</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">type</span>&nbsp;<span class="ace_identifier">Beam</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">Hypothesis</span><span class="ace_paren ace_rparen">]</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">decodeModel2</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">tm</span>:<span class="ace_identifier">Model</span>,&nbsp;<span class="ace_identifier">lm</span>:<span class="ace_identifier">LanguageModel</span>,&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;<span class="ace_identifier">source</span>:<span class="ace_identifier">IndexedSeq</span><span class="ace_paren ace_lparen">[</span><span class="ace_support ace_function">String</span><span class="ace_paren ace_rparen">]</span>,&nbsp;<span class="ace_identifier">beamSize</span>:<span class="ace_support ace_function">Int</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">score</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">hyp</span>:<span class="ace_identifier">Hypothesis</span>,<span class="ace_identifier">newTarget</span>:<span class="ace_support ace_function">String</span>,<span class="ace_identifier">sourceIndex</span>:<span class="ace_support ace_function">Int</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">targetLength</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">source</span>.<span class="ace_identifier">length</span>&nbsp;<span class="ace_keyword ace_operator">+</span>&nbsp;<span class="ace_constant ace_numeric">1</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">history</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">hyp</span>.<span class="ace_identifier">target</span>.<span class="ace_identifier">take</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">lm</span>.<span class="ace_identifier">order</span>&nbsp;<span class="ace_keyword ace_operator">-</span>&nbsp;<span class="ace_constant ace_numeric">1</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">reverse</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">lmProb</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">math</span>.<span class="ace_identifier">log</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">lm</span>.<span class="ace_identifier">probability</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">newTarget</span>,<span class="ace_identifier">history</span>:<span class="ace_identifier">_</span><span class="ace_keyword ace_operator">*</span><span class="ace_paren ace_rparen">))</span></div></div><div class="ace_line_group" style="height:32px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">tmProb</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">math</span>.<span class="ace_identifier">log</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">tm</span>.<span class="ace_identifier">alpha</span><span class="ace_paren ace_lparen">((</span><span class="ace_identifier">source</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">sourceIndex</span><span class="ace_paren ace_rparen">)</span>,<span class="ace_identifier">newTarget</span><span class="ace_paren ace_rparen">)))</span>&nbsp;<span class="ace_keyword ace_operator">+</span>&nbsp;<span class="ace_identifier">math</span>.<span class="ace_identifier">log</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">tm</span>.<span class="ace_identifier">beta</span><span class="ace_paren ace_lparen">((</span><span class="ace_identifier">hyp</span>.<span class="ace_identifier">target</span>&nbsp;.<span class="ace_identifier">length</span>,&nbsp;</div><div class="ace_line" style="height:16px"><span class="ace_identifier">sourceIndex</span>,&nbsp;<span class="ace_identifier">targetLength</span>,&nbsp;<span class="ace_identifier">source</span>.<span class="ace_identifier">length</span><span class="ace_paren ace_rparen">)))</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">lmProb</span>&nbsp;<span class="ace_keyword ace_operator">+</span>&nbsp;<span class="ace_identifier">tmProb</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">def</span>&nbsp;<span class="ace_identifier">append</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">hyp</span>:<span class="ace_identifier">Hypothesis</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_paren ace_lparen">{</span>&nbsp;<span class="ace_keyword">for</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">sourceIndex</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_identifier">hyp</span>.<span class="ace_identifier">remaining</span>;&nbsp;<span class="ace_identifier">targetWord</span>&nbsp;<span class="ace_keyword ace_operator">&lt;-</span>&nbsp;<span class="ace_identifier">lm</span>.<span class="ace_identifier">vocab</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_keyword">yield</span>&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">Hypothesis</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">targetWord</span>&nbsp;::&nbsp;<span class="ace_identifier">hyp</span>.<span class="ace_identifier">target</span>,&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;<span class="ace_identifier">hyp</span>.<span class="ace_identifier">align</span>&nbsp;<span class="ace_keyword ace_operator">+</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">sourceIndex</span>&nbsp;<span class="ace_keyword ace_operator">-&gt;</span>&nbsp;<span class="ace_identifier">hyp</span>.<span class="ace_identifier">target</span>.<span class="ace_identifier">length</span><span class="ace_paren ace_rparen">)</span>,&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;<span class="ace_identifier">hyp</span>.<span class="ace_identifier">remaining</span>&nbsp;<span class="ace_keyword ace_operator">-</span>&nbsp;<span class="ace_identifier">sourceIndex</span>,&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;<span class="ace_identifier">hyp</span>.<span class="ace_identifier">score</span>&nbsp;<span class="ace_keyword ace_operator">+</span>&nbsp;<span class="ace_identifier">score</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">hyp</span>,<span class="ace_identifier">targetWord</span>,<span class="ace_identifier">sourceIndex</span><span class="ace_paren ace_rparen">)</span>,&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="ace_indent-guide">&nbsp;&nbsp;&nbsp;&nbsp;</span>&nbsp;&nbsp;&nbsp;<span class="ace_identifier">Some</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">hyp</span><span class="ace_paren ace_rparen">))}</span>&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">var</span>&nbsp;<span class="ace_identifier">beam</span>:<span class="ace_identifier">Beam</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">Hypothesis</span><span class="ace_paren ace_lparen">(</span><span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"NULL"</span><span class="ace_paren ace_rparen">)</span>,&nbsp;<span class="ace_identifier">Map</span>.<span class="ace_identifier">empty</span>,&nbsp;<span class="ace_identifier">source</span>.<span class="ace_identifier">indices</span>.<span class="ace_identifier">toSet</span>,&nbsp;&nbsp;<span class="ace_constant ace_numeric">0.0</span><span class="ace_paren ace_rparen">))</span>&nbsp;&nbsp;&nbsp;&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">var</span>&nbsp;<span class="ace_identifier">history</span>:<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">[</span><span class="ace_identifier">Beam</span><span class="ace_paren ace_rparen">]</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_support ace_function">List</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">beam</span><span class="ace_paren ace_rparen">)</span>&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_keyword">while</span>&nbsp;<span class="ace_paren ace_lparen">(</span><span class="ace_identifier">beam</span>.<span class="ace_identifier">head</span>.<span class="ace_identifier">remaining</span>.<span class="ace_identifier">nonEmpty</span><span class="ace_paren ace_rparen">)</span>&nbsp;<span class="ace_paren ace_lparen">{</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">withNewTarget</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">beam</span>.<span class="ace_identifier">flatMap</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">hyp</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_identifier">append</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">hyp</span><span class="ace_paren ace_rparen">))</span>.<span class="ace_identifier">distinct</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">beam</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">withNewTarget</span>.<span class="ace_identifier">sortBy</span><span class="ace_paren ace_lparen">(</span><span class="ace_keyword ace_operator">-</span><span class="ace_identifier">_</span>.<span class="ace_identifier">score</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">take</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">beamSize</span><span class="ace_paren ace_rparen">)</span>.<span class="ace_identifier">toList</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;&nbsp;&nbsp;<span class="ace_identifier">history</span>&nbsp;::<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">beam</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_paren ace_rparen">}</span>&nbsp;&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px">&nbsp;&nbsp;<span class="ace_identifier">history</span>.<span class="ace_identifier">map</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">map</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">h</span>&nbsp;<span class="ace_keyword ace_operator">=&gt;</span>&nbsp;<span class="ace_identifier">h</span>.<span class="ace_identifier">copy</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">target</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">h</span>.<span class="ace_identifier">target</span>.<span class="ace_identifier">reverse</span><span class="ace_paren ace_rparen">)))</span>.<span class="ace_identifier">reverse</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_paren ace_rparen">}</span>&nbsp;</div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 18.4025px; top: 496px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 532px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 48px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 826px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode42" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay42" class="cell" style="display: none;"><div class="text-center"><i class="fa fa-refresh fa-spin fa-lg"></i></div></div></div><div id="cell43" class="cellWrapper" hidden="true"><div id="editCell43" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor43" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode43" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay43" class="cell" style="display: none;"><div class="text-center"><i class="fa fa-refresh fa-spin fa-lg"></i></div></div></div><div id="cell44" class="cellWrapper"><div id="editCell44" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor44" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode44" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay44" class="cell"><div class="newslide"></div><p>Let us test this decoder on a simple sentence, using a uniform language model.</p></div></div><div id="cell45" class="cellWrapper"><div id="editCell45" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor45" class="cell editor ace_editor ace-chaos ace_dark" style="height: 116px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 16px; width: 7.20125px; left: 397.861px; top: 90px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 148px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div><div class="ace_gutter-cell " style="height: 16px;">2</div><div class="ace_gutter-cell " style="height: 16px;">3</div><div class="ace_gutter-cell " style="height: 16px;">4</div><div class="ace_gutter-cell " style="height: 16px;">5</div><div class="ace_gutter-cell " style="height: 16px;">6</div></div><div class="ace_gutter-active-line" style="top: 90px; height: 16px;"></div></div><div class="ace_scroller" style="left: 41px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 833px; height: 148px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">source</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">Vector</span><span class="ace_paren ace_lparen">(</span><span class="ace_string">"groß"</span>,&nbsp;<span class="ace_string">"ist"</span>,&nbsp;<span class="ace_string">"ein"</span>,&nbsp;<span class="ace_string">"Mann"</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">targetVocab</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">trainM2</span>.<span class="ace_identifier">flatMap</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">_1</span>.<span class="ace_identifier">tokens</span>.<span class="ace_identifier">map</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">word</span><span class="ace_paren ace_rparen">))</span>.<span class="ace_identifier">toSet</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">lm</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">UniformLM</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">targetVocab</span>&nbsp;<span class="ace_keyword ace_operator">-</span>&nbsp;<span class="ace_string">"NULL"</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">hist</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">decodeModel2</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ibm2</span>,<span class="ace_identifier">lm</span>,&nbsp;<span class="ace_identifier">source</span>,&nbsp;<span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_identifier">renderHistory</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">hist</span>.<span class="ace_identifier">take</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">5</span><span class="ace_paren ace_rparen">)</span>,<span class="ace_identifier">source</span><span class="ace_paren ace_rparen">)</span>&nbsp;&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_comment">//ibm2.alpha.filter(_._1._1&nbsp;==&nbsp;"klein")&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 356.861px; top: 80px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 116px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 41px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 833px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode45" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay45" class="cell"><div class="string-result"><table> <tbody><tr> <td> NULL </td><td> _ _ _ _ </td><td> 4 </td><td> 0.0 </td> </tr><tr> <td> NULL a </td><td> _ _ ein _ </td><td> 3 </td><td> -2.3978952727983707 </td> </tr><tr> <td> NULL man </td><td> groß _ _ _ </td><td> 3 </td><td> -Infinity </td> </tr><tr> <td> NULL a man </td><td> _ _ ein Mann </td><td> 2 </td><td> -4.795790545596741 </td> </tr><tr> <td> NULL a my </td><td> groß _ ein _ </td><td> 2 </td><td> -Infinity </td> </tr><tr> <td> NULL a man is </td><td> _ ist ein Mann </td><td> 1 </td><td> -7.886832998955057 </td> </tr><tr> <td> NULL a man man </td><td> _ ist ein Mann </td><td> 1 </td><td> -Infinity </td> </tr><tr> <td> NULL a man is big </td><td> groß ist ein Mann </td><td> 0 </td><td> -10.284728271753428 </td> </tr><tr> <td> NULL a man is tall </td><td> groß ist ein Mann </td><td> 0 </td><td> -10.284728271753428 </td> </tr> </tbody></table></div></div></div><div id="cell46" class="cellWrapper"><div id="editCell46" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor46" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode46" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay46" class="cell"><div class="newslide"></div><p>There are currently two contenders for the most likely translation. This is because the translation model is uncertain about the translation of "groß" which can be "tall" in the context of the height of humans, and "big" in most other settings. To avoid this uncertainty we can use a language model to capture the fact that "man is big" is a little less likely than "man is tall". <span class="summary">We can reduce ambiguity by using a better <em>language model</em></span></p></div></div><div id="cell47" class="cellWrapper"><div id="editCell47" class="cell" hidden="true" style="display: block;"><div class="input"><div id="editor47" class="cell editor ace_editor ace-chaos ace_dark" style="height: 100px;"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0; height: 16px; width: 7.20125px; left: 325.849px; top: 74px;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled" style="margin-top: 10px; height: 132px; width: 41px;"><div class="ace_gutter-cell " style="height: 16px;">1</div><div class="ace_gutter-cell " style="height: 16px;">2</div><div class="ace_gutter-cell " style="height: 16px;">3</div><div class="ace_gutter-cell " style="height: 16px;">4</div><div class="ace_gutter-cell " style="height: 16px;">5</div></div><div class="ace_gutter-active-line" style="top: 74px; height: 16px;"></div></div><div class="ace_scroller" style="left: 41px; right: 0px; bottom: 0px;"><div class="ace_content" style="margin-top: 10px; width: 833px; height: 132px; margin-left: 0px;"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 580.1px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">lmTrainSet</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">trainM2</span>.<span class="ace_identifier">flatMap</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">_1</span>.<span class="ace_identifier">tokens</span>.<span class="ace_identifier">map</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">_</span>.<span class="ace_identifier">word</span><span class="ace_paren ace_rparen">))</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">lm2</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">LaplaceLM</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">NGramLM</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">lmTrainSet</span>.<span class="ace_identifier">toIndexedSeq</span>,&nbsp;<span class="ace_constant ace_numeric">3</span><span class="ace_paren ace_rparen">)</span>,<span class="ace_constant ace_numeric">0.1</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_keyword">val</span>&nbsp;<span class="ace_identifier">hist2</span>&nbsp;<span class="ace_keyword ace_operator">=</span>&nbsp;<span class="ace_identifier">decodeModel2</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">ibm2</span>,<span class="ace_identifier">lm2</span>,&nbsp;<span class="ace_identifier">source</span>,&nbsp;<span class="ace_constant ace_numeric">2</span><span class="ace_paren ace_rparen">)</span></div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_identifier">renderHistory</span><span class="ace_paren ace_lparen">(</span><span class="ace_identifier">hist2</span>.<span class="ace_identifier">take</span><span class="ace_paren ace_lparen">(</span><span class="ace_constant ace_numeric">5</span><span class="ace_paren ace_rparen">)</span>,<span class="ace_identifier">source</span><span class="ace_paren ace_rparen">)</span>&nbsp;</div></div><div class="ace_line_group" style="height:16px"><div class="ace_line" style="height:16px"><span class="ace_comment">//lm2.probability("tall",&nbsp;"man",&nbsp;"is")&nbsp;</span></div></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor" style="left: 284.849px; top: 64px; width: 7.20125px; height: 16px;"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px; bottom: 0px;"><div class="ace_scrollbar-inner" style="width: 20px; height: 100px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px; left: 41px; right: 0px;"><div class="ace_scrollbar-inner" style="height: 20px; width: 833px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode47" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay47" class="cell"><div class="string-result"><table> <tbody><tr> <td> NULL </td><td> _ _ _ _ </td><td> 4 </td><td> 0.0 </td> </tr><tr> <td> NULL a </td><td> _ _ ein _ </td><td> 3 </td><td> -2.4849066497880004 </td> </tr><tr> <td> NULL man </td><td> groß _ _ _ </td><td> 3 </td><td> -Infinity </td> </tr><tr> <td> NULL a man </td><td> _ _ ein Mann </td><td> 2 </td><td> -3.1780538303479458 </td> </tr><tr> <td> NULL a tall </td><td> _ ist ein _ </td><td> 2 </td><td> -Infinity </td> </tr><tr> <td> NULL a man is </td><td> _ ist ein Mann </td><td> 1 </td><td> -4.564348191467836 </td> </tr><tr> <td> NULL a man NULL </td><td> _ ist ein Mann </td><td> 1 </td><td> -6.962243464266207 </td> </tr><tr> <td> NULL a man is tall </td><td> groß ist ein Mann </td><td> 0 </td><td> -5.2574953720277815 </td> </tr><tr> <td> NULL a man is big </td><td> groß ist ein Mann </td><td> 0 </td><td> -7.655390644826152 </td> </tr> </tbody></table></div></div></div><div id="cell48" class="cellWrapper"><div id="editCell48" class="cell" hidden="true" style="display: none;"><div class="input"><div id="editor48" class="cell editor ace_editor ace-chaos ace_dark"><div style="position: absolute;"></div><textarea class="ace_text-input" wrap="off" autocapitalize="off" spellcheck="false" style="opacity: 0;"></textarea><div class="ace_gutter"><div class="ace_layer ace_gutter-layer ace_folding-enabled"></div><div class="ace_gutter-active-line"></div></div><div class="ace_scroller"><div class="ace_content"><div class="ace_layer ace_print-margin-layer"><div class="ace_print-margin" style="left: 4px; visibility: hidden;"></div></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_text-layer" style="padding: 0px 4px;"></div><div class="ace_layer ace_marker-layer"></div><div class="ace_layer ace_cursor-layer ace_hidden-cursors"><div class="ace_cursor"></div></div></div></div><div class="ace_scrollbar ace_scrollbar-v" style="display: none; width: 20px;"><div class="ace_scrollbar-inner" style="width: 20px;"></div></div><div class="ace_scrollbar ace_scrollbar-h" style="display: none; height: 20px;"><div class="ace_scrollbar-inner" style="height: 20px;"></div></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: hidden;"><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;"></div><div style="height: auto; width: auto; top: -100px; left: -100px; visibility: hidden; position: fixed; white-space: pre; font-style: inherit; font-variant: inherit; font-weight: inherit; font-stretch: inherit; font-size: inherit; line-height: inherit; font-family: inherit; overflow: visible;">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div></div></div><a id="runCode48" role="button" class="runButton btn disabled" disabled="disabled" "=""><i class="fa fa-play-circle-o fa-2x"></i></a></div></div><div id="renderDisplay48" class="cell"><p>Note that "a man is tall" is also more likely in the <a href="https://books.google.com/ngrams/graph?content=a+man+is+tall%2C+a+man+is+big&amp;year_start=1800&amp;year_end=2000&amp;corpus=15&amp;smoothing=3&amp;share=&amp;direct_url=t1%3B%2Ca%20man%20is%20tall%3B%2Cc0%3B.t1%3B%2Ca%20man%20is%20big%3B%2Cc0">Google N-grams corpus</a>.</p>
<div class="newslide"></div><h3>Summary</h3><p>There are a few high level messages to take away from this chapter.</p>
<ul>
  <li>MT is an instance structured prediction recipe</li>
  <li>The noisy channel is one modeling framework</li>
  <li>word-based MT is foundation and blue print for more complex models</li>
  <li>Training with EM</li>
  <li>NLP Tricks:
  <ul>
    <li>introducing latent alignment variables to simplify problem</li>
    <li>decoding with Beams</li>
  </ul></li>
</ul><h3>Background Material</h3>
<ul>
  <li><a href="http://www.cs.columbia.edu/~mcollins/courses/nlp2011/notes/ibm12.pdf">Lecture notes on IBM Model 1 and 2</a> of Mike Collins.</li>
  <li>Jurafsky &amp; Martin, Speech and Language Processing:
  <ul>
    <li>Chapter 26, Machine Translation.</li>
    <li>Chapter 6, EM Algorithm</li>
  </ul></li>
</ul></div></div></div>
                

<script>
    var divCells = $('#static_content');
    /* COMPILERS OBJECT */
    var compilers = {};
    
        compilers.scala = {};
        compilers.scala.hideAfterCompile = false;
        compilers.scala.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/scala");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = '';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.scala.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.scala.aggregate = true;
    
        compilers.markdown = {};
        compilers.markdown.hideAfterCompile = true;
        compilers.markdown.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/markdown");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = '';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.markdown.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.markdown.aggregate = false;
    
        compilers.section = {};
        compilers.section.hideAfterCompile = true;
        compilers.section.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/text");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = 'Section Name';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.section.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.section.aggregate = false;
    
        compilers.latex = {};
        compilers.latex.hideAfterCompile = true;
        compilers.latex.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/latex");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = '';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.latex.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.latex.aggregate = false;
    
        compilers.heading1 = {};
        compilers.heading1.hideAfterCompile = true;
        compilers.heading1.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/text");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = 'Heading';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.heading1.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.heading1.aggregate = false;
    
        compilers.heading2 = {};
        compilers.heading2.hideAfterCompile = true;
        compilers.heading2.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/text");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = 'Heading';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.heading2.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.heading2.aggregate = false;
    
        compilers.heading3 = {};
        compilers.heading3.hideAfterCompile = true;
        compilers.heading3.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/text");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = 'Heading';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.heading3.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.heading3.aggregate = false;
    
        compilers.heading4 = {};
        compilers.heading4.hideAfterCompile = true;
        compilers.heading4.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/text");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = 'Heading';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.heading4.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.heading4.aggregate = false;
    
        compilers.heading5 = {};
        compilers.heading5.hideAfterCompile = true;
        compilers.heading5.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/text");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = 'Heading';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.heading5.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.heading5.aggregate = false;
    
        compilers.html = {};
        compilers.html.hideAfterCompile = true;
        compilers.html.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/html");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = '';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.html.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.html.aggregate = false;
    
        compilers.imageurl = {};
        compilers.imageurl.hideAfterCompile = true;
        compilers.imageurl.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/text");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = 'URL';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.imageurl.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.imageurl.aggregate = false;
    
        compilers.google_viewer = {};
        compilers.google_viewer.hideAfterCompile = true;
        compilers.google_viewer.editor = 
function(id,content) {
    $("#editor"+id).empty();
    var editor = ace.edit("editor"+id);
    editor.setOptions({
      maxLines: Infinity,
      enableBasicAutocompletion: true,
      enableSnippets: true,
      enableLiveAutocompletion: true
    });
    editor.setTheme("ace/theme/" + doc.aceTheme);
    editor.getSession().setMode("ace/mode/text");
    editor.getSession().setUseWrapMode(true);
    editor.getSession().setWrapLimitRange(null, null);
    var contentToAdd = ""
    if(content=="") contentToAdd = 'URL';
    else contentToAdd = content;
    editor.renderer.setScrollMargin(10, 10, 0, 0);
    //editor.renderer.setPadding(20);
    editor.getSession().setValue(contentToAdd, 1);
    editor.focus();
    editor.navigateFileEnd();
    editor.setBehavioursEnabled(true);
    editor.setWrapBehavioursEnabled(true);
    editor.setShowFoldWidgets(true);
    editor.setHighlightActiveLine(false);
    editor.setShowPrintMargin(false);
    editor.setAutoScrollEditorIntoView(true);
    editor.renderer.setShowGutter(true);
    editor.on('change', function () {
        //heightUpdateFunction(editor, '#editor'+id);
    });
    if(!doc.allowExecution) editor.setReadOnly(true);

    editor.commands.addCommand({
        name: "runCode",
        bindKey: {win: "Ctrl-Enter", mac: "Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById("runCode"+id).click();
        }
    })
    editor.getSession().on('change', function() {
      var mode = currentMode(id);
      if(mode=='markdown' || mode=='html') {
        //document.getElementById("runCode"+id).click();
      }
    });
    editor.commands.addCommand({
        name: "addCellBelow",
        bindKey: {win: "Shift-Enter", mac: "Shift-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.focus();
              ne.insert(text,1);
              ne.navigateTo(0, 0);
              newId = nextCellId(id);
              changeMode(newId,oldMode)
              console.log("changing " + newId + " to " + oldMode);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "injectEmptyCell",
        bindKey: {win: "Shift-Ctrl-Enter", mac: "Shift-Ctrl-Enter"},
        exec: function(editor) {
            document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            oldMode=currentMode(id);
            if(typeof(ne)!='undefined') {
              editor.getSelection().selectFileEnd();
              var text = editor.getCopyText();
              editor.remove('right');
              console.log("splitting a cell!");
              ne.insert(text,1);
            }
            if (oldMode == 'markdown') document.getElementById('runCode' + id).click();
            if (!(ne.getValue().trim() === "")) document.getElementById('addBelow' + id).click();
            ne=nextEditor(doc,id);
            newId = nextCellId(id);
            changeMode(newId,toggledMode(oldMode));
            if(typeof(ne)!='undefined') {
              ne.focus();
              ne.navigateTo(0, 0);
            }
        }
    })
    editor.commands.addCommand({
        name: "deleteCell",
        bindKey: {win: "Shift-Del", mac: "Shift-Del"},
        exec: function(editor) {
            document.getElementById('remove' + id).click();
        }
    })
    editor.commands.addCommand({
        name: "moveCursorRight",
        bindKey: {win: 'Right', mac: 'Right'},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            if(editor.getCursorPosition().row == eodRow &&
               editor.getCursorPosition().column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateFileStart();
                ne.focus();
              }
            }
            editor.navigateRight(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorLeft",
        bindKey: {win: 'Left', mac: 'Left'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0 &&
               editor.getCursorPosition().column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateFileEnd();
                pe.focus();
              }
            }
            editor.navigateLeft(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorUp",
        bindKey: {win: 'Up', mac: 'Up'},
        exec: function(editor) {
            if(editor.getCursorPosition().row == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                pe.navigateTo(pe.getSession().getDocument().getLength()-1, editor.getCursorPosition().column);
                pe.focus();
              }
            }
            editor.navigateUp(1);
        }
    })
    editor.commands.addCommand({
        name: "moveCursorDown",
        bindKey: {win: 'Down', mac: 'Down'},
        exec: function(editor) {
            if(editor.getCursorPosition().row + 1 == editor.getSession().getDocument().getLength()) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                ne.navigateTo(0, editor.getCursorPosition().column);
                ne.focus();
              }
            }
            editor.navigateDown(1);
        }
    })
    editor.commands.addCommand({
        name: "mergeBefore",
        bindKey: {win: "Shift-Backspace|Backspace", mac: "Ctrl-Backspace|Shift-Backspace|Backspace|Ctrl-H"},
        exec: function(editor) {
            var curPos = editor.getCursorPosition();
            if(curPos.row == 0 && curPos.column == 0) {
              pe=prevEditor(doc,id);
              if(typeof(pe)!='undefined') {
                console.log("merge with previous!");
                var text = editor.getSession().getDocument().getValue();
                pe.focus();
                pe.gotoLine(pe.getSession().getDocument().getLength());
                pe.navigateLineEnd();
                var newCurPos = pe.getCursorPosition();
                pe.insert('\n'+ text);
                pe.navigateTo(newCurPos.row+1, 0);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("left");
            }
        }
    })
    editor.commands.addCommand({
        name: "mergeAfter",
        bindKey: {win: "Delete", mac: "Delete|Ctrl-D|Shift-Delete"},
        exec: function(editor) {
            var eodRow = editor.getSession().getDocument().getLength()-1;
            var eodCol = editor.session.getLine(eodRow).length;
            var curPos = editor.getCursorPosition();
            if(curPos.row == eodRow && curPos.column == eodCol) {
              ne=nextEditor(doc,id);
              if(typeof(ne)!='undefined') {
                console.log("merge with after!");
                var text = editor.getSession().getDocument().getValue();
                ne.focus();
                ne.navigateTo(0, 0);
                ne.insert(text+'\n', 1);
                document.getElementById('remove' + id).click();
              }
            } else {
              editor.remove("right");
            }
        }
    })
    editor.commands.addCommand({
        name: "saveDoc",
        bindKey: {win: "Ctrl-S", mac: "Cmd-S"},
        exec: function(editor) {
            saveDoc(doc, compilers);
        }
    })
    editor.commands.addCommand({
        name: "modeScala",
        bindKey: {win: "Ctrl-Alt-S", mac: "Ctrl-Alt-S"},
        exec: function(editor) {
            console.log("changing mode to scala");
            changeMode(id,'scala');
        }
    })
    editor.commands.addCommand({
        name: "modeMarkdown",
        bindKey: {win: "Ctrl-Alt-M", mac: "Ctrl-Alt-M"},
        exec: function(editor) {
            console.log("changing mode to markdown");
            changeMode(id,'markdown');
        }
    })
    editor.commands.addCommand({
        name: "toggleMode",
        bindKey: {win: "Ctrl-M", mac: "Ctrl-M"},
        exec: function(editor) {
            mode = currentMode(id);
            console.log("changing mode to " + toggledMode(mode));
            changeMode(id, toggledMode(mode));
        }
    })
    //heightUpdateFunction(editor, '#editor'+id);
    return editor;
}
    ;
        compilers.google_viewer.editorToInput = 
function (doc, id) {
  input = {}
  input.code = doc.cells[id].editor.getSession().getValue();
  return input;
};
    ;
        compilers.google_viewer.aggregate = false;
    

    /* DOCUMENT OBJECT */
    var doc = newDoc("Word-based Machine Translation");
    doc.aceTheme = 'chaos';
    doc.allowExecution = false;

    /* add cells */
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nMachine Translation (MT) is one of the canonical NLP applications, and one that nowadays most people are familiar with, primarily through online translation services of the major search engine providers. While there is still some way to go before machines can provide fluent and flawless translations, in particular for more distant language pairs like English and Japanese, progress in this field has been remarkable. <span class=\"summary\">MT is one of the most widely used NLP application. It is an example of **end-to-end NLP**, and MT-like architectures can be found in many other applications.</span> \n\n<div class=\"newslide\"></div>\nIn this chapter we will illustrate the foundations of this progress, and focus on word-based machine translation models. In such models words are the basic unit of translation. Nowadays the field has mostly moved to phrase and syntax-based approaches, but the word-based approach is still important, both from a foundational point of view, and as sub-component in more complex approaches. <span class=\"summary\">We focus on **word-based** MT which is not the state-of-the-art anymore, but a **foundation and blueprint** for modern mechanisms.</span>   \n\n<div class=\"newslide\"></div>\n### MT as [Structured Prediction](/template/statnlpbook/02_methods/00_structuredprediction)\n\nFormally we will see MT as the task of translating a _source_ sentence \\\\(\\source\\\\) to a _target_ sentence \\\\(\\target\\\\). We can tackle the problem using the [structured prediction recipe](/template/statnlpbook/02_methods/00_structuredprediction): We define a parametrised model \\\\(s_\\params(\\target,\\source)\\\\) that measures how well a target  \\\\(\\target\\\\) sentence matches a source sentence \\\\(\\source\\\\), learn the parameters \\\\(\\params\\\\) from training data, and then find <span class=\"summary\">Define a parametrised model \\\\(s_\\params(\\target,\\source)\\\\) measuring how well a **target** sentence \\\\(\\target\\\\)  matches a **source** sentence \\\\(\\source\\\\), learn the parameters \\\\(\\params\\\\) from training data, and find</span> \n\n\\begin{equation} \n  \\label{decode-mt}\n  \\argmax_\\target s_\\params(\\target,\\source) \n\\end{equation}\n\nas translation of \\\\(\\source\\\\). Different _statistical_ MT approaches, in this view, differ primarily in how \\\\(s\\\\) is defined, \\\\(\\params\\\\) are learned, and how the \\\\(\\argmax\\\\) is found. <span class=\"summary\"></span>\n","extraFields":{}};
        var id = 0;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"\n<div class=\"newslide\"></div>\n### Noisy Channel Model for MT\n\n<div class=\"book-start\"></div>\n\nMany Word-based MT systems, as well as those based on more advanced representations, rely on a [Noisy Channel](https://www.dropbox.com/s/gfucv538m6anmgd/NoisyChannel.pdf?dl=0) model as choice for the scoring function \\\\(s_\\params\\\\). In this approach to MT we effectively model the translation process *in reverse*. That is, we assume that a probabilistic process (the speaker's brain) first generates the target sentence \\\\(\\target\\\\) according to the distribution \\\\(\\prob(\\target)\\\\). Then the target sentence \\\\(\\target\\\\) is transmitted through a _noisy channel_ \\\\(\\prob(\\source|\\target)\\\\) that translates \\\\(\\target\\\\) into \\\\(\\source\\\\). \n\n<div class=\"slide-start\"></div>\n\nA generative process (the speaker's brain): \n\n* generate target sentence \\\\(\\target\\\\) according to \\\\(\\prob(\\target)\\\\). \n* Transmit \\\\(\\target\\\\) through a _noisy channel_ \\\\(\\prob(\\source|\\target)\\\\) to generate source \\\\(\\source\\\\).\n\nFor a graphical view on the noisy channel see my [slides](https://www.dropbox.com/s/gfucv538m6anmgd/NoisyChannel.pdf?dl=0). \n\n<div class=\"slide-end\"></div>\n\n<div class=\"newslide\"></div>\nHence translation is seen as adding noise to a clean \\\\(\\target\\\\). This _generative story_ defines a _joint distribution_ over target and source sentences \\\\(\\prob(\\source,\\target) = \\prob(\\target) \\prob(\\source|\\target) \\\\). We can in turn operate this distribution in the direction we actually care about: to infer a target sentence \\\\(\\target\\\\) given a source sentence \\\\(\\source\\\\) we find the _maximum a posteriori_ sentence <span class=\"summary\">The distribution over target words and the channel noise model define a joint distribution \\\\(\\prob(\\source,\\target) = \\prob(\\target) \\prob(\\source|\\target) \\\\). To use it for translation we operate it **backwards**: </span>\n\n\\begin{equation}\n\\label{decode-nc}\n\\target^* = \\argmax_\\target \\prob(\\target | \\source) = \\argmax_\\target \\prob(\\target) \\, \\prob(\\source | \\target). \n\\end{equation}\n\nFor the structured prediction recipe this means setting \n\n$$\ns_\\params(\\target,\\source) = \\prob(\\target) \\, \\prob(\\source | \\target). \n$$\n\n<div class=\"newslide\"></div>\n<div class=\"book-start\"></div>\nIn the noisy channel approach for MT the distribution \\\\(\\prob(\\target)\\\\) that generates the target sentence is usually referred to as [language model](/template/statnlpbook/01_tasks/01_languagemodels), and the noisy channel is called the _translation model_. As we have discussed language models earlier, in this chapter we focus on the translation model \\\\(\\prob(\\source|\\target)\\\\).\n<div class=\"slide-start\"></div>\n\nIn Machine Translation:\n\n* \\\\(\\prob(\\target)\\\\) is usually referred to as [language model](/template/statnlpbook/01_tasks/01_languagemodels).\n* \\\\(\\prob(\\source|\\target)\\\\) is referred to as **translation model**.\n\nHere we focus on translation models. \n\n<div class=\"slide-end\"></div>\n\n\n<div class=\"newslide\"></div>\n### A Naive Baseline Translation Model\nThe most straightforward translation model translates words one-by-one, in the order of appearance:\n$$\n\\prob_\\params^\\text{Naive}(\\ssource|\\starget) = \\prod_i^{\\length{\\source}} \\param_{\\ssource_i,\\starget_i}\n$$\nwhere \\\\(\\param_{\\ssource,\\starget} \\\\) is the probability of translating \\\\(\\starget\\\\) as \\\\(\\ssource\\\\). \\\\(\\params\\\\) is often referred to as *translation table*.\n\n<div class=\"newslide\"></div>\nFor many language pairs one can acquire training sets \\\\(\\train=\\left( \\left(\\source_i,\\target_i\\right) \\right)_{i=1}^n \\\\) of paired source and target sentences. For example, for French and English the [Aligned Hansards](http://www.isi.edu/natural-language/download/hansard/) of the Parliament of Canada can be used. Given such a training set \\\\(\\train\\\\) we can learn the parameters \\\\(\\params\\\\) using the [Maximum Likelhood estimator](/template/statnlpbook/02_methods/0x_mle). In the case of our Naive model this amounts to setting <span class=\"summary\">Using **parallel** data of paired source and target sentences, we can train the model using the **Maximum Likelihood Estimator**:</span>\n\n$$\n\\param_{\\ssource,\\starget} = \\frac{\\counts{\\train}{s,t}}{\\counts{\\train}{t}} \n$$\n\nHere \\\\(\\counts{\\train}{s,t}\\\\) is the number of times we see target word \\\\(t\\\\) translated as source word \\\\(s\\\\), and \\\\(\\counts{\\train}{t}\\\\) the number of times we the target word \\\\(t\\\\) in total.\n\n<!--\n<div class=\"exercise\">\n  <div class=\"exname\">Exercise</div>\n  <div class=\"extext\">Derive the maximum likelhood estimate for \\\\(\\prob_\\params^\\text{Naive}\\\\) for training data \\\\(\\train=\\left( \\left(\\source_i,\\target_i\\right) \\right)_{i=1}^n \\\\). </div>\n</div>\n-->\n\n\n<div class=\"newslide\"></div>\n#### Training the Naive Model\nLet us prepare some toy data to show how train this naive model.\n","extraFields":{}};
        var id = 1;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"val train = Seq(\n  \"the house is small\" -> \"das Haus ist klein\",\n  \"the house is small\" -> \"klein ist das Haus\",\n  \"a man is tall\" -> \"ein Mann ist groß\",\n  \"my house is small\" -> \"klein ist mein Haus\"\n) map (p => segment(p._1).sentences.head -> segment(p._2).sentences.head)\ntrain.size ","extraFields":{"aggregatedCells":"[]"}};
        var id = 2;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nNotice how we transformed raw strings into Document objects via `segment`, and how we then fill the training set with Sentence objects by extracting the documents `head` sentence from each document. This dataset can be used to train the naive model as follows. <span class=\"summary\">We can train the naive model as follows.</span>\n\n","extraFields":{}};
        var id = 3;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"import scala.collection.mutable.HashMap\ncase class Param(src:String, tgt: String, prob: Double)\ntype NaiveModel = Seq[Param]\ndef learn(data:Seq[(Sentence,Sentence)]):NaiveModel = {\n  //data structures to store counts in nominator and denominator\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\n  //do the counting\n  for ((target,source) <- data) {\n    for (i <- 0 until target.tokens.length) {\n      norm(target.tokens(i).word) += 1.0\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\n    }    \n  }\n  //convert the map to a sequence of parameters\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\n} ","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p._1).sentences.head -> segment(p._2).sentences.head)\\ntrain.size \"]","hide_output":"true"}};
        var id = 4;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nLet us train on the toy dataset:","extraFields":{}};
        var id = 5;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"val model = learn(train)\nbarChart(model map (p => (p.src,p.tgt) -> p.prob) filter (_._1._2 == \"is\")) ","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p._1).sentences.head -> segment(p._2).sentences.head)\\ntrain.size \",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype NaiveModel = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):NaiveModel = {\\n  //data structures to store counts in nominator and denominator\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  //do the counting\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  //convert the map to a sequence of parameters\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n} \"]"}};
        var id = 6;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<!--\n<div class=\"newslide\"></div>\n##### Exercise\nImplement an non-procedural [functional](https://www.coursera.org/course/progfun) version of this code.\n\n##### Exercise\nMake this work even when sentences don't have the same length. \n\n##### Exercise\nWhich sentences make the problem easier, which harder?\n-->\n\n<div class=\"newslide\"></div>\n#### Decoding with the Naive Model\n\n<div class=\"book-start\"></div>\n\n*Decoding* in MT is the task of finding the solution to equation \\\\(\\ref{decode-mt}\\\\). That is, we need to find that target sentence with maximum a posteriori probability, which is equivalent to finding the target sentence with maximum likelihood as per equation \\\\(\\ref{decode-nc}\\\\). The phrase \"decoding\" relates to the noisy channel analogy. Somebody generated a message, the channel encodes (translates) this message and the receiver needs to find out what the original message was.   \n\nIn the naive model decoding is trivial if we assume a unigram language model. We need to choose, for each source word, the target word with maximal product of translation and language model probability. For more complex models this is not sufficient, and we discuss a more powerful decoding method later.\n\n<div class=\"slide-start\"></div>\nTranslation is often called **decoding** and means:\n$$\n  \\argmax_\\target \\prob(\\target) \\, \\prob(\\source | \\target)\n$$\nHow can we achieve this for the Naive Model?\n<div class=\"slide-end\"></div>\n\n<div class=\"newslide\"></div>","extraFields":{}};
        var id = 7;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"import uk.ac.ucl.cs.mr.statnlpbook.chapter.languagemodels._\n\ndef decode(source:Sentence, model:NaiveModel, lm:LanguageModel) = {\n  //create a mapping from source words to relevant parameters\n  val source2targets = model groupBy (_.src) \n  def translate(token:Token) = {\n    val candidates:Seq[Param] = source2targets(token.word)\n    val scoredByLM = candidates map (p => p.copy(prob = p.prob * lm.probability(p.tgt)))\n    scoredByLM.maxBy(_.prob).tgt\n  }\n  //translate word-by-word (for which LM does this work?)\n  val words = source.tokens map translate\n  Document(IndexedSeq(words))\n}\nval source = train(1)._2 //\"klein ist das Haus\"\nval lm = UniformLM(model.map(_.tgt).toSet)\nval target = decode(source, model, lm) \ntarget.toText ","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p._1).sentences.head -> segment(p._2).sentences.head)\\ntrain.size \",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype NaiveModel = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):NaiveModel = {\\n  //data structures to store counts in nominator and denominator\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  //do the counting\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  //convert the map to a sequence of parameters\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n} \",\"val model = learn(train)\\nbarChart(model map (p => (p.src,p.tgt) -> p.prob) filter (_._1._2 == \\\"is\\\")) \"]"}};
        var id = 8;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nThe naive model is broken in several ways. Most severely, it ignores the fact that word order can differ and still yield (roughly) the same meaning.   \n\n<div class=\"newslide\"></div>\n### IBM Model 2\nThe IBM Model 2 is one of the most influential translation models, even though these days it is only indirectly used in actual MT systems, for example to initialize translation and alignment models. As IBM Model 2 can be understood as generalization of IBM Model 1, we omit the latter for now and briefly illustrate it afterward our introduction of Model 2. Notice that parts of these exposition are based on the excellent [lecture notes on IBM Model 1 and 2](http://www.cs.columbia.edu/~mcollins/courses/nlp2011/notes/ibm12.pdf) of Mike Collins. <span class=\"summary\">IBM Model 2 is one of the most influential translation models, even though these days it is only indirectly used in actual MT systems, for example to initialize translation and alignment models.</span> \n\n<div class=\"newslide\"></div>\n#### Alignment\n<div class=\"book-start\"></div>\n\nThe core difference of Model 2 to our naive baseline model is the introduction of _latent_ auxiliary variables: the word to word _alignment_ \\\\(\\aligns\\\\) between words. In particular, we introduce a variable \\\\(a_i \\in [0 \\ldots \\length{\\target}]\\\\) for each source sentence index \\\\(i \\in [1 \\ldots \\length{\\source}]\\\\). The word alignment \\\\(a_i = j \\\\) means that the source word at token \\\\(i\\\\) is _aligned_ with the target word at index \\\\(j\\\\). \n\n\nNotice that \\\\(\\align_i\\\\) can be \\\\(0\\\\). This corresponds to a imaginary _NULL_ token \\\\(\\starget_0\\\\) in the target sentence and allows source words to be omitted in an alignment. \n\n<div class=\"slide-start\"></div>\n\nThe core difference of Model 2 is the introduction of _latent_ auxiliary variables \\\\(\\aligns\\\\):\n\n* \\\\(a_i \\in [0 \\ldots \\length{\\target}]\\\\) for each source token \\\\(i \\in [1 \\ldots \\length{\\source}]\\\\)\n* \\\\(a_i = j \\\\) means source token \\\\(i\\\\) is _aligned_ with the target token \\\\(j\\\\).\n* \\\\(\\align_i\\\\) can be \\\\(0\\\\) to point to a _NULL_ token to omit source words. \n\n<div class=\"slide-end\"></div>\n\n\n\n<!--\n<p class=\"exercise\">\nHow can _target_ words be omitted in an alignment?\n</p>\n-->\n\n<div class=\"newslide\"></div>\nBelow you see a simple example of an alignment.\n\n\n\n\n","extraFields":{}};
        var id = 9;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"val target = segment(\"NULL the house is small\").sentences(0)\nval source = segment(\"klein ist das Haus\").sentences(0)\nRenderer.renderAlignment(target,source,Seq(1->2,2->3,3->1,4->0))","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p._1).sentences.head -> segment(p._2).sentences.head)\\ntrain.size \",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype NaiveModel = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):NaiveModel = {\\n  //data structures to store counts in nominator and denominator\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  //do the counting\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  //convert the map to a sequence of parameters\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n} \",\"val model = learn(train)\\nbarChart(model map (p => (p.src,p.tgt) -> p.prob) filter (_._1._2 == \\\"is\\\")) \",\"import uk.ac.ucl.cs.mr.statnlpbook.chapter.languagemodels._\\n\\ndef decode(source:Sentence, model:NaiveModel, lm:LanguageModel) = {\\n  //create a mapping from source words to relevant parameters\\n  val source2targets = model groupBy (_.src) \\n  def translate(token:Token) = {\\n    val candidates:Seq[Param] = source2targets(token.word)\\n    val scoredByLM = candidates map (p => p.copy(prob = p.prob * lm.probability(p.tgt)))\\n    scoredByLM.maxBy(_.prob).tgt\\n  }\\n  //translate word-by-word (for which LM does this work?)\\n  val words = source.tokens map translate\\n  Document(IndexedSeq(words))\\n}\\nval source = train(1)._2 //\\\"klein ist das Haus\\\"\\nval lm = UniformLM(model.map(_.tgt).toSet)\\nval target = decode(source, model, lm) \\ntarget.toText \"]"}};
        var id = 10;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"val target2 = segment(\"NULL 家 わ 小さいい です\").sentences(0)\nval source2 = segment(\"The house is small\").sentences(0)\nRenderer.renderAlignment(target2,source2,Seq(0 -> 0, 1 -> 1, 3 -> 3, 4 -> 2))","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p._1).sentences.head -> segment(p._2).sentences.head)\\ntrain.size \",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype NaiveModel = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):NaiveModel = {\\n  //data structures to store counts in nominator and denominator\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  //do the counting\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  //convert the map to a sequence of parameters\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n} \",\"val model = learn(train)\\nbarChart(model map (p => (p.src,p.tgt) -> p.prob) filter (_._1._2 == \\\"is\\\")) \",\"import uk.ac.ucl.cs.mr.statnlpbook.chapter.languagemodels._\\n\\ndef decode(source:Sentence, model:NaiveModel, lm:LanguageModel) = {\\n  //create a mapping from source words to relevant parameters\\n  val source2targets = model groupBy (_.src) \\n  def translate(token:Token) = {\\n    val candidates:Seq[Param] = source2targets(token.word)\\n    val scoredByLM = candidates map (p => p.copy(prob = p.prob * lm.probability(p.tgt)))\\n    scoredByLM.maxBy(_.prob).tgt\\n  }\\n  //translate word-by-word (for which LM does this work?)\\n  val words = source.tokens map translate\\n  Document(IndexedSeq(words))\\n}\\nval source = train(1)._2 //\\\"klein ist das Haus\\\"\\nval lm = UniformLM(model.map(_.tgt).toSet)\\nval target = decode(source, model, lm) \\ntarget.toText \",\"val target = segment(\\\"NULL the house is small\\\").sentences(0)\\nval source = segment(\\\"klein ist das Haus\\\").sentences(0)\\nRenderer.renderAlignment(target,source,Seq(1->2,2->3,3->1,4->0))\"]"}};
        var id = 11;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"\n\n<div class=\"newslide\"></div>\nIBM Model 2 defines a conditional distribution \\\\(\\prob(\\source,\\aligns|\\target)\\\\) over both the source sentence \\\\(\\source\\\\) and its alignment \\\\(\\aligns\\\\) to the target sentence \\\\(\\target\\\\). Such a model can be used as translation model \\\\(\\prob(\\source|\\target)\\\\), as defined above, by marginalizing out the alignment <span class=\"summary\"> Model 2 defines a distribution \\\\(\\prob(\\source,\\aligns|\\target)\\\\). A **translation model** can be derived by marginalizing out the alignments</span>\n\n$$\n\\prob(\\source|\\target) = \\sum_{\\aligns} \\prob(\\source,\\aligns|\\target).\n$$\n\n<!--\n<div class=\"newslide\"></div>\n\nNotice that pluging this translation model into the argmax problem of equation \\\\(\\ref{decode-nc}\\\\) results in a nested summation and maximization problem. [Park and Darwiche](http://arxiv.org/pdf/1107.0024.pdf) show that this problem is generally substantially harder than only performing the max. To avoid the computational issues that arise in this setting, it is therefore common to instead maximize over both target and alignment at decoding time: <span class=\"summary\">For computational reasons we often search over both alignments and targets</span>\n\n$$\n(\\target^*,\\aligns^*) = \\argmax_{\\target,\\aligns} \\prob(\\target, \\aligns | \\source).\n$$\n\nNotice that marginalization happens to be feasible for Model 2, but generally latent alignments models do not have this property. \n\n-->\n\n\n<div class=\"newslide\"></div>\n#### Model Parametrization\n\n<div class=\"book-start\"></div>\n\nIBM Model 2 defines its conditional distribution over source and alignments using two sets of parameters \\\\(\\params=(\\balpha,\\bbeta)\\\\). Here \\\\(\\alpha(\\ssource|\\starget)\\\\) is a parameter defining the probability of translation target word \\\\(\\starget\\\\) into source word \\\\(\\ssource\\\\), and \\\\(\\beta(j|i,l_\\starget,l_\\ssource)\\\\) a parameter that defines the probability of aligning the source word at token \\\\(i\\\\) with the target word at token \\\\(j\\\\), conditioned on the length \\\\(l_\\starget\\\\) of the target sentence, and the length \\\\(l_\\ssource\\\\) of the source sentence. \n\n<div class=\"slide-start\"></div>\n\nIBM Model 2 has two sets of parameters \\\\(\\params=(\\balpha,\\bbeta)\\\\)\n\n* \\\\(\\alpha(\\ssource|\\starget)\\\\): probability of translation target word \\\\(\\starget\\\\) into source word \\\\(\\ssource\\\\). \n* \\\\(\\beta(j|i,l_\\starget,l_\\ssource)\\\\): probability of aligning the source token \\\\(i\\\\) with target token \\\\(j\\\\), conditioned on the target length \\\\(l_\\starget\\\\) and source length \\\\(l_\\ssource\\\\).  \n\n<div class=\"slide-end\"></div>\n\n<div class=\"newslide\"></div>\nWith the above parameters, IBM Model 2 defines a conditional distribution over source sentences and alignments, conditioned on a target sentence _and a desired source sentence length_ \\\\(l_\\ssource\\\\): <span class=\"summary\">Model 2 defines a conditional distribution over source sentences and alignments, conditioned on a target sentence _and a desired source sentence length_</span>\n\n\\begin{equation}\n\\label{ibm2}\n  p_\\params^\\text{IBM2}(\\ssource_1 \\ldots \\ssource_{l_\\ssource},\\align_1 \\ldots \\align_{l_\\ssource}|\\starget_1 \\ldots \\starget_{l_\\starget}, l_\\ssource) = \\prod_i^{l_\\ssource} \\alpha(\\ssource_i|\\starget_{a_i}) \\beta(a_i|i,l_\\starget,l_\\ssource)\n\\end{equation}\n","extraFields":{"aggregatedCells":"[\"1 + 3\\n\"]"}};
        var id = 12;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"\n<div class=\"newslide\"></div>\n### Training IBM Model 2 with the EM Algorithm\n\n<div class=\"book-start\"></div>\n\nTraining IBM Model 2 is less straightforward than training our naive baseline. The main reason is the lack of _gold alignments_ in the training data. That is, while we can quite easily find, or heuristically construct, _sentence-aligned_ corpora like our toy dataset, we generally do not have _word aligned_ sentences.\n\n<div class=\"slide-start\"></div>\nTraining Model 2 is challenging:\n\n  * we have gold sentence alignments \n  * but **no gold word alignments**!\n\n<div class=\"slide-end\"></div>\n\n<div class=\"newslide\"></div>\nTo overcome this problem, IBM Model can be trained using the Expectation Maximization (EM) Algorithm, a general recipe when learning with partially observed data&mdash;in our case the data is partially observed because we observe the source and target sentences, but not their alignments. The EM algorithm maximizes a lower bound of the log-likelihood of the data. The log-likelihood of the data is <span class=\"summary\">The Expectation Maximization (EM) Algorithm is a standard training algorithm for **partially observed data**. It maximizes a lower bound of the likelihood</span>:\n\n$$\n  \\sum_{(\\target_i,\\source_i) \\in \\train} \\log p_\\params^\\text{IBM2}(\\source_i|\\target_i) =  \\sum_{(\\target_i,\\source_i) \\in \\train} \\log \\sum_{\\aligns}  p_\\params^\\text{IBM2}(\\source_i,\\aligns|\\target_i) \n$$\n\nEM can be be seen as [block coordinate descent](https://www.dropbox.com/s/vrsefe3m57bxpgv/EMforTM.pdf?dl=0) on this bound.\n\n<div class=\"newslide\"></div>\n\nThe EM algorithm is an iterative method that iterates between two steps, the E-step (Expectation) and the M-Step (Maximization), until convergence. For the case of IBM Model 2 the E and M steps are instantiated as follows: <span class=\"summary\">EM for Model 2 iterates between:</span> \n\n  * **E-Step**: given a current set of parameters \\\\(\\params\\\\), calculate the **expectations** \\\\(\\pi\\\\) of the latent alignment variables under the model \\\\(p_\\params^\\text{IBM2}\\\\) &mdash; this amounts to estimating a _soft alignment_ for each sentence.    \n  * **M-Step**: Given training set of soft alignments \\\\(\\pi\\\\), find new parameters \\\\(\\params\\\\) that **maximize** the log likelihood of this (weighted) training set. This amounts to soft counting. \n\n<div class=\"newslide\"></div>\n#### E-Step\n<div class=\"book-start\"></div>\n\nThe E-Step calculates the distribution\n\n$$\n\\pi(\\aligns|\\source,\\target) = p_\\params^\\text{IBM2}(\\aligns|\\source,\\target)\n$$\n\nfor the current parameters \\\\(\\params\\\\). For Model 2 this distribution has a very simple form:\n\n$$\n\\pi(\\aligns|\\source,\\target) = \\prod_i^{l_{\\ssource}} \\pi(a_i|\\source,\\target,i) = \\prod_i^{l_{\\ssource}} \n  \\frac\n    {\\alpha(\\ssource_i|\\starget_{a_i}) \\beta(a_i|i,l_\\starget,l_\\ssource)}\n    {\\sum_j^{l_{\\starget}} \\alpha(\\ssource_i|\\starget_j) \\beta(j|i,l_\\starget,l_\\ssource) }\n$$\n\nImportantly, the distribution over alignments *factorizes* in a per-source-token fashion, and hence we only need to calculate, for each source token \\\\(i\\\\) and each possible alignment \\\\(a_i\\\\), the probability (or expectation) \\\\(\\pi(a_i|\\source,\\target,i)\\\\).\n\n<div class=\"slide-start\"></div>\n\n* Calculate distribution over alignments \n\n$$\n\\pi(\\aligns|\\source,\\target) = p_\\params^\\text{IBM2}(\\aligns|\\source,\\target)\n$$\n\n* Distribution **factorizes**:\n\n$$\n\\pi(\\aligns|\\source,\\target) = \\prod_i^{l_{\\ssource}} \\pi(a_i|\\source,\\target,i) = \\prod_i^{l_{\\ssource}} \n  \\frac\n    {\\alpha(\\ssource_i|\\starget_{a_i}) \\beta(a_i|i,l_\\starget,l_\\ssource)}\n    {\\sum_j^{l_{\\starget}} \\alpha(\\ssource_i|\\starget_j) \\beta(j|i,l_\\starget,l_\\ssource) }\n$$\n\n\n<div class=\"slide-end\"></div>\n\n\n<div class=\"newslide\"></div>\nBefore we look at the implementation of this algorithm we will set up the training data to be compatible with our formulation. This involves introducing a 'NULL' token to each target sentence to allow source tokens to remain unaligned. We also gather a few statistics that will be useful in our implementation later on. <span class=\"summary\">First we create some toy data:</span>  \n","extraFields":{}};
        var id = 13;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"val trainM2 = Seq(\n  \"NULL the house is small\" -> \"klein ist das Haus\",\n  \"NULL a man is tall\" -> \"groß ist ein Mann\",\n  \"NULL my house is small\" -> \"klein ist mein Haus\",\n  \"NULL the building is big\" -> \"groß ist das Gebäude\",\n  \"NULL the building is long\" -> \"lang ist das Gebäude\"\n) map (p => segment(p _1).sentences.head -> segment(p _2).sentences.head) ","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p._1).sentences.head -> segment(p._2).sentences.head)\\ntrain.size \",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype NaiveModel = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):NaiveModel = {\\n  //data structures to store counts in nominator and denominator\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  //do the counting\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  //convert the map to a sequence of parameters\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n} \",\"val model = learn(train)\\nbarChart(model map (p => (p.src,p.tgt) -> p.prob) filter (_._1._2 == \\\"is\\\")) \",\"import uk.ac.ucl.cs.mr.statnlpbook.chapter.languagemodels._\\n\\ndef decode(source:Sentence, model:NaiveModel, lm:LanguageModel) = {\\n  //create a mapping from source words to relevant parameters\\n  val source2targets = model groupBy (_.src) \\n  def translate(token:Token) = {\\n    val candidates:Seq[Param] = source2targets(token.word)\\n    val scoredByLM = candidates map (p => p.copy(prob = p.prob * lm.probability(p.tgt)))\\n    scoredByLM.maxBy(_.prob).tgt\\n  }\\n  //translate word-by-word (for which LM does this work?)\\n  val words = source.tokens map translate\\n  Document(IndexedSeq(words))\\n}\\nval source = train(1)._2 //\\\"klein ist das Haus\\\"\\nval lm = UniformLM(model.map(_.tgt).toSet)\\nval target = decode(source, model, lm) \\ntarget.toText \",\"val target = segment(\\\"NULL the house is small\\\").sentences(0)\\nval source = segment(\\\"klein ist das Haus\\\").sentences(0)\\nRenderer.renderAlignment(target,source,Seq(1->2,2->3,3->1,4->0))\",\"val target2 = segment(\\\"NULL 家 わ 小さいい です\\\").sentences(0)\\nval source2 = segment(\\\"The house is small\\\").sentences(0)\\nRenderer.renderAlignment(target2,source2,Seq(0 -> 0, 1 -> 1, 3 -> 3, 4 -> 2))\"]","hide_output":"true"}};
        var id = 14;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nWe can now implement the E-Step.","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p _1).sentences.head -> segment(p _2).sentences.head)\\ntrain.size\",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype Model = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):Model = {\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n}\\nval model = learn(train)\\nbarChart(model sortBy(_.tgt) map (p => (p.src,p.tgt) -> p.prob) filter (_._1._2 == \\\"is\\\")) \",\"def decode(source:Sentence, model:Model) = {\\n  val source2targets = model groupBy (_.src) //create one sub-model per source word\\n  val source2Best = source2targets mapValues (m => (m maxBy (_.prob)).tgt) //only keep best target\\n  val words = source.tokens map (s => source2Best(s.word))\\n  Document(IndexedSeq(words))\\n}\\nval source = train(1)._2\\nval target = decode(source, model)\\nrenderTokens(target)\",\"val target = segment(\\\"NULL the house is small\\\").sentences(0)\\nval source = segment(\\\"klein ist das Haus\\\").sentences(0)\\nRenderer.renderAlignment(target,source,Seq(1->2,2->3,3->1,4->0))\",\"val train = Seq(\\n  \\\"NULL the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"NULL the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"NULL a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"NULL my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p _1).sentences.head -> segment(p _2).sentences.head)\\n\\nval targetVocab = train.flatMap(_._1.tokens.map(_.word)).toSet\\nval sourceVocab = train.flatMap(_._2.tokens.map(_.word)).toSet \"]"}};
        var id = 15;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"//Each element in the sequence corresponds to one source token,\n//and each element in the nested sequence to a target token.\ntype Align = IndexedSeq[IndexedSeq[Double]]\n\n//Model parameters\ncase class Model(\n  alpha:Map[(String,String),Double],\n  beta:Map[(Int,Int,Int,Int),Double]) \n\n//normalizing a distribution\ndef norm(v:IndexedSeq[Double]) = { val s = v.sum; v map (_ / s) } \n\n//estimate new soft alignments\ndef eStep(model:Model, data:Seq[(Sentence,Sentence)]):Seq[Align] = {\n  for ((target,source) <- data) yield {\n    def score(si:Int, ti:Int) = \n      model.alpha(source.tokens(si).word,target.tokens(ti).word) * \n      model.beta(ti,si,target.tokens.length, source.tokens.length)\n    for (si <- source.tokens.indices) yield \n      norm(for (ti <- target.tokens.indices) yield score(si,ti))\n  }\n}","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p._1).sentences.head -> segment(p._2).sentences.head)\\ntrain.size \",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype NaiveModel = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):NaiveModel = {\\n  //data structures to store counts in nominator and denominator\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  //do the counting\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  //convert the map to a sequence of parameters\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n} \",\"val model = learn(train)\\nbarChart(model map (p => (p.src,p.tgt) -> p.prob) filter (_._1._2 == \\\"is\\\")) \",\"import uk.ac.ucl.cs.mr.statnlpbook.chapter.languagemodels._\\n\\ndef decode(source:Sentence, model:NaiveModel, lm:LanguageModel) = {\\n  //create a mapping from source words to relevant parameters\\n  val source2targets = model groupBy (_.src) \\n  def translate(token:Token) = {\\n    val candidates:Seq[Param] = source2targets(token.word)\\n    val scoredByLM = candidates map (p => p.copy(prob = p.prob * lm.probability(p.tgt)))\\n    scoredByLM.maxBy(_.prob).tgt\\n  }\\n  //translate word-by-word (for which LM does this work?)\\n  val words = source.tokens map translate\\n  Document(IndexedSeq(words))\\n}\\nval source = train(1)._2 //\\\"klein ist das Haus\\\"\\nval lm = UniformLM(model.map(_.tgt).toSet)\\nval target = decode(source, model, lm) \\ntarget.toText \",\"val target = segment(\\\"NULL the house is small\\\").sentences(0)\\nval source = segment(\\\"klein ist das Haus\\\").sentences(0)\\nRenderer.renderAlignment(target,source,Seq(1->2,2->3,3->1,4->0))\",\"val target2 = segment(\\\"NULL 家 わ 小さいい です\\\").sentences(0)\\nval source2 = segment(\\\"The house is small\\\").sentences(0)\\nRenderer.renderAlignment(target2,source2,Seq(0 -> 0, 1 -> 1, 3 -> 3, 4 -> 2))\",\"val trainM2 = Seq(\\n  \\\"NULL the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"NULL a man is tall\\\" -> \\\"groß ist ein Mann\\\",\\n  \\\"NULL my house is small\\\" -> \\\"klein ist mein Haus\\\",\\n  \\\"NULL the building is big\\\" -> \\\"groß ist das Gebäude\\\",\\n  \\\"NULL the building is long\\\" -> \\\"lang ist das Gebäude\\\"\\n) map (p => segment(p _1).sentences.head -> segment(p _2).sentences.head) \"]","hide_output":"true"}};
        var id = 16;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nLet us run this code:","extraFields":{}};
        var id = 17;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"val sourceVocab = trainM2.flatMap(_._2.tokens.map(_.word)).toSet \nval init = Model(\n    Map.empty withDefaultValue (1.0 / sourceVocab.size),\n    Map.empty withDefault {case (ti,si,lt,ls) => 1.0 / lt })\n\nval alignments = eStep(init,trainM2) \nRenderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, alignments(0))","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p._1).sentences.head -> segment(p._2).sentences.head)\\ntrain.size \",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype NaiveModel = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):NaiveModel = {\\n  //data structures to store counts in nominator and denominator\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  //do the counting\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  //convert the map to a sequence of parameters\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n} \",\"val model = learn(train)\\nbarChart(model map (p => (p.src,p.tgt) -> p.prob) filter (_._1._2 == \\\"is\\\")) \",\"import uk.ac.ucl.cs.mr.statnlpbook.chapter.languagemodels._\\n\\ndef decode(source:Sentence, model:NaiveModel, lm:LanguageModel) = {\\n  //create a mapping from source words to relevant parameters\\n  val source2targets = model groupBy (_.src) \\n  def translate(token:Token) = {\\n    val candidates:Seq[Param] = source2targets(token.word)\\n    val scoredByLM = candidates map (p => p.copy(prob = p.prob * lm.probability(p.tgt)))\\n    scoredByLM.maxBy(_.prob).tgt\\n  }\\n  //translate word-by-word (for which LM does this work?)\\n  val words = source.tokens map translate\\n  Document(IndexedSeq(words))\\n}\\nval source = train(1)._2 //\\\"klein ist das Haus\\\"\\nval lm = UniformLM(model.map(_.tgt).toSet)\\nval target = decode(source, model, lm) \\ntarget.toText \",\"val target = segment(\\\"NULL the house is small\\\").sentences(0)\\nval source = segment(\\\"klein ist das Haus\\\").sentences(0)\\nRenderer.renderAlignment(target,source,Seq(1->2,2->3,3->1,4->0))\",\"val target2 = segment(\\\"NULL 家 わ 小さいい です\\\").sentences(0)\\nval source2 = segment(\\\"The house is small\\\").sentences(0)\\nRenderer.renderAlignment(target2,source2,Seq(0 -> 0, 1 -> 1, 3 -> 3, 4 -> 2))\",\"val trainM2 = Seq(\\n  \\\"NULL the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"NULL a man is tall\\\" -> \\\"groß ist ein Mann\\\",\\n  \\\"NULL my house is small\\\" -> \\\"klein ist mein Haus\\\",\\n  \\\"NULL the building is big\\\" -> \\\"groß ist das Gebäude\\\",\\n  \\\"NULL the building is long\\\" -> \\\"lang ist das Gebäude\\\"\\n) map (p => segment(p _1).sentences.head -> segment(p _2).sentences.head) \",\"//Each element in the sequence corresponds to one source token,\\n//and each element in the nested sequence to a target token.\\ntype Align = IndexedSeq[IndexedSeq[Double]]\\n\\n//Model parameters\\ncase class Model(\\n  alpha:Map[(String,String),Double],\\n  beta:Map[(Int,Int,Int,Int),Double]) \\n\\n//normalizing a distribution\\ndef norm(v:IndexedSeq[Double]) = { val s = v.sum; v map (_ / s) } \\n\\n//estimate new soft alignments\\ndef eStep(model:Model, data:Seq[(Sentence,Sentence)]):Seq[Align] = {\\n  for ((target,source) <- data) yield {\\n    def score(si:Int, ti:Int) = \\n      model.alpha(source.tokens(si).word,target.tokens(ti).word) * \\n      model.beta(ti,si,target.tokens.length, source.tokens.length)\\n    for (si <- source.tokens.indices) yield \\n      norm(for (ti <- target.tokens.indices) yield score(si,ti))\\n  }\\n}\"]"}};
        var id = 18;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"You can play around with the initialization of \\\\(\\bbeta\\\\) to see how the alignments react to changes of the word-to-word translation probabilities.\n\n<div class=\"newslide\"></div>\n#### M-Step\n\n<div class=\"book-start\"></div>\n\nThe M-Step optimizes a *weighted* or *expected* version of the log-likelihood of the data, using the distribution \\\\(\\pi\\\\) from the last E-Step:\n\n$$\n  \\params^* = \\argmax_\\params \\sum_{(\\target,\\source) \\in \\train} \\sum_\\aligns \\pi(\\aligns|\\target,\\source) \\log \\prob _\\params^\\text{IBM2}(\\source,\\aligns|\\target)\n$$\n\nThe summing over hidden alignments seems daunting, but because \\\\(\\pi\\\\) factorizes as we discussed above, we again have a simple closed-form solution:\n\n$$\n  \\alpha(\\ssource|\\starget) = \\frac\n    {\\sum_{(\\target,\\source)}\\sum_i^{l_\\source} \\sum_j^{l_\\target} \\pi(j|i) \\delta(\\ssource,\\ssource_i) \\delta(\\starget,\\starget_j) }\n    {\\sum_{(\\target,\\source)} \\sum_j^{l_\\target} \\delta(\\starget,\\starget_j) }\n$$\n\nwhere \\\\(\\delta(x,y)\\\\) is 1 if \\\\(x=y\\\\) and 0 otherwise. The updates for \\\\(\\beta\\\\) are similar. \n\n<div class=\"slide-start\"></div>\n\n* Calculate **weighted** maximum likelihood estimate:\n\n$$\n  \\params^* = \\argmax_\\params \\sum_{(\\target,\\source) \\in \\train} \\sum_\\aligns \\pi(\\aligns|\\target,\\source) \\log \\prob _\\params^\\text{IBM2}(\\source,\\aligns|\\target)\n$$ \n\n* Closed form solution (weighted counting):\n\n$$\n  \\alpha(\\ssource|\\starget) = \\frac\n    {\\sum_{(\\target,\\source)}\\sum_i^{l_\\source} \\sum_j^{l_\\target} \\pi(j|i) \\delta(\\ssource,\\ssource_i) \\delta(\\starget,\\starget_j) }\n    {\\sum_{(\\target,\\source)} \\sum_j^{l_\\target} \\delta(\\starget,\\starget_j) }\n$$\n\n\\\\(\\delta(x,y)\\\\) is 1 if \\\\(x=y\\\\) and 0 otherwise\n\n<div class=\"slide-end\"></div>\n\n<div class=\"newslide\"></div>\nLet us implement the M-Step now. In this step we estimate parameters \\\\(\\params\\\\) from a given set of (soft) alignments \\\\(\\aligns\\\\). \n\n","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p _1).sentences.head -> segment(p _2).sentences.head)\\ntrain.size\",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype Model = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):Model = {\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n}\\nval model = learn(train)\\nbarChart(model sortBy(_.tgt) map(p => (p.src,p.tgt) -> p.prob))\",\"def decode(source:Sentence, model:Model) = {\\n  val source2targets = model groupBy (_.src) //create one sub-model per source word\\n  val source2Best = source2targets mapValues (m => (m maxBy (_.prob)).tgt) //only keep best target\\n  val words = source.tokens map (s => source2Best(s.word))\\n  Document(IndexedSeq(words))\\n}\\nval source = train(1)._2\\nval target = decode(source, model)\\nrenderTokens(target)\",\"val target = segment(\\\"NULL the house is small\\\").sentences(0)\\nval source = segment(\\\"klein ist das Haus\\\").sentences(0)\\nRenderer.renderAlignment(target,source,Seq(1->2,2->3,3->1,4->0))\",\"def eStep() = {\\n  1\\n}\\neStep()\"]"}};
        var id = 19;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"def mStep(aligns:Seq[Align],data:Seq[(Sentence,Sentence)]) = {\n  val alpha = new HashMap[(String,String),Double] withDefaultValue 0.0\n  val alphaNorm = new HashMap[String,Double] withDefaultValue 0.0\n  val beta = new HashMap[(Int,Int,Int,Int),Double] withDefaultValue 0.0\n  val betaNorm = new HashMap[(Int,Int,Int),Double] withDefaultValue 0.0\n  for ((pi,(t,s)) <- aligns zip data) {\n    for (ti <- t.tokens.indices; si <- s.tokens.indices) {\n      alpha(s.tokens(si).word,t.tokens(ti).word) += pi(si)(ti) \n      alphaNorm(t.tokens(ti).word) += pi(si)(ti) \n      beta(ti,si,t.tokens.length,s.tokens.length) += pi(si)(ti)\n      betaNorm(si,t.tokens.length,s.tokens.length) += pi(si)(ti)\n    }  \n  }                 \n  Model(\n    alpha.toMap map {case ((s,t),p) => ((s,t), p / alphaNorm(t))} withDefaultValue 0.0,\n    beta.toMap map {case ((ti,si,ls,lt),p) => ((ti,si,ls,lt),p / betaNorm(si,ls,lt))} withDefaultValue 0.0)    \n}\n","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p._1).sentences.head -> segment(p._2).sentences.head)\\ntrain.size \",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype NaiveModel = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):NaiveModel = {\\n  //data structures to store counts in nominator and denominator\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  //do the counting\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  //convert the map to a sequence of parameters\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n} \",\"val model = learn(train)\\nbarChart(model map (p => (p.src,p.tgt) -> p.prob) filter (_._1._2 == \\\"is\\\")) \",\"import uk.ac.ucl.cs.mr.statnlpbook.chapter.languagemodels._\\n\\ndef decode(source:Sentence, model:NaiveModel, lm:LanguageModel) = {\\n  //create a mapping from source words to relevant parameters\\n  val source2targets = model groupBy (_.src) \\n  def translate(token:Token) = {\\n    val candidates:Seq[Param] = source2targets(token.word)\\n    val scoredByLM = candidates map (p => p.copy(prob = p.prob * lm.probability(p.tgt)))\\n    scoredByLM.maxBy(_.prob).tgt\\n  }\\n  //translate word-by-word (for which LM does this work?)\\n  val words = source.tokens map translate\\n  Document(IndexedSeq(words))\\n}\\nval source = train(1)._2 //\\\"klein ist das Haus\\\"\\nval lm = UniformLM(model.map(_.tgt).toSet)\\nval target = decode(source, model, lm) \\ntarget.toText \",\"val target = segment(\\\"NULL the house is small\\\").sentences(0)\\nval source = segment(\\\"klein ist das Haus\\\").sentences(0)\\nRenderer.renderAlignment(target,source,Seq(1->2,2->3,3->1,4->0))\",\"val target2 = segment(\\\"NULL 家 わ 小さいい です\\\").sentences(0)\\nval source2 = segment(\\\"The house is small\\\").sentences(0)\\nRenderer.renderAlignment(target2,source2,Seq(0 -> 0, 1 -> 1, 3 -> 3, 4 -> 2))\",\"val trainM2 = Seq(\\n  \\\"NULL the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"NULL a man is tall\\\" -> \\\"groß ist ein Mann\\\",\\n  \\\"NULL my house is small\\\" -> \\\"klein ist mein Haus\\\",\\n  \\\"NULL the building is big\\\" -> \\\"groß ist das Gebäude\\\",\\n  \\\"NULL the building is long\\\" -> \\\"lang ist das Gebäude\\\"\\n) map (p => segment(p _1).sentences.head -> segment(p _2).sentences.head) \",\"//Each element in the sequence corresponds to one source token,\\n//and each element in the nested sequence to a target token.\\ntype Align = IndexedSeq[IndexedSeq[Double]]\\n\\n//Model parameters\\ncase class Model(\\n  alpha:Map[(String,String),Double],\\n  beta:Map[(Int,Int,Int,Int),Double]) \\n\\n//normalizing a distribution\\ndef norm(v:IndexedSeq[Double]) = { val s = v.sum; v map (_ / s) } \\n\\n//estimate new soft alignments\\ndef eStep(model:Model, data:Seq[(Sentence,Sentence)]):Seq[Align] = {\\n  for ((target,source) <- data) yield {\\n    def score(si:Int, ti:Int) = \\n      model.alpha(source.tokens(si).word,target.tokens(ti).word) * \\n      model.beta(ti,si,target.tokens.length, source.tokens.length)\\n    for (si <- source.tokens.indices) yield \\n      norm(for (ti <- target.tokens.indices) yield score(si,ti))\\n  }\\n}\",\"val sourceVocab = trainM2.flatMap(_._2.tokens.map(_.word)).toSet \\nval init = Model(\\n    Map.empty withDefaultValue (1.0 / sourceVocab.size),\\n    Map.empty withDefault {case (ti,si,lt,ls) => 1.0 / lt })\\n\\nval alignments = eStep(init,trainM2) \\nRenderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, alignments(0))\"]","hide_output":"true"}};
        var id = 20;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nLet us run one M-Step on the alignments we estimated earlier.","extraFields":{}};
        var id = 21;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"val theta1 = mStep(alignments,trainM2)\nbarChart(theta1.alpha.filter(_._1._2 == \"is\"))","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p._1).sentences.head -> segment(p._2).sentences.head)\\ntrain.size \",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype NaiveModel = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):NaiveModel = {\\n  //data structures to store counts in nominator and denominator\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  //do the counting\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  //convert the map to a sequence of parameters\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n} \",\"val model = learn(train)\\nbarChart(model map (p => (p.src,p.tgt) -> p.prob) filter (_._1._2 == \\\"is\\\")) \",\"import uk.ac.ucl.cs.mr.statnlpbook.chapter.languagemodels._\\n\\ndef decode(source:Sentence, model:NaiveModel, lm:LanguageModel) = {\\n  //create a mapping from source words to relevant parameters\\n  val source2targets = model groupBy (_.src) \\n  def translate(token:Token) = {\\n    val candidates:Seq[Param] = source2targets(token.word)\\n    val scoredByLM = candidates map (p => p.copy(prob = p.prob * lm.probability(p.tgt)))\\n    scoredByLM.maxBy(_.prob).tgt\\n  }\\n  //translate word-by-word (for which LM does this work?)\\n  val words = source.tokens map translate\\n  Document(IndexedSeq(words))\\n}\\nval source = train(1)._2 //\\\"klein ist das Haus\\\"\\nval lm = UniformLM(model.map(_.tgt).toSet)\\nval target = decode(source, model, lm) \\ntarget.toText \",\"val target = segment(\\\"NULL the house is small\\\").sentences(0)\\nval source = segment(\\\"klein ist das Haus\\\").sentences(0)\\nRenderer.renderAlignment(target,source,Seq(1->2,2->3,3->1,4->0))\",\"val target2 = segment(\\\"NULL 家 わ 小さいい です\\\").sentences(0)\\nval source2 = segment(\\\"The house is small\\\").sentences(0)\\nRenderer.renderAlignment(target2,source2,Seq(0 -> 0, 1 -> 1, 3 -> 3, 4 -> 2))\",\"val trainM2 = Seq(\\n  \\\"NULL the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"NULL a man is tall\\\" -> \\\"groß ist ein Mann\\\",\\n  \\\"NULL my house is small\\\" -> \\\"klein ist mein Haus\\\",\\n  \\\"NULL the building is big\\\" -> \\\"groß ist das Gebäude\\\",\\n  \\\"NULL the building is long\\\" -> \\\"lang ist das Gebäude\\\"\\n) map (p => segment(p _1).sentences.head -> segment(p _2).sentences.head) \",\"//Each element in the sequence corresponds to one source token,\\n//and each element in the nested sequence to a target token.\\ntype Align = IndexedSeq[IndexedSeq[Double]]\\n\\n//Model parameters\\ncase class Model(\\n  alpha:Map[(String,String),Double],\\n  beta:Map[(Int,Int,Int,Int),Double]) \\n\\n//normalizing a distribution\\ndef norm(v:IndexedSeq[Double]) = { val s = v.sum; v map (_ / s) } \\n\\n//estimate new soft alignments\\ndef eStep(model:Model, data:Seq[(Sentence,Sentence)]):Seq[Align] = {\\n  for ((target,source) <- data) yield {\\n    def score(si:Int, ti:Int) = \\n      model.alpha(source.tokens(si).word,target.tokens(ti).word) * \\n      model.beta(ti,si,target.tokens.length, source.tokens.length)\\n    for (si <- source.tokens.indices) yield \\n      norm(for (ti <- target.tokens.indices) yield score(si,ti))\\n  }\\n}\",\"val sourceVocab = trainM2.flatMap(_._2.tokens.map(_.word)).toSet \\nval init = Model(\\n    Map.empty withDefaultValue (1.0 / sourceVocab.size),\\n    Map.empty withDefault {case (ti,si,lt,ls) => 1.0 / lt })\\n\\nval alignments = eStep(init,trainM2) \\nRenderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, alignments(0))\",\"def mStep(aligns:Seq[Align],data:Seq[(Sentence,Sentence)]) = {\\n  val alpha = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  val alphaNorm = new HashMap[String,Double] withDefaultValue 0.0\\n  val beta = new HashMap[(Int,Int,Int,Int),Double] withDefaultValue 0.0\\n  val betaNorm = new HashMap[(Int,Int,Int),Double] withDefaultValue 0.0\\n  for ((pi,(t,s)) <- aligns zip data) {\\n    for (ti <- t.tokens.indices; si <- s.tokens.indices) {\\n      alpha(s.tokens(si).word,t.tokens(ti).word) += pi(si)(ti) \\n      alphaNorm(t.tokens(ti).word) += pi(si)(ti) \\n      beta(ti,si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n      betaNorm(si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n    }  \\n  }                 \\n  Model(\\n    alpha.toMap map {case ((s,t),p) => ((s,t), p / alphaNorm(t))} withDefaultValue 0.0,\\n    beta.toMap map {case ((ti,si,ls,lt),p) => ((ti,si,ls,lt),p / betaNorm(si,ls,lt))} withDefaultValue 0.0)    \\n}\\n\"]"}};
        var id = 22;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"Notice that the algorithm already figured out that \"is\" is most likely translated to \"ist\". This is because it is (softly) aligned with \"is\" in every sentence, whereas other German words only appear in a subset of the sentences.","extraFields":{}};
        var id = 23;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"\n<div class=\"newslide\"></div>\n#### Initialization (IBM Model 1)\nWe could already iteratively call `eStep` and `mStep`until convergence. However, a crucial question is how to initialize the model parameters for the first call to 'eStep'. So far we used a uniform initialization, but given that the EM algorithm's results usually depend significantly on initialization, using a more informed starting point can be useful. <span class=\"summary\">Due to non-convexity of the EM bound, good initialization is crucial. </span>\n\n<div class=\"newslide\"></div>\nA common way to initialize EM for IBM Model 2 training is to first train the so called IBM Model 1 using EM. This model really is an instantiation of Model 2 with a specific and **fixed** alignment parameter set \\\\(\\bbeta\\\\). Instead of estimating \\\\(\\bbeta\\\\) it is set to assign uniform probability to all target tokens with respect to a given length: <span class=\"summary\">We can train **IBM Model 1**, which fixes the distortion parameters \\\\(\\bbeta\\\\) to be uniform:</span>\n\n$$\n  \\beta(a_i|i,l_\\starget,l_\\ssource) = \\frac{1}{l_\\starget + 1}\n$$\n\nAfter training the parameters \\\\(\\params\\\\) of Model 1 can be used to initialize EM for Model 2.  \n\n<div class=\"newslide\"></div>\nTraining Model 1 using EM could have the same initialization problem. Fortunately it turns out that with \\\\(\\bbeta\\\\) fixed in this way it can be shown, under mild conditions, that EM will converge to a global optimum, making IBM Model 1 robust to choices of initialization. <span class=\"summary\">EM for IBM Model 1 converges to a global optimum.</span>\n\n<div class=\"newslide\"></div>\nLet us train IBM Model 1 now. This amounts to using our previous `eStep` and `mStep` methods, initializing \\\\(\\bbeta\\\\) as above and not updating it during `mStep`. ","extraFields":{}};
        var id = 24;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"def change(a1:Seq[Align],a2:Seq[Align]) = {\n  val flatA1 = a1.flatMap(_.flatten) \n  val flatA2 = a2.flatMap(_.flatten)\n  val diffs = (flatA1 zip flatA2) map {case(p1,p2) => math.abs(p1 - p2)}\n  diffs.sum / flatA1.length\n}\ndef emModel1(init:Model, data:Seq[(Sentence,Sentence)], iterations:Int) = {\n  var model = init\n  var alignments = data.map(d => d._2.tokens.map(t => d._1.tokens.map(_ => 0.0)))\n  for (_ <- 0 until iterations) yield {\n    val old = alignments\n    alignments = eStep(model, data)\n    model = mStep(alignments, data).copy(beta = init.beta) \n    (alignments,model,change(old,alignments))\n  }                   \n} ","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p._1).sentences.head -> segment(p._2).sentences.head)\\ntrain.size \",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype NaiveModel = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):NaiveModel = {\\n  //data structures to store counts in nominator and denominator\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  //do the counting\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  //convert the map to a sequence of parameters\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n} \",\"val model = learn(train)\\nbarChart(model map (p => (p.src,p.tgt) -> p.prob) filter (_._1._2 == \\\"is\\\")) \",\"import uk.ac.ucl.cs.mr.statnlpbook.chapter.languagemodels._\\n\\ndef decode(source:Sentence, model:NaiveModel, lm:LanguageModel) = {\\n  //create a mapping from source words to relevant parameters\\n  val source2targets = model groupBy (_.src) \\n  def translate(token:Token) = {\\n    val candidates:Seq[Param] = source2targets(token.word)\\n    val scoredByLM = candidates map (p => p.copy(prob = p.prob * lm.probability(p.tgt)))\\n    scoredByLM.maxBy(_.prob).tgt\\n  }\\n  //translate word-by-word (for which LM does this work?)\\n  val words = source.tokens map translate\\n  Document(IndexedSeq(words))\\n}\\nval source = train(1)._2 //\\\"klein ist das Haus\\\"\\nval lm = UniformLM(model.map(_.tgt).toSet)\\nval target = decode(source, model, lm) \\ntarget.toText \",\"val target = segment(\\\"NULL the house is small\\\").sentences(0)\\nval source = segment(\\\"klein ist das Haus\\\").sentences(0)\\nRenderer.renderAlignment(target,source,Seq(1->2,2->3,3->1,4->0))\",\"val target2 = segment(\\\"NULL 家 わ 小さいい です\\\").sentences(0)\\nval source2 = segment(\\\"The house is small\\\").sentences(0)\\nRenderer.renderAlignment(target2,source2,Seq(0 -> 0, 1 -> 1, 3 -> 3, 4 -> 2))\",\"val trainM2 = Seq(\\n  \\\"NULL the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"NULL a man is tall\\\" -> \\\"groß ist ein Mann\\\",\\n  \\\"NULL my house is small\\\" -> \\\"klein ist mein Haus\\\",\\n  \\\"NULL the building is big\\\" -> \\\"groß ist das Gebäude\\\",\\n  \\\"NULL the building is long\\\" -> \\\"lang ist das Gebäude\\\"\\n) map (p => segment(p _1).sentences.head -> segment(p _2).sentences.head) \",\"//Each element in the sequence corresponds to one source token,\\n//and each element in the nested sequence to a target token.\\ntype Align = IndexedSeq[IndexedSeq[Double]]\\n\\n//Model parameters\\ncase class Model(\\n  alpha:Map[(String,String),Double],\\n  beta:Map[(Int,Int,Int,Int),Double]) \\n\\n//normalizing a distribution\\ndef norm(v:IndexedSeq[Double]) = { val s = v.sum; v map (_ / s) } \\n\\n//estimate new soft alignments\\ndef eStep(model:Model, data:Seq[(Sentence,Sentence)]):Seq[Align] = {\\n  for ((target,source) <- data) yield {\\n    def score(si:Int, ti:Int) = \\n      model.alpha(source.tokens(si).word,target.tokens(ti).word) * \\n      model.beta(ti,si,target.tokens.length, source.tokens.length)\\n    for (si <- source.tokens.indices) yield \\n      norm(for (ti <- target.tokens.indices) yield score(si,ti))\\n  }\\n}\",\"val sourceVocab = trainM2.flatMap(_._2.tokens.map(_.word)).toSet \\nval init = Model(\\n    Map.empty withDefaultValue (1.0 / sourceVocab.size),\\n    Map.empty withDefault {case (ti,si,lt,ls) => 1.0 / lt })\\n\\nval alignments = eStep(init,trainM2) \\nRenderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, alignments(0))\",\"def mStep(aligns:Seq[Align],data:Seq[(Sentence,Sentence)]) = {\\n  val alpha = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  val alphaNorm = new HashMap[String,Double] withDefaultValue 0.0\\n  val beta = new HashMap[(Int,Int,Int,Int),Double] withDefaultValue 0.0\\n  val betaNorm = new HashMap[(Int,Int,Int),Double] withDefaultValue 0.0\\n  for ((pi,(t,s)) <- aligns zip data) {\\n    for (ti <- t.tokens.indices; si <- s.tokens.indices) {\\n      alpha(s.tokens(si).word,t.tokens(ti).word) += pi(si)(ti) \\n      alphaNorm(t.tokens(ti).word) += pi(si)(ti) \\n      beta(ti,si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n      betaNorm(si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n    }  \\n  }                 \\n  Model(\\n    alpha.toMap map {case ((s,t),p) => ((s,t), p / alphaNorm(t))} withDefaultValue 0.0,\\n    beta.toMap map {case ((ti,si,ls,lt),p) => ((ti,si,ls,lt),p / betaNorm(si,ls,lt))} withDefaultValue 0.0)    \\n}\\n\",\"val theta1 = mStep(alignments,trainM2)\\nbarChart(theta1.alpha.filter(_._1._2 == \\\"is\\\"))\"]","hide_output":"true"}};
        var id = 25;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nYou can see below that the alignments converge relatively quickly.   ","extraFields":{}};
        var id = 26;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"val ibm1Iterations = emModel1(init, trainM2, 100)\nval xyData = ibm1Iterations.indices.map(_.toDouble) -> ibm1Iterations.map(_._3) \nlineplot(xyData)  ","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p._1).sentences.head -> segment(p._2).sentences.head)\\ntrain.size \",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype NaiveModel = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):NaiveModel = {\\n  //data structures to store counts in nominator and denominator\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  //do the counting\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  //convert the map to a sequence of parameters\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n} \",\"val model = learn(train)\\nbarChart(model map (p => (p.src,p.tgt) -> p.prob) filter (_._1._2 == \\\"is\\\")) \",\"import uk.ac.ucl.cs.mr.statnlpbook.chapter.languagemodels._\\n\\ndef decode(source:Sentence, model:NaiveModel, lm:LanguageModel) = {\\n  //create a mapping from source words to relevant parameters\\n  val source2targets = model groupBy (_.src) \\n  def translate(token:Token) = {\\n    val candidates:Seq[Param] = source2targets(token.word)\\n    val scoredByLM = candidates map (p => p.copy(prob = p.prob * lm.probability(p.tgt)))\\n    scoredByLM.maxBy(_.prob).tgt\\n  }\\n  //translate word-by-word (for which LM does this work?)\\n  val words = source.tokens map translate\\n  Document(IndexedSeq(words))\\n}\\nval source = train(1)._2 //\\\"klein ist das Haus\\\"\\nval lm = UniformLM(model.map(_.tgt).toSet)\\nval target = decode(source, model, lm) \\ntarget.toText \",\"val target = segment(\\\"NULL the house is small\\\").sentences(0)\\nval source = segment(\\\"klein ist das Haus\\\").sentences(0)\\nRenderer.renderAlignment(target,source,Seq(1->2,2->3,3->1,4->0))\",\"val target2 = segment(\\\"NULL 家 わ 小さいい です\\\").sentences(0)\\nval source2 = segment(\\\"The house is small\\\").sentences(0)\\nRenderer.renderAlignment(target2,source2,Seq(0 -> 0, 1 -> 1, 3 -> 3, 4 -> 2))\",\"val trainM2 = Seq(\\n  \\\"NULL the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"NULL a man is tall\\\" -> \\\"groß ist ein Mann\\\",\\n  \\\"NULL my house is small\\\" -> \\\"klein ist mein Haus\\\",\\n  \\\"NULL the building is big\\\" -> \\\"groß ist das Gebäude\\\",\\n  \\\"NULL the building is long\\\" -> \\\"lang ist das Gebäude\\\"\\n) map (p => segment(p _1).sentences.head -> segment(p _2).sentences.head) \",\"//Each element in the sequence corresponds to one source token,\\n//and each element in the nested sequence to a target token.\\ntype Align = IndexedSeq[IndexedSeq[Double]]\\n\\n//Model parameters\\ncase class Model(\\n  alpha:Map[(String,String),Double],\\n  beta:Map[(Int,Int,Int,Int),Double]) \\n\\n//normalizing a distribution\\ndef norm(v:IndexedSeq[Double]) = { val s = v.sum; v map (_ / s) } \\n\\n//estimate new soft alignments\\ndef eStep(model:Model, data:Seq[(Sentence,Sentence)]):Seq[Align] = {\\n  for ((target,source) <- data) yield {\\n    def score(si:Int, ti:Int) = \\n      model.alpha(source.tokens(si).word,target.tokens(ti).word) * \\n      model.beta(ti,si,target.tokens.length, source.tokens.length)\\n    for (si <- source.tokens.indices) yield \\n      norm(for (ti <- target.tokens.indices) yield score(si,ti))\\n  }\\n}\",\"val sourceVocab = trainM2.flatMap(_._2.tokens.map(_.word)).toSet \\nval init = Model(\\n    Map.empty withDefaultValue (1.0 / sourceVocab.size),\\n    Map.empty withDefault {case (ti,si,lt,ls) => 1.0 / lt })\\n\\nval alignments = eStep(init,trainM2) \\nRenderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, alignments(0))\",\"def mStep(aligns:Seq[Align],data:Seq[(Sentence,Sentence)]) = {\\n  val alpha = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  val alphaNorm = new HashMap[String,Double] withDefaultValue 0.0\\n  val beta = new HashMap[(Int,Int,Int,Int),Double] withDefaultValue 0.0\\n  val betaNorm = new HashMap[(Int,Int,Int),Double] withDefaultValue 0.0\\n  for ((pi,(t,s)) <- aligns zip data) {\\n    for (ti <- t.tokens.indices; si <- s.tokens.indices) {\\n      alpha(s.tokens(si).word,t.tokens(ti).word) += pi(si)(ti) \\n      alphaNorm(t.tokens(ti).word) += pi(si)(ti) \\n      beta(ti,si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n      betaNorm(si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n    }  \\n  }                 \\n  Model(\\n    alpha.toMap map {case ((s,t),p) => ((s,t), p / alphaNorm(t))} withDefaultValue 0.0,\\n    beta.toMap map {case ((ti,si,ls,lt),p) => ((ti,si,ls,lt),p / betaNorm(si,ls,lt))} withDefaultValue 0.0)    \\n}\\n\",\"val theta1 = mStep(alignments,trainM2)\\nbarChart(theta1.alpha.filter(_._1._2 == \\\"is\\\"))\",\"def change(a1:Seq[Align],a2:Seq[Align]) = {\\n  val flatA1 = a1.flatMap(_.flatten) \\n  val flatA2 = a2.flatMap(_.flatten)\\n  val diffs = (flatA1 zip flatA2) map {case(p1,p2) => math.abs(p1 - p2)}\\n  diffs.sum / flatA1.length\\n}\\ndef emModel1(init:Model, data:Seq[(Sentence,Sentence)], iterations:Int) = {\\n  var model = init\\n  var alignments = data.map(d => d._2.tokens.map(t => d._1.tokens.map(_ => 0.0)))\\n  for (_ <- 0 until iterations) yield {\\n    val old = alignments\\n    alignments = eStep(model, data)\\n    model = mStep(alignments, data).copy(beta = init.beta) \\n    (alignments,model,change(old,alignments))\\n  }                   \\n} \"]"}};
        var id = 27;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\n<div class=\"start-book\"></div>\n<div class=\"exercise\">\n  <div class=\"exname\">Exercise 1</div>\n  <div class=\"extext\">Can you think of other reasonable measures for convergence? Hint: consider the formal derivation of EM. </div>\n</div>\n<div class=\"start-slide\"></div>\n<div class=\"end-slide\"></div>\n\n","extraFields":{}};
        var id = 28;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nLet us have a look at the translation table.","extraFields":{}};
        var id = 29;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"barChart(ibm1Iterations.last._2.alpha.filter(_._1._2 == \"house\")) ","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p._1).sentences.head -> segment(p._2).sentences.head)\\ntrain.size \",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype NaiveModel = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):NaiveModel = {\\n  //data structures to store counts in nominator and denominator\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  //do the counting\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  //convert the map to a sequence of parameters\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n} \",\"val model = learn(train)\\nbarChart(model map (p => (p.src,p.tgt) -> p.prob) filter (_._1._2 == \\\"is\\\")) \",\"import uk.ac.ucl.cs.mr.statnlpbook.chapter.languagemodels._\\n\\ndef decode(source:Sentence, model:NaiveModel, lm:LanguageModel) = {\\n  //create a mapping from source words to relevant parameters\\n  val source2targets = model groupBy (_.src) \\n  def translate(token:Token) = {\\n    val candidates:Seq[Param] = source2targets(token.word)\\n    val scoredByLM = candidates map (p => p.copy(prob = p.prob * lm.probability(p.tgt)))\\n    scoredByLM.maxBy(_.prob).tgt\\n  }\\n  //translate word-by-word (for which LM does this work?)\\n  val words = source.tokens map translate\\n  Document(IndexedSeq(words))\\n}\\nval source = train(1)._2 //\\\"klein ist das Haus\\\"\\nval lm = UniformLM(model.map(_.tgt).toSet)\\nval target = decode(source, model, lm) \\ntarget.toText \",\"val target = segment(\\\"NULL the house is small\\\").sentences(0)\\nval source = segment(\\\"klein ist das Haus\\\").sentences(0)\\nRenderer.renderAlignment(target,source,Seq(1->2,2->3,3->1,4->0))\",\"val target2 = segment(\\\"NULL 家 わ 小さいい です\\\").sentences(0)\\nval source2 = segment(\\\"The house is small\\\").sentences(0)\\nRenderer.renderAlignment(target2,source2,Seq(0 -> 0, 1 -> 1, 3 -> 3, 4 -> 2))\",\"val trainM2 = Seq(\\n  \\\"NULL the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"NULL a man is tall\\\" -> \\\"groß ist ein Mann\\\",\\n  \\\"NULL my house is small\\\" -> \\\"klein ist mein Haus\\\",\\n  \\\"NULL the building is big\\\" -> \\\"groß ist das Gebäude\\\",\\n  \\\"NULL the building is long\\\" -> \\\"lang ist das Gebäude\\\"\\n) map (p => segment(p _1).sentences.head -> segment(p _2).sentences.head) \",\"//Each element in the sequence corresponds to one source token,\\n//and each element in the nested sequence to a target token.\\ntype Align = IndexedSeq[IndexedSeq[Double]]\\n\\n//Model parameters\\ncase class Model(\\n  alpha:Map[(String,String),Double],\\n  beta:Map[(Int,Int,Int,Int),Double]) \\n\\n//normalizing a distribution\\ndef norm(v:IndexedSeq[Double]) = { val s = v.sum; v map (_ / s) } \\n\\n//estimate new soft alignments\\ndef eStep(model:Model, data:Seq[(Sentence,Sentence)]):Seq[Align] = {\\n  for ((target,source) <- data) yield {\\n    def score(si:Int, ti:Int) = \\n      model.alpha(source.tokens(si).word,target.tokens(ti).word) * \\n      model.beta(ti,si,target.tokens.length, source.tokens.length)\\n    for (si <- source.tokens.indices) yield \\n      norm(for (ti <- target.tokens.indices) yield score(si,ti))\\n  }\\n}\",\"val sourceVocab = trainM2.flatMap(_._2.tokens.map(_.word)).toSet \\nval init = Model(\\n    Map.empty withDefaultValue (1.0 / sourceVocab.size),\\n    Map.empty withDefault {case (ti,si,lt,ls) => 1.0 / lt })\\n\\nval alignments = eStep(init,trainM2) \\nRenderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, alignments(0))\",\"def mStep(aligns:Seq[Align],data:Seq[(Sentence,Sentence)]) = {\\n  val alpha = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  val alphaNorm = new HashMap[String,Double] withDefaultValue 0.0\\n  val beta = new HashMap[(Int,Int,Int,Int),Double] withDefaultValue 0.0\\n  val betaNorm = new HashMap[(Int,Int,Int),Double] withDefaultValue 0.0\\n  for ((pi,(t,s)) <- aligns zip data) {\\n    for (ti <- t.tokens.indices; si <- s.tokens.indices) {\\n      alpha(s.tokens(si).word,t.tokens(ti).word) += pi(si)(ti) \\n      alphaNorm(t.tokens(ti).word) += pi(si)(ti) \\n      beta(ti,si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n      betaNorm(si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n    }  \\n  }                 \\n  Model(\\n    alpha.toMap map {case ((s,t),p) => ((s,t), p / alphaNorm(t))} withDefaultValue 0.0,\\n    beta.toMap map {case ((ti,si,ls,lt),p) => ((ti,si,ls,lt),p / betaNorm(si,ls,lt))} withDefaultValue 0.0)    \\n}\\n\",\"val theta1 = mStep(alignments,trainM2)\\nbarChart(theta1.alpha.filter(_._1._2 == \\\"is\\\"))\",\"def change(a1:Seq[Align],a2:Seq[Align]) = {\\n  val flatA1 = a1.flatMap(_.flatten) \\n  val flatA2 = a2.flatMap(_.flatten)\\n  val diffs = (flatA1 zip flatA2) map {case(p1,p2) => math.abs(p1 - p2)}\\n  diffs.sum / flatA1.length\\n}\\ndef emModel1(init:Model, data:Seq[(Sentence,Sentence)], iterations:Int) = {\\n  var model = init\\n  var alignments = data.map(d => d._2.tokens.map(t => d._1.tokens.map(_ => 0.0)))\\n  for (_ <- 0 until iterations) yield {\\n    val old = alignments\\n    alignments = eStep(model, data)\\n    model = mStep(alignments, data).copy(beta = init.beta) \\n    (alignments,model,change(old,alignments))\\n  }                   \\n} \",\"val ibm1Iterations = emModel1(init, trainM2, 100)\\nval xyData = ibm1Iterations.indices.map(_.toDouble) -> ibm1Iterations.map(_._3) \\nlineplot(xyData)  \"]"}};
        var id = 30;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div> \nWe can also inspect the alignments generated during EM.","extraFields":{}};
        var id = 31;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"Renderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, ibm1Iterations.last._1(0))","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p._1).sentences.head -> segment(p._2).sentences.head)\\ntrain.size \",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype NaiveModel = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):NaiveModel = {\\n  //data structures to store counts in nominator and denominator\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  //do the counting\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  //convert the map to a sequence of parameters\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n} \",\"val model = learn(train)\\nbarChart(model map (p => (p.src,p.tgt) -> p.prob) filter (_._1._2 == \\\"is\\\")) \",\"import uk.ac.ucl.cs.mr.statnlpbook.chapter.languagemodels._\\n\\ndef decode(source:Sentence, model:NaiveModel, lm:LanguageModel) = {\\n  //create a mapping from source words to relevant parameters\\n  val source2targets = model groupBy (_.src) \\n  def translate(token:Token) = {\\n    val candidates:Seq[Param] = source2targets(token.word)\\n    val scoredByLM = candidates map (p => p.copy(prob = p.prob * lm.probability(p.tgt)))\\n    scoredByLM.maxBy(_.prob).tgt\\n  }\\n  //translate word-by-word (for which LM does this work?)\\n  val words = source.tokens map translate\\n  Document(IndexedSeq(words))\\n}\\nval source = train(1)._2 //\\\"klein ist das Haus\\\"\\nval lm = UniformLM(model.map(_.tgt).toSet)\\nval target = decode(source, model, lm) \\ntarget.toText \",\"val target = segment(\\\"NULL the house is small\\\").sentences(0)\\nval source = segment(\\\"klein ist das Haus\\\").sentences(0)\\nRenderer.renderAlignment(target,source,Seq(1->2,2->3,3->1,4->0))\",\"val target2 = segment(\\\"NULL 家 わ 小さいい です\\\").sentences(0)\\nval source2 = segment(\\\"The house is small\\\").sentences(0)\\nRenderer.renderAlignment(target2,source2,Seq(0 -> 0, 1 -> 1, 3 -> 3, 4 -> 2))\",\"val trainM2 = Seq(\\n  \\\"NULL the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"NULL a man is tall\\\" -> \\\"groß ist ein Mann\\\",\\n  \\\"NULL my house is small\\\" -> \\\"klein ist mein Haus\\\",\\n  \\\"NULL the building is big\\\" -> \\\"groß ist das Gebäude\\\",\\n  \\\"NULL the building is long\\\" -> \\\"lang ist das Gebäude\\\"\\n) map (p => segment(p _1).sentences.head -> segment(p _2).sentences.head) \",\"//Each element in the sequence corresponds to one source token,\\n//and each element in the nested sequence to a target token.\\ntype Align = IndexedSeq[IndexedSeq[Double]]\\n\\n//Model parameters\\ncase class Model(\\n  alpha:Map[(String,String),Double],\\n  beta:Map[(Int,Int,Int,Int),Double]) \\n\\n//normalizing a distribution\\ndef norm(v:IndexedSeq[Double]) = { val s = v.sum; v map (_ / s) } \\n\\n//estimate new soft alignments\\ndef eStep(model:Model, data:Seq[(Sentence,Sentence)]):Seq[Align] = {\\n  for ((target,source) <- data) yield {\\n    def score(si:Int, ti:Int) = \\n      model.alpha(source.tokens(si).word,target.tokens(ti).word) * \\n      model.beta(ti,si,target.tokens.length, source.tokens.length)\\n    for (si <- source.tokens.indices) yield \\n      norm(for (ti <- target.tokens.indices) yield score(si,ti))\\n  }\\n}\",\"val sourceVocab = trainM2.flatMap(_._2.tokens.map(_.word)).toSet \\nval init = Model(\\n    Map.empty withDefaultValue (1.0 / sourceVocab.size),\\n    Map.empty withDefault {case (ti,si,lt,ls) => 1.0 / lt })\\n\\nval alignments = eStep(init,trainM2) \\nRenderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, alignments(0))\",\"def mStep(aligns:Seq[Align],data:Seq[(Sentence,Sentence)]) = {\\n  val alpha = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  val alphaNorm = new HashMap[String,Double] withDefaultValue 0.0\\n  val beta = new HashMap[(Int,Int,Int,Int),Double] withDefaultValue 0.0\\n  val betaNorm = new HashMap[(Int,Int,Int),Double] withDefaultValue 0.0\\n  for ((pi,(t,s)) <- aligns zip data) {\\n    for (ti <- t.tokens.indices; si <- s.tokens.indices) {\\n      alpha(s.tokens(si).word,t.tokens(ti).word) += pi(si)(ti) \\n      alphaNorm(t.tokens(ti).word) += pi(si)(ti) \\n      beta(ti,si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n      betaNorm(si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n    }  \\n  }                 \\n  Model(\\n    alpha.toMap map {case ((s,t),p) => ((s,t), p / alphaNorm(t))} withDefaultValue 0.0,\\n    beta.toMap map {case ((ti,si,ls,lt),p) => ((ti,si,ls,lt),p / betaNorm(si,ls,lt))} withDefaultValue 0.0)    \\n}\\n\",\"val theta1 = mStep(alignments,trainM2)\\nbarChart(theta1.alpha.filter(_._1._2 == \\\"is\\\"))\",\"def change(a1:Seq[Align],a2:Seq[Align]) = {\\n  val flatA1 = a1.flatMap(_.flatten) \\n  val flatA2 = a2.flatMap(_.flatten)\\n  val diffs = (flatA1 zip flatA2) map {case(p1,p2) => math.abs(p1 - p2)}\\n  diffs.sum / flatA1.length\\n}\\ndef emModel1(init:Model, data:Seq[(Sentence,Sentence)], iterations:Int) = {\\n  var model = init\\n  var alignments = data.map(d => d._2.tokens.map(t => d._1.tokens.map(_ => 0.0)))\\n  for (_ <- 0 until iterations) yield {\\n    val old = alignments\\n    alignments = eStep(model, data)\\n    model = mStep(alignments, data).copy(beta = init.beta) \\n    (alignments,model,change(old,alignments))\\n  }                   \\n} \",\"val ibm1Iterations = emModel1(init, trainM2, 100)\\nval xyData = ibm1Iterations.indices.map(_.toDouble) -> ibm1Iterations.map(_._3) \\nlineplot(xyData)  \",\"barChart(ibm1Iterations.last._2.alpha.filter(_._1._2 == \\\"house\\\")) \"]"}};
        var id = 32;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\n#### Training IBM Model 2\nNow that we have a reasonable initial model we can use it to initialize EM for IBM Model 2. Here is the EM code in full.\n","extraFields":{}};
        var id = 33;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"def emModel2(init:Model, data:Seq[(Sentence,Sentence)], iterations:Int) = {\n  var model = init\n  var alignments = data.map(d => d._2.tokens.map(t => d._1.tokens.map(_ => 0.0)))\n  for (_ <- 0 until iterations) yield {\n    val old = alignments\n    alignments = eStep(model, data)\n    model = mStep(alignments, data)\n    (alignments,model,change(old,alignments))\n  }                   \n} ","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p._1).sentences.head -> segment(p._2).sentences.head)\\ntrain.size \",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype NaiveModel = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):NaiveModel = {\\n  //data structures to store counts in nominator and denominator\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  //do the counting\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  //convert the map to a sequence of parameters\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n} \",\"val model = learn(train)\\nbarChart(model map (p => (p.src,p.tgt) -> p.prob) filter (_._1._2 == \\\"is\\\")) \",\"import uk.ac.ucl.cs.mr.statnlpbook.chapter.languagemodels._\\n\\ndef decode(source:Sentence, model:NaiveModel, lm:LanguageModel) = {\\n  //create a mapping from source words to relevant parameters\\n  val source2targets = model groupBy (_.src) \\n  def translate(token:Token) = {\\n    val candidates:Seq[Param] = source2targets(token.word)\\n    val scoredByLM = candidates map (p => p.copy(prob = p.prob * lm.probability(p.tgt)))\\n    scoredByLM.maxBy(_.prob).tgt\\n  }\\n  //translate word-by-word (for which LM does this work?)\\n  val words = source.tokens map translate\\n  Document(IndexedSeq(words))\\n}\\nval source = train(1)._2 //\\\"klein ist das Haus\\\"\\nval lm = UniformLM(model.map(_.tgt).toSet)\\nval target = decode(source, model, lm) \\ntarget.toText \",\"val target = segment(\\\"NULL the house is small\\\").sentences(0)\\nval source = segment(\\\"klein ist das Haus\\\").sentences(0)\\nRenderer.renderAlignment(target,source,Seq(1->2,2->3,3->1,4->0))\",\"val target2 = segment(\\\"NULL 家 わ 小さいい です\\\").sentences(0)\\nval source2 = segment(\\\"The house is small\\\").sentences(0)\\nRenderer.renderAlignment(target2,source2,Seq(0 -> 0, 1 -> 1, 3 -> 3, 4 -> 2))\",\"val trainM2 = Seq(\\n  \\\"NULL the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"NULL a man is tall\\\" -> \\\"groß ist ein Mann\\\",\\n  \\\"NULL my house is small\\\" -> \\\"klein ist mein Haus\\\",\\n  \\\"NULL the building is big\\\" -> \\\"groß ist das Gebäude\\\",\\n  \\\"NULL the building is long\\\" -> \\\"lang ist das Gebäude\\\"\\n) map (p => segment(p _1).sentences.head -> segment(p _2).sentences.head) \",\"//Each element in the sequence corresponds to one source token,\\n//and each element in the nested sequence to a target token.\\ntype Align = IndexedSeq[IndexedSeq[Double]]\\n\\n//Model parameters\\ncase class Model(\\n  alpha:Map[(String,String),Double],\\n  beta:Map[(Int,Int,Int,Int),Double]) \\n\\n//normalizing a distribution\\ndef norm(v:IndexedSeq[Double]) = { val s = v.sum; v map (_ / s) } \\n\\n//estimate new soft alignments\\ndef eStep(model:Model, data:Seq[(Sentence,Sentence)]):Seq[Align] = {\\n  for ((target,source) <- data) yield {\\n    def score(si:Int, ti:Int) = \\n      model.alpha(source.tokens(si).word,target.tokens(ti).word) * \\n      model.beta(ti,si,target.tokens.length, source.tokens.length)\\n    for (si <- source.tokens.indices) yield \\n      norm(for (ti <- target.tokens.indices) yield score(si,ti))\\n  }\\n}\",\"val sourceVocab = trainM2.flatMap(_._2.tokens.map(_.word)).toSet \\nval init = Model(\\n    Map.empty withDefaultValue (1.0 / sourceVocab.size),\\n    Map.empty withDefault {case (ti,si,lt,ls) => 1.0 / lt })\\n\\nval alignments = eStep(init,trainM2) \\nRenderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, alignments(0))\",\"def mStep(aligns:Seq[Align],data:Seq[(Sentence,Sentence)]) = {\\n  val alpha = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  val alphaNorm = new HashMap[String,Double] withDefaultValue 0.0\\n  val beta = new HashMap[(Int,Int,Int,Int),Double] withDefaultValue 0.0\\n  val betaNorm = new HashMap[(Int,Int,Int),Double] withDefaultValue 0.0\\n  for ((pi,(t,s)) <- aligns zip data) {\\n    for (ti <- t.tokens.indices; si <- s.tokens.indices) {\\n      alpha(s.tokens(si).word,t.tokens(ti).word) += pi(si)(ti) \\n      alphaNorm(t.tokens(ti).word) += pi(si)(ti) \\n      beta(ti,si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n      betaNorm(si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n    }  \\n  }                 \\n  Model(\\n    alpha.toMap map {case ((s,t),p) => ((s,t), p / alphaNorm(t))} withDefaultValue 0.0,\\n    beta.toMap map {case ((ti,si,ls,lt),p) => ((ti,si,ls,lt),p / betaNorm(si,ls,lt))} withDefaultValue 0.0)    \\n}\\n\",\"val theta1 = mStep(alignments,trainM2)\\nbarChart(theta1.alpha.filter(_._1._2 == \\\"is\\\"))\",\"def change(a1:Seq[Align],a2:Seq[Align]) = {\\n  val flatA1 = a1.flatMap(_.flatten) \\n  val flatA2 = a2.flatMap(_.flatten)\\n  val diffs = (flatA1 zip flatA2) map {case(p1,p2) => math.abs(p1 - p2)}\\n  diffs.sum / flatA1.length\\n}\\ndef emModel1(init:Model, data:Seq[(Sentence,Sentence)], iterations:Int) = {\\n  var model = init\\n  var alignments = data.map(d => d._2.tokens.map(t => d._1.tokens.map(_ => 0.0)))\\n  for (_ <- 0 until iterations) yield {\\n    val old = alignments\\n    alignments = eStep(model, data)\\n    model = mStep(alignments, data).copy(beta = init.beta) \\n    (alignments,model,change(old,alignments))\\n  }                   \\n} \",\"val ibm1Iterations = emModel1(init, trainM2, 100)\\nval xyData = ibm1Iterations.indices.map(_.toDouble) -> ibm1Iterations.map(_._3) \\nlineplot(xyData)  \",\"barChart(ibm1Iterations.last._2.alpha.filter(_._1._2 == \\\"house\\\")) \",\"Renderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, ibm1Iterations.last._1(0))\"]","hide_output":"true"}};
        var id = 34;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nInitializing with the IBM Model 1 result gives us: ","extraFields":{}};
        var id = 35;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"val ibm1 = ibm1Iterations.last._2\nval ibm2Iterations = emModel2(ibm1, trainM2, 100)\nval ibm2 = ibm2Iterations.last._2\nbarChart(ibm2.alpha.filter(_._1._2 == \"house\")) ","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p._1).sentences.head -> segment(p._2).sentences.head)\\ntrain.size \",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype NaiveModel = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):NaiveModel = {\\n  //data structures to store counts in nominator and denominator\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  //do the counting\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  //convert the map to a sequence of parameters\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n} \",\"val model = learn(train)\\nbarChart(model map (p => (p.src,p.tgt) -> p.prob) filter (_._1._2 == \\\"is\\\")) \",\"import uk.ac.ucl.cs.mr.statnlpbook.chapter.languagemodels._\\n\\ndef decode(source:Sentence, model:NaiveModel, lm:LanguageModel) = {\\n  //create a mapping from source words to relevant parameters\\n  val source2targets = model groupBy (_.src) \\n  def translate(token:Token) = {\\n    val candidates:Seq[Param] = source2targets(token.word)\\n    val scoredByLM = candidates map (p => p.copy(prob = p.prob * lm.probability(p.tgt)))\\n    scoredByLM.maxBy(_.prob).tgt\\n  }\\n  //translate word-by-word (for which LM does this work?)\\n  val words = source.tokens map translate\\n  Document(IndexedSeq(words))\\n}\\nval source = train(1)._2 //\\\"klein ist das Haus\\\"\\nval lm = UniformLM(model.map(_.tgt).toSet)\\nval target = decode(source, model, lm) \\ntarget.toText \",\"val target = segment(\\\"NULL the house is small\\\").sentences(0)\\nval source = segment(\\\"klein ist das Haus\\\").sentences(0)\\nRenderer.renderAlignment(target,source,Seq(1->2,2->3,3->1,4->0))\",\"val target2 = segment(\\\"NULL 家 わ 小さいい です\\\").sentences(0)\\nval source2 = segment(\\\"The house is small\\\").sentences(0)\\nRenderer.renderAlignment(target2,source2,Seq(0 -> 0, 1 -> 1, 3 -> 3, 4 -> 2))\",\"val trainM2 = Seq(\\n  \\\"NULL the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"NULL a man is tall\\\" -> \\\"groß ist ein Mann\\\",\\n  \\\"NULL my house is small\\\" -> \\\"klein ist mein Haus\\\",\\n  \\\"NULL the building is big\\\" -> \\\"groß ist das Gebäude\\\",\\n  \\\"NULL the building is long\\\" -> \\\"lang ist das Gebäude\\\"\\n) map (p => segment(p _1).sentences.head -> segment(p _2).sentences.head) \",\"//Each element in the sequence corresponds to one source token,\\n//and each element in the nested sequence to a target token.\\ntype Align = IndexedSeq[IndexedSeq[Double]]\\n\\n//Model parameters\\ncase class Model(\\n  alpha:Map[(String,String),Double],\\n  beta:Map[(Int,Int,Int,Int),Double]) \\n\\n//normalizing a distribution\\ndef norm(v:IndexedSeq[Double]) = { val s = v.sum; v map (_ / s) } \\n\\n//estimate new soft alignments\\ndef eStep(model:Model, data:Seq[(Sentence,Sentence)]):Seq[Align] = {\\n  for ((target,source) <- data) yield {\\n    def score(si:Int, ti:Int) = \\n      model.alpha(source.tokens(si).word,target.tokens(ti).word) * \\n      model.beta(ti,si,target.tokens.length, source.tokens.length)\\n    for (si <- source.tokens.indices) yield \\n      norm(for (ti <- target.tokens.indices) yield score(si,ti))\\n  }\\n}\",\"val sourceVocab = trainM2.flatMap(_._2.tokens.map(_.word)).toSet \\nval init = Model(\\n    Map.empty withDefaultValue (1.0 / sourceVocab.size),\\n    Map.empty withDefault {case (ti,si,lt,ls) => 1.0 / lt })\\n\\nval alignments = eStep(init,trainM2) \\nRenderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, alignments(0))\",\"def mStep(aligns:Seq[Align],data:Seq[(Sentence,Sentence)]) = {\\n  val alpha = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  val alphaNorm = new HashMap[String,Double] withDefaultValue 0.0\\n  val beta = new HashMap[(Int,Int,Int,Int),Double] withDefaultValue 0.0\\n  val betaNorm = new HashMap[(Int,Int,Int),Double] withDefaultValue 0.0\\n  for ((pi,(t,s)) <- aligns zip data) {\\n    for (ti <- t.tokens.indices; si <- s.tokens.indices) {\\n      alpha(s.tokens(si).word,t.tokens(ti).word) += pi(si)(ti) \\n      alphaNorm(t.tokens(ti).word) += pi(si)(ti) \\n      beta(ti,si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n      betaNorm(si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n    }  \\n  }                 \\n  Model(\\n    alpha.toMap map {case ((s,t),p) => ((s,t), p / alphaNorm(t))} withDefaultValue 0.0,\\n    beta.toMap map {case ((ti,si,ls,lt),p) => ((ti,si,ls,lt),p / betaNorm(si,ls,lt))} withDefaultValue 0.0)    \\n}\\n\",\"val theta1 = mStep(alignments,trainM2)\\nbarChart(theta1.alpha.filter(_._1._2 == \\\"is\\\"))\",\"def change(a1:Seq[Align],a2:Seq[Align]) = {\\n  val flatA1 = a1.flatMap(_.flatten) \\n  val flatA2 = a2.flatMap(_.flatten)\\n  val diffs = (flatA1 zip flatA2) map {case(p1,p2) => math.abs(p1 - p2)}\\n  diffs.sum / flatA1.length\\n}\\ndef emModel1(init:Model, data:Seq[(Sentence,Sentence)], iterations:Int) = {\\n  var model = init\\n  var alignments = data.map(d => d._2.tokens.map(t => d._1.tokens.map(_ => 0.0)))\\n  for (_ <- 0 until iterations) yield {\\n    val old = alignments\\n    alignments = eStep(model, data)\\n    model = mStep(alignments, data).copy(beta = init.beta) \\n    (alignments,model,change(old,alignments))\\n  }                   \\n} \",\"val ibm1Iterations = emModel1(init, trainM2, 100)\\nval xyData = ibm1Iterations.indices.map(_.toDouble) -> ibm1Iterations.map(_._3) \\nlineplot(xyData)  \",\"barChart(ibm1Iterations.last._2.alpha.filter(_._1._2 == \\\"house\\\")) \",\"Renderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, ibm1Iterations.last._1(0))\",\"def emModel2(init:Model, data:Seq[(Sentence,Sentence)], iterations:Int) = {\\n  var model = init\\n  var alignments = data.map(d => d._2.tokens.map(t => d._1.tokens.map(_ => 0.0)))\\n  for (_ <- 0 until iterations) yield {\\n    val old = alignments\\n    alignments = eStep(model, data)\\n    model = mStep(alignments, data)\\n    (alignments,model,change(old,alignments))\\n  }                   \\n} \"]"}};
        var id = 36;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nFor alignments we get:\n","extraFields":{}};
        var id = 37;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"val ibm2Alignments = ibm2Iterations.last._1\nRenderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, ibm2Alignments(0))   ","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p._1).sentences.head -> segment(p._2).sentences.head)\\ntrain.size \",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype NaiveModel = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):NaiveModel = {\\n  //data structures to store counts in nominator and denominator\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  //do the counting\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  //convert the map to a sequence of parameters\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n} \",\"val model = learn(train)\\nbarChart(model map (p => (p.src,p.tgt) -> p.prob) filter (_._1._2 == \\\"is\\\")) \",\"import uk.ac.ucl.cs.mr.statnlpbook.chapter.languagemodels._\\n\\ndef decode(source:Sentence, model:NaiveModel, lm:LanguageModel) = {\\n  //create a mapping from source words to relevant parameters\\n  val source2targets = model groupBy (_.src) \\n  def translate(token:Token) = {\\n    val candidates:Seq[Param] = source2targets(token.word)\\n    val scoredByLM = candidates map (p => p.copy(prob = p.prob * lm.probability(p.tgt)))\\n    scoredByLM.maxBy(_.prob).tgt\\n  }\\n  //translate word-by-word (for which LM does this work?)\\n  val words = source.tokens map translate\\n  Document(IndexedSeq(words))\\n}\\nval source = train(1)._2 //\\\"klein ist das Haus\\\"\\nval lm = UniformLM(model.map(_.tgt).toSet)\\nval target = decode(source, model, lm) \\ntarget.toText \",\"val target = segment(\\\"NULL the house is small\\\").sentences(0)\\nval source = segment(\\\"klein ist das Haus\\\").sentences(0)\\nRenderer.renderAlignment(target,source,Seq(1->2,2->3,3->1,4->0))\",\"val target2 = segment(\\\"NULL 家 わ 小さいい です\\\").sentences(0)\\nval source2 = segment(\\\"The house is small\\\").sentences(0)\\nRenderer.renderAlignment(target2,source2,Seq(0 -> 0, 1 -> 1, 3 -> 3, 4 -> 2))\",\"val trainM2 = Seq(\\n  \\\"NULL the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"NULL a man is tall\\\" -> \\\"groß ist ein Mann\\\",\\n  \\\"NULL my house is small\\\" -> \\\"klein ist mein Haus\\\",\\n  \\\"NULL the building is big\\\" -> \\\"groß ist das Gebäude\\\",\\n  \\\"NULL the building is long\\\" -> \\\"lang ist das Gebäude\\\"\\n) map (p => segment(p _1).sentences.head -> segment(p _2).sentences.head) \",\"//Each element in the sequence corresponds to one source token,\\n//and each element in the nested sequence to a target token.\\ntype Align = IndexedSeq[IndexedSeq[Double]]\\n\\n//Model parameters\\ncase class Model(\\n  alpha:Map[(String,String),Double],\\n  beta:Map[(Int,Int,Int,Int),Double]) \\n\\n//normalizing a distribution\\ndef norm(v:IndexedSeq[Double]) = { val s = v.sum; v map (_ / s) } \\n\\n//estimate new soft alignments\\ndef eStep(model:Model, data:Seq[(Sentence,Sentence)]):Seq[Align] = {\\n  for ((target,source) <- data) yield {\\n    def score(si:Int, ti:Int) = \\n      model.alpha(source.tokens(si).word,target.tokens(ti).word) * \\n      model.beta(ti,si,target.tokens.length, source.tokens.length)\\n    for (si <- source.tokens.indices) yield \\n      norm(for (ti <- target.tokens.indices) yield score(si,ti))\\n  }\\n}\",\"val sourceVocab = trainM2.flatMap(_._2.tokens.map(_.word)).toSet \\nval init = Model(\\n    Map.empty withDefaultValue (1.0 / sourceVocab.size),\\n    Map.empty withDefault {case (ti,si,lt,ls) => 1.0 / lt })\\n\\nval alignments = eStep(init,trainM2) \\nRenderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, alignments(0))\",\"def mStep(aligns:Seq[Align],data:Seq[(Sentence,Sentence)]) = {\\n  val alpha = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  val alphaNorm = new HashMap[String,Double] withDefaultValue 0.0\\n  val beta = new HashMap[(Int,Int,Int,Int),Double] withDefaultValue 0.0\\n  val betaNorm = new HashMap[(Int,Int,Int),Double] withDefaultValue 0.0\\n  for ((pi,(t,s)) <- aligns zip data) {\\n    for (ti <- t.tokens.indices; si <- s.tokens.indices) {\\n      alpha(s.tokens(si).word,t.tokens(ti).word) += pi(si)(ti) \\n      alphaNorm(t.tokens(ti).word) += pi(si)(ti) \\n      beta(ti,si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n      betaNorm(si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n    }  \\n  }                 \\n  Model(\\n    alpha.toMap map {case ((s,t),p) => ((s,t), p / alphaNorm(t))} withDefaultValue 0.0,\\n    beta.toMap map {case ((ti,si,ls,lt),p) => ((ti,si,ls,lt),p / betaNorm(si,ls,lt))} withDefaultValue 0.0)    \\n}\\n\",\"val theta1 = mStep(alignments,trainM2)\\nbarChart(theta1.alpha.filter(_._1._2 == \\\"is\\\"))\",\"def change(a1:Seq[Align],a2:Seq[Align]) = {\\n  val flatA1 = a1.flatMap(_.flatten) \\n  val flatA2 = a2.flatMap(_.flatten)\\n  val diffs = (flatA1 zip flatA2) map {case(p1,p2) => math.abs(p1 - p2)}\\n  diffs.sum / flatA1.length\\n}\\ndef emModel1(init:Model, data:Seq[(Sentence,Sentence)], iterations:Int) = {\\n  var model = init\\n  var alignments = data.map(d => d._2.tokens.map(t => d._1.tokens.map(_ => 0.0)))\\n  for (_ <- 0 until iterations) yield {\\n    val old = alignments\\n    alignments = eStep(model, data)\\n    model = mStep(alignments, data).copy(beta = init.beta) \\n    (alignments,model,change(old,alignments))\\n  }                   \\n} \",\"val ibm1Iterations = emModel1(init, trainM2, 100)\\nval xyData = ibm1Iterations.indices.map(_.toDouble) -> ibm1Iterations.map(_._3) \\nlineplot(xyData)  \",\"barChart(ibm1Iterations.last._2.alpha.filter(_._1._2 == \\\"house\\\")) \",\"Renderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, ibm1Iterations.last._1(0))\",\"def emModel2(init:Model, data:Seq[(Sentence,Sentence)], iterations:Int) = {\\n  var model = init\\n  var alignments = data.map(d => d._2.tokens.map(t => d._1.tokens.map(_ => 0.0)))\\n  for (_ <- 0 until iterations) yield {\\n    val old = alignments\\n    alignments = eStep(model, data)\\n    model = mStep(alignments, data)\\n    (alignments,model,change(old,alignments))\\n  }                   \\n} \",\"val ibm1 = ibm1Iterations.last._2\\nval ibm2Iterations = emModel2(ibm1, trainM2, 100)\\nval ibm2 = ibm2Iterations.last._2\\nbarChart(ibm2.alpha.filter(_._1._2 == \\\"house\\\")) \"]"}};
        var id = 38;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nLet us look at the distortion probabilities for a given source position and source and target lengths.","extraFields":{}};
        var id = 39;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"def distort(si:Int) = for (ti <- 0 until 5) yield ti -> ibm2.beta(ti,si,5,4) \nbarChart(distort(0), color = Some(\"#fc0\"))","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p._1).sentences.head -> segment(p._2).sentences.head)\\ntrain.size \",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype NaiveModel = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):NaiveModel = {\\n  //data structures to store counts in nominator and denominator\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  //do the counting\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  //convert the map to a sequence of parameters\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n} \",\"val model = learn(train)\\nbarChart(model map (p => (p.src,p.tgt) -> p.prob) filter (_._1._2 == \\\"is\\\")) \",\"import uk.ac.ucl.cs.mr.statnlpbook.chapter.languagemodels._\\n\\ndef decode(source:Sentence, model:NaiveModel, lm:LanguageModel) = {\\n  //create a mapping from source words to relevant parameters\\n  val source2targets = model groupBy (_.src) \\n  def translate(token:Token) = {\\n    val candidates:Seq[Param] = source2targets(token.word)\\n    val scoredByLM = candidates map (p => p.copy(prob = p.prob * lm.probability(p.tgt)))\\n    scoredByLM.maxBy(_.prob).tgt\\n  }\\n  //translate word-by-word (for which LM does this work?)\\n  val words = source.tokens map translate\\n  Document(IndexedSeq(words))\\n}\\nval source = train(1)._2 //\\\"klein ist das Haus\\\"\\nval lm = UniformLM(model.map(_.tgt).toSet)\\nval target = decode(source, model, lm) \\ntarget.toText \",\"val target = segment(\\\"NULL the house is small\\\").sentences(0)\\nval source = segment(\\\"klein ist das Haus\\\").sentences(0)\\nRenderer.renderAlignment(target,source,Seq(1->2,2->3,3->1,4->0))\",\"val target2 = segment(\\\"NULL 家 わ 小さいい です\\\").sentences(0)\\nval source2 = segment(\\\"The house is small\\\").sentences(0)\\nRenderer.renderAlignment(target2,source2,Seq(0 -> 0, 1 -> 1, 3 -> 3, 4 -> 2))\",\"val trainM2 = Seq(\\n  \\\"NULL the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"NULL a man is tall\\\" -> \\\"groß ist ein Mann\\\",\\n  \\\"NULL my house is small\\\" -> \\\"klein ist mein Haus\\\",\\n  \\\"NULL the building is big\\\" -> \\\"groß ist das Gebäude\\\",\\n  \\\"NULL the building is long\\\" -> \\\"lang ist das Gebäude\\\"\\n) map (p => segment(p _1).sentences.head -> segment(p _2).sentences.head) \",\"//Each element in the sequence corresponds to one source token,\\n//and each element in the nested sequence to a target token.\\ntype Align = IndexedSeq[IndexedSeq[Double]]\\n\\n//Model parameters\\ncase class Model(\\n  alpha:Map[(String,String),Double],\\n  beta:Map[(Int,Int,Int,Int),Double]) \\n\\n//normalizing a distribution\\ndef norm(v:IndexedSeq[Double]) = { val s = v.sum; v map (_ / s) } \\n\\n//estimate new soft alignments\\ndef eStep(model:Model, data:Seq[(Sentence,Sentence)]):Seq[Align] = {\\n  for ((target,source) <- data) yield {\\n    def score(si:Int, ti:Int) = \\n      model.alpha(source.tokens(si).word,target.tokens(ti).word) * \\n      model.beta(ti,si,target.tokens.length, source.tokens.length)\\n    for (si <- source.tokens.indices) yield \\n      norm(for (ti <- target.tokens.indices) yield score(si,ti))\\n  }\\n}\",\"val sourceVocab = trainM2.flatMap(_._2.tokens.map(_.word)).toSet \\nval init = Model(\\n    Map.empty withDefaultValue (1.0 / sourceVocab.size),\\n    Map.empty withDefault {case (ti,si,lt,ls) => 1.0 / lt })\\n\\nval alignments = eStep(init,trainM2) \\nRenderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, alignments(0))\",\"def mStep(aligns:Seq[Align],data:Seq[(Sentence,Sentence)]) = {\\n  val alpha = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  val alphaNorm = new HashMap[String,Double] withDefaultValue 0.0\\n  val beta = new HashMap[(Int,Int,Int,Int),Double] withDefaultValue 0.0\\n  val betaNorm = new HashMap[(Int,Int,Int),Double] withDefaultValue 0.0\\n  for ((pi,(t,s)) <- aligns zip data) {\\n    for (ti <- t.tokens.indices; si <- s.tokens.indices) {\\n      alpha(s.tokens(si).word,t.tokens(ti).word) += pi(si)(ti) \\n      alphaNorm(t.tokens(ti).word) += pi(si)(ti) \\n      beta(ti,si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n      betaNorm(si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n    }  \\n  }                 \\n  Model(\\n    alpha.toMap map {case ((s,t),p) => ((s,t), p / alphaNorm(t))} withDefaultValue 0.0,\\n    beta.toMap map {case ((ti,si,ls,lt),p) => ((ti,si,ls,lt),p / betaNorm(si,ls,lt))} withDefaultValue 0.0)    \\n}\\n\",\"val theta1 = mStep(alignments,trainM2)\\nbarChart(theta1.alpha.filter(_._1._2 == \\\"is\\\"))\",\"def change(a1:Seq[Align],a2:Seq[Align]) = {\\n  val flatA1 = a1.flatMap(_.flatten) \\n  val flatA2 = a2.flatMap(_.flatten)\\n  val diffs = (flatA1 zip flatA2) map {case(p1,p2) => math.abs(p1 - p2)}\\n  diffs.sum / flatA1.length\\n}\\ndef emModel1(init:Model, data:Seq[(Sentence,Sentence)], iterations:Int) = {\\n  var model = init\\n  var alignments = data.map(d => d._2.tokens.map(t => d._1.tokens.map(_ => 0.0)))\\n  for (_ <- 0 until iterations) yield {\\n    val old = alignments\\n    alignments = eStep(model, data)\\n    model = mStep(alignments, data).copy(beta = init.beta) \\n    (alignments,model,change(old,alignments))\\n  }                   \\n} \",\"val ibm1Iterations = emModel1(init, trainM2, 100)\\nval xyData = ibm1Iterations.indices.map(_.toDouble) -> ibm1Iterations.map(_._3) \\nlineplot(xyData)  \",\"barChart(ibm1Iterations.last._2.alpha.filter(_._1._2 == \\\"house\\\")) \",\"Renderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, ibm1Iterations.last._1(0))\",\"def emModel2(init:Model, data:Seq[(Sentence,Sentence)], iterations:Int) = {\\n  var model = init\\n  var alignments = data.map(d => d._2.tokens.map(t => d._1.tokens.map(_ => 0.0)))\\n  for (_ <- 0 until iterations) yield {\\n    val old = alignments\\n    alignments = eStep(model, data)\\n    model = mStep(alignments, data)\\n    (alignments,model,change(old,alignments))\\n  }                   \\n} \",\"val ibm1 = ibm1Iterations.last._2\\nval ibm2Iterations = emModel2(ibm1, trainM2, 100)\\nval ibm2 = ibm2Iterations.last._2\\nbarChart(ibm2.alpha.filter(_._1._2 == \\\"house\\\")) \",\"val ibm2Alignments = ibm2Iterations.last._1\\nRenderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, ibm2Alignments(0))   \"]"}};
        var id = 40;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\n#### Decoding for IBM Model 2\n\nDecoding IBM Model 2 requires us to  solve the argmax problem in equation \\\\(\\ref{decode-nc}\\\\), this time using the conditional probability from equation \\\\(\\ref{ibm2}\\\\) with the hidden alignments marginalized out: <span class=\"summary\">Decoding IBM Model 2 ideally means:</span>\n\n\\begin{equation}\n  \\argmax_{\\target} p_\\params^\\text{IBM2}(\\source | \\target) = \n  \\argmax_{\\target} \\sum_{\\aligns} p_\\params^\\text{IBM2}(\\source,\\aligns | \\target)\n\\end{equation}\n\n<div class=\"newslide\"></div>\nThis nested argmax and sum is generally computationally very hard (see [Park and Darwiche](http://arxiv.org/pdf/1107.0024.pdf)), and often replaced with the simpler problem of finding a combination of best target sequence and corresponding alignment. <span class=\"summary\">This nested argmax/sum is generally **computationally very hard**. It's easier to argmax over target and alignments: </span>   \n\n\\begin{equation}\n  \\argmax_{\\target,\\aligns} p_\\params^\\text{IBM2}(\\source,\\aligns | \\target)\n\\end{equation}\n\nAs it turns out for IBM Model 2 the sum can be efficiently calculated, and [Wang and Waibel](http://aclweb.org/anthology/P/P97/P97-1047.pdf) show a stack based decoder that does take this into account. <span class=\"summary\"></span>   \n\n<div class=\"newslide\"></div>\nHowever, both for simplicity of exposition and because for most real-world models this marginalization is not possible, we present a decoder that searches over both target and alignment. To simplify the algorithm further we assume that target and source sentences have to have them same length. Of course this is a major restriction, and it is not necessary, but makes the algorithm easier to explain while maintaining the core mechanism. Here we only show only the Scala code and refer the reader to our [slides](https://www.dropbox.com/s/p495n19h5rtk3uf/IBM-decoding.pdf?dl=0) for an illustration of how stack and beam based decoders work. <span class=\"summary\">A simplified **same-length** decoder in Scala, using a [beam](https://www.dropbox.com/s/p495n19h5rtk3uf/IBM-decoding.pdf?dl=0):</span>  ","extraFields":{}};
        var id = 41;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"case class Hypothesis(target:List[String], align:Map[Int,Int], remaining:Set[Int],\n                      score:Double, parent:Option[Hypothesis]= None)\n\ntype Beam = List[Hypothesis]\n \ndef decodeModel2(tm:Model, lm:LanguageModel, \n                 source:IndexedSeq[String], beamSize:Int) = {\n  \n  def score(hyp:Hypothesis,newTarget:String,sourceIndex:Int) = {\n    val targetLength = source.length + 1\n    val history = hyp.target.take(lm.order - 1).reverse\n    val lmProb = math.log(lm.probability(newTarget,history:_*))\n    val tmProb = math.log(tm.alpha((source(sourceIndex),newTarget))) + math.log(tm.beta((hyp.target .length, sourceIndex, targetLength, source.length)))\n    lmProb + tmProb\n  }\n  def append(hyp:Hypothesis) = { for (sourceIndex <- hyp.remaining; targetWord <- lm.vocab) yield \n    Hypothesis(targetWord :: hyp.target, \n               hyp.align + (sourceIndex -> hyp.target.length), \n               hyp.remaining - sourceIndex, \n               hyp.score + score(hyp,targetWord,sourceIndex), \n               Some(hyp))} \n  \n  var beam:Beam = List(Hypothesis(List(\"NULL\"), Map.empty, source.indices.toSet,  0.0))    \n  var history:List[Beam] = List(beam) \n  while (beam.head.remaining.nonEmpty) {\n    val withNewTarget = beam.flatMap(hyp => append(hyp)).distinct\n    beam = withNewTarget.sortBy(-_.score).take(beamSize).toList\n    history ::= beam\n  }  \n  history.map(_.map(h => h.copy(target = h.target.reverse))).reverse\n} ","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p._1).sentences.head -> segment(p._2).sentences.head)\\ntrain.size \",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype NaiveModel = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):NaiveModel = {\\n  //data structures to store counts in nominator and denominator\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  //do the counting\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  //convert the map to a sequence of parameters\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n} \",\"val model = learn(train)\\nbarChart(model map (p => (p.src,p.tgt) -> p.prob) filter (_._1._2 == \\\"is\\\")) \",\"import uk.ac.ucl.cs.mr.statnlpbook.chapter.languagemodels._\\n\\ndef decode(source:Sentence, model:NaiveModel, lm:LanguageModel) = {\\n  //create a mapping from source words to relevant parameters\\n  val source2targets = model groupBy (_.src) \\n  def translate(token:Token) = {\\n    val candidates:Seq[Param] = source2targets(token.word)\\n    val scoredByLM = candidates map (p => p.copy(prob = p.prob * lm.probability(p.tgt)))\\n    scoredByLM.maxBy(_.prob).tgt\\n  }\\n  //translate word-by-word (for which LM does this work?)\\n  val words = source.tokens map translate\\n  Document(IndexedSeq(words))\\n}\\nval source = train(1)._2 //\\\"klein ist das Haus\\\"\\nval lm = UniformLM(model.map(_.tgt).toSet)\\nval target = decode(source, model, lm) \\ntarget.toText \",\"val target = segment(\\\"NULL the house is small\\\").sentences(0)\\nval source = segment(\\\"klein ist das Haus\\\").sentences(0)\\nRenderer.renderAlignment(target,source,Seq(1->2,2->3,3->1,4->0))\",\"val target2 = segment(\\\"NULL 家 わ 小さいい です\\\").sentences(0)\\nval source2 = segment(\\\"The house is small\\\").sentences(0)\\nRenderer.renderAlignment(target2,source2,Seq(0 -> 0, 1 -> 1, 3 -> 3, 4 -> 2))\",\"val trainM2 = Seq(\\n  \\\"NULL the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"NULL a man is tall\\\" -> \\\"groß ist ein Mann\\\",\\n  \\\"NULL my house is small\\\" -> \\\"klein ist mein Haus\\\",\\n  \\\"NULL the building is big\\\" -> \\\"groß ist das Gebäude\\\",\\n  \\\"NULL the building is long\\\" -> \\\"lang ist das Gebäude\\\"\\n) map (p => segment(p _1).sentences.head -> segment(p _2).sentences.head) \",\"//Each element in the sequence corresponds to one source token,\\n//and each element in the nested sequence to a target token.\\ntype Align = IndexedSeq[IndexedSeq[Double]]\\n\\n//Model parameters\\ncase class Model(\\n  alpha:Map[(String,String),Double],\\n  beta:Map[(Int,Int,Int,Int),Double]) \\n\\n//normalizing a distribution\\ndef norm(v:IndexedSeq[Double]) = { val s = v.sum; v map (_ / s) } \\n\\n//estimate new soft alignments\\ndef eStep(model:Model, data:Seq[(Sentence,Sentence)]):Seq[Align] = {\\n  for ((target,source) <- data) yield {\\n    def score(si:Int, ti:Int) = \\n      model.alpha(source.tokens(si).word,target.tokens(ti).word) * \\n      model.beta(ti,si,target.tokens.length, source.tokens.length)\\n    for (si <- source.tokens.indices) yield \\n      norm(for (ti <- target.tokens.indices) yield score(si,ti))\\n  }\\n}\",\"val sourceVocab = trainM2.flatMap(_._2.tokens.map(_.word)).toSet \\nval init = Model(\\n    Map.empty withDefaultValue (1.0 / sourceVocab.size),\\n    Map.empty withDefault {case (ti,si,lt,ls) => 1.0 / lt })\\n\\nval alignments = eStep(init,trainM2) \\nRenderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, alignments(0))\",\"def mStep(aligns:Seq[Align],data:Seq[(Sentence,Sentence)]) = {\\n  val alpha = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  val alphaNorm = new HashMap[String,Double] withDefaultValue 0.0\\n  val beta = new HashMap[(Int,Int,Int,Int),Double] withDefaultValue 0.0\\n  val betaNorm = new HashMap[(Int,Int,Int),Double] withDefaultValue 0.0\\n  for ((pi,(t,s)) <- aligns zip data) {\\n    for (ti <- t.tokens.indices; si <- s.tokens.indices) {\\n      alpha(s.tokens(si).word,t.tokens(ti).word) += pi(si)(ti) \\n      alphaNorm(t.tokens(ti).word) += pi(si)(ti) \\n      beta(ti,si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n      betaNorm(si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n    }  \\n  }                 \\n  Model(\\n    alpha.toMap map {case ((s,t),p) => ((s,t), p / alphaNorm(t))} withDefaultValue 0.0,\\n    beta.toMap map {case ((ti,si,ls,lt),p) => ((ti,si,ls,lt),p / betaNorm(si,ls,lt))} withDefaultValue 0.0)    \\n}\\n\",\"val theta1 = mStep(alignments,trainM2)\\nbarChart(theta1.alpha.filter(_._1._2 == \\\"is\\\"))\",\"def change(a1:Seq[Align],a2:Seq[Align]) = {\\n  val flatA1 = a1.flatMap(_.flatten) \\n  val flatA2 = a2.flatMap(_.flatten)\\n  val diffs = (flatA1 zip flatA2) map {case(p1,p2) => math.abs(p1 - p2)}\\n  diffs.sum / flatA1.length\\n}\\ndef emModel1(init:Model, data:Seq[(Sentence,Sentence)], iterations:Int) = {\\n  var model = init\\n  var alignments = data.map(d => d._2.tokens.map(t => d._1.tokens.map(_ => 0.0)))\\n  for (_ <- 0 until iterations) yield {\\n    val old = alignments\\n    alignments = eStep(model, data)\\n    model = mStep(alignments, data).copy(beta = init.beta) \\n    (alignments,model,change(old,alignments))\\n  }                   \\n} \",\"val ibm1Iterations = emModel1(init, trainM2, 100)\\nval xyData = ibm1Iterations.indices.map(_.toDouble) -> ibm1Iterations.map(_._3) \\nlineplot(xyData)  \",\"barChart(ibm1Iterations.last._2.alpha.filter(_._1._2 == \\\"house\\\")) \",\"Renderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, ibm1Iterations.last._1(0))\",\"def emModel2(init:Model, data:Seq[(Sentence,Sentence)], iterations:Int) = {\\n  var model = init\\n  var alignments = data.map(d => d._2.tokens.map(t => d._1.tokens.map(_ => 0.0)))\\n  for (_ <- 0 until iterations) yield {\\n    val old = alignments\\n    alignments = eStep(model, data)\\n    model = mStep(alignments, data)\\n    (alignments,model,change(old,alignments))\\n  }                   \\n} \",\"val ibm1 = ibm1Iterations.last._2\\nval ibm2Iterations = emModel2(ibm1, trainM2, 100)\\nval ibm2 = ibm2Iterations.last._2\\nbarChart(ibm2.alpha.filter(_._1._2 == \\\"house\\\")) \",\"val ibm2Alignments = ibm2Iterations.last._1\\nRenderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, ibm2Alignments(0))   \",\"def distort(si:Int) = for (ti <- 0 until 5) yield ti -> ibm2.beta(ti,si,5,4) \\nbarChart(distort(0), color = Some(\\\"#fc0\\\"))\"]","hide_output":"true"}};
        var id = 42;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"def toStringSeq(hyp:Hypothesis,source:IndexedSeq[String]) = \n  Seq(hyp.target.mkString(\" \"), source.indices.map(i => if (hyp.remaining(i)) \"_\" else source(i)).mkString(\" \"), hyp.remaining.size, hyp.score)    \n  \ndef renderBeam(beam:Beam, source:IndexedSeq[String]) = \n  table(beam.map(toStringSeq(_,source)))\n\ndef renderHistory(hist:List[Beam], source:IndexedSeq[String]) = \n  table(hist.flatMap(_.map(toStringSeq(_,source))))\n\n//renderBeam(List(Hypothesis(List(\"NULL\"), Map.empty, source.indices.toSet,  0.0)),source)    ","extraFields":{"hide":"true","hide_output":"true","aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p._1).sentences.head -> segment(p._2).sentences.head)\\ntrain.size \",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype NaiveModel = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):NaiveModel = {\\n  //data structures to store counts in nominator and denominator\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  //do the counting\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  //convert the map to a sequence of parameters\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n} \",\"val model = learn(train)\\nbarChart(model map (p => (p.src,p.tgt) -> p.prob) filter (_._1._2 == \\\"is\\\")) \",\"import uk.ac.ucl.cs.mr.statnlpbook.chapter.languagemodels._\\n\\ndef decode(source:Sentence, model:NaiveModel, lm:LanguageModel) = {\\n  //create a mapping from source words to relevant parameters\\n  val source2targets = model groupBy (_.src) \\n  def translate(token:Token) = {\\n    val candidates:Seq[Param] = source2targets(token.word)\\n    val scoredByLM = candidates map (p => p.copy(prob = p.prob * lm.probability(p.tgt)))\\n    scoredByLM.maxBy(_.prob).tgt\\n  }\\n  //translate word-by-word (for which LM does this work?)\\n  val words = source.tokens map translate\\n  Document(IndexedSeq(words))\\n}\\nval source = train(1)._2 //\\\"klein ist das Haus\\\"\\nval lm = UniformLM(model.map(_.tgt).toSet)\\nval target = decode(source, model, lm) \\ntarget.toText \",\"val target = segment(\\\"NULL the house is small\\\").sentences(0)\\nval source = segment(\\\"klein ist das Haus\\\").sentences(0)\\nRenderer.renderAlignment(target,source,Seq(1->2,2->3,3->1,4->0))\",\"val target2 = segment(\\\"NULL 家 わ 小さいい です\\\").sentences(0)\\nval source2 = segment(\\\"The house is small\\\").sentences(0)\\nRenderer.renderAlignment(target2,source2,Seq(0 -> 0, 1 -> 1, 3 -> 3, 4 -> 2))\",\"val trainM2 = Seq(\\n  \\\"NULL the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"NULL a man is tall\\\" -> \\\"groß ist ein Mann\\\",\\n  \\\"NULL my house is small\\\" -> \\\"klein ist mein Haus\\\",\\n  \\\"NULL the building is big\\\" -> \\\"groß ist das Gebäude\\\",\\n  \\\"NULL the building is long\\\" -> \\\"lang ist das Gebäude\\\"\\n) map (p => segment(p _1).sentences.head -> segment(p _2).sentences.head) \",\"//Each element in the sequence corresponds to one source token,\\n//and each element in the nested sequence to a target token.\\ntype Align = IndexedSeq[IndexedSeq[Double]]\\n\\n//Model parameters\\ncase class Model(\\n  alpha:Map[(String,String),Double],\\n  beta:Map[(Int,Int,Int,Int),Double]) \\n\\n//normalizing a distribution\\ndef norm(v:IndexedSeq[Double]) = { val s = v.sum; v map (_ / s) } \\n\\n//estimate new soft alignments\\ndef eStep(model:Model, data:Seq[(Sentence,Sentence)]):Seq[Align] = {\\n  for ((target,source) <- data) yield {\\n    def score(si:Int, ti:Int) = \\n      model.alpha(source.tokens(si).word,target.tokens(ti).word) * \\n      model.beta(ti,si,target.tokens.length, source.tokens.length)\\n    for (si <- source.tokens.indices) yield \\n      norm(for (ti <- target.tokens.indices) yield score(si,ti))\\n  }\\n}\",\"val sourceVocab = trainM2.flatMap(_._2.tokens.map(_.word)).toSet \\nval init = Model(\\n    Map.empty withDefaultValue (1.0 / sourceVocab.size),\\n    Map.empty withDefault {case (ti,si,lt,ls) => 1.0 / lt })\\n\\nval alignments = eStep(init,trainM2) \\nRenderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, alignments(0))\",\"def mStep(aligns:Seq[Align],data:Seq[(Sentence,Sentence)]) = {\\n  val alpha = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  val alphaNorm = new HashMap[String,Double] withDefaultValue 0.0\\n  val beta = new HashMap[(Int,Int,Int,Int),Double] withDefaultValue 0.0\\n  val betaNorm = new HashMap[(Int,Int,Int),Double] withDefaultValue 0.0\\n  for ((pi,(t,s)) <- aligns zip data) {\\n    for (ti <- t.tokens.indices; si <- s.tokens.indices) {\\n      alpha(s.tokens(si).word,t.tokens(ti).word) += pi(si)(ti) \\n      alphaNorm(t.tokens(ti).word) += pi(si)(ti) \\n      beta(ti,si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n      betaNorm(si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n    }  \\n  }                 \\n  Model(\\n    alpha.toMap map {case ((s,t),p) => ((s,t), p / alphaNorm(t))} withDefaultValue 0.0,\\n    beta.toMap map {case ((ti,si,ls,lt),p) => ((ti,si,ls,lt),p / betaNorm(si,ls,lt))} withDefaultValue 0.0)    \\n}\\n\",\"val theta1 = mStep(alignments,trainM2)\\nbarChart(theta1.alpha.filter(_._1._2 == \\\"is\\\"))\",\"def change(a1:Seq[Align],a2:Seq[Align]) = {\\n  val flatA1 = a1.flatMap(_.flatten) \\n  val flatA2 = a2.flatMap(_.flatten)\\n  val diffs = (flatA1 zip flatA2) map {case(p1,p2) => math.abs(p1 - p2)}\\n  diffs.sum / flatA1.length\\n}\\ndef emModel1(init:Model, data:Seq[(Sentence,Sentence)], iterations:Int) = {\\n  var model = init\\n  var alignments = data.map(d => d._2.tokens.map(t => d._1.tokens.map(_ => 0.0)))\\n  for (_ <- 0 until iterations) yield {\\n    val old = alignments\\n    alignments = eStep(model, data)\\n    model = mStep(alignments, data).copy(beta = init.beta) \\n    (alignments,model,change(old,alignments))\\n  }                   \\n} \",\"val ibm1Iterations = emModel1(init, trainM2, 100)\\nval xyData = ibm1Iterations.indices.map(_.toDouble) -> ibm1Iterations.map(_._3) \\nlineplot(xyData)  \",\"barChart(ibm1Iterations.last._2.alpha.filter(_._1._2 == \\\"house\\\")) \",\"Renderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, ibm1Iterations.last._1(0))\",\"def emModel2(init:Model, data:Seq[(Sentence,Sentence)], iterations:Int) = {\\n  var model = init\\n  var alignments = data.map(d => d._2.tokens.map(t => d._1.tokens.map(_ => 0.0)))\\n  for (_ <- 0 until iterations) yield {\\n    val old = alignments\\n    alignments = eStep(model, data)\\n    model = mStep(alignments, data)\\n    (alignments,model,change(old,alignments))\\n  }                   \\n} \",\"val ibm1 = ibm1Iterations.last._2\\nval ibm2Iterations = emModel2(ibm1, trainM2, 100)\\nval ibm2 = ibm2Iterations.last._2\\nbarChart(ibm2.alpha.filter(_._1._2 == \\\"house\\\")) \",\"val ibm2Alignments = ibm2Iterations.last._1\\nRenderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, ibm2Alignments(0))   \",\"def distort(si:Int) = for (ti <- 0 until 5) yield ti -> ibm2.beta(ti,si,5,4) \\nbarChart(distort(0), color = Some(\\\"#fc0\\\"))\",\"case class Hypothesis(target:List[String], align:Map[Int,Int], remaining:Set[Int],\\n                      score:Double, parent:Option[Hypothesis]= None)\\n\\ntype Beam = List[Hypothesis]\\n \\ndef decodeModel2(tm:Model, lm:LanguageModel, \\n                 source:IndexedSeq[String], beamSize:Int) = {\\n  \\n  def score(hyp:Hypothesis,newTarget:String,sourceIndex:Int) = {\\n    val targetLength = source.length + 1\\n    val history = hyp.target.take(lm.order - 1).reverse\\n    val lmProb = math.log(lm.probability(newTarget,history:_*))\\n    val tmProb = math.log(tm.alpha((source(sourceIndex),newTarget))) + math.log(tm.beta((hyp.target .length, sourceIndex, targetLength, source.length)))\\n    lmProb + tmProb\\n  }\\n  def append(hyp:Hypothesis) = { for (sourceIndex <- hyp.remaining; targetWord <- lm.vocab) yield \\n    Hypothesis(targetWord :: hyp.target, \\n               hyp.align + (sourceIndex -> hyp.target.length), \\n               hyp.remaining - sourceIndex, \\n               hyp.score + score(hyp,targetWord,sourceIndex), \\n               Some(hyp))} \\n  \\n  var beam:Beam = List(Hypothesis(List(\\\"NULL\\\"), Map.empty, source.indices.toSet,  0.0))    \\n  var history:List[Beam] = List(beam) \\n  while (beam.head.remaining.nonEmpty) {\\n    val withNewTarget = beam.flatMap(hyp => append(hyp)).distinct\\n    beam = withNewTarget.sortBy(-_.score).take(beamSize).toList\\n    history ::= beam\\n  }  \\n  history.map(_.map(h => h.copy(target = h.target.reverse))).reverse\\n} \"]"}};
        var id = 43;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nLet us test this decoder on a simple sentence, using a uniform language model.","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p _1).sentences.head -> segment(p _2).sentences.head)\\ntrain.size\",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype Model = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):Model = {\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n}\\nval model = learn(train)\\nbarChart(model sortBy(_.tgt) map (p => (p.src,p.tgt) -> p.prob) filter (_._1._2 == \\\"is\\\")) \",\"import uk.ac.ucl.cs.mr.statnlpbook.chapter.languagemodels._\\ndef decode(source:Sentence, model:Model, lm:LanguageModel) = {\\n  def score(param:Param) = param.prob * lm.probability(param.tgt)\\n  val source2targets = model groupBy (_.src) //create one sub-model per source word\\n  val source2Best = source2targets mapValues (m => (m maxBy score).tgt) //only keep best target\\n  val words = source.tokens map (s => source2Best(s.word))\\n  Document(IndexedSeq(words))\\n}\\nval source = train(1)._2\\nval lm = UniformLM(model.map(_.tgt).toSet)\\nval target = decode(source, model, lm)\\nrenderTokens(target) \",\"val target = segment(\\\"NULL the house is small\\\").sentences(0)\\nval source = segment(\\\"klein ist das Haus\\\").sentences(0)\\nRenderer.renderAlignment(target,source,Seq(1->2,2->3,3->1,4->0))\",\"val train = Seq(\\n  \\\"NULL the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"NULL the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"NULL a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"NULL my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p _1).sentences.head -> segment(p _2).sentences.head)\\n\\nval targetVocab = train.flatMap(_._1.tokens.map(_.word)).toSet\\nval sourceVocab = train.flatMap(_._2.tokens.map(_.word)).toSet \",\"type Align = IndexedSeq[IndexedSeq[Double]]\\ncase class Model(\\n    alpha:Map[(String,String),Double],\\n    beta:Map[(Int,Int,Int,Int),Double]) \\n\\ndef norm(v:IndexedSeq[Double]) = { val s = v.sum; v map (_ / s) } \\n\\ndef eStep(model:Model, data:Seq[(Sentence,Sentence)]):Seq[Align] = {\\n  for ((target,source) <- data) yield {\\n    def score(si:Int, ti:Int) = \\n      model.alpha(source.tokens(si).word,target.tokens(ti).word) * \\n      model.beta(ti,si,target.tokens.length, source.tokens.length)\\n    for (si <- source.tokens.indices) yield \\n      norm(for (ti <- target.tokens.indices) yield score(si,ti))\\n  }\\n}\\n\\nval init = Model(\\n    Map.empty withDefaultValue (1.0 / sourceVocab.size),\\n    Map.empty withDefault {case (ti,si,lt,ls) => 1.0 / lt })\\n\\nval alignments = eStep(init,train)\\nRenderer.renderWeightedAlignment(train.head._1, train.head._2, alignments.head)\",\"def mStep(aligns:Seq[Align],data:Seq[(Sentence,Sentence)]) = {\\n  val alpha = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  val alphaNorm = new HashMap[String,Double] withDefaultValue 0.0\\n  val beta = new HashMap[(Int,Int,Int,Int),Double] withDefaultValue 0.0\\n  val betaNorm = new HashMap[(Int,Int,Int),Double] withDefaultValue 0.0\\n  for ((a,(t,s)) <- aligns zip data) {\\n    for (ti <- t.tokens.indices; si <- s.tokens.indices) {\\n      alpha(s.tokens(si).word,t.tokens(ti).word) += a(si)(ti) \\n      alphaNorm(t.tokens(ti).word) += a(si)(ti) \\n      beta(ti,si,t.tokens.length,s.tokens.length) += a(si)(ti)\\n      betaNorm(si,t.tokens.length,s.tokens.length) += a(si)(ti)\\n    }  \\n  }                 \\n  Model(\\n    alpha.toMap map {case ((s,t),p) => ((s,t), p / alphaNorm(t))} withDefaultValue 0.0,\\n    beta.toMap map {case ((ti,si,ls,lt),p) => ((ti,si,ls,lt),p / betaNorm(si,ls,lt))} withDefaultValue 0.0)    \\n}\\nval theta1 = mStep(alignments,train)\\nbarChart(theta1.alpha.filter(_._1._2 == \\\"small\\\")) \",\"def change(a1:Seq[Align],a2:Seq[Align]) = {\\n  val flatA1 = a1.flatMap(_.flatten) \\n  val flatA2 = a2.flatMap(_.flatten)\\n  val diffs = (flatA1 zip flatA2) map {case(p1,p2) => math.abs(p1 - p2)}\\n  diffs.sum / flatA1.length\\n}\\ndef emModel1(init:Model, data:Seq[(Sentence,Sentence)], iterations:Int) = {\\n  var model = init\\n  var alignments = data.map(d => d._2.tokens.map(t => d._1.tokens.map(_ => 0.0)))\\n  for (_ <- 0 until iterations) yield {\\n    val old = alignments\\n    alignments = eStep(model, data)\\n    model = mStep(alignments, data).copy(beta = init.beta) \\n    (alignments,model,change(old,alignments))\\n  }                   \\n} \\nval ibm1Iterations = emModel1(init, train, 10)\\nval xyData = ibm1Iterations.indices.map(_.toDouble) -> ibm1Iterations.map(_._3) \\nlineplot(xyData)\",\"barChart(ibm1Iterations.last._2.alpha.filter(_._1._2 == \\\"small\\\"))\",\"Renderer.renderWeightedAlignment(train.head._1, train.head._2, ibm1Iterations.last._1.head)\",\"def emModel2(init:Model, data:Seq[(Sentence,Sentence)], iterations:Int) = {\\n  var model = init\\n  var alignments = data.map(d => d._2.tokens.map(t => d._1.tokens.map(_ => 0.0)))\\n  for (_ <- 0 until iterations) yield {\\n    val old = alignments\\n    alignments = eStep(model, data)\\n    model = mStep(alignments, data)\\n    (alignments,model,change(old,alignments))\\n  }                   \\n} \\nval ibm1 = ibm1Iterations.last._2\\nval ibm2Iterations = emModel2(ibm1, train, 10)\\nval ibm2 = ibm2Iterations.last._2\\nibm2Iterations.last._3 \",\"def distort(si:Int) = for (ti <- 0 until 5) yield ti -> ibm2Iterations.last._2.beta(ti,si,5,4) \\nbarChart(distort(0), color = Some(\\\"#fc0\\\"))\",\"case class Hypothesis(target:List[String], align:Map[Int,Int], remaining:Set[Int],\\n                      score:Double, parent:Option[Hypothesis]= None)\\n\\ntype Beam = List[Hypothesis]\\n \\ndef decodeModel2(tm:Model, lm:LanguageModel, \\n                 source:IndexedSeq[String], beamSize:Int) = {\\n  \\n  def score(hyp:Hypothesis,newTarget:String,sourceIndex:Int) = {\\n    val targetLength = source.length + 1\\n    val history = hyp.target.take(lm.order - 1)\\n    val lmProb = math.log(lm.probability(newTarget,history:_*))\\n    val tmProb = math.log(tm.alpha((source(sourceIndex),newTarget))) + math.log(tm.beta((hyp.target .length, sourceIndex, targetLength, source.length)))\\n    lmProb + tmProb\\n  }\\n  def append(hyp:Hypothesis) = { for (sourceIndex <- hyp.remaining; targetWord <- lm.vocab) yield \\n    Hypothesis(targetWord :: hyp.target, \\n               hyp.align + (sourceIndex -> hyp.target.length), \\n               hyp.remaining - sourceIndex, \\n               hyp.score + score(hyp,targetWord,sourceIndex), \\n               Some(hyp))} \\n  \\n  var beam:Beam = List(Hypothesis(List(\\\"NULL\\\"), Map.empty, source.indices.toSet,  0.0))    \\n  var history:List[Beam] = List(beam) \\n  while (beam.head.remaining.nonEmpty) {\\n    val withNewTarget = beam.flatMap(hyp => append(hyp)).distinct\\n    beam = withNewTarget.sortBy(-_.score).take(beamSize).toList\\n    history ::= beam\\n  }  \\n  history.map(_.map(h => h.copy(target = h.target.reverse))).reverse\\n}\",\"def toStringSeq(hyp:Hypothesis,source:IndexedSeq[String]) = \\n  Seq(hyp.target.mkString(\\\" \\\"), source.indices.map(i => if (hyp.remaining(i)) \\\"_\\\" else source(i)).mkString(\\\" \\\"), hyp.remaining.size, hyp.score)    \\n  \\ndef renderBeam(beam:Beam, source:IndexedSeq[String]) = \\n  table(beam.map(toStringSeq(_,source)))\\n\\ndef renderHistory(hist:List[Beam], source:IndexedSeq[String]) = \\n  table(hist.flatMap(_.map(toStringSeq(_,source))))\\n\\n//renderBeam(List(Hypothesis(List(\\\"NULL\\\"), Map.empty, source.indices.toSet,  0.0)),source)    \"]"}};
        var id = 44;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"val source = Vector(\"groß\", \"ist\", \"ein\", \"Mann\")\nval targetVocab = trainM2.flatMap(_._1.tokens.map(_.word)).toSet\nval lm = UniformLM(targetVocab - \"NULL\")\nval hist = decodeModel2(ibm2,lm, source, 2)\nrenderHistory(hist.take(5),source)  \n//ibm2.alpha.filter(_._1._1 == \"klein\")          ","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p._1).sentences.head -> segment(p._2).sentences.head)\\ntrain.size \",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype NaiveModel = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):NaiveModel = {\\n  //data structures to store counts in nominator and denominator\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  //do the counting\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  //convert the map to a sequence of parameters\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n} \",\"val model = learn(train)\\nbarChart(model map (p => (p.src,p.tgt) -> p.prob) filter (_._1._2 == \\\"is\\\")) \",\"import uk.ac.ucl.cs.mr.statnlpbook.chapter.languagemodels._\\n\\ndef decode(source:Sentence, model:NaiveModel, lm:LanguageModel) = {\\n  //create a mapping from source words to relevant parameters\\n  val source2targets = model groupBy (_.src) \\n  def translate(token:Token) = {\\n    val candidates:Seq[Param] = source2targets(token.word)\\n    val scoredByLM = candidates map (p => p.copy(prob = p.prob * lm.probability(p.tgt)))\\n    scoredByLM.maxBy(_.prob).tgt\\n  }\\n  //translate word-by-word (for which LM does this work?)\\n  val words = source.tokens map translate\\n  Document(IndexedSeq(words))\\n}\\nval source = train(1)._2 //\\\"klein ist das Haus\\\"\\nval lm = UniformLM(model.map(_.tgt).toSet)\\nval target = decode(source, model, lm) \\ntarget.toText \",\"val target = segment(\\\"NULL the house is small\\\").sentences(0)\\nval source = segment(\\\"klein ist das Haus\\\").sentences(0)\\nRenderer.renderAlignment(target,source,Seq(1->2,2->3,3->1,4->0))\",\"val target2 = segment(\\\"NULL 家 わ 小さいい です\\\").sentences(0)\\nval source2 = segment(\\\"The house is small\\\").sentences(0)\\nRenderer.renderAlignment(target2,source2,Seq(0 -> 0, 1 -> 1, 3 -> 3, 4 -> 2))\",\"val trainM2 = Seq(\\n  \\\"NULL the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"NULL a man is tall\\\" -> \\\"groß ist ein Mann\\\",\\n  \\\"NULL my house is small\\\" -> \\\"klein ist mein Haus\\\",\\n  \\\"NULL the building is big\\\" -> \\\"groß ist das Gebäude\\\",\\n  \\\"NULL the building is long\\\" -> \\\"lang ist das Gebäude\\\"\\n) map (p => segment(p _1).sentences.head -> segment(p _2).sentences.head) \",\"//Each element in the sequence corresponds to one source token,\\n//and each element in the nested sequence to a target token.\\ntype Align = IndexedSeq[IndexedSeq[Double]]\\n\\n//Model parameters\\ncase class Model(\\n  alpha:Map[(String,String),Double],\\n  beta:Map[(Int,Int,Int,Int),Double]) \\n\\n//normalizing a distribution\\ndef norm(v:IndexedSeq[Double]) = { val s = v.sum; v map (_ / s) } \\n\\n//estimate new soft alignments\\ndef eStep(model:Model, data:Seq[(Sentence,Sentence)]):Seq[Align] = {\\n  for ((target,source) <- data) yield {\\n    def score(si:Int, ti:Int) = \\n      model.alpha(source.tokens(si).word,target.tokens(ti).word) * \\n      model.beta(ti,si,target.tokens.length, source.tokens.length)\\n    for (si <- source.tokens.indices) yield \\n      norm(for (ti <- target.tokens.indices) yield score(si,ti))\\n  }\\n}\",\"val sourceVocab = trainM2.flatMap(_._2.tokens.map(_.word)).toSet \\nval init = Model(\\n    Map.empty withDefaultValue (1.0 / sourceVocab.size),\\n    Map.empty withDefault {case (ti,si,lt,ls) => 1.0 / lt })\\n\\nval alignments = eStep(init,trainM2) \\nRenderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, alignments(0))\",\"def mStep(aligns:Seq[Align],data:Seq[(Sentence,Sentence)]) = {\\n  val alpha = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  val alphaNorm = new HashMap[String,Double] withDefaultValue 0.0\\n  val beta = new HashMap[(Int,Int,Int,Int),Double] withDefaultValue 0.0\\n  val betaNorm = new HashMap[(Int,Int,Int),Double] withDefaultValue 0.0\\n  for ((pi,(t,s)) <- aligns zip data) {\\n    for (ti <- t.tokens.indices; si <- s.tokens.indices) {\\n      alpha(s.tokens(si).word,t.tokens(ti).word) += pi(si)(ti) \\n      alphaNorm(t.tokens(ti).word) += pi(si)(ti) \\n      beta(ti,si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n      betaNorm(si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n    }  \\n  }                 \\n  Model(\\n    alpha.toMap map {case ((s,t),p) => ((s,t), p / alphaNorm(t))} withDefaultValue 0.0,\\n    beta.toMap map {case ((ti,si,ls,lt),p) => ((ti,si,ls,lt),p / betaNorm(si,ls,lt))} withDefaultValue 0.0)    \\n}\\n\",\"val theta1 = mStep(alignments,trainM2)\\nbarChart(theta1.alpha.filter(_._1._2 == \\\"is\\\"))\",\"def change(a1:Seq[Align],a2:Seq[Align]) = {\\n  val flatA1 = a1.flatMap(_.flatten) \\n  val flatA2 = a2.flatMap(_.flatten)\\n  val diffs = (flatA1 zip flatA2) map {case(p1,p2) => math.abs(p1 - p2)}\\n  diffs.sum / flatA1.length\\n}\\ndef emModel1(init:Model, data:Seq[(Sentence,Sentence)], iterations:Int) = {\\n  var model = init\\n  var alignments = data.map(d => d._2.tokens.map(t => d._1.tokens.map(_ => 0.0)))\\n  for (_ <- 0 until iterations) yield {\\n    val old = alignments\\n    alignments = eStep(model, data)\\n    model = mStep(alignments, data).copy(beta = init.beta) \\n    (alignments,model,change(old,alignments))\\n  }                   \\n} \",\"val ibm1Iterations = emModel1(init, trainM2, 100)\\nval xyData = ibm1Iterations.indices.map(_.toDouble) -> ibm1Iterations.map(_._3) \\nlineplot(xyData)  \",\"barChart(ibm1Iterations.last._2.alpha.filter(_._1._2 == \\\"house\\\")) \",\"Renderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, ibm1Iterations.last._1(0))\",\"def emModel2(init:Model, data:Seq[(Sentence,Sentence)], iterations:Int) = {\\n  var model = init\\n  var alignments = data.map(d => d._2.tokens.map(t => d._1.tokens.map(_ => 0.0)))\\n  for (_ <- 0 until iterations) yield {\\n    val old = alignments\\n    alignments = eStep(model, data)\\n    model = mStep(alignments, data)\\n    (alignments,model,change(old,alignments))\\n  }                   \\n} \",\"val ibm1 = ibm1Iterations.last._2\\nval ibm2Iterations = emModel2(ibm1, trainM2, 100)\\nval ibm2 = ibm2Iterations.last._2\\nbarChart(ibm2.alpha.filter(_._1._2 == \\\"house\\\")) \",\"val ibm2Alignments = ibm2Iterations.last._1\\nRenderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, ibm2Alignments(0))   \",\"def distort(si:Int) = for (ti <- 0 until 5) yield ti -> ibm2.beta(ti,si,5,4) \\nbarChart(distort(0), color = Some(\\\"#fc0\\\"))\",\"case class Hypothesis(target:List[String], align:Map[Int,Int], remaining:Set[Int],\\n                      score:Double, parent:Option[Hypothesis]= None)\\n\\ntype Beam = List[Hypothesis]\\n \\ndef decodeModel2(tm:Model, lm:LanguageModel, \\n                 source:IndexedSeq[String], beamSize:Int) = {\\n  \\n  def score(hyp:Hypothesis,newTarget:String,sourceIndex:Int) = {\\n    val targetLength = source.length + 1\\n    val history = hyp.target.take(lm.order - 1).reverse\\n    val lmProb = math.log(lm.probability(newTarget,history:_*))\\n    val tmProb = math.log(tm.alpha((source(sourceIndex),newTarget))) + math.log(tm.beta((hyp.target .length, sourceIndex, targetLength, source.length)))\\n    lmProb + tmProb\\n  }\\n  def append(hyp:Hypothesis) = { for (sourceIndex <- hyp.remaining; targetWord <- lm.vocab) yield \\n    Hypothesis(targetWord :: hyp.target, \\n               hyp.align + (sourceIndex -> hyp.target.length), \\n               hyp.remaining - sourceIndex, \\n               hyp.score + score(hyp,targetWord,sourceIndex), \\n               Some(hyp))} \\n  \\n  var beam:Beam = List(Hypothesis(List(\\\"NULL\\\"), Map.empty, source.indices.toSet,  0.0))    \\n  var history:List[Beam] = List(beam) \\n  while (beam.head.remaining.nonEmpty) {\\n    val withNewTarget = beam.flatMap(hyp => append(hyp)).distinct\\n    beam = withNewTarget.sortBy(-_.score).take(beamSize).toList\\n    history ::= beam\\n  }  \\n  history.map(_.map(h => h.copy(target = h.target.reverse))).reverse\\n} \",\"def toStringSeq(hyp:Hypothesis,source:IndexedSeq[String]) = \\n  Seq(hyp.target.mkString(\\\" \\\"), source.indices.map(i => if (hyp.remaining(i)) \\\"_\\\" else source(i)).mkString(\\\" \\\"), hyp.remaining.size, hyp.score)    \\n  \\ndef renderBeam(beam:Beam, source:IndexedSeq[String]) = \\n  table(beam.map(toStringSeq(_,source)))\\n\\ndef renderHistory(hist:List[Beam], source:IndexedSeq[String]) = \\n  table(hist.flatMap(_.map(toStringSeq(_,source))))\\n\\n//renderBeam(List(Hypothesis(List(\\\"NULL\\\"), Map.empty, source.indices.toSet,  0.0)),source)    \"]"}};
        var id = 45;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"<div class=\"newslide\"></div>\nThere are currently two contenders for the most likely translation. This is because the translation model is uncertain about the translation of \"groß\" which can be \"tall\" in the context of the height of humans, and \"big\" in most other settings. To avoid this uncertainty we can use a language model to capture the fact that \"man is big\" is a little less likely than \"man is tall\". <span class=\"summary\">We can reduce ambiguity by using a better *language model*</span>","extraFields":{}};
        var id = 46;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'scala';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"val lmTrainSet = trainM2.flatMap(_._1.tokens.map(_.word))\nval lm2 = LaplaceLM(NGramLM(lmTrainSet.toIndexedSeq, 3),0.1)\nval hist2 = decodeModel2(ibm2,lm2, source, 2)\nrenderHistory(hist2.take(5),source) \n//lm2.probability(\"tall\", \"man\", \"is\") ","extraFields":{"aggregatedCells":"[\"val train = Seq(\\n  \\\"the house is small\\\" -> \\\"das Haus ist klein\\\",\\n  \\\"the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"a man is tall\\\" -> \\\"ein Mann ist groß\\\",\\n  \\\"my house is small\\\" -> \\\"klein ist mein Haus\\\"\\n) map (p => segment(p._1).sentences.head -> segment(p._2).sentences.head)\\ntrain.size \",\"import scala.collection.mutable.HashMap\\ncase class Param(src:String, tgt: String, prob: Double)\\ntype NaiveModel = Seq[Param]\\ndef learn(data:Seq[(Sentence,Sentence)]):NaiveModel = {\\n  //data structures to store counts in nominator and denominator\\n  val norm = new HashMap[String,Double] withDefaultValue 0.0\\n  val counts = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  //do the counting\\n  for ((target,source) <- data) {\\n    for (i <- 0 until target.tokens.length) {\\n      norm(target.tokens(i).word) += 1.0\\n      counts(source.tokens(i).word -> target.tokens(i).word) += 1.0\\n    }    \\n  }\\n  //convert the map to a sequence of parameters\\n  counts.toSeq map {case ((source,target),count) => Param(source,target,count/norm(target)) }\\n} \",\"val model = learn(train)\\nbarChart(model map (p => (p.src,p.tgt) -> p.prob) filter (_._1._2 == \\\"is\\\")) \",\"import uk.ac.ucl.cs.mr.statnlpbook.chapter.languagemodels._\\n\\ndef decode(source:Sentence, model:NaiveModel, lm:LanguageModel) = {\\n  //create a mapping from source words to relevant parameters\\n  val source2targets = model groupBy (_.src) \\n  def translate(token:Token) = {\\n    val candidates:Seq[Param] = source2targets(token.word)\\n    val scoredByLM = candidates map (p => p.copy(prob = p.prob * lm.probability(p.tgt)))\\n    scoredByLM.maxBy(_.prob).tgt\\n  }\\n  //translate word-by-word (for which LM does this work?)\\n  val words = source.tokens map translate\\n  Document(IndexedSeq(words))\\n}\\nval source = train(1)._2 //\\\"klein ist das Haus\\\"\\nval lm = UniformLM(model.map(_.tgt).toSet)\\nval target = decode(source, model, lm) \\ntarget.toText \",\"val target = segment(\\\"NULL the house is small\\\").sentences(0)\\nval source = segment(\\\"klein ist das Haus\\\").sentences(0)\\nRenderer.renderAlignment(target,source,Seq(1->2,2->3,3->1,4->0))\",\"val target2 = segment(\\\"NULL 家 わ 小さいい です\\\").sentences(0)\\nval source2 = segment(\\\"The house is small\\\").sentences(0)\\nRenderer.renderAlignment(target2,source2,Seq(0 -> 0, 1 -> 1, 3 -> 3, 4 -> 2))\",\"val trainM2 = Seq(\\n  \\\"NULL the house is small\\\" -> \\\"klein ist das Haus\\\",\\n  \\\"NULL a man is tall\\\" -> \\\"groß ist ein Mann\\\",\\n  \\\"NULL my house is small\\\" -> \\\"klein ist mein Haus\\\",\\n  \\\"NULL the building is big\\\" -> \\\"groß ist das Gebäude\\\",\\n  \\\"NULL the building is long\\\" -> \\\"lang ist das Gebäude\\\"\\n) map (p => segment(p _1).sentences.head -> segment(p _2).sentences.head) \",\"//Each element in the sequence corresponds to one source token,\\n//and each element in the nested sequence to a target token.\\ntype Align = IndexedSeq[IndexedSeq[Double]]\\n\\n//Model parameters\\ncase class Model(\\n  alpha:Map[(String,String),Double],\\n  beta:Map[(Int,Int,Int,Int),Double]) \\n\\n//normalizing a distribution\\ndef norm(v:IndexedSeq[Double]) = { val s = v.sum; v map (_ / s) } \\n\\n//estimate new soft alignments\\ndef eStep(model:Model, data:Seq[(Sentence,Sentence)]):Seq[Align] = {\\n  for ((target,source) <- data) yield {\\n    def score(si:Int, ti:Int) = \\n      model.alpha(source.tokens(si).word,target.tokens(ti).word) * \\n      model.beta(ti,si,target.tokens.length, source.tokens.length)\\n    for (si <- source.tokens.indices) yield \\n      norm(for (ti <- target.tokens.indices) yield score(si,ti))\\n  }\\n}\",\"val sourceVocab = trainM2.flatMap(_._2.tokens.map(_.word)).toSet \\nval init = Model(\\n    Map.empty withDefaultValue (1.0 / sourceVocab.size),\\n    Map.empty withDefault {case (ti,si,lt,ls) => 1.0 / lt })\\n\\nval alignments = eStep(init,trainM2) \\nRenderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, alignments(0))\",\"def mStep(aligns:Seq[Align],data:Seq[(Sentence,Sentence)]) = {\\n  val alpha = new HashMap[(String,String),Double] withDefaultValue 0.0\\n  val alphaNorm = new HashMap[String,Double] withDefaultValue 0.0\\n  val beta = new HashMap[(Int,Int,Int,Int),Double] withDefaultValue 0.0\\n  val betaNorm = new HashMap[(Int,Int,Int),Double] withDefaultValue 0.0\\n  for ((pi,(t,s)) <- aligns zip data) {\\n    for (ti <- t.tokens.indices; si <- s.tokens.indices) {\\n      alpha(s.tokens(si).word,t.tokens(ti).word) += pi(si)(ti) \\n      alphaNorm(t.tokens(ti).word) += pi(si)(ti) \\n      beta(ti,si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n      betaNorm(si,t.tokens.length,s.tokens.length) += pi(si)(ti)\\n    }  \\n  }                 \\n  Model(\\n    alpha.toMap map {case ((s,t),p) => ((s,t), p / alphaNorm(t))} withDefaultValue 0.0,\\n    beta.toMap map {case ((ti,si,ls,lt),p) => ((ti,si,ls,lt),p / betaNorm(si,ls,lt))} withDefaultValue 0.0)    \\n}\\n\",\"val theta1 = mStep(alignments,trainM2)\\nbarChart(theta1.alpha.filter(_._1._2 == \\\"is\\\"))\",\"def change(a1:Seq[Align],a2:Seq[Align]) = {\\n  val flatA1 = a1.flatMap(_.flatten) \\n  val flatA2 = a2.flatMap(_.flatten)\\n  val diffs = (flatA1 zip flatA2) map {case(p1,p2) => math.abs(p1 - p2)}\\n  diffs.sum / flatA1.length\\n}\\ndef emModel1(init:Model, data:Seq[(Sentence,Sentence)], iterations:Int) = {\\n  var model = init\\n  var alignments = data.map(d => d._2.tokens.map(t => d._1.tokens.map(_ => 0.0)))\\n  for (_ <- 0 until iterations) yield {\\n    val old = alignments\\n    alignments = eStep(model, data)\\n    model = mStep(alignments, data).copy(beta = init.beta) \\n    (alignments,model,change(old,alignments))\\n  }                   \\n} \",\"val ibm1Iterations = emModel1(init, trainM2, 100)\\nval xyData = ibm1Iterations.indices.map(_.toDouble) -> ibm1Iterations.map(_._3) \\nlineplot(xyData)  \",\"barChart(ibm1Iterations.last._2.alpha.filter(_._1._2 == \\\"house\\\")) \",\"Renderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, ibm1Iterations.last._1(0))\",\"def emModel2(init:Model, data:Seq[(Sentence,Sentence)], iterations:Int) = {\\n  var model = init\\n  var alignments = data.map(d => d._2.tokens.map(t => d._1.tokens.map(_ => 0.0)))\\n  for (_ <- 0 until iterations) yield {\\n    val old = alignments\\n    alignments = eStep(model, data)\\n    model = mStep(alignments, data)\\n    (alignments,model,change(old,alignments))\\n  }                   \\n} \",\"val ibm1 = ibm1Iterations.last._2\\nval ibm2Iterations = emModel2(ibm1, trainM2, 100)\\nval ibm2 = ibm2Iterations.last._2\\nbarChart(ibm2.alpha.filter(_._1._2 == \\\"house\\\")) \",\"val ibm2Alignments = ibm2Iterations.last._1\\nRenderer.renderWeightedAlignment(trainM2(0)._1, trainM2(0)._2, ibm2Alignments(0))   \",\"def distort(si:Int) = for (ti <- 0 until 5) yield ti -> ibm2.beta(ti,si,5,4) \\nbarChart(distort(0), color = Some(\\\"#fc0\\\"))\",\"case class Hypothesis(target:List[String], align:Map[Int,Int], remaining:Set[Int],\\n                      score:Double, parent:Option[Hypothesis]= None)\\n\\ntype Beam = List[Hypothesis]\\n \\ndef decodeModel2(tm:Model, lm:LanguageModel, \\n                 source:IndexedSeq[String], beamSize:Int) = {\\n  \\n  def score(hyp:Hypothesis,newTarget:String,sourceIndex:Int) = {\\n    val targetLength = source.length + 1\\n    val history = hyp.target.take(lm.order - 1).reverse\\n    val lmProb = math.log(lm.probability(newTarget,history:_*))\\n    val tmProb = math.log(tm.alpha((source(sourceIndex),newTarget))) + math.log(tm.beta((hyp.target .length, sourceIndex, targetLength, source.length)))\\n    lmProb + tmProb\\n  }\\n  def append(hyp:Hypothesis) = { for (sourceIndex <- hyp.remaining; targetWord <- lm.vocab) yield \\n    Hypothesis(targetWord :: hyp.target, \\n               hyp.align + (sourceIndex -> hyp.target.length), \\n               hyp.remaining - sourceIndex, \\n               hyp.score + score(hyp,targetWord,sourceIndex), \\n               Some(hyp))} \\n  \\n  var beam:Beam = List(Hypothesis(List(\\\"NULL\\\"), Map.empty, source.indices.toSet,  0.0))    \\n  var history:List[Beam] = List(beam) \\n  while (beam.head.remaining.nonEmpty) {\\n    val withNewTarget = beam.flatMap(hyp => append(hyp)).distinct\\n    beam = withNewTarget.sortBy(-_.score).take(beamSize).toList\\n    history ::= beam\\n  }  \\n  history.map(_.map(h => h.copy(target = h.target.reverse))).reverse\\n} \",\"def toStringSeq(hyp:Hypothesis,source:IndexedSeq[String]) = \\n  Seq(hyp.target.mkString(\\\" \\\"), source.indices.map(i => if (hyp.remaining(i)) \\\"_\\\" else source(i)).mkString(\\\" \\\"), hyp.remaining.size, hyp.score)    \\n  \\ndef renderBeam(beam:Beam, source:IndexedSeq[String]) = \\n  table(beam.map(toStringSeq(_,source)))\\n\\ndef renderHistory(hist:List[Beam], source:IndexedSeq[String]) = \\n  table(hist.flatMap(_.map(toStringSeq(_,source))))\\n\\n//renderBeam(List(Hypothesis(List(\\\"NULL\\\"), Map.empty, source.indices.toSet,  0.0)),source)    \",\"val source = Vector(\\\"groß\\\", \\\"ist\\\", \\\"ein\\\", \\\"Mann\\\")\\nval targetVocab = trainM2.flatMap(_._1.tokens.map(_.word)).toSet\\nval lm = UniformLM(targetVocab - \\\"NULL\\\")\\nval hist = decodeModel2(ibm2,lm, source, 2)\\nrenderHistory(hist.take(5),source)  \\n//ibm2.alpha.filter(_._1._1 == \\\"klein\\\")          \"]"}};
        var id = 47;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
        var mode = 'markdown';
        if(mode == 'wolfe') mode = 'scala';
        var input = {"sessionId":null,"code":"Note that \"a man is tall\" is also more likely in the [Google N-grams corpus](https://books.google.com/ngrams/graph?content=a+man+is+tall%2C+a+man+is+big&year_start=1800&year_end=2000&corpus=15&smoothing=3&share=&direct_url=t1%3B%2Ca%20man%20is%20tall%3B%2Cc0%3B.t1%3B%2Ca%20man%20is%20big%3B%2Cc0).\n\n<div class=\"newslide\"></div>\n### Summary\nThere are a few high level messages to take away from this chapter.\n\n* MT is an instance structured prediction recipe\n* The noisy channel is one modeling framework\n* word-based MT is foundation and blue print for more complex models\n* Training with EM\n* NLP Tricks: \n    * introducing latent alignment variables to simplify problem\n    * decoding with Beams\n\n### Background Material\n* [Lecture notes on IBM Model 1 and 2](http://www.cs.columbia.edu/~mcollins/courses/nlp2011/notes/ibm12.pdf) of Mike Collins.  \n* Jurafsky & Martin, Speech and Language Processing: \n    * Chapter 26, Machine Translation.\n    * Chapter 6, EM Algorithm\n\n\n\n","extraFields":{}};
        var id = 48;
        createStaticCellHTML(id, divCells, doc, mode, input, compilers);
    
    compileAll(doc,compilers);
    enableAceScalaCompletion();
</script>

            </div>
        </section>
        <script>

           $(function() {
             console.log("Removing slide-only content");
             window.setTimeout(function() {
               console.log($(".slide-start"));
               console.log($('.slide-start').nextUntil('.slide-end').andSelf());
               $('.slide-start').nextUntil('.slide-end').andSelf().remove();
             },1000);
           });
        </script>
    


<div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; padding: 0px; border: 0px; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: bold; font-style: italic; font-family: STIXGeneral, sans-serif;"></div></div></body></html>